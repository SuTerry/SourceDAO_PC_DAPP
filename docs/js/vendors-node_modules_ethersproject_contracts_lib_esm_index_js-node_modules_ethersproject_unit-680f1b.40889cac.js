/*! For license information please see vendors-node_modules_ethersproject_contracts_lib_esm_index_js-node_modules_ethersproject_unit-680f1b.40889cac.js.LICENSE.txt */
(self.webpackChunksourcedao_pc_dapp=self.webpackChunksourcedao_pc_dapp||[]).push([["vendors-node_modules_ethersproject_contracts_lib_esm_index_js-node_modules_ethersproject_unit-680f1b"],{12200:(e,t,r)=>{"use strict";var n=r(82784);const s="undefined"!=typeof BigUint64Array,i=Symbol(),o=1024;function a(e,t){const r=new Uint32Array(e),n=new Uint16Array(e);var s=r[t+-4>>>2]>>>1,i=t>>>1;if(s<=o)return String.fromCharCode.apply(String,n.subarray(i,i+s));const a=[];do{const e=n[i+o-1],t=e>=55296&&e<56320?1023:o;a.push(String.fromCharCode.apply(String,n.subarray(i,i+=t))),s-=t}while(s>o);return a.join("")+String.fromCharCode.apply(String,n.subarray(i,i+s))}function c(e){const t={};function r(e,t){return e?a(e.buffer,t):"<yet unknown>"}const s=e.env=e.env||{};return s.abort=s.abort||function(e,n,i,o){const a=t.memory||s.memory;throw Error("abort: "+r(a,e)+" at "+r(a,n)+":"+i+":"+o)},s.trace=s.trace||function(e,i){const o=t.memory||s.memory;n.log("trace: "+r(o,e)+(i?" ":"")+Array.prototype.slice.call(arguments,2,2+i).join(", "))},e.Math=e.Math||Math,e.Date=e.Date||Date,t}function l(e,t){const r=t.exports,n=r.memory,i=r.table,o=r.__alloc,c=r.__retain,l=r.__rtti_base||-1;function h(e){const t=new Uint32Array(n.buffer);if((e>>>=0)>=t[l>>>2])throw Error("invalid id: "+e);return t[(l+4>>>2)+2*e]}function u(e){const t=new Uint32Array(n.buffer);if((e>>>=0)>=t[l>>>2])throw Error("invalid id: "+e);return t[(l+4>>>2)+2*e+1]}function d(e){return 31-Math.clz32(e>>>5&31)}function f(e,t,r){const s=n.buffer;if(r)switch(e){case 2:return new Float32Array(s);case 3:return new Float64Array(s)}else switch(e){case 0:return new(t?Int8Array:Uint8Array)(s);case 1:return new(t?Int16Array:Uint16Array)(s);case 2:return new(t?Int32Array:Uint32Array)(s);case 3:return new(t?BigInt64Array:BigUint64Array)(s)}throw Error("unsupported align: "+e)}function y(e){const t=new Uint32Array(n.buffer),r=t[e+-8>>>2],s=h(r);if(!(1&s))throw Error("not an array: "+r);const i=d(s);var o=t[e+4>>>2];const a=2&s?t[e+12>>>2]:t[o+-4>>>2]>>>i;return f(i,1024&s,2048&s).subarray(o>>>=i,o+a)}function g(e,t,r){return new e(m(e,t,r))}function m(e,t,r){const s=n.buffer,i=new Uint32Array(s),o=i[r+4>>>2];return new e(s,o,i[o+-4>>>2]>>>t)}return e.__allocString=function(e){const t=e.length,r=o(t<<1,1),s=new Uint16Array(n.buffer);for(var i=0,a=r>>>1;i<t;++i)s[a+i]=e.charCodeAt(i);return r},e.__getString=function(e){const t=n.buffer;if(1!==new Uint32Array(t)[e+-8>>>2])throw Error("not a string: "+e);return a(t,e)},e.__allocArray=function(e,t){const r=h(e);if(!(3&r))throw Error("not an array: "+e+" @ "+r);const s=d(r),i=t.length,a=o(i<<s,0),l=o(2&r?16:12,e),u=new Uint32Array(n.buffer);u[l+0>>>2]=c(a),u[l+4>>>2]=a,u[l+8>>>2]=i<<s,2&r&&(u[l+12>>>2]=i);const p=f(s,1024&r,2048&r);if(8192&r)for(let e=0;e<i;++e)p[(a>>>s)+e]=c(t[e]);else p.set(t,a>>>s);return l},e.__getArrayView=y,e.__getArray=function(e){const t=y(e),r=t.length,n=new Array(r);for(let e=0;e<r;e++)n[e]=t[e];return n},e.__getArrayBuffer=function(e){const t=n.buffer,r=new Uint32Array(t)[e+-4>>>2];return t.slice(e,e+r)},e.__getInt8Array=g.bind(null,Int8Array,0),e.__getInt8ArrayView=m.bind(null,Int8Array,0),e.__getUint8Array=g.bind(null,Uint8Array,0),e.__getUint8ArrayView=m.bind(null,Uint8Array,0),e.__getUint8ClampedArray=g.bind(null,Uint8ClampedArray,0),e.__getUint8ClampedArrayView=m.bind(null,Uint8ClampedArray,0),e.__getInt16Array=g.bind(null,Int16Array,1),e.__getInt16ArrayView=m.bind(null,Int16Array,1),e.__getUint16Array=g.bind(null,Uint16Array,1),e.__getUint16ArrayView=m.bind(null,Uint16Array,1),e.__getInt32Array=g.bind(null,Int32Array,2),e.__getInt32ArrayView=m.bind(null,Int32Array,2),e.__getUint32Array=g.bind(null,Uint32Array,2),e.__getUint32ArrayView=m.bind(null,Uint32Array,2),s&&(e.__getInt64Array=g.bind(null,BigInt64Array,3),e.__getInt64ArrayView=m.bind(null,BigInt64Array,3),e.__getUint64Array=g.bind(null,BigUint64Array,3),e.__getUint64ArrayView=m.bind(null,BigUint64Array,3)),e.__getFloat32Array=g.bind(null,Float32Array,2),e.__getFloat32ArrayView=m.bind(null,Float32Array,2),e.__getFloat64Array=g.bind(null,Float64Array,3),e.__getFloat64ArrayView=m.bind(null,Float64Array,3),e.__instanceof=function(e,t){const r=new Uint32Array(n.buffer);var s=r[e+-8>>>2];if(s<=r[l>>>2])do{if(s==t)return!0}while(s=u(s));return!1},e.memory=e.memory||n,e.table=e.table||i,p(r,e)}function h(e){return"undefined"!=typeof Response&&e instanceof Response}async function u(e,t){return h(e=await e)?d(e,t):l(c(t||(t={})),await WebAssembly.instantiate(e instanceof WebAssembly.Module?e:await WebAssembly.compile(e),t))}async function d(e,t){return WebAssembly.instantiateStreaming?l(c(t||(t={})),(await WebAssembly.instantiateStreaming(e,t)).instance):u(h(e=await e)?e.arrayBuffer():e,t)}function p(e,t){var r=t?Object.create(t):{},n=e.__argumentsLength?function(t){e.__argumentsLength.value=t}:e.__setArgumentsLength||e.__setargc||function(){};for(let t in e){if(!Object.prototype.hasOwnProperty.call(e,t))continue;const s=e[t];let o=t.split("."),a=r;for(;o.length>1;){let e=o.shift();Object.prototype.hasOwnProperty.call(a,e)||(a[e]={}),a=a[e]}let c=o[0],l=c.indexOf("#");if(l>=0){let r=c.substring(0,l),o=a[r];if(void 0===o||!o.prototype){let e=function(...t){return e.wrap(e.prototype.constructor(0,...t))};e.prototype={valueOf:function(){return this[i]}},e.wrap=function(t){return Object.create(e.prototype,{[i]:{value:t,writable:!1}})},o&&Object.getOwnPropertyNames(o).forEach((t=>Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t)))),a[r]=e}if(c=c.substring(l+1),a=a[r].prototype,/^(get|set):/.test(c)){if(!Object.prototype.hasOwnProperty.call(a,c=c.substring(4))){let r=e[t.replace("set:","get:")],n=e[t.replace("get:","set:")];Object.defineProperty(a,c,{get:function(){return r(this[i])},set:function(e){n(this[i],e)},enumerable:!0})}}else"constructor"===c?(a[c]=(...e)=>(n(e.length),s(...e))).original=s:(a[c]=function(...e){return n(e.length),s(this[i],...e)}).original=s}else/^(get|set):/.test(c)?Object.prototype.hasOwnProperty.call(a,c=c.substring(4))||Object.defineProperty(a,c,{get:e[t.replace("set:","get:")],set:e[t.replace("get:","set:")],enumerable:!0}):"function"==typeof s&&s!==n?(a[c]=(...e)=>(n(e.length),s(...e))).original=s:a[c]=s}return r}t.instantiate=u,t.instantiateSync=function(e,t){return l(c(t||(t={})),new WebAssembly.Instance(e instanceof WebAssembly.Module?e:new WebAssembly.Module(e),t))},t.instantiateStreaming=d,t.demangle=p},43161:(e,t,r)=>{"use strict";e.exports=r(7758)},7758:(e,t,r)=>{"use strict";var n=t;function s(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(14640),n.BufferWriter=r(39429),n.Reader=r(69375),n.BufferReader=r(12626),n.util=r(42427),n.rpc=r(68029),n.roots=r(88346),n.configure=s,s()},69375:(e,t,r)=>{"use strict";e.exports=c;var n,s=r(42427),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var l,h="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},u=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new n(e):h(e)})(e)}:h};function d(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new i(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}c.create=u(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return l}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){n=e,c.create=u(),n._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},12626:(e,t,r)=>{"use strict";e.exports=i;var n=r(69375);(i.prototype=Object.create(n.prototype)).constructor=i;var s=r(42427);function i(e){n.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},88346:e=>{"use strict";e.exports={}},68029:(e,t,r)=>{"use strict";t.Service=r(6830)},6830:(e,t,r)=>{"use strict";e.exports=s;var n=r(42427);function s(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(s.prototype=Object.create(n.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function e(t,r,s,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return n.asPromise(e,a,t,r,s,i);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,r){if(e)return a.emit("error",e,t),o(e);if(null!==r){if(!(r instanceof s))try{r=s[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",r,t),o(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},25212:(e,t,r)=>{"use strict";e.exports=s;var n=r(42427);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new s(r,n)},s.from=function(e){if("number"==typeof e)return s.fromNumber(e);if(n.isString(e)){if(!n.Long)return s.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},42427:function(e,t,r){"use strict";var n=t;function s(e,t,r){for(var n=Object.keys(t),s=0;s<n.length;++s)void 0!==e[n[s]]&&r||(e[n[s]]=t[n[s]]);return e}function i(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&s(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=r(12835),n.base64=r(82968),n.EventEmitter=r(25560),n.float=r(14278),n.inquire=r(33149),n.utf8=r(48301),n.pool=r(66765),n.LongBits=r(25212),n.isNode=Boolean(void 0!==r.g&&r.g&&r.g.process&&r.g.process.versions&&r.g.process.versions.node),n.global=n.isNode&&r.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=s,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}},14640:(e,t,r)=>{"use strict";e.exports=u;var n,s=r(42427),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function l(){}function h(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function u(){this.len=0,this.head=new c(l,0,0),this.tail=this.head,this.states=null}var d=function(){return s.Buffer?function(){return(u.create=function(){return new n})()}:function(){return new u}};function p(e,t,r){t[r]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function g(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}u.create=d(),u.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(u.alloc=s.pool(u.alloc,s.Array.prototype.subarray)),u.prototype._push=function(e,t,r){return this.tail=this.tail.next=new c(e,t,r),this.len+=t,this},f.prototype=Object.create(c.prototype),f.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},u.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},u.prototype.int32=function(e){return e<0?this._push(y,10,i.fromNumber(e)):this.uint32(e)},u.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},u.prototype.uint64=function(e){var t=i.from(e);return this._push(y,t.length(),t)},u.prototype.int64=u.prototype.uint64,u.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(y,t.length(),t)},u.prototype.bool=function(e){return this._push(p,1,e?1:0)},u.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},u.prototype.sfixed32=u.prototype.fixed32,u.prototype.fixed64=function(e){var t=i.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},u.prototype.sfixed64=u.prototype.fixed64,u.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},u.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var m=s.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};u.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(s.isString(e)){var r=u.alloc(t=o.length(e));o.decode(e,r,0),e=r}return this.uint32(t)._push(m,t,e)},u.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},u.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new c(l,0,0),this.len=0,this},u.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(l,0,0),this.len=0),this},u.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},u.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},u._configure=function(e){n=e,u.create=d(),n._configure()}},39429:(e,t,r)=>{"use strict";e.exports=i;var n=r(14640);(i.prototype=Object.create(n.prototype)).constructor=i;var s=r(42427);function i(){n.call(this)}function o(e,t,r){e.length<40?s.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},71343:(e,t,r)=>{"use strict";r.d(t,{CH:()=>Ce});var n=r(50864),s=r(66661),i=r(61118),o=r(33811);const a="abi/5.7.0",c=new o.Yd(a);class l{constructor(e,t,r,n){this.name=e,this.type=t,this.localName=r,this.dynamic=n}_throwError(e,t){c.throwArgumentError(e,this.localName,t)}}class h{constructor(e){(0,i.zG)(this,"wordSize",e||32),this._data=[],this._dataLength=0,this._padding=new Uint8Array(e)}get data(){return(0,n.xs)(this._data)}get length(){return this._dataLength}_writeData(e){return this._data.push(e),this._dataLength+=e.length,e.length}appendWriter(e){return this._writeData((0,n.zo)(e._data))}writeBytes(e){let t=(0,n.lE)(e);const r=t.length%this.wordSize;return r&&(t=(0,n.zo)([t,this._padding.slice(r)])),this._writeData(t)}_getValue(e){let t=(0,n.lE)(s.O$.from(e));return t.length>this.wordSize&&c.throwError("value out-of-bounds",o.Yd.errors.BUFFER_OVERRUN,{length:this.wordSize,offset:t.length}),t.length%this.wordSize&&(t=(0,n.zo)([this._padding.slice(t.length%this.wordSize),t])),t}writeValue(e){return this._writeData(this._getValue(e))}writeUpdatableValue(){const e=this._data.length;return this._data.push(this._padding),this._dataLength+=this.wordSize,t=>{this._data[e]=this._getValue(t)}}}class u{constructor(e,t,r,s){(0,i.zG)(this,"_data",(0,n.lE)(e)),(0,i.zG)(this,"wordSize",t||32),(0,i.zG)(this,"_coerceFunc",r),(0,i.zG)(this,"allowLoose",s),this._offset=0}get data(){return(0,n.Dv)(this._data)}get consumed(){return this._offset}static coerce(e,t){let r=e.match("^u?int([0-9]+)$");return r&&parseInt(r[1])<=48&&(t=t.toNumber()),t}coerce(e,t){return this._coerceFunc?this._coerceFunc(e,t):u.coerce(e,t)}_peekBytes(e,t,r){let n=Math.ceil(t/this.wordSize)*this.wordSize;return this._offset+n>this._data.length&&(this.allowLoose&&r&&this._offset+t<=this._data.length?n=t:c.throwError("data out-of-bounds",o.Yd.errors.BUFFER_OVERRUN,{length:this._data.length,offset:this._offset+n})),this._data.slice(this._offset,this._offset+n)}subReader(e){return new u(this._data.slice(this._offset+e),this.wordSize,this._coerceFunc,this.allowLoose)}readBytes(e,t){let r=this._peekBytes(0,e,!!t);return this._offset+=r.length,r.slice(0,e)}readValue(){return s.O$.from(this.readBytes(this.wordSize))}}var d=r(2566),p=r(25211),f=r(71616);class y extends l{constructor(e){super("address","address",e,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(e,t){try{t=(0,d.Kn)(t)}catch(e){this._throwError(e.message,t)}return e.writeValue(t)}decode(e){return(0,d.Kn)((0,n.$m)(e.readValue().toHexString(),20))}}class g extends l{constructor(e){super(e.name,e.type,void 0,e.dynamic),this.coder=e}defaultValue(){return this.coder.defaultValue()}encode(e,t){return this.coder.encode(e,t)}decode(e){return this.coder.decode(e)}}const m=new o.Yd(a);function w(e,t,r){let n=null;if(Array.isArray(r))n=r;else if(r&&"object"==typeof r){let e={};n=t.map((t=>{const n=t.localName;return n||m.throwError("cannot encode object for signature with missing names",o.Yd.errors.INVALID_ARGUMENT,{argument:"values",coder:t,value:r}),e[n]&&m.throwError("cannot encode object for signature with duplicate names",o.Yd.errors.INVALID_ARGUMENT,{argument:"values",coder:t,value:r}),e[n]=!0,r[n]}))}else m.throwArgumentError("invalid tuple value","tuple",r);t.length!==n.length&&m.throwArgumentError("types/value length mismatch","tuple",r);let s=new h(e.wordSize),i=new h(e.wordSize),a=[];t.forEach(((e,t)=>{let r=n[t];if(e.dynamic){let t=i.length;e.encode(i,r);let n=s.writeUpdatableValue();a.push((e=>{n(e+t)}))}else e.encode(s,r)})),a.forEach((e=>{e(s.length)}));let c=e.appendWriter(s);return c+=e.appendWriter(i),c}function b(e,t){let r=[],n=e.subReader(0);t.forEach((t=>{let s=null;if(t.dynamic){let r=e.readValue(),i=n.subReader(r.toNumber());try{s=t.decode(i)}catch(e){if(e.code===o.Yd.errors.BUFFER_OVERRUN)throw e;s=e,s.baseType=t.name,s.name=t.localName,s.type=t.type}}else try{s=t.decode(e)}catch(e){if(e.code===o.Yd.errors.BUFFER_OVERRUN)throw e;s=e,s.baseType=t.name,s.name=t.localName,s.type=t.type}null!=s&&r.push(s)}));const s=t.reduce(((e,t)=>{const r=t.localName;return r&&(e[r]||(e[r]=0),e[r]++),e}),{});t.forEach(((e,t)=>{let n=e.localName;if(!n||1!==s[n])return;if("length"===n&&(n="_length"),null!=r[n])return;const i=r[t];i instanceof Error?Object.defineProperty(r,n,{enumerable:!0,get:()=>{throw i}}):r[n]=i}));for(let e=0;e<r.length;e++){const t=r[e];t instanceof Error&&Object.defineProperty(r,e,{enumerable:!0,get:()=>{throw t}})}return Object.freeze(r)}class v extends l{constructor(e,t,r){super("array",e.type+"["+(t>=0?t:"")+"]",r,-1===t||e.dynamic),this.coder=e,this.length=t}defaultValue(){const e=this.coder.defaultValue(),t=[];for(let r=0;r<this.length;r++)t.push(e);return t}encode(e,t){Array.isArray(t)||this._throwError("expected array value",t);let r=this.length;-1===r&&(r=t.length,e.writeValue(t.length)),m.checkArgumentCount(t.length,r,"coder array"+(this.localName?" "+this.localName:""));let n=[];for(let e=0;e<t.length;e++)n.push(this.coder);return w(e,n,t)}decode(e){let t=this.length;-1===t&&(t=e.readValue().toNumber(),32*t>e._data.length&&m.throwError("insufficient data length",o.Yd.errors.BUFFER_OVERRUN,{length:e._data.length,count:t}));let r=[];for(let e=0;e<t;e++)r.push(new g(this.coder));return e.coerce(this.name,b(e,r))}}class E extends l{constructor(e){super("bool","bool",e,!1)}defaultValue(){return!1}encode(e,t){return e.writeValue(t?1:0)}decode(e){return e.coerce(this.type,!e.readValue().isZero())}}class _ extends l{constructor(e,t){super(e,e,t,!0)}defaultValue(){return"0x"}encode(e,t){t=(0,n.lE)(t);let r=e.writeValue(t.length);return r+=e.writeBytes(t),r}decode(e){return e.readBytes(e.readValue().toNumber(),!0)}}class S extends _{constructor(e){super("bytes",e)}decode(e){return e.coerce(this.name,(0,n.Dv)(super.decode(e)))}}class A extends l{constructor(e,t){let r="bytes"+String(e);super(r,r,t,!1),this.size=e}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+2*this.size)}encode(e,t){let r=(0,n.lE)(t);return r.length!==this.size&&this._throwError("incorrect data length",t),e.writeBytes(r)}decode(e){return e.coerce(this.name,(0,n.Dv)(e.readBytes(this.size)))}}class I extends l{constructor(e){super("null","",e,!1)}defaultValue(){return null}encode(e,t){return null!=t&&this._throwError("not null",t),e.writeBytes([])}decode(e){return e.readBytes(0),e.coerce(this.name,null)}}var R=r(48713);class k extends l{constructor(e,t,r){const n=(t?"int":"uint")+8*e;super(n,n,r,!1),this.size=e,this.signed=t}defaultValue(){return 0}encode(e,t){let r=s.O$.from(t),n=R.Bz.mask(8*e.wordSize);if(this.signed){let e=n.mask(8*this.size-1);(r.gt(e)||r.lt(e.add(R.fh).mul(R.tL)))&&this._throwError("value out-of-bounds",t)}else(r.lt(R._Y)||r.gt(n.mask(8*this.size)))&&this._throwError("value out-of-bounds",t);return r=r.toTwos(8*this.size).mask(8*this.size),this.signed&&(r=r.fromTwos(8*this.size).toTwos(8*e.wordSize)),e.writeValue(r)}decode(e){let t=e.readValue().mask(8*this.size);return this.signed&&(t=t.fromTwos(8*this.size)),e.coerce(this.name,t)}}var T=r(63478);class C extends _{constructor(e){super("string",e)}defaultValue(){return""}encode(e,t){return super.encode(e,(0,T.Y0)(t))}decode(e){return(0,T.ZN)(super.decode(e))}}class P extends l{constructor(e,t){let r=!1;const n=[];e.forEach((e=>{e.dynamic&&(r=!0),n.push(e.type)})),super("tuple","tuple("+n.join(",")+")",t,r),this.coders=e}defaultValue(){const e=[];this.coders.forEach((t=>{e.push(t.defaultValue())}));const t=this.coders.reduce(((e,t)=>{const r=t.localName;return r&&(e[r]||(e[r]=0),e[r]++),e}),{});return this.coders.forEach(((r,n)=>{let s=r.localName;s&&1===t[s]&&("length"===s&&(s="_length"),null==e[s]&&(e[s]=e[n]))})),Object.freeze(e)}encode(e,t){return w(e,this.coders,t)}decode(e){return e.coerce(this.name,b(e,this.coders))}}var N=r(82784);const D=new o.Yd(a),O={};let x={calldata:!0,memory:!0,storage:!0},L={calldata:!0,memory:!0};function B(e,t){if("bytes"===e||"string"===e){if(x[t])return!0}else if("address"===e){if("payable"===t)return!0}else if((e.indexOf("[")>=0||"tuple"===e)&&L[t])return!0;return(x[t]||"payable"===t)&&D.throwArgumentError("invalid modifier","name",t),!1}function M(e,t){for(let r in t)(0,i.zG)(e,r,t[r])}const U=Object.freeze({sighash:"sighash",minimal:"minimal",full:"full",json:"json"}),z=new RegExp(/^(.*)\[([0-9]*)\]$/);class V{constructor(e,t){e!==O&&D.throwError("use fromString",o.Yd.errors.UNSUPPORTED_OPERATION,{operation:"new ParamType()"}),M(this,t);let r=this.type.match(z);M(this,r?{arrayLength:parseInt(r[2]||"-1"),arrayChildren:V.fromObject({type:r[1],components:this.components}),baseType:"array"}:{arrayLength:null,arrayChildren:null,baseType:null!=this.components?"tuple":this.type}),this._isParamType=!0,Object.freeze(this)}format(e){if(e||(e=U.sighash),U[e]||D.throwArgumentError("invalid format type","format",e),e===U.json){let t={type:"tuple"===this.baseType?"tuple":this.type,name:this.name||void 0};return"boolean"==typeof this.indexed&&(t.indexed=this.indexed),this.components&&(t.components=this.components.map((t=>JSON.parse(t.format(e))))),JSON.stringify(t)}let t="";return"array"===this.baseType?(t+=this.arrayChildren.format(e),t+="["+(this.arrayLength<0?"":String(this.arrayLength))+"]"):"tuple"===this.baseType?(e!==U.sighash&&(t+=this.type),t+="("+this.components.map((t=>t.format(e))).join(e===U.full?", ":",")+")"):t+=this.type,e!==U.sighash&&(!0===this.indexed&&(t+=" indexed"),e===U.full&&this.name&&(t+=" "+this.name)),t}static from(e,t){return"string"==typeof e?V.fromString(e,t):V.fromObject(e)}static fromObject(e){return V.isParamType(e)?e:new V(O,{name:e.name||null,type:Q(e.type),indexed:null==e.indexed?null:!!e.indexed,components:e.components?e.components.map(V.fromObject):null})}static fromString(e,t){return r=function(e,t){let r=e;function n(t){D.throwArgumentError(`unexpected character at position ${t}`,"param",e)}function s(e){let r={type:"",name:"",parent:e,state:{allowType:!0}};return t&&(r.indexed=!1),r}e=e.replace(/\s/g," ");let i={type:"",name:"",state:{allowType:!0}},o=i;for(let r=0;r<e.length;r++){let i=e[r];switch(i){case"(":o.state.allowType&&""===o.type?o.type="tuple":o.state.allowParams||n(r),o.state.allowType=!1,o.type=Q(o.type),o.components=[s(o)],o=o.components[0];break;case")":delete o.state,"indexed"===o.name&&(t||n(r),o.indexed=!0,o.name=""),B(o.type,o.name)&&(o.name=""),o.type=Q(o.type);let e=o;o=o.parent,o||n(r),delete e.parent,o.state.allowParams=!1,o.state.allowName=!0,o.state.allowArray=!0;break;case",":delete o.state,"indexed"===o.name&&(t||n(r),o.indexed=!0,o.name=""),B(o.type,o.name)&&(o.name=""),o.type=Q(o.type);let a=s(o.parent);o.parent.components.push(a),delete o.parent,o=a;break;case" ":o.state.allowType&&""!==o.type&&(o.type=Q(o.type),delete o.state.allowType,o.state.allowName=!0,o.state.allowParams=!0),o.state.allowName&&""!==o.name&&("indexed"===o.name?(t||n(r),o.indexed&&n(r),o.indexed=!0,o.name=""):B(o.type,o.name)?o.name="":o.state.allowName=!1);break;case"[":o.state.allowArray||n(r),o.type+=i,o.state.allowArray=!1,o.state.allowName=!1,o.state.readArray=!0;break;case"]":o.state.readArray||n(r),o.type+=i,o.state.readArray=!1,o.state.allowArray=!0,o.state.allowName=!0;break;default:o.state.allowType?(o.type+=i,o.state.allowParams=!0,o.state.allowArray=!0):o.state.allowName?(o.name+=i,delete o.state.allowArray):o.state.readArray?o.type+=i:n(r)}}return o.parent&&D.throwArgumentError("unexpected eof","param",e),delete i.state,"indexed"===o.name?(t||n(r.length-7),o.indexed&&n(r.length-7),o.indexed=!0,o.name=""):B(o.type,o.name)&&(o.name=""),i.type=Q(i.type),i}(e,!!t),V.fromObject({name:r.name,type:r.type,indexed:r.indexed,components:r.components});var r}static isParamType(e){return!(null==e||!e._isParamType)}}function F(e,t){return function(e){e=e.trim();let t=[],r="",n=0;for(let s=0;s<e.length;s++){let i=e[s];","===i&&0===n?(t.push(r),r=""):(r+=i,"("===i?n++:")"===i&&(n--,-1===n&&D.throwArgumentError("unbalanced parenthesis","value",e)))}return r&&t.push(r),t}(e).map((e=>V.fromString(e,t)))}class j{constructor(e,t){e!==O&&D.throwError("use a static from method",o.Yd.errors.UNSUPPORTED_OPERATION,{operation:"new Fragment()"}),M(this,t),this._isFragment=!0,Object.freeze(this)}static from(e){return j.isFragment(e)?e:"string"==typeof e?j.fromString(e):j.fromObject(e)}static fromObject(e){if(j.isFragment(e))return e;switch(e.type){case"function":return W.fromObject(e);case"event":return K.fromObject(e);case"constructor":return G.fromObject(e);case"error":return Z.fromObject(e);case"fallback":case"receive":return null}return D.throwArgumentError("invalid fragment object","value",e)}static fromString(e){return"event"===(e=(e=(e=e.replace(/\s/g," ")).replace(/\(/g," (").replace(/\)/g,") ").replace(/\s+/g," ")).trim()).split(" ")[0]?K.fromString(e.substring(5).trim()):"function"===e.split(" ")[0]?W.fromString(e.substring(8).trim()):"constructor"===e.split("(")[0].trim()?G.fromString(e.trim()):"error"===e.split(" ")[0]?Z.fromString(e.substring(5).trim()):D.throwArgumentError("unsupported fragment","value",e)}static isFragment(e){return!(!e||!e._isFragment)}}class K extends j{format(e){if(e||(e=U.sighash),U[e]||D.throwArgumentError("invalid format type","format",e),e===U.json)return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map((t=>JSON.parse(t.format(e))))});let t="";return e!==U.sighash&&(t+="event "),t+=this.name+"("+this.inputs.map((t=>t.format(e))).join(e===U.full?", ":",")+") ",e!==U.sighash&&this.anonymous&&(t+="anonymous "),t.trim()}static from(e){return"string"==typeof e?K.fromString(e):K.fromObject(e)}static fromObject(e){if(K.isEventFragment(e))return e;"event"!==e.type&&D.throwArgumentError("invalid event object","value",e);const t={name:X(e.name),anonymous:e.anonymous,inputs:e.inputs?e.inputs.map(V.fromObject):[],type:"event"};return new K(O,t)}static fromString(e){let t=e.match(ee);t||D.throwArgumentError("invalid event string","value",e);let r=!1;return t[3].split(" ").forEach((e=>{switch(e.trim()){case"anonymous":r=!0;break;case"":break;default:D.warn("unknown modifier: "+e)}})),K.fromObject({name:t[1].trim(),anonymous:r,inputs:F(t[2],!0),type:"event"})}static isEventFragment(e){return e&&e._isFragment&&"event"===e.type}}function $(e,t){t.gas=null;let r=e.split("@");return 1!==r.length?(r.length>2&&D.throwArgumentError("invalid human-readable ABI signature","value",e),r[1].match(/^[0-9]+$/)||D.throwArgumentError("invalid human-readable ABI signature gas","value",e),t.gas=s.O$.from(r[1]),r[0]):e}function H(e,t){t.constant=!1,t.payable=!1,t.stateMutability="nonpayable",e.split(" ").forEach((e=>{switch(e.trim()){case"constant":t.constant=!0;break;case"payable":t.payable=!0,t.stateMutability="payable";break;case"nonpayable":t.payable=!1,t.stateMutability="nonpayable";break;case"pure":t.constant=!0,t.stateMutability="pure";break;case"view":t.constant=!0,t.stateMutability="view";break;case"external":case"public":case"":break;default:N.log("unknown modifier: "+e)}}))}function q(e){let t={constant:!1,payable:!0,stateMutability:"payable"};return null!=e.stateMutability?(t.stateMutability=e.stateMutability,t.constant="view"===t.stateMutability||"pure"===t.stateMutability,null!=e.constant&&!!e.constant!==t.constant&&D.throwArgumentError("cannot have constant function with mutability "+t.stateMutability,"value",e),t.payable="payable"===t.stateMutability,null!=e.payable&&!!e.payable!==t.payable&&D.throwArgumentError("cannot have payable function with mutability "+t.stateMutability,"value",e)):null!=e.payable?(t.payable=!!e.payable,null!=e.constant||t.payable||"constructor"===e.type||D.throwArgumentError("unable to determine stateMutability","value",e),t.constant=!!e.constant,t.constant?t.stateMutability="view":t.stateMutability=t.payable?"payable":"nonpayable",t.payable&&t.constant&&D.throwArgumentError("cannot have constant payable function","value",e)):null!=e.constant?(t.constant=!!e.constant,t.payable=!t.constant,t.stateMutability=t.constant?"view":"payable"):"constructor"!==e.type&&D.throwArgumentError("unable to determine stateMutability","value",e),t}class G extends j{format(e){if(e||(e=U.sighash),U[e]||D.throwArgumentError("invalid format type","format",e),e===U.json)return JSON.stringify({type:"constructor",stateMutability:"nonpayable"!==this.stateMutability?this.stateMutability:void 0,payable:this.payable,gas:this.gas?this.gas.toNumber():void 0,inputs:this.inputs.map((t=>JSON.parse(t.format(e))))});e===U.sighash&&D.throwError("cannot format a constructor for sighash",o.Yd.errors.UNSUPPORTED_OPERATION,{operation:"format(sighash)"});let t="constructor("+this.inputs.map((t=>t.format(e))).join(e===U.full?", ":",")+") ";return this.stateMutability&&"nonpayable"!==this.stateMutability&&(t+=this.stateMutability+" "),t.trim()}static from(e){return"string"==typeof e?G.fromString(e):G.fromObject(e)}static fromObject(e){if(G.isConstructorFragment(e))return e;"constructor"!==e.type&&D.throwArgumentError("invalid constructor object","value",e);let t=q(e);t.constant&&D.throwArgumentError("constructor cannot be constant","value",e);const r={name:null,type:e.type,inputs:e.inputs?e.inputs.map(V.fromObject):[],payable:t.payable,stateMutability:t.stateMutability,gas:e.gas?s.O$.from(e.gas):null};return new G(O,r)}static fromString(e){let t={type:"constructor"},r=(e=$(e,t)).match(ee);return r&&"constructor"===r[1].trim()||D.throwArgumentError("invalid constructor string","value",e),t.inputs=F(r[2].trim(),!1),H(r[3].trim(),t),G.fromObject(t)}static isConstructorFragment(e){return e&&e._isFragment&&"constructor"===e.type}}class W extends G{format(e){if(e||(e=U.sighash),U[e]||D.throwArgumentError("invalid format type","format",e),e===U.json)return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:"nonpayable"!==this.stateMutability?this.stateMutability:void 0,payable:this.payable,gas:this.gas?this.gas.toNumber():void 0,inputs:this.inputs.map((t=>JSON.parse(t.format(e)))),outputs:this.outputs.map((t=>JSON.parse(t.format(e))))});let t="";return e!==U.sighash&&(t+="function "),t+=this.name+"("+this.inputs.map((t=>t.format(e))).join(e===U.full?", ":",")+") ",e!==U.sighash&&(this.stateMutability?"nonpayable"!==this.stateMutability&&(t+=this.stateMutability+" "):this.constant&&(t+="view "),this.outputs&&this.outputs.length&&(t+="returns ("+this.outputs.map((t=>t.format(e))).join(", ")+") "),null!=this.gas&&(t+="@"+this.gas.toString()+" ")),t.trim()}static from(e){return"string"==typeof e?W.fromString(e):W.fromObject(e)}static fromObject(e){if(W.isFunctionFragment(e))return e;"function"!==e.type&&D.throwArgumentError("invalid function object","value",e);let t=q(e);const r={type:e.type,name:X(e.name),constant:t.constant,inputs:e.inputs?e.inputs.map(V.fromObject):[],outputs:e.outputs?e.outputs.map(V.fromObject):[],payable:t.payable,stateMutability:t.stateMutability,gas:e.gas?s.O$.from(e.gas):null};return new W(O,r)}static fromString(e){let t={type:"function"},r=(e=$(e,t)).split(" returns ");r.length>2&&D.throwArgumentError("invalid function string","value",e);let n=r[0].match(ee);if(n||D.throwArgumentError("invalid function signature","value",e),t.name=n[1].trim(),t.name&&X(t.name),t.inputs=F(n[2],!1),H(n[3].trim(),t),r.length>1){let n=r[1].match(ee);""==n[1].trim()&&""==n[3].trim()||D.throwArgumentError("unexpected tokens","value",e),t.outputs=F(n[2],!1)}else t.outputs=[];return W.fromObject(t)}static isFunctionFragment(e){return e&&e._isFragment&&"function"===e.type}}function Y(e){const t=e.format();return"Error(string)"!==t&&"Panic(uint256)"!==t||D.throwArgumentError(`cannot specify user defined ${t} error`,"fragment",e),e}class Z extends j{format(e){if(e||(e=U.sighash),U[e]||D.throwArgumentError("invalid format type","format",e),e===U.json)return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map((t=>JSON.parse(t.format(e))))});let t="";return e!==U.sighash&&(t+="error "),t+=this.name+"("+this.inputs.map((t=>t.format(e))).join(e===U.full?", ":",")+") ",t.trim()}static from(e){return"string"==typeof e?Z.fromString(e):Z.fromObject(e)}static fromObject(e){if(Z.isErrorFragment(e))return e;"error"!==e.type&&D.throwArgumentError("invalid error object","value",e);const t={type:e.type,name:X(e.name),inputs:e.inputs?e.inputs.map(V.fromObject):[]};return Y(new Z(O,t))}static fromString(e){let t={type:"error"},r=e.match(ee);return r||D.throwArgumentError("invalid error signature","value",e),t.name=r[1].trim(),t.name&&X(t.name),t.inputs=F(r[2],!1),Y(Z.fromObject(t))}static isErrorFragment(e){return e&&e._isFragment&&"error"===e.type}}function Q(e){return e.match(/^uint($|[^1-9])/)?e="uint256"+e.substring(4):e.match(/^int($|[^1-9])/)&&(e="int256"+e.substring(3)),e}const J=new RegExp("^[a-zA-Z$_][a-zA-Z0-9$_]*$");function X(e){return e&&e.match(J)||D.throwArgumentError(`invalid identifier "${e}"`,"value",e),e}const ee=new RegExp("^([^)(]*)\\((.*)\\)([^)(]*)$"),te=new o.Yd(a),re=new RegExp(/^bytes([0-9]*)$/),ne=new RegExp(/^(u?int)([0-9]*)$/),se=new class{constructor(e){(0,i.zG)(this,"coerceFunc",e||null)}_getCoder(e){switch(e.baseType){case"address":return new y(e.name);case"bool":return new E(e.name);case"string":return new C(e.name);case"bytes":return new S(e.name);case"array":return new v(this._getCoder(e.arrayChildren),e.arrayLength,e.name);case"tuple":return new P((e.components||[]).map((e=>this._getCoder(e))),e.name);case"":return new I(e.name)}let t=e.type.match(ne);if(t){let r=parseInt(t[2]||"256");return(0===r||r>256||r%8!=0)&&te.throwArgumentError("invalid "+t[1]+" bit length","param",e),new k(r/8,"int"===t[1],e.name)}if(t=e.type.match(re),t){let r=parseInt(t[1]);return(0===r||r>32)&&te.throwArgumentError("invalid bytes length","param",e),new A(r,e.name)}return te.throwArgumentError("invalid type","type",e.type)}_getWordSize(){return 32}_getReader(e,t){return new u(e,this._getWordSize(),this.coerceFunc,t)}_getWriter(){return new h(this._getWordSize())}getDefaultValue(e){const t=e.map((e=>this._getCoder(V.from(e))));return new P(t,"_").defaultValue()}encode(e,t){e.length!==t.length&&te.throwError("types/values length mismatch",o.Yd.errors.INVALID_ARGUMENT,{count:{types:e.length,values:t.length},value:{types:e,values:t}});const r=e.map((e=>this._getCoder(V.from(e)))),n=new P(r,"_"),s=this._getWriter();return n.encode(s,t),s.data}decode(e,t,r){const s=e.map((e=>this._getCoder(V.from(e))));return new P(s,"_").decode(this._getReader((0,n.lE)(t),r))}},ie=new o.Yd(a);class oe extends i.dk{}class ae extends i.dk{}class ce extends i.dk{}class le extends i.dk{static isIndexed(e){return!(!e||!e._isIndexed)}}const he={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:!0},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"]}};function ue(e,t){const r=new Error(`deferred error during ABI decoding triggered accessing ${e}`);return r.error=t,r}class de{constructor(e){let t=[];t="string"==typeof e?JSON.parse(e):e,(0,i.zG)(this,"fragments",t.map((e=>j.from(e))).filter((e=>null!=e))),(0,i.zG)(this,"_abiCoder",(0,i.tu)(new.target,"getAbiCoder")()),(0,i.zG)(this,"functions",{}),(0,i.zG)(this,"errors",{}),(0,i.zG)(this,"events",{}),(0,i.zG)(this,"structs",{}),this.fragments.forEach((e=>{let t=null;switch(e.type){case"constructor":return this.deploy?void ie.warn("duplicate definition - constructor"):void(0,i.zG)(this,"deploy",e);case"function":t=this.functions;break;case"event":t=this.events;break;case"error":t=this.errors;break;default:return}let r=e.format();t[r]?ie.warn("duplicate definition - "+r):t[r]=e})),this.deploy||(0,i.zG)(this,"deploy",G.from({payable:!1,type:"constructor"})),(0,i.zG)(this,"_isInterface",!0)}format(e){e||(e=U.full),e===U.sighash&&ie.throwArgumentError("interface does not support formatting sighash","format",e);const t=this.fragments.map((t=>t.format(e)));return e===U.json?JSON.stringify(t.map((e=>JSON.parse(e)))):t}static getAbiCoder(){return se}static getAddress(e){return(0,d.Kn)(e)}static getSighash(e){return(0,n.p3)((0,p.id)(e.format()),0,4)}static getEventTopic(e){return(0,p.id)(e.format())}getFunction(e){if((0,n.A7)(e)){for(const t in this.functions)if(e===this.getSighash(t))return this.functions[t];ie.throwArgumentError("no matching function","sighash",e)}if(-1===e.indexOf("(")){const t=e.trim(),r=Object.keys(this.functions).filter((e=>e.split("(")[0]===t));return 0===r.length?ie.throwArgumentError("no matching function","name",t):r.length>1&&ie.throwArgumentError("multiple matching functions","name",t),this.functions[r[0]]}const t=this.functions[W.fromString(e).format()];return t||ie.throwArgumentError("no matching function","signature",e),t}getEvent(e){if((0,n.A7)(e)){const t=e.toLowerCase();for(const e in this.events)if(t===this.getEventTopic(e))return this.events[e];ie.throwArgumentError("no matching event","topichash",t)}if(-1===e.indexOf("(")){const t=e.trim(),r=Object.keys(this.events).filter((e=>e.split("(")[0]===t));return 0===r.length?ie.throwArgumentError("no matching event","name",t):r.length>1&&ie.throwArgumentError("multiple matching events","name",t),this.events[r[0]]}const t=this.events[K.fromString(e).format()];return t||ie.throwArgumentError("no matching event","signature",e),t}getError(e){if((0,n.A7)(e)){const t=(0,i.tu)(this.constructor,"getSighash");for(const r in this.errors)if(e===t(this.errors[r]))return this.errors[r];ie.throwArgumentError("no matching error","sighash",e)}if(-1===e.indexOf("(")){const t=e.trim(),r=Object.keys(this.errors).filter((e=>e.split("(")[0]===t));return 0===r.length?ie.throwArgumentError("no matching error","name",t):r.length>1&&ie.throwArgumentError("multiple matching errors","name",t),this.errors[r[0]]}const t=this.errors[W.fromString(e).format()];return t||ie.throwArgumentError("no matching error","signature",e),t}getSighash(e){if("string"==typeof e)try{e=this.getFunction(e)}catch(t){try{e=this.getError(e)}catch(e){throw t}}return(0,i.tu)(this.constructor,"getSighash")(e)}getEventTopic(e){return"string"==typeof e&&(e=this.getEvent(e)),(0,i.tu)(this.constructor,"getEventTopic")(e)}_decodeParams(e,t){return this._abiCoder.decode(e,t)}_encodeParams(e,t){return this._abiCoder.encode(e,t)}encodeDeploy(e){return this._encodeParams(this.deploy.inputs,e||[])}decodeErrorResult(e,t){"string"==typeof e&&(e=this.getError(e));const r=(0,n.lE)(t);return(0,n.Dv)(r.slice(0,4))!==this.getSighash(e)&&ie.throwArgumentError(`data signature does not match error ${e.name}.`,"data",(0,n.Dv)(r)),this._decodeParams(e.inputs,r.slice(4))}encodeErrorResult(e,t){return"string"==typeof e&&(e=this.getError(e)),(0,n.Dv)((0,n.zo)([this.getSighash(e),this._encodeParams(e.inputs,t||[])]))}decodeFunctionData(e,t){"string"==typeof e&&(e=this.getFunction(e));const r=(0,n.lE)(t);return(0,n.Dv)(r.slice(0,4))!==this.getSighash(e)&&ie.throwArgumentError(`data signature does not match function ${e.name}.`,"data",(0,n.Dv)(r)),this._decodeParams(e.inputs,r.slice(4))}encodeFunctionData(e,t){return"string"==typeof e&&(e=this.getFunction(e)),(0,n.Dv)((0,n.zo)([this.getSighash(e),this._encodeParams(e.inputs,t||[])]))}decodeFunctionResult(e,t){"string"==typeof e&&(e=this.getFunction(e));let r=(0,n.lE)(t),s=null,i="",a=null,c=null,l=null;switch(r.length%this._abiCoder._getWordSize()){case 0:try{return this._abiCoder.decode(e.outputs,r)}catch(e){}break;case 4:{const e=(0,n.Dv)(r.slice(0,4)),t=he[e];if(t)a=this._abiCoder.decode(t.inputs,r.slice(4)),c=t.name,l=t.signature,t.reason&&(s=a[0]),"Error"===c?i=`; VM Exception while processing transaction: reverted with reason string ${JSON.stringify(a[0])}`:"Panic"===c&&(i=`; VM Exception while processing transaction: reverted with panic code ${a[0]}`);else try{const t=this.getError(e);a=this._abiCoder.decode(t.inputs,r.slice(4)),c=t.name,l=t.format()}catch(e){}break}}return ie.throwError("call revert exception"+i,o.Yd.errors.CALL_EXCEPTION,{method:e.format(),data:(0,n.Dv)(t),errorArgs:a,errorName:c,errorSignature:l,reason:s})}encodeFunctionResult(e,t){return"string"==typeof e&&(e=this.getFunction(e)),(0,n.Dv)(this._abiCoder.encode(e.outputs,t||[]))}encodeFilterTopics(e,t){"string"==typeof e&&(e=this.getEvent(e)),t.length>e.inputs.length&&ie.throwError("too many arguments for "+e.format(),o.Yd.errors.UNEXPECTED_ARGUMENT,{argument:"values",value:t});let r=[];e.anonymous||r.push(this.getEventTopic(e));const i=(e,t)=>"string"===e.type?(0,p.id)(t):"bytes"===e.type?(0,f.w)((0,n.Dv)(t)):("bool"===e.type&&"boolean"==typeof t&&(t=t?"0x01":"0x00"),e.type.match(/^u?int/)&&(t=s.O$.from(t).toHexString()),"address"===e.type&&this._abiCoder.encode(["address"],[t]),(0,n.$m)((0,n.Dv)(t),32));for(t.forEach(((t,n)=>{let s=e.inputs[n];s.indexed?null==t?r.push(null):"array"===s.baseType||"tuple"===s.baseType?ie.throwArgumentError("filtering with tuples or arrays not supported","contract."+s.name,t):Array.isArray(t)?r.push(t.map((e=>i(s,e)))):r.push(i(s,t)):null!=t&&ie.throwArgumentError("cannot filter non-indexed parameters; must be null","contract."+s.name,t)}));r.length&&null===r[r.length-1];)r.pop();return r}encodeEventLog(e,t){"string"==typeof e&&(e=this.getEvent(e));const r=[],n=[],s=[];return e.anonymous||r.push(this.getEventTopic(e)),t.length!==e.inputs.length&&ie.throwArgumentError("event arguments/values mismatch","values",t),e.inputs.forEach(((e,i)=>{const o=t[i];if(e.indexed)if("string"===e.type)r.push((0,p.id)(o));else if("bytes"===e.type)r.push((0,f.w)(o));else{if("tuple"===e.baseType||"array"===e.baseType)throw new Error("not implemented");r.push(this._abiCoder.encode([e.type],[o]))}else n.push(e),s.push(o)})),{data:this._abiCoder.encode(n,s),topics:r}}decodeEventLog(e,t,r){if("string"==typeof e&&(e=this.getEvent(e)),null!=r&&!e.anonymous){let t=this.getEventTopic(e);(0,n.A7)(r[0],32)&&r[0].toLowerCase()===t||ie.throwError("fragment/topic mismatch",o.Yd.errors.INVALID_ARGUMENT,{argument:"topics[0]",expected:t,value:r[0]}),r=r.slice(1)}let s=[],i=[],a=[];e.inputs.forEach(((e,t)=>{e.indexed?"string"===e.type||"bytes"===e.type||"tuple"===e.baseType||"array"===e.baseType?(s.push(V.fromObject({type:"bytes32",name:e.name})),a.push(!0)):(s.push(e),a.push(!1)):(i.push(e),a.push(!1))}));let c=null!=r?this._abiCoder.decode(s,(0,n.zo)(r)):null,l=this._abiCoder.decode(i,t,!0),h=[],u=0,d=0;e.inputs.forEach(((e,t)=>{if(e.indexed)if(null==c)h[t]=new le({_isIndexed:!0,hash:null});else if(a[t])h[t]=new le({_isIndexed:!0,hash:c[d++]});else try{h[t]=c[d++]}catch(e){h[t]=e}else try{h[t]=l[u++]}catch(e){h[t]=e}if(e.name&&null==h[e.name]){const r=h[t];r instanceof Error?Object.defineProperty(h,e.name,{enumerable:!0,get:()=>{throw ue(`property ${JSON.stringify(e.name)}`,r)}}):h[e.name]=r}}));for(let e=0;e<h.length;e++){const t=h[e];t instanceof Error&&Object.defineProperty(h,e,{enumerable:!0,get:()=>{throw ue(`index ${e}`,t)}})}return Object.freeze(h)}parseTransaction(e){let t=this.getFunction(e.data.substring(0,10).toLowerCase());return t?new ae({args:this._abiCoder.decode(t.inputs,"0x"+e.data.substring(10)),functionFragment:t,name:t.name,signature:t.format(),sighash:this.getSighash(t),value:s.O$.from(e.value||"0")}):null}parseLog(e){let t=this.getEvent(e.topics[0]);return!t||t.anonymous?null:new oe({eventFragment:t,name:t.name,signature:t.format(),topic:this.getEventTopic(t),args:this.decodeEventLog(t,e.data,e.topics)})}parseError(e){const t=(0,n.Dv)(e);let r=this.getError(t.substring(0,10).toLowerCase());return r?new ce({args:this._abiCoder.decode(r.inputs,"0x"+t.substring(10)),errorFragment:r,name:r.name,signature:r.format(),sighash:this.getSighash(r)}):null}static isInterface(e){return!(!e||!e._isInterface)}}var pe=r(99883),fe=r(27108),ye=r(30074),ge=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))};const me=new o.Yd("contracts/5.7.0");function we(e,t){return ge(this,void 0,void 0,(function*(){const r=yield t;"string"!=typeof r&&me.throwArgumentError("invalid address or ENS name","name",r);try{return(0,d.Kn)(r)}catch(e){}e||me.throwError("a provider or signer is needed to resolve ENS names",o.Yd.errors.UNSUPPORTED_OPERATION,{operation:"resolveName"});const n=yield e.resolveName(r);return null==n&&me.throwArgumentError("resolver or addr is not configured for ENS name","name",r),n}))}function be(e,t,r){return ge(this,void 0,void 0,(function*(){return Array.isArray(r)?yield Promise.all(r.map(((r,n)=>be(e,Array.isArray(t)?t[n]:t[r.name],r)))):"address"===r.type?yield we(e,t):"tuple"===r.type?yield be(e,t,r.components):"array"===r.baseType?Array.isArray(t)?yield Promise.all(t.map((t=>be(e,t,r.arrayChildren)))):Promise.reject(me.makeError("invalid value for array",o.Yd.errors.INVALID_ARGUMENT,{argument:"value",value:t})):t}))}function ve(e,t,r){return ge(this,void 0,void 0,(function*(){let a={};r.length===t.inputs.length+1&&"object"==typeof r[r.length-1]&&(a=(0,i.DC)(r.pop())),me.checkArgumentCount(r.length,t.inputs.length,"passed to contract"),e.signer?a.from?a.from=(0,i.mE)({override:we(e.signer,a.from),signer:e.signer.getAddress()}).then((e=>ge(this,void 0,void 0,(function*(){return(0,d.Kn)(e.signer)!==e.override&&me.throwError("Contract with a Signer cannot override from",o.Yd.errors.UNSUPPORTED_OPERATION,{operation:"overrides.from"}),e.override})))):a.from=e.signer.getAddress():a.from&&(a.from=we(e.provider,a.from));const c=yield(0,i.mE)({args:be(e.signer||e.provider,r,t.inputs),address:e.resolvedAddress,overrides:(0,i.mE)(a)||{}}),l=e.interface.encodeFunctionData(t,c.args),h={data:l,to:c.address},u=c.overrides;if(null!=u.nonce&&(h.nonce=s.O$.from(u.nonce).toNumber()),null!=u.gasLimit&&(h.gasLimit=s.O$.from(u.gasLimit)),null!=u.gasPrice&&(h.gasPrice=s.O$.from(u.gasPrice)),null!=u.maxFeePerGas&&(h.maxFeePerGas=s.O$.from(u.maxFeePerGas)),null!=u.maxPriorityFeePerGas&&(h.maxPriorityFeePerGas=s.O$.from(u.maxPriorityFeePerGas)),null!=u.from&&(h.from=u.from),null!=u.type&&(h.type=u.type),null!=u.accessList&&(h.accessList=(0,ye.z7)(u.accessList)),null==h.gasLimit&&null!=t.gas){let e=21e3;const r=(0,n.lE)(l);for(let t=0;t<r.length;t++)e+=4,r[t]&&(e+=64);h.gasLimit=s.O$.from(t.gas).add(e)}if(u.value){const e=s.O$.from(u.value);e.isZero()||t.payable||me.throwError("non-payable method cannot override value",o.Yd.errors.UNSUPPORTED_OPERATION,{operation:"overrides.value",value:a.value}),h.value=e}u.customData&&(h.customData=(0,i.DC)(u.customData)),u.ccipReadEnabled&&(h.ccipReadEnabled=!!u.ccipReadEnabled),delete a.nonce,delete a.gasLimit,delete a.gasPrice,delete a.from,delete a.value,delete a.type,delete a.accessList,delete a.maxFeePerGas,delete a.maxPriorityFeePerGas,delete a.customData,delete a.ccipReadEnabled;const p=Object.keys(a).filter((e=>null!=a[e]));return p.length&&me.throwError(`cannot override ${p.map((e=>JSON.stringify(e))).join(",")}`,o.Yd.errors.UNSUPPORTED_OPERATION,{operation:"overrides",overrides:p}),h}))}function Ee(e,t,r){const n=e.signer||e.provider;return function(...s){return ge(this,void 0,void 0,(function*(){let a;if(s.length===t.inputs.length+1&&"object"==typeof s[s.length-1]){const e=(0,i.DC)(s.pop());null!=e.blockTag&&(a=yield e.blockTag),delete e.blockTag,s.push(e)}null!=e.deployTransaction&&(yield e._deployed(a));const c=yield ve(e,t,s),l=yield n.call(c,a);try{let n=e.interface.decodeFunctionResult(t,l);return r&&1===t.outputs.length&&(n=n[0]),n}catch(t){throw t.code===o.Yd.errors.CALL_EXCEPTION&&(t.address=e.address,t.args=s,t.transaction=c),t}}))}}function _e(e,t,r){return t.constant?Ee(e,t,r):function(e,t){return function(...r){return ge(this,void 0,void 0,(function*(){e.signer||me.throwError("sending a transaction requires a signer",o.Yd.errors.UNSUPPORTED_OPERATION,{operation:"sendTransaction"}),null!=e.deployTransaction&&(yield e._deployed());const n=yield ve(e,t,r),s=yield e.signer.sendTransaction(n);return function(e,t){const r=t.wait.bind(t);t.wait=t=>r(t).then((t=>(t.events=t.logs.map((r=>{let n=(0,i.p$)(r),s=null;try{s=e.interface.parseLog(r)}catch(e){}return s&&(n.args=s.args,n.decode=(t,r)=>e.interface.decodeEventLog(s.eventFragment,t,r),n.event=s.name,n.eventSignature=s.signature),n.removeListener=()=>e.provider,n.getBlock=()=>e.provider.getBlock(t.blockHash),n.getTransaction=()=>e.provider.getTransaction(t.transactionHash),n.getTransactionReceipt=()=>Promise.resolve(t),n})),t)))}(e,s),s}))}}(e,t)}function Se(e){return!e.address||null!=e.topics&&0!==e.topics.length?(e.address||"*")+"@"+(e.topics?e.topics.map((e=>Array.isArray(e)?e.join("|"):e)).join(":"):""):"*"}class Ae{constructor(e,t){(0,i.zG)(this,"tag",e),(0,i.zG)(this,"filter",t),this._listeners=[]}addListener(e,t){this._listeners.push({listener:e,once:t})}removeListener(e){let t=!1;this._listeners=this._listeners.filter((r=>!(!t&&r.listener===e&&(t=!0,1))))}removeAllListeners(){this._listeners=[]}listeners(){return this._listeners.map((e=>e.listener))}listenerCount(){return this._listeners.length}run(e){const t=this.listenerCount();return this._listeners=this._listeners.filter((t=>{const r=e.slice();return setTimeout((()=>{t.listener.apply(this,r)}),0),!t.once})),t}prepareEvent(e){}getEmit(e){return[e]}}class Ie extends Ae{constructor(){super("error",null)}}class Re extends Ae{constructor(e,t,r,n){const s={address:e};let o=t.getEventTopic(r);n?(o!==n[0]&&me.throwArgumentError("topic mismatch","topics",n),s.topics=n.slice()):s.topics=[o],super(Se(s),s),(0,i.zG)(this,"address",e),(0,i.zG)(this,"interface",t),(0,i.zG)(this,"fragment",r)}prepareEvent(e){super.prepareEvent(e),e.event=this.fragment.name,e.eventSignature=this.fragment.format(),e.decode=(e,t)=>this.interface.decodeEventLog(this.fragment,e,t);try{e.args=this.interface.decodeEventLog(this.fragment,e.data,e.topics)}catch(t){e.args=null,e.decodeError=t}}getEmit(e){const t=function(e){const t=[],r=function(e,n){if(Array.isArray(n))for(let s in n){const i=e.slice();i.push(s);try{r(i,n[s])}catch(e){t.push({path:i,error:e})}}};return r([],e),t}(e.args);if(t.length)throw t[0].error;const r=(e.args||[]).slice();return r.push(e),r}}class ke extends Ae{constructor(e,t){super("*",{address:e}),(0,i.zG)(this,"address",e),(0,i.zG)(this,"interface",t)}prepareEvent(e){super.prepareEvent(e);try{const t=this.interface.parseLog(e);e.event=t.name,e.eventSignature=t.signature,e.decode=(e,r)=>this.interface.decodeEventLog(t.eventFragment,e,r),e.args=t.args}catch(e){}}}class Te{constructor(e,t,r){(0,i.zG)(this,"interface",(0,i.tu)(new.target,"getInterface")(t)),null==r?((0,i.zG)(this,"provider",null),(0,i.zG)(this,"signer",null)):fe.E.isSigner(r)?((0,i.zG)(this,"provider",r.provider||null),(0,i.zG)(this,"signer",r)):pe.zt.isProvider(r)?((0,i.zG)(this,"provider",r),(0,i.zG)(this,"signer",null)):me.throwArgumentError("invalid signer or provider","signerOrProvider",r),(0,i.zG)(this,"callStatic",{}),(0,i.zG)(this,"estimateGas",{}),(0,i.zG)(this,"functions",{}),(0,i.zG)(this,"populateTransaction",{}),(0,i.zG)(this,"filters",{});{const e={};Object.keys(this.interface.events).forEach((t=>{const r=this.interface.events[t];(0,i.zG)(this.filters,t,((...e)=>({address:this.address,topics:this.interface.encodeFilterTopics(r,e)}))),e[r.name]||(e[r.name]=[]),e[r.name].push(t)})),Object.keys(e).forEach((t=>{const r=e[t];1===r.length?(0,i.zG)(this.filters,t,this.filters[r[0]]):me.warn(`Duplicate definition of ${t} (${r.join(", ")})`)}))}if((0,i.zG)(this,"_runningEvents",{}),(0,i.zG)(this,"_wrappedEmits",{}),null==e&&me.throwArgumentError("invalid contract address or ENS name","addressOrName",e),(0,i.zG)(this,"address",e),this.provider)(0,i.zG)(this,"resolvedAddress",we(this.provider,e));else try{(0,i.zG)(this,"resolvedAddress",Promise.resolve((0,d.Kn)(e)))}catch(e){me.throwError("provider is required to use ENS name as contract address",o.Yd.errors.UNSUPPORTED_OPERATION,{operation:"new Contract"})}this.resolvedAddress.catch((e=>{}));const n={},s={};Object.keys(this.interface.functions).forEach((e=>{const t=this.interface.functions[e];if(s[e])me.warn(`Duplicate ABI entry for ${JSON.stringify(e)}`);else{s[e]=!0;{const r=t.name;n[`%${r}`]||(n[`%${r}`]=[]),n[`%${r}`].push(e)}null==this[e]&&(0,i.zG)(this,e,_e(this,t,!0)),null==this.functions[e]&&(0,i.zG)(this.functions,e,_e(this,t,!1)),null==this.callStatic[e]&&(0,i.zG)(this.callStatic,e,Ee(this,t,!0)),null==this.populateTransaction[e]&&(0,i.zG)(this.populateTransaction,e,function(e,t){return function(...r){return ve(e,t,r)}}(this,t)),null==this.estimateGas[e]&&(0,i.zG)(this.estimateGas,e,function(e,t){const r=e.signer||e.provider;return function(...n){return ge(this,void 0,void 0,(function*(){r||me.throwError("estimate require a provider or signer",o.Yd.errors.UNSUPPORTED_OPERATION,{operation:"estimateGas"});const s=yield ve(e,t,n);return yield r.estimateGas(s)}))}}(this,t))}})),Object.keys(n).forEach((e=>{const t=n[e];if(t.length>1)return;e=e.substring(1);const r=t[0];try{null==this[e]&&(0,i.zG)(this,e,this[r])}catch(e){}null==this.functions[e]&&(0,i.zG)(this.functions,e,this.functions[r]),null==this.callStatic[e]&&(0,i.zG)(this.callStatic,e,this.callStatic[r]),null==this.populateTransaction[e]&&(0,i.zG)(this.populateTransaction,e,this.populateTransaction[r]),null==this.estimateGas[e]&&(0,i.zG)(this.estimateGas,e,this.estimateGas[r])}))}static getContractAddress(e){return(0,d.CR)(e)}static getInterface(e){return de.isInterface(e)?e:new de(e)}deployed(){return this._deployed()}_deployed(e){return this._deployedPromise||(this.deployTransaction?this._deployedPromise=this.deployTransaction.wait().then((()=>this)):this._deployedPromise=this.provider.getCode(this.address,e).then((e=>("0x"===e&&me.throwError("contract not deployed",o.Yd.errors.UNSUPPORTED_OPERATION,{contractAddress:this.address,operation:"getDeployed"}),this)))),this._deployedPromise}fallback(e){this.signer||me.throwError("sending a transactions require a signer",o.Yd.errors.UNSUPPORTED_OPERATION,{operation:"sendTransaction(fallback)"});const t=(0,i.DC)(e||{});return["from","to"].forEach((function(e){null!=t[e]&&me.throwError("cannot override "+e,o.Yd.errors.UNSUPPORTED_OPERATION,{operation:e})})),t.to=this.resolvedAddress,this.deployed().then((()=>this.signer.sendTransaction(t)))}connect(e){"string"==typeof e&&(e=new fe.b(e,this.provider));const t=new this.constructor(this.address,this.interface,e);return this.deployTransaction&&(0,i.zG)(t,"deployTransaction",this.deployTransaction),t}attach(e){return new this.constructor(e,this.interface,this.signer||this.provider)}static isIndexed(e){return le.isIndexed(e)}_normalizeRunningEvent(e){return this._runningEvents[e.tag]?this._runningEvents[e.tag]:e}_getRunningEvent(e){if("string"==typeof e){if("error"===e)return this._normalizeRunningEvent(new Ie);if("event"===e)return this._normalizeRunningEvent(new Ae("event",null));if("*"===e)return this._normalizeRunningEvent(new ke(this.address,this.interface));const t=this.interface.getEvent(e);return this._normalizeRunningEvent(new Re(this.address,this.interface,t))}if(e.topics&&e.topics.length>0){try{const t=e.topics[0];if("string"!=typeof t)throw new Error("invalid topic");const r=this.interface.getEvent(t);return this._normalizeRunningEvent(new Re(this.address,this.interface,r,e.topics))}catch(e){}const t={address:this.address,topics:e.topics};return this._normalizeRunningEvent(new Ae(Se(t),t))}return this._normalizeRunningEvent(new ke(this.address,this.interface))}_checkRunningEvents(e){if(0===e.listenerCount()){delete this._runningEvents[e.tag];const t=this._wrappedEmits[e.tag];t&&e.filter&&(this.provider.off(e.filter,t),delete this._wrappedEmits[e.tag])}}_wrapEvent(e,t,r){const n=(0,i.p$)(t);return n.removeListener=()=>{r&&(e.removeListener(r),this._checkRunningEvents(e))},n.getBlock=()=>this.provider.getBlock(t.blockHash),n.getTransaction=()=>this.provider.getTransaction(t.transactionHash),n.getTransactionReceipt=()=>this.provider.getTransactionReceipt(t.transactionHash),e.prepareEvent(n),n}_addEventListener(e,t,r){if(this.provider||me.throwError("events require a provider or a signer with a provider",o.Yd.errors.UNSUPPORTED_OPERATION,{operation:"once"}),e.addListener(t,r),this._runningEvents[e.tag]=e,!this._wrappedEmits[e.tag]){const r=r=>{let n=this._wrapEvent(e,r,t);if(null==n.decodeError)try{const t=e.getEmit(n);this.emit(e.filter,...t)}catch(e){n.decodeError=e.error}null!=e.filter&&this.emit("event",n),null!=n.decodeError&&this.emit("error",n.decodeError,n)};this._wrappedEmits[e.tag]=r,null!=e.filter&&this.provider.on(e.filter,r)}}queryFilter(e,t,r){const s=this._getRunningEvent(e),o=(0,i.DC)(s.filter);return"string"==typeof t&&(0,n.A7)(t,32)?(null!=r&&me.throwArgumentError("cannot specify toBlock with blockhash","toBlock",r),o.blockHash=t):(o.fromBlock=null!=t?t:0,o.toBlock=null!=r?r:"latest"),this.provider.getLogs(o).then((e=>e.map((e=>this._wrapEvent(s,e,null)))))}on(e,t){return this._addEventListener(this._getRunningEvent(e),t,!1),this}once(e,t){return this._addEventListener(this._getRunningEvent(e),t,!0),this}emit(e,...t){if(!this.provider)return!1;const r=this._getRunningEvent(e),n=r.run(t)>0;return this._checkRunningEvents(r),n}listenerCount(e){return this.provider?null==e?Object.keys(this._runningEvents).reduce(((e,t)=>e+this._runningEvents[t].listenerCount()),0):this._getRunningEvent(e).listenerCount():0}listeners(e){if(!this.provider)return[];if(null==e){const e=[];for(let t in this._runningEvents)this._runningEvents[t].listeners().forEach((t=>{e.push(t)}));return e}return this._getRunningEvent(e).listeners()}removeAllListeners(e){if(!this.provider)return this;if(null==e){for(const e in this._runningEvents){const t=this._runningEvents[e];t.removeAllListeners(),this._checkRunningEvents(t)}return this}const t=this._getRunningEvent(e);return t.removeAllListeners(),this._checkRunningEvents(t),this}off(e,t){if(!this.provider)return this;const r=this._getRunningEvent(e);return r.removeListener(t),this._checkRunningEvents(r),this}removeListener(e,t){return this.off(e,t)}}class Ce extends Te{}},9814:(e,t,r)=>{"use strict";r.d(t,{dF:()=>E});var n=r(50864),s=r(33811),i=r(73881),o=r(66661);const a=new s.Yd(i.i),c={},l=o.O$.from(0),h=o.O$.from(-1);function u(e,t,r,n){const i={fault:t,operation:r};return void 0!==n&&(i.value=n),a.throwError(e,s.Yd.errors.NUMERIC_FAULT,i)}let d="0";for(;d.length<256;)d+=d;function p(e){if("number"!=typeof e)try{e=o.O$.from(e).toNumber()}catch(e){}return"number"==typeof e&&e>=0&&e<=256&&!(e%1)?"1"+d.substring(0,e):a.throwArgumentError("invalid decimal size","decimals",e)}function f(e,t){null==t&&(t=0);const r=p(t),n=(e=o.O$.from(e)).lt(l);n&&(e=e.mul(h));let s=e.mod(r).toString();for(;s.length<r.length-1;)s="0"+s;s=s.match(/^([0-9]*[1-9]|0)(0*)/)[1];const i=e.div(r).toString();return e=1===r.length?i:i+"."+s,n&&(e="-"+e),e}function y(e,t){null==t&&(t=0);const r=p(t);"string"==typeof e&&e.match(/^-?[0-9.]+$/)||a.throwArgumentError("invalid decimal value","value",e);const n="-"===e.substring(0,1);n&&(e=e.substring(1)),"."===e&&a.throwArgumentError("missing value","value",e);const s=e.split(".");s.length>2&&a.throwArgumentError("too many decimal points","value",e);let i=s[0],c=s[1];for(i||(i="0"),c||(c="0");"0"===c[c.length-1];)c=c.substring(0,c.length-1);for(c.length>r.length-1&&u("fractional component exceeds decimals","underflow","parseFixed"),""===c&&(c="0");c.length<r.length-1;)c+="0";const l=o.O$.from(i),d=o.O$.from(c);let f=l.mul(r).add(d);return n&&(f=f.mul(h)),f}class g{constructor(e,t,r,n){e!==c&&a.throwError("cannot use FixedFormat constructor; use FixedFormat.from",s.Yd.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.signed=t,this.width=r,this.decimals=n,this.name=(t?"":"u")+"fixed"+String(r)+"x"+String(n),this._multiplier=p(n),Object.freeze(this)}static from(e){if(e instanceof g)return e;"number"==typeof e&&(e=`fixed128x${e}`);let t=!0,r=128,n=18;if("string"==typeof e)if("fixed"===e);else if("ufixed"===e)t=!1;else{const s=e.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);s||a.throwArgumentError("invalid fixed format","format",e),t="u"!==s[1],r=parseInt(s[2]),n=parseInt(s[3])}else if(e){const s=(t,r,n)=>null==e[t]?n:(typeof e[t]!==r&&a.throwArgumentError("invalid fixed format ("+t+" not "+r+")","format."+t,e[t]),e[t]);t=s("signed","boolean",t),r=s("width","number",r),n=s("decimals","number",n)}return r%8&&a.throwArgumentError("invalid fixed format width (not byte aligned)","format.width",r),n>80&&a.throwArgumentError("invalid fixed format (decimals too large)","format.decimals",n),new g(c,t,r,n)}}class m{constructor(e,t,r,n){e!==c&&a.throwError("cannot use FixedNumber constructor; use FixedNumber.from",s.Yd.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.format=n,this._hex=t,this._value=r,this._isFixedNumber=!0,Object.freeze(this)}_checkFormat(e){this.format.name!==e.format.name&&a.throwArgumentError("incompatible format; use fixedNumber.toFormat","other",e)}addUnsafe(e){this._checkFormat(e);const t=y(this._value,this.format.decimals),r=y(e._value,e.format.decimals);return m.fromValue(t.add(r),this.format.decimals,this.format)}subUnsafe(e){this._checkFormat(e);const t=y(this._value,this.format.decimals),r=y(e._value,e.format.decimals);return m.fromValue(t.sub(r),this.format.decimals,this.format)}mulUnsafe(e){this._checkFormat(e);const t=y(this._value,this.format.decimals),r=y(e._value,e.format.decimals);return m.fromValue(t.mul(r).div(this.format._multiplier),this.format.decimals,this.format)}divUnsafe(e){this._checkFormat(e);const t=y(this._value,this.format.decimals),r=y(e._value,e.format.decimals);return m.fromValue(t.mul(this.format._multiplier).div(r),this.format.decimals,this.format)}floor(){const e=this.toString().split(".");1===e.length&&e.push("0");let t=m.from(e[0],this.format);const r=!e[1].match(/^(0*)$/);return this.isNegative()&&r&&(t=t.subUnsafe(w.toFormat(t.format))),t}ceiling(){const e=this.toString().split(".");1===e.length&&e.push("0");let t=m.from(e[0],this.format);const r=!e[1].match(/^(0*)$/);return!this.isNegative()&&r&&(t=t.addUnsafe(w.toFormat(t.format))),t}round(e){null==e&&(e=0);const t=this.toString().split(".");if(1===t.length&&t.push("0"),(e<0||e>80||e%1)&&a.throwArgumentError("invalid decimal count","decimals",e),t[1].length<=e)return this;const r=m.from("1"+d.substring(0,e),this.format),n=b.toFormat(this.format);return this.mulUnsafe(r).addUnsafe(n).floor().divUnsafe(r)}isZero(){return"0.0"===this._value||"0"===this._value}isNegative(){return"-"===this._value[0]}toString(){return this._value}toHexString(e){if(null==e)return this._hex;e%8&&a.throwArgumentError("invalid byte width","width",e);const t=o.O$.from(this._hex).fromTwos(this.format.width).toTwos(e).toHexString();return(0,n.$m)(t,e/8)}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(e){return m.fromString(this._value,e)}static fromValue(e,t,r){return null!=r||null==t||(0,o.Zm)(t)||(r=t,t=null),null==t&&(t=0),null==r&&(r="fixed"),m.fromString(f(e,t),g.from(r))}static fromString(e,t){null==t&&(t="fixed");const r=g.from(t),s=y(e,r.decimals);!r.signed&&s.lt(l)&&u("unsigned value cannot be negative","overflow","value",e);let i=null;r.signed?i=s.toTwos(r.width).toHexString():(i=s.toHexString(),i=(0,n.$m)(i,r.width/8));const o=f(s,r.decimals);return new m(c,i,o,r)}static fromBytes(e,t){null==t&&(t="fixed");const r=g.from(t);if((0,n.lE)(e).length>r.width/8)throw new Error("overflow");let s=o.O$.from(e);r.signed&&(s=s.fromTwos(r.width));const i=s.toTwos((r.signed?0:1)+r.width).toHexString(),a=f(s,r.decimals);return new m(c,i,a,r)}static from(e,t){if("string"==typeof e)return m.fromString(e,t);if((0,n._t)(e))return m.fromBytes(e,t);try{return m.fromValue(e,0,t)}catch(e){if(e.code!==s.Yd.errors.INVALID_ARGUMENT)throw e}return a.throwArgumentError("invalid FixedNumber value","value",e)}static isFixedNumber(e){return!(!e||!e._isFixedNumber)}}const w=m.from(1),b=m.from("0.5"),v=(new s.Yd("units/5.7.0"),["wei","kwei","mwei","gwei","szabo","finney","ether"]);function E(e){return function(e,t){if("string"==typeof t){const e=v.indexOf(t);-1!==e&&(t=3*e)}return f(e,null!=t?t:18)}(e,18)}},98935:e=>{"use strict";e.exports=async e=>{for await(const t of e);}},81608:e=>{"use strict";e.exports=async e=>{for await(const t of e)return t}},76295:(e,t,r)=>{"use strict";const n=r(61352);e.exports=async function*(...e){const t=n();setTimeout((async()=>{try{await Promise.all(e.map((async e=>{for await(const r of e)t.push(r)}))),t.end()}catch(e){t.end(e)}}),0),yield*t}},61352:(e,t,r)=>{const n=r(98502);e.exports=e=>{let t;"function"==typeof(e=e||{})?(t=e,e={}):t=e.onEnd;let r,s,i,o=new n;const a=e=>s?s(e):(o.push(e),r),c=e=>i?r:a({done:!1,value:e}),l=e=>i?r:(i=!0,e?(e=>(o=new n,s?s({error:e}):(o.push({error:e}),r)))(e):a({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:()=>{if(!o.isEmpty()){if(e.writev){let e;const t=[];for(;!o.isEmpty();){if(e=o.shift(),e.error)throw e.error;t.push(e.value)}return{done:e.done,value:t}}const t=o.shift();if(t.error)throw t.error;return t}return i?{done:!0}:new Promise(((t,n)=>{s=i=>(s=null,i.error?n(i.error):e.writev&&!i.done?t({done:i.done,value:[i.value]}):t(i),r)}))},return:()=>(o=new n,l(),{done:!0}),throw:e=>(l(e),{done:!0}),push:c,end:l},!t)return r;const h=r;return r={[Symbol.asyncIterator](){return this},next:()=>h.next(),throw:e=>(h.throw(e),t&&(t(e),t=null),{done:!0}),return:()=>(h.return(),t&&(t(),t=null),{done:!0}),push:c,end:e=>(h.end(e),t&&(t(e),t=null),r)},r}},95623:e=>{"use strict";e.exports=async e=>{const t=[];for await(const r of e)t.push(r);return t}},1773:e=>{"use strict";e.exports=async function*(e,t){for await(const r of e)yield t(r)}},33750:(e,t,r)=>{"use strict";r.d(t,{Z:()=>g});var n=r(53669),s=r(93244),i=r(44441),o=r(9795),a=r(18157),c=r(96880),l=r(8604),h=r(48908),u=r(96420);function d(e){return(0,u.Z)("MuiCardContent",e)}(0,h.Z)("MuiCardContent",["root"]);var p=r(17774);const f=["className","component"],y=(0,c.ZP)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({padding:16,"&:last-child":{paddingBottom:24}}))),g=i.forwardRef((function(e,t){const r=(0,l.Z)({props:e,name:"MuiCardContent"}),{className:i,component:c="div"}=r,h=(0,s.Z)(r,f),u=(0,n.Z)({},r,{component:c}),g=(e=>{const{classes:t}=e;return(0,a.Z)({root:["root"]},d,t)})(u);return(0,p.jsx)(y,(0,n.Z)({as:c,className:(0,o.Z)(g.root,i),ownerState:u,ref:t},h))}))},16062:(e,t,r)=>{"use strict";r.d(t,{Z:()=>m});var n=r(53669),s=r(93244),i=r(44441),o=r(9795),a=r(18157),c=r(96880),l=r(8604),h=r(70831),u=r(48908),d=r(96420);function p(e){return(0,d.Z)("MuiCard",e)}(0,u.Z)("MuiCard",["root"]);var f=r(17774);const y=["className","raised"],g=(0,c.ZP)(h.Z,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({overflow:"hidden"}))),m=i.forwardRef((function(e,t){const r=(0,l.Z)({props:e,name:"MuiCard"}),{className:i,raised:c=!1}=r,h=(0,s.Z)(r,y),u=(0,n.Z)({},r,{raised:c}),d=(e=>{const{classes:t}=e;return(0,a.Z)({root:["root"]},p,t)})(u);return(0,f.jsx)(g,(0,n.Z)({className:(0,o.Z)(d.root,i),elevation:c?8:void 0,ref:t,ownerState:u},h))}))},32920:(e,t,r)=>{"use strict";r.d(t,{Z:()=>k});var n=r(93244),s=r(53669),i=r(44441),o=r(9795),a=r(18157),c=r(418),l=r(14544),h=r(8604),u=r(96880),d=r(48908),p=r(96420);function f(e){return(0,p.Z)("MuiCircularProgress",e)}(0,d.Z)("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);var y=r(17774);const g=["className","color","disableShrink","size","style","thickness","value","variant"];let m,w,b,v,E=e=>e;const _=(0,c.F4)(m||(m=E`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`)),S=(0,c.F4)(w||(w=E`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -125px;
  }
`)),A=(0,u.ZP)("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],t[`color${(0,l.Z)(r.color)}`]]}})((({ownerState:e,theme:t})=>(0,s.Z)({display:"inline-block"},"determinate"===e.variant&&{transition:t.transitions.create("transform")},"inherit"!==e.color&&{color:(t.vars||t).palette[e.color].main})),(({ownerState:e})=>"indeterminate"===e.variant&&(0,c.iv)(b||(b=E`
      animation: ${0} 1.4s linear infinite;
    `),_))),I=(0,u.ZP)("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(e,t)=>t.svg})({display:"block"}),R=(0,u.ZP)("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.circle,t[`circle${(0,l.Z)(r.variant)}`],r.disableShrink&&t.circleDisableShrink]}})((({ownerState:e,theme:t})=>(0,s.Z)({stroke:"currentColor"},"determinate"===e.variant&&{transition:t.transitions.create("stroke-dashoffset")},"indeterminate"===e.variant&&{strokeDasharray:"80px, 200px",strokeDashoffset:0})),(({ownerState:e})=>"indeterminate"===e.variant&&!e.disableShrink&&(0,c.iv)(v||(v=E`
      animation: ${0} 1.4s ease-in-out infinite;
    `),S))),k=i.forwardRef((function(e,t){const r=(0,h.Z)({props:e,name:"MuiCircularProgress"}),{className:i,color:c="primary",disableShrink:u=!1,size:d=40,style:p,thickness:m=3.6,value:w=0,variant:b="indeterminate"}=r,v=(0,n.Z)(r,g),E=(0,s.Z)({},r,{color:c,disableShrink:u,size:d,thickness:m,value:w,variant:b}),_=(e=>{const{classes:t,variant:r,color:n,disableShrink:s}=e,i={root:["root",r,`color${(0,l.Z)(n)}`],svg:["svg"],circle:["circle",`circle${(0,l.Z)(r)}`,s&&"circleDisableShrink"]};return(0,a.Z)(i,f,t)})(E),S={},k={},T={};if("determinate"===b){const e=2*Math.PI*((44-m)/2);S.strokeDasharray=e.toFixed(3),T["aria-valuenow"]=Math.round(w),S.strokeDashoffset=`${((100-w)/100*e).toFixed(3)}px`,k.transform="rotate(-90deg)"}return(0,y.jsx)(A,(0,s.Z)({className:(0,o.Z)(_.root,i),style:(0,s.Z)({width:d,height:d},k,p),ownerState:E,ref:t,role:"progressbar"},T,v,{children:(0,y.jsx)(I,{className:_.svg,ownerState:E,viewBox:"22 22 44 44",children:(0,y.jsx)(R,{className:_.circle,style:S,ownerState:E,cx:44,cy:44,r:(44-m)/2,fill:"none",strokeWidth:m})})}))}))},68739:(e,t,r)=>{"use strict";r.d(t,{Z:()=>g});var n=r(93244),s=r(53669),i=r(44441),o=r(9795),a=r(18157),c=r(96880),l=r(8604),h=r(48908),u=r(96420);function d(e){return(0,u.Z)("MuiDialogActions",e)}(0,h.Z)("MuiDialogActions",["root","spacing"]);var p=r(17774);const f=["className","disableSpacing"],y=(0,c.ZP)("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,!r.disableSpacing&&t.spacing]}})((({ownerState:e})=>(0,s.Z)({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},!e.disableSpacing&&{"& > :not(:first-of-type)":{marginLeft:8}}))),g=i.forwardRef((function(e,t){const r=(0,l.Z)({props:e,name:"MuiDialogActions"}),{className:i,disableSpacing:c=!1}=r,h=(0,n.Z)(r,f),u=(0,s.Z)({},r,{disableSpacing:c}),g=(e=>{const{classes:t,disableSpacing:r}=e,n={root:["root",!r&&"spacing"]};return(0,a.Z)(n,d,t)})(u);return(0,p.jsx)(y,(0,s.Z)({className:(0,o.Z)(g.root,i),ownerState:u,ref:t},h))}))},50500:(e,t,r)=>{"use strict";r.d(t,{Z:()=>g});var n=r(53669),s=r(93244),i=r(44441),o=r(9795),a=r(18157),c=r(14189),l=r(96880),h=r(8604),u=r(46075),d=r(99112),p=r(17774);const f=["className","id"],y=(0,l.ZP)(c.Z,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:"16px 24px",flex:"0 0 auto"}),g=i.forwardRef((function(e,t){const r=(0,h.Z)({props:e,name:"MuiDialogTitle"}),{className:c,id:l}=r,g=(0,s.Z)(r,f),m=r,w=(e=>{const{classes:t}=e;return(0,a.Z)({root:["root"]},u.a,t)})(m),{titleId:b=l}=i.useContext(d.Z);return(0,p.jsx)(y,(0,n.Z)({component:"h2",className:(0,o.Z)(w.root,c),ownerState:m,ref:t,variant:"h6",id:b},g))}))},46075:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o,a:()=>i});var n=r(48908),s=r(96420);function i(e){return(0,s.Z)("MuiDialogTitle",e)}const o=(0,n.Z)("MuiDialogTitle",["root"])},19456:(e,t,r)=>{"use strict";r.d(t,{Z:()=>T});var n=r(93244),s=r(53669),i=r(44441),o=r(9795),a=r(18157),c=r(13547),l=r(14544),h=r(25794),u=r(40751),d=r(70831),p=r(8604),f=r(96880),y=r(48908),g=r(96420);function m(e){return(0,g.Z)("MuiDialog",e)}const w=(0,y.Z)("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]);var b=r(99112),v=r(87888),E=r(96570),_=r(17774);const S=["aria-describedby","aria-labelledby","BackdropComponent","BackdropProps","children","className","disableEscapeKeyDown","fullScreen","fullWidth","maxWidth","onBackdropClick","onClose","open","PaperComponent","PaperProps","scroll","TransitionComponent","transitionDuration","TransitionProps"],A=(0,f.ZP)(v.Z,{name:"MuiDialog",slot:"Backdrop",overrides:(e,t)=>t.backdrop})({zIndex:-1}),I=(0,f.ZP)(h.Z,{name:"MuiDialog",slot:"Root",overridesResolver:(e,t)=>t.root})({"@media print":{position:"absolute !important"}}),R=(0,f.ZP)("div",{name:"MuiDialog",slot:"Container",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.container,t[`scroll${(0,l.Z)(r.scroll)}`]]}})((({ownerState:e})=>(0,s.Z)({height:"100%","@media print":{height:"auto"},outline:0},"paper"===e.scroll&&{display:"flex",justifyContent:"center",alignItems:"center"},"body"===e.scroll&&{overflowY:"auto",overflowX:"hidden",textAlign:"center","&:after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}}))),k=(0,f.ZP)(d.Z,{name:"MuiDialog",slot:"Paper",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.paper,t[`scrollPaper${(0,l.Z)(r.scroll)}`],t[`paperWidth${(0,l.Z)(String(r.maxWidth))}`],r.fullWidth&&t.paperFullWidth,r.fullScreen&&t.paperFullScreen]}})((({theme:e,ownerState:t})=>(0,s.Z)({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"}},"paper"===t.scroll&&{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"},"body"===t.scroll&&{display:"inline-block",verticalAlign:"middle",textAlign:"left"},!t.maxWidth&&{maxWidth:"calc(100% - 64px)"},"xs"===t.maxWidth&&{maxWidth:"px"===e.breakpoints.unit?Math.max(e.breakpoints.values.xs,444):`${e.breakpoints.values.xs}${e.breakpoints.unit}`,[`&.${w.paperScrollBody}`]:{[e.breakpoints.down(Math.max(e.breakpoints.values.xs,444)+64)]:{maxWidth:"calc(100% - 64px)"}}},t.maxWidth&&"xs"!==t.maxWidth&&{maxWidth:`${e.breakpoints.values[t.maxWidth]}${e.breakpoints.unit}`,[`&.${w.paperScrollBody}`]:{[e.breakpoints.down(e.breakpoints.values[t.maxWidth]+64)]:{maxWidth:"calc(100% - 64px)"}}},t.fullWidth&&{width:"calc(100% - 64px)"},t.fullScreen&&{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${w.paperScrollBody}`]:{margin:0,maxWidth:"100%"}}))),T=i.forwardRef((function(e,t){const r=(0,p.Z)({props:e,name:"MuiDialog"}),h=(0,E.Z)(),f={enter:h.transitions.duration.enteringScreen,exit:h.transitions.duration.leavingScreen},{"aria-describedby":y,"aria-labelledby":g,BackdropComponent:w,BackdropProps:v,children:T,className:C,disableEscapeKeyDown:P=!1,fullScreen:N=!1,fullWidth:D=!1,maxWidth:O="sm",onBackdropClick:x,onClose:L,open:B,PaperComponent:M=d.Z,PaperProps:U={},scroll:z="paper",TransitionComponent:V=u.Z,transitionDuration:F=f,TransitionProps:j}=r,K=(0,n.Z)(r,S),$=(0,s.Z)({},r,{disableEscapeKeyDown:P,fullScreen:N,fullWidth:D,maxWidth:O,scroll:z}),H=(e=>{const{classes:t,scroll:r,maxWidth:n,fullWidth:s,fullScreen:i}=e,o={root:["root"],container:["container",`scroll${(0,l.Z)(r)}`],paper:["paper",`paperScroll${(0,l.Z)(r)}`,`paperWidth${(0,l.Z)(String(n))}`,s&&"paperFullWidth",i&&"paperFullScreen"]};return(0,a.Z)(o,m,t)})($),q=i.useRef(),G=(0,c.Z)(g),W=i.useMemo((()=>({titleId:G})),[G]);return(0,_.jsx)(I,(0,s.Z)({className:(0,o.Z)(H.root,C),closeAfterTransition:!0,components:{Backdrop:A},componentsProps:{backdrop:(0,s.Z)({transitionDuration:F,as:w},v)},disableEscapeKeyDown:P,onClose:L,open:B,ref:t,onClick:e=>{q.current&&(q.current=null,x&&x(e),L&&L(e,"backdropClick"))},ownerState:$},K,{children:(0,_.jsx)(V,(0,s.Z)({appear:!0,in:B,timeout:F,role:"presentation"},j,{children:(0,_.jsx)(R,{className:(0,o.Z)(H.container),onMouseDown:e=>{q.current=e.target===e.currentTarget},ownerState:$,children:(0,_.jsx)(k,(0,s.Z)({as:M,elevation:24,role:"dialog","aria-describedby":y,"aria-labelledby":G},U,{className:(0,o.Z)(H.paper,U.className),ownerState:$,children:(0,_.jsx)(b.Z.Provider,{value:W,children:T})}))})}))}))}))},99112:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});const n=(0,r(44441).createContext)({})},40438:(e,t,r)=>{"use strict";r.d(t,{Z:()=>g});var n=r(93244),s=r(53669),i=r(44441),o=r(9795),a=r(18157),c=r(82813),l=r(96880),h=r(8604),u=r(96070),d=r(17774);const p=["absolute","children","className","component","flexItem","light","orientation","role","textAlign","variant"],f=(0,l.ZP)("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.absolute&&t.absolute,t[r.variant],r.light&&t.light,"vertical"===r.orientation&&t.vertical,r.flexItem&&t.flexItem,r.children&&t.withChildren,r.children&&"vertical"===r.orientation&&t.withChildrenVertical,"right"===r.textAlign&&"vertical"!==r.orientation&&t.textAlignRight,"left"===r.textAlign&&"vertical"!==r.orientation&&t.textAlignLeft]}})((({theme:e,ownerState:t})=>(0,s.Z)({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(e.vars||e).palette.divider,borderBottomWidth:"thin"},t.absolute&&{position:"absolute",bottom:0,left:0,width:"100%"},t.light&&{borderColor:e.vars?`rgba(${e.vars.palette.dividerChannel} / 0.08)`:(0,c.Fq)(e.palette.divider,.08)},"inset"===t.variant&&{marginLeft:72},"middle"===t.variant&&"horizontal"===t.orientation&&{marginLeft:e.spacing(2),marginRight:e.spacing(2)},"middle"===t.variant&&"vertical"===t.orientation&&{marginTop:e.spacing(1),marginBottom:e.spacing(1)},"vertical"===t.orientation&&{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"},t.flexItem&&{alignSelf:"stretch",height:"auto"})),(({theme:e,ownerState:t})=>(0,s.Z)({},t.children&&{display:"flex",whiteSpace:"nowrap",textAlign:"center",border:0,"&::before, &::after":{position:"relative",width:"100%",borderTop:`thin solid ${(e.vars||e).palette.divider}`,top:"50%",content:'""',transform:"translateY(50%)"}})),(({theme:e,ownerState:t})=>(0,s.Z)({},t.children&&"vertical"===t.orientation&&{flexDirection:"column","&::before, &::after":{height:"100%",top:"0%",left:"50%",borderTop:0,borderLeft:`thin solid ${(e.vars||e).palette.divider}`,transform:"translateX(0%)"}})),(({ownerState:e})=>(0,s.Z)({},"right"===e.textAlign&&"vertical"!==e.orientation&&{"&::before":{width:"90%"},"&::after":{width:"10%"}},"left"===e.textAlign&&"vertical"!==e.orientation&&{"&::before":{width:"10%"},"&::after":{width:"90%"}}))),y=(0,l.ZP)("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.wrapper,"vertical"===r.orientation&&t.wrapperVertical]}})((({theme:e,ownerState:t})=>(0,s.Z)({display:"inline-block",paddingLeft:`calc(${e.spacing(1)} * 1.2)`,paddingRight:`calc(${e.spacing(1)} * 1.2)`},"vertical"===t.orientation&&{paddingTop:`calc(${e.spacing(1)} * 1.2)`,paddingBottom:`calc(${e.spacing(1)} * 1.2)`}))),g=i.forwardRef((function(e,t){const r=(0,h.Z)({props:e,name:"MuiDivider"}),{absolute:i=!1,children:c,className:l,component:g=(c?"div":"hr"),flexItem:m=!1,light:w=!1,orientation:b="horizontal",role:v=("hr"!==g?"separator":void 0),textAlign:E="center",variant:_="fullWidth"}=r,S=(0,n.Z)(r,p),A=(0,s.Z)({},r,{absolute:i,component:g,flexItem:m,light:w,orientation:b,role:v,textAlign:E,variant:_}),I=(e=>{const{absolute:t,children:r,classes:n,flexItem:s,light:i,orientation:o,textAlign:c,variant:l}=e,h={root:["root",t&&"absolute",l,i&&"light","vertical"===o&&"vertical",s&&"flexItem",r&&"withChildren",r&&"vertical"===o&&"withChildrenVertical","right"===c&&"vertical"!==o&&"textAlignRight","left"===c&&"vertical"!==o&&"textAlignLeft"],wrapper:["wrapper","vertical"===o&&"wrapperVertical"]};return(0,a.Z)(h,u.V,n)})(A);return(0,d.jsx)(f,(0,s.Z)({as:g,className:(0,o.Z)(I.root,l),role:v,ref:t,ownerState:A},S,{children:c?(0,d.jsx)(y,{className:I.wrapper,ownerState:A,children:c}):null}))}))},97392:(e,t,r)=>{"use strict";r.d(t,{Z:()=>E});var n=r(93244),s=r(53669),i=r(44441),o=r(9795),a=r(18157),c=r(19238),l=r(14189),h=r(14544),u=r(96880),d=r(8604),p=r(48908),f=r(96420);function y(e){return(0,f.Z)("MuiFormControlLabel",e)}const g=(0,p.Z)("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error"]);var m=r(74648),w=r(17774);const b=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","slotProps","value"],v=(0,u.ZP)("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[{[`& .${g.label}`]:t.label},t.root,t[`labelPlacement${(0,h.Z)(r.labelPlacement)}`]]}})((({theme:e,ownerState:t})=>(0,s.Z)({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${g.disabled}`]:{cursor:"default"}},"start"===t.labelPlacement&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},"top"===t.labelPlacement&&{flexDirection:"column-reverse",marginLeft:16},"bottom"===t.labelPlacement&&{flexDirection:"column",marginLeft:16},{[`& .${g.label}`]:{[`&.${g.disabled}`]:{color:(e.vars||e).palette.text.disabled}}}))),E=i.forwardRef((function(e,t){var r;const u=(0,d.Z)({props:e,name:"MuiFormControlLabel"}),{className:p,componentsProps:f={},control:g,disabled:E,disableTypography:_,label:S,labelPlacement:A="end",slotProps:I={}}=u,R=(0,n.Z)(u,b),k=(0,c.Z)();let T=E;void 0===T&&void 0!==g.props.disabled&&(T=g.props.disabled),void 0===T&&k&&(T=k.disabled);const C={disabled:T};["checked","name","onChange","value","inputRef"].forEach((e=>{void 0===g.props[e]&&void 0!==u[e]&&(C[e]=u[e])}));const P=(0,m.Z)({props:u,muiFormControl:k,states:["error"]}),N=(0,s.Z)({},u,{disabled:T,labelPlacement:A,error:P.error}),D=(e=>{const{classes:t,disabled:r,labelPlacement:n,error:s}=e,i={root:["root",r&&"disabled",`labelPlacement${(0,h.Z)(n)}`,s&&"error"],label:["label",r&&"disabled"]};return(0,a.Z)(i,y,t)})(N),O=null!=(r=I.typography)?r:f.typography;let x=S;return null==x||x.type===l.Z||_||(x=(0,w.jsx)(l.Z,(0,s.Z)({component:"span"},O,{className:(0,o.Z)(D.label,null==O?void 0:O.className),children:x}))),(0,w.jsxs)(v,(0,s.Z)({className:(0,o.Z)(D.root,p),ownerState:N,ref:t},R,{children:[i.cloneElement(g,C),x]}))}))},74648:(e,t,r)=>{"use strict";function n({props:e,states:t,muiFormControl:r}){return t.reduce(((t,n)=>(t[n]=e[n],r&&void 0===e[n]&&(t[n]=r[n]),t)),{})}r.d(t,{Z:()=>n})},19238:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var n=r(44441);const s=n.createContext();function i(){return n.useContext(s)}},42486:(e,t,r)=>{"use strict";r.d(t,{Z:()=>A});var n=r(53669),s=r(93244),i=r(44441),o=r(9795),a=r(18157),c=r(96880),l=r(8604),h=r(48908),u=r(96420);function d(e){return(0,u.Z)("MuiFormGroup",e)}(0,h.Z)("MuiFormGroup",["root","row","error"]);var p=r(19238),f=r(74648),y=r(17774);const g=["className","row"],m=(0,c.ZP)("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.row&&t.row]}})((({ownerState:e})=>(0,n.Z)({display:"flex",flexDirection:"column",flexWrap:"wrap"},e.row&&{flexDirection:"row"}))),w=i.forwardRef((function(e,t){const r=(0,l.Z)({props:e,name:"MuiFormGroup"}),{className:i,row:c=!1}=r,h=(0,s.Z)(r,g),u=(0,p.Z)(),w=(0,f.Z)({props:r,muiFormControl:u,states:["error"]}),b=(0,n.Z)({},r,{row:c,error:w.error}),v=(e=>{const{classes:t,row:r,error:n}=e,s={root:["root",r&&"row",n&&"error"]};return(0,a.Z)(s,d,t)})(b);return(0,y.jsx)(m,(0,n.Z)({className:(0,o.Z)(v.root,i),ownerState:b,ref:t},h))}));var b=r(37797),v=r(67436),E=r(2427),_=r(64136);const S=["actions","children","defaultValue","name","onChange","value"],A=i.forwardRef((function(e,t){const{actions:r,children:o,defaultValue:a,name:c,onChange:l,value:h}=e,u=(0,s.Z)(e,S),d=i.useRef(null),[p,f]=(0,v.Z)({controlled:h,default:a,name:"RadioGroup"});i.useImperativeHandle(r,(()=>({focus:()=>{let e=d.current.querySelector("input:not(:disabled):checked");e||(e=d.current.querySelector("input:not(:disabled)")),e&&e.focus()}})),[]);const g=(0,b.Z)(t,d),m=(0,_.Z)(c),A=i.useMemo((()=>({name:m,onChange(e){f(e.target.value),l&&l(e,e.target.value)},value:p})),[m,l,f,p]);return(0,y.jsx)(E.Z.Provider,{value:A,children:(0,y.jsx)(w,(0,n.Z)({role:"radiogroup",ref:g},u,{children:o}))})}))},2427:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});const n=r(44441).createContext(void 0)},65290:(e,t,r)=>{"use strict";r.d(t,{Z:()=>U});var n=r(93244),s=r(53669),i=r(44441),o=r(9795),a=r(18157),c=r(82813),l=r(14544),h=r(96880),u=r(67436),d=r(19238),p=r(58088),f=r(48908),y=r(96420);function g(e){return(0,y.Z)("PrivateSwitchBase",e)}(0,f.Z)("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);var m=r(17774);const w=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],b=(0,h.ZP)(p.Z)((({ownerState:e})=>(0,s.Z)({padding:9,borderRadius:"50%"},"start"===e.edge&&{marginLeft:"small"===e.size?-3:-12},"end"===e.edge&&{marginRight:"small"===e.size?-3:-12}))),v=(0,h.ZP)("input")({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),E=i.forwardRef((function(e,t){const{autoFocus:r,checked:i,checkedIcon:c,className:h,defaultChecked:p,disabled:f,disableFocusRipple:y=!1,edge:E=!1,icon:_,id:S,inputProps:A,inputRef:I,name:R,onBlur:k,onChange:T,onFocus:C,readOnly:P,required:N,tabIndex:D,type:O,value:x}=e,L=(0,n.Z)(e,w),[B,M]=(0,u.Z)({controlled:i,default:Boolean(p),name:"SwitchBase",state:"checked"}),U=(0,d.Z)();let z=f;U&&void 0===z&&(z=U.disabled);const V="checkbox"===O||"radio"===O,F=(0,s.Z)({},e,{checked:B,disabled:z,disableFocusRipple:y,edge:E}),j=(e=>{const{classes:t,checked:r,disabled:n,edge:s}=e,i={root:["root",r&&"checked",n&&"disabled",s&&`edge${(0,l.Z)(s)}`],input:["input"]};return(0,a.Z)(i,g,t)})(F);return(0,m.jsxs)(b,(0,s.Z)({component:"span",className:(0,o.Z)(j.root,h),centerRipple:!0,focusRipple:!y,disabled:z,tabIndex:null,role:void 0,onFocus:e=>{C&&C(e),U&&U.onFocus&&U.onFocus(e)},onBlur:e=>{k&&k(e),U&&U.onBlur&&U.onBlur(e)},ownerState:F,ref:t},L,{children:[(0,m.jsx)(v,(0,s.Z)({autoFocus:r,checked:i,defaultChecked:p,className:j.input,disabled:z,id:V&&S,name:R,onChange:e=>{if(e.nativeEvent.defaultPrevented)return;const t=e.target.checked;M(t),T&&T(e,t)},readOnly:P,ref:I,required:N,ownerState:F,tabIndex:D,type:O},"checkbox"===O&&void 0===x?{}:{value:x},A)),B?c:_]}))}));var _=r(8604),S=r(13242);const A=(0,S.Z)((0,m.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),I=(0,S.Z)((0,m.jsx)("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),R=(0,h.ZP)("span")({position:"relative",display:"flex"}),k=(0,h.ZP)(A)({transform:"scale(1)"}),T=(0,h.ZP)(I)((({theme:e,ownerState:t})=>(0,s.Z)({left:0,position:"absolute",transform:"scale(0)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeIn,duration:e.transitions.duration.shortest})},t.checked&&{transform:"scale(1)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.shortest})}))),C=function(e){const{checked:t=!1,classes:r={},fontSize:n}=e,i=(0,s.Z)({},e,{checked:t});return(0,m.jsxs)(R,{className:r.root,ownerState:i,children:[(0,m.jsx)(k,{fontSize:n,className:r.background,ownerState:i}),(0,m.jsx)(T,{fontSize:n,className:r.dot,ownerState:i})]})};var P=r(10833),N=r(2427);function D(e){return(0,y.Z)("MuiRadio",e)}const O=(0,f.Z)("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary"]),x=["checked","checkedIcon","color","icon","name","onChange","size","className"],L=(0,h.ZP)(E,{shouldForwardProp:e=>(0,h.FO)(e)||"classes"===e,name:"MuiRadio",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[`color${(0,l.Z)(r.color)}`]]}})((({theme:e,ownerState:t})=>(0,s.Z)({color:(e.vars||e).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:e.vars?`rgba(${"default"===t.color?e.vars.palette.action.activeChannel:e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,c.Fq)("default"===t.color?e.palette.action.active:e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==t.color&&{[`&.${O.checked}`]:{color:(e.vars||e).palette[t.color].main}},{[`&.${O.disabled}`]:{color:(e.vars||e).palette.action.disabled}}))),B=(0,m.jsx)(C,{checked:!0}),M=(0,m.jsx)(C,{}),U=i.forwardRef((function(e,t){var r,c;const h=(0,_.Z)({props:e,name:"MuiRadio"}),{checked:u,checkedIcon:d=B,color:p="primary",icon:f=M,name:y,onChange:g,size:w="medium",className:b}=h,v=(0,n.Z)(h,x),E=(0,s.Z)({},h,{color:p,size:w}),S=(e=>{const{classes:t,color:r}=e,n={root:["root",`color${(0,l.Z)(r)}`]};return(0,s.Z)({},t,(0,a.Z)(n,D,t))})(E),A=i.useContext(N.Z);let I=u;const R=(0,P.Z)(g,A&&A.onChange);let k=y;var T,C;return A&&(void 0===I&&(T=A.value,I="object"==typeof(C=h.value)&&null!==C?T===C:String(T)===String(C)),void 0===k&&(k=A.name)),(0,m.jsx)(L,(0,s.Z)({type:"radio",icon:i.cloneElement(f,{fontSize:null!=(r=M.props.fontSize)?r:w}),checkedIcon:i.cloneElement(d,{fontSize:null!=(c=B.props.fontSize)?c:w}),ownerState:E,classes:S,name:k,checked:I,onChange:R,ref:t,className:(0,o.Z)(S.root,b)},v))}))},89151:(e,t,r)=>{"use strict";r.d(t,{Z:()=>I});var n=r(93244),s=r(53669),i=r(44441),o=r(9795),a=r(418),c=r(18157);var l=r(82813),h=r(96880),u=r(8604),d=r(48908),p=r(96420);function f(e){return(0,p.Z)("MuiSkeleton",e)}(0,d.Z)("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);var y=r(17774);const g=["animation","className","component","height","style","variant","width"];let m,w,b,v,E=e=>e;const _=(0,a.F4)(m||(m=E`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),S=(0,a.F4)(w||(w=E`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),A=(0,h.ZP)("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],!1!==r.animation&&t[r.animation],r.hasChildren&&t.withChildren,r.hasChildren&&!r.width&&t.fitContent,r.hasChildren&&!r.height&&t.heightAuto]}})((({theme:e,ownerState:t})=>{const r=(o=e.shape.borderRadius,String(o).match(/[\d.\-+]*\s*(.*)/)[1]||""||"px"),n=(i=e.shape.borderRadius,parseFloat(i));var i,o;return(0,s.Z)({display:"block",backgroundColor:e.vars?e.vars.palette.Skeleton.bg:(0,l.Fq)(e.palette.text.primary,"light"===e.palette.mode?.11:.13),height:"1.2em"},"text"===t.variant&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${n}${r}/${Math.round(n/.6*10)/10}${r}`,"&:empty:before":{content:'"\\00a0"'}},"circular"===t.variant&&{borderRadius:"50%"},"rounded"===t.variant&&{borderRadius:(e.vars||e).shape.borderRadius},t.hasChildren&&{"& > *":{visibility:"hidden"}},t.hasChildren&&!t.width&&{maxWidth:"fit-content"},t.hasChildren&&!t.height&&{height:"auto"})}),(({ownerState:e})=>"pulse"===e.animation&&(0,a.iv)(b||(b=E`
      animation: ${0} 1.5s ease-in-out 0.5s infinite;
    `),_)),(({ownerState:e,theme:t})=>"wave"===e.animation&&(0,a.iv)(v||(v=E`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 1.6s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),S,(t.vars||t).palette.action.hover))),I=i.forwardRef((function(e,t){const r=(0,u.Z)({props:e,name:"MuiSkeleton"}),{animation:i="pulse",className:a,component:l="span",height:h,style:d,variant:p="text",width:m}=r,w=(0,n.Z)(r,g),b=(0,s.Z)({},r,{animation:i,component:l,variant:p,hasChildren:Boolean(w.children)}),v=(e=>{const{classes:t,variant:r,animation:n,hasChildren:s,width:i,height:o}=e,a={root:["root",r,n,s&&"withChildren",s&&!i&&"fitContent",s&&!o&&"heightAuto"]};return(0,c.Z)(a,f,t)})(b);return(0,y.jsx)(A,(0,s.Z)({as:l,ref:t,className:(0,o.Z)(v.root,a),ownerState:b},w,{style:(0,s.Z)({width:m,height:h},d)}))}))},12835:e=>{"use strict";e.exports=function(e,t){for(var r=new Array(arguments.length-1),n=0,s=2,i=!0;s<arguments.length;)r[n++]=arguments[s++];return new Promise((function(s,o){r[n]=function(e){if(i)if(i=!1,e)o(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];s.apply(null,t)}};try{e.apply(t||null,r)}catch(e){i&&(i=!1,o(e))}}))}},82968:(e,t)=>{"use strict";var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var n=new Array(64),s=new Array(123),i=0;i<64;)s[n[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;r.encode=function(e,t,r){for(var s,i=null,o=[],a=0,c=0;t<r;){var l=e[t++];switch(c){case 0:o[a++]=n[l>>2],s=(3&l)<<4,c=1;break;case 1:o[a++]=n[s|l>>4],s=(15&l)<<2,c=2;break;case 2:o[a++]=n[s|l>>6],o[a++]=n[63&l],c=0}a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0)}return c&&(o[a++]=n[s],o[a++]=61,1===c&&(o[a++]=61)),i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var o="invalid encoding";r.decode=function(e,t,r){for(var n,i=r,a=0,c=0;c<e.length;){var l=e.charCodeAt(c++);if(61===l&&a>1)break;if(void 0===(l=s[l]))throw Error(o);switch(a){case 0:n=l,a=1;break;case 1:t[r++]=n<<2|(48&l)>>4,n=l,a=2;break;case 2:t[r++]=(15&n)<<4|(60&l)>>2,n=l,a=3;break;case 3:t[r++]=(3&n)<<6|l,a=0}}if(1===a)throw Error(o);return r-i},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},25560:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},14278:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function s(e,n,s){t[0]=e,n[s]=r[0],n[s+1]=r[1],n[s+2]=r[2],n[s+3]=r[3]}function i(e,n,s){t[0]=e,n[s]=r[3],n[s+1]=r[2],n[s+2]=r[1],n[s+3]=r[0]}function o(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function a(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?s:i,e.writeFloatBE=n?i:s,e.readFloatLE=n?o:a,e.readFloatBE=n?a:o}():function(){function t(e,t,r,n){var s=t<0?1:0;if(s&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((s<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((s<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var i=Math.floor(Math.log(t)/Math.LN2);e((s<<31|i+127<<23|8388607&Math.round(t*Math.pow(2,-i)*8388608))>>>0,r,n)}}function o(e,t,r){var n=e(t,r),s=2*(n>>31)+1,i=n>>>23&255,o=8388607&n;return 255===i?o?NaN:s*(1/0):0===i?1401298464324817e-60*s*o:s*Math.pow(2,i-150)*(o+8388608)}e.writeFloatLE=t.bind(null,r),e.writeFloatBE=t.bind(null,n),e.readFloatLE=o.bind(null,s),e.readFloatBE=o.bind(null,i)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function s(e,n,s){t[0]=e,n[s]=r[0],n[s+1]=r[1],n[s+2]=r[2],n[s+3]=r[3],n[s+4]=r[4],n[s+5]=r[5],n[s+6]=r[6],n[s+7]=r[7]}function i(e,n,s){t[0]=e,n[s]=r[7],n[s+1]=r[6],n[s+2]=r[5],n[s+3]=r[4],n[s+4]=r[3],n[s+5]=r[2],n[s+6]=r[1],n[s+7]=r[0]}function o(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function a(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?s:i,e.writeDoubleBE=n?i:s,e.readDoubleLE=n?o:a,e.readDoubleBE=n?a:o}():function(){function t(e,t,r,n,s,i){var o=n<0?1:0;if(o&&(n=-n),0===n)e(0,s,i+t),e(1/n>0?0:2147483648,s,i+r);else if(isNaN(n))e(0,s,i+t),e(2146959360,s,i+r);else if(n>17976931348623157e292)e(0,s,i+t),e((o<<31|2146435072)>>>0,s,i+r);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,s,i+t),e((o<<31|a/4294967296)>>>0,s,i+r);else{var c=Math.floor(Math.log(n)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(a=n*Math.pow(2,-c))>>>0,s,i+t),e((o<<31|c+1023<<20|1048576*a&1048575)>>>0,s,i+r)}}}function o(e,t,r,n,s){var i=e(n,s+t),o=e(n,s+r),a=2*(o>>31)+1,c=o>>>20&2047,l=4294967296*(1048575&o)+i;return 2047===c?l?NaN:a*(1/0):0===c?5e-324*a*l:a*Math.pow(2,c-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,r,0,4),e.writeDoubleBE=t.bind(null,n,4,0),e.readDoubleLE=o.bind(null,s,0,4),e.readDoubleBE=o.bind(null,i,4,0)}(),e}function r(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function n(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function i(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},33149:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},66765:e=>{"use strict";e.exports=function(e,t,r){var n=r||8192,s=n>>>1,i=null,o=n;return function(r){if(r<1||r>s)return e(r);o+r>n&&(i=e(n),o=0);var a=t.call(i,o,o+=r);return 7&o&&(o=1+(7|o)),a}}},48301:(e,t)=>{"use strict";var r=t;r.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},r.read=function(e,t,r){if(r-t<1)return"";for(var n,s=null,i=[],o=0;t<r;)(n=e[t++])<128?i[o++]=n:n>191&&n<224?i[o++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,i[o++]=55296+(n>>10),i[o++]=56320+(1023&n)):i[o++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,i)),o=0);return s?(o&&s.push(String.fromCharCode.apply(String,i.slice(0,o))),s.join("")):String.fromCharCode.apply(String,i.slice(0,o))},r.write=function(e,t,r){for(var n,s,i=r,o=0;o<e.length;++o)(n=e.charCodeAt(o))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(s=e.charCodeAt(o+1)))?(n=65536+((1023&n)<<10)+(1023&s),++o,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-i}},8028:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(87531);function s(e,t,r){return void 0===t&&(t=new Uint8Array(2)),void 0===r&&(r=0),t[r+0]=e>>>8,t[r+1]=e>>>0,t}function i(e,t,r){return void 0===t&&(t=new Uint8Array(2)),void 0===r&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t}function o(e,t){return void 0===t&&(t=0),e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function a(e,t){return void 0===t&&(t=0),(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function c(e,t){return void 0===t&&(t=0),e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function l(e,t){return void 0===t&&(t=0),(e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t])>>>0}function h(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),t[r+0]=e>>>24,t[r+1]=e>>>16,t[r+2]=e>>>8,t[r+3]=e>>>0,t}function u(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24,t}function d(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),h(e/4294967296>>>0,t,r),h(e>>>0,t,r+4),t}function p(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),u(e>>>0,t,r),u(e/4294967296>>>0,t,r+4),t}t.readInt16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])<<16>>16},t.readUint16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])>>>0},t.readInt16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])<<16>>16},t.readUint16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])>>>0},t.writeUint16BE=s,t.writeInt16BE=s,t.writeUint16LE=i,t.writeInt16LE=i,t.readInt32BE=o,t.readUint32BE=a,t.readInt32LE=c,t.readUint32LE=l,t.writeUint32BE=h,t.writeInt32BE=h,t.writeUint32LE=u,t.writeInt32LE=u,t.readInt64BE=function(e,t){void 0===t&&(t=0);var r=o(e,t),n=o(e,t+4);return 4294967296*r+n-4294967296*(n>>31)},t.readUint64BE=function(e,t){return void 0===t&&(t=0),4294967296*a(e,t)+a(e,t+4)},t.readInt64LE=function(e,t){void 0===t&&(t=0);var r=c(e,t);return 4294967296*c(e,t+4)+r-4294967296*(r>>31)},t.readUint64LE=function(e,t){void 0===t&&(t=0);var r=l(e,t);return 4294967296*l(e,t+4)+r},t.writeUint64BE=d,t.writeInt64BE=d,t.writeUint64LE=p,t.writeInt64LE=p,t.readUintBE=function(e,t,r){if(void 0===r&&(r=0),e%8!=0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,s=1,i=e/8+r-1;i>=r;i--)n+=t[i]*s,s*=256;return n},t.readUintLE=function(e,t,r){if(void 0===r&&(r=0),e%8!=0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,s=1,i=r;i<r+e/8;i++)n+=t[i]*s,s*=256;return n},t.writeUintBE=function(e,t,r,s){if(void 0===r&&(r=new Uint8Array(e/8)),void 0===s&&(s=0),e%8!=0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!n.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var i=1,o=e/8+s-1;o>=s;o--)r[o]=t/i&255,i*=256;return r},t.writeUintLE=function(e,t,r,s){if(void 0===r&&(r=new Uint8Array(e/8)),void 0===s&&(s=0),e%8!=0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!n.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var i=1,o=s;o<s+e/8;o++)r[o]=t/i&255,i*=256;return r},t.readFloat32BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t)},t.readFloat32LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t,!0)},t.readFloat64BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t)},t.readFloat64LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t,!0)},t.writeFloat32BE=function(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e),t},t.writeFloat32LE=function(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e,!0),t},t.writeFloat64BE=function(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e),t},t.writeFloat64LE=function(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e,!0),t}},73691:(e,t,r)=>{"use strict";var n=r(2988),s=r(13664),i=r(63198),o=r(8028),a=r(19467);t.Cv=32,t.WH=12,t.pg=16;var c=new Uint8Array(16),l=function(){function e(e){if(this.nonceLength=t.WH,this.tagLength=t.pg,e.length!==t.Cv)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(e)}return e.prototype.seal=function(e,t,r,s){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var o=new Uint8Array(16);o.set(e,o.length-e.length);var a=new Uint8Array(32);n.stream(this._key,o,a,4);var c,l=t.length+this.tagLength;if(s){if(s.length!==l)throw new Error("ChaCha20Poly1305: incorrect destination length");c=s}else c=new Uint8Array(l);return n.streamXOR(this._key,o,t,c,4),this._authenticate(c.subarray(c.length-this.tagLength,c.length),a,c.subarray(0,c.length-this.tagLength),r),i.wipe(o),c},e.prototype.open=function(e,t,r,s){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(t.length<this.tagLength)return null;var o=new Uint8Array(16);o.set(e,o.length-e.length);var c=new Uint8Array(32);n.stream(this._key,o,c,4);var l=new Uint8Array(this.tagLength);if(this._authenticate(l,c,t.subarray(0,t.length-this.tagLength),r),!a.equal(l,t.subarray(t.length-this.tagLength,t.length)))return null;var h,u=t.length-this.tagLength;if(s){if(s.length!==u)throw new Error("ChaCha20Poly1305: incorrect destination length");h=s}else h=new Uint8Array(u);return n.streamXOR(this._key,o,t.subarray(0,t.length-this.tagLength),h,4),i.wipe(o),h},e.prototype.clean=function(){return i.wipe(this._key),this},e.prototype._authenticate=function(e,t,r,n){var a=new s.Poly1305(t);n&&(a.update(n),n.length%16>0&&a.update(c.subarray(n.length%16))),a.update(r),r.length%16>0&&a.update(c.subarray(r.length%16));var l=new Uint8Array(8);n&&o.writeUint64LE(n.length,l),a.update(l),o.writeUint64LE(r.length,l),a.update(l);for(var h=a.digest(),u=0;u<h.length;u++)e[u]=h[u];a.clean(),i.wipe(h),i.wipe(l)},e}();t.OK=l},2988:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8028),s=r(63198);function i(e,t,r){for(var s=1634760805,i=857760878,o=2036477234,a=1797285236,c=r[3]<<24|r[2]<<16|r[1]<<8|r[0],l=r[7]<<24|r[6]<<16|r[5]<<8|r[4],h=r[11]<<24|r[10]<<16|r[9]<<8|r[8],u=r[15]<<24|r[14]<<16|r[13]<<8|r[12],d=r[19]<<24|r[18]<<16|r[17]<<8|r[16],p=r[23]<<24|r[22]<<16|r[21]<<8|r[20],f=r[27]<<24|r[26]<<16|r[25]<<8|r[24],y=r[31]<<24|r[30]<<16|r[29]<<8|r[28],g=t[3]<<24|t[2]<<16|t[1]<<8|t[0],m=t[7]<<24|t[6]<<16|t[5]<<8|t[4],w=t[11]<<24|t[10]<<16|t[9]<<8|t[8],b=t[15]<<24|t[14]<<16|t[13]<<8|t[12],v=s,E=i,_=o,S=a,A=c,I=l,R=h,k=u,T=d,C=p,P=f,N=y,D=g,O=m,x=w,L=b,B=0;B<20;B+=2)A=(A^=T=T+(D=(D^=v=v+A|0)>>>16|D<<16)|0)>>>20|A<<12,I=(I^=C=C+(O=(O^=E=E+I|0)>>>16|O<<16)|0)>>>20|I<<12,R=(R^=P=P+(x=(x^=_=_+R|0)>>>16|x<<16)|0)>>>20|R<<12,k=(k^=N=N+(L=(L^=S=S+k|0)>>>16|L<<16)|0)>>>20|k<<12,R=(R^=P=P+(x=(x^=_=_+R|0)>>>24|x<<8)|0)>>>25|R<<7,k=(k^=N=N+(L=(L^=S=S+k|0)>>>24|L<<8)|0)>>>25|k<<7,I=(I^=C=C+(O=(O^=E=E+I|0)>>>24|O<<8)|0)>>>25|I<<7,A=(A^=T=T+(D=(D^=v=v+A|0)>>>24|D<<8)|0)>>>25|A<<7,I=(I^=P=P+(L=(L^=v=v+I|0)>>>16|L<<16)|0)>>>20|I<<12,R=(R^=N=N+(D=(D^=E=E+R|0)>>>16|D<<16)|0)>>>20|R<<12,k=(k^=T=T+(O=(O^=_=_+k|0)>>>16|O<<16)|0)>>>20|k<<12,A=(A^=C=C+(x=(x^=S=S+A|0)>>>16|x<<16)|0)>>>20|A<<12,k=(k^=T=T+(O=(O^=_=_+k|0)>>>24|O<<8)|0)>>>25|k<<7,A=(A^=C=C+(x=(x^=S=S+A|0)>>>24|x<<8)|0)>>>25|A<<7,R=(R^=N=N+(D=(D^=E=E+R|0)>>>24|D<<8)|0)>>>25|R<<7,I=(I^=P=P+(L=(L^=v=v+I|0)>>>24|L<<8)|0)>>>25|I<<7;n.writeUint32LE(v+s|0,e,0),n.writeUint32LE(E+i|0,e,4),n.writeUint32LE(_+o|0,e,8),n.writeUint32LE(S+a|0,e,12),n.writeUint32LE(A+c|0,e,16),n.writeUint32LE(I+l|0,e,20),n.writeUint32LE(R+h|0,e,24),n.writeUint32LE(k+u|0,e,28),n.writeUint32LE(T+d|0,e,32),n.writeUint32LE(C+p|0,e,36),n.writeUint32LE(P+f|0,e,40),n.writeUint32LE(N+y|0,e,44),n.writeUint32LE(D+g|0,e,48),n.writeUint32LE(O+m|0,e,52),n.writeUint32LE(x+w|0,e,56),n.writeUint32LE(L+b|0,e,60)}function o(e,t,r,n,o){if(void 0===o&&(o=0),32!==e.length)throw new Error("ChaCha: key size must be 32 bytes");if(n.length<r.length)throw new Error("ChaCha: destination is shorter than source");var c,l;if(0===o){if(8!==t.length&&12!==t.length)throw new Error("ChaCha nonce must be 8 or 12 bytes");l=(c=new Uint8Array(16)).length-t.length,c.set(t,l)}else{if(16!==t.length)throw new Error("ChaCha nonce with counter must be 16 bytes");c=t,l=o}for(var h=new Uint8Array(64),u=0;u<r.length;u+=64){i(h,c,e);for(var d=u;d<u+64&&d<r.length;d++)n[d]=r[d]^h[d-u];a(c,0,l)}return s.wipe(h),0===o&&s.wipe(c),n}function a(e,t,r){for(var n=1;r--;)n=n+(255&e[t])|0,e[t]=255&n,n>>>=8,t++;if(n>0)throw new Error("ChaCha: counter overflow")}t.streamXOR=o,t.stream=function(e,t,r,n){return void 0===n&&(n=0),s.wipe(r),o(e,t,r,r,n)}},19467:(e,t)=>{"use strict";function r(e,t){if(e.length!==t.length)return 0;for(var r=0,n=0;n<e.length;n++)r|=e[n]^t[n];return 1&r-1>>>8}Object.defineProperty(t,"__esModule",{value:!0}),t.select=function(e,t,r){return~(e-1)&t|e-1&r},t.lessOrEqual=function(e,t){return(0|e)-(0|t)-1>>>31&1},t.compare=r,t.equal=function(e,t){return 0!==e.length&&0!==t.length&&0!==r(e,t)}},66003:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializableHash=function(e){return void 0!==e.saveState&&void 0!==e.restoreState&&void 0!==e.cleanSavedState}},78770:(e,t,r)=>{"use strict";var n=r(22345),s=r(63198),i=function(){function e(e,t,r,s){void 0===r&&(r=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var i=n.hmac(this._hash,r,t);this._hmac=new n.HMAC(e,i),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return e.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(0===e)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},e.prototype.expand=function(e){for(var t=new Uint8Array(e),r=0;r<t.length;r++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[r]=this._buffer[this._bufpos++];return t},e.prototype.clean=function(){this._hmac.clean(),s.wipe(this._buffer),s.wipe(this._counter),this._bufpos=0},e}();t.t=i},22345:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(66003),s=r(19467),i=r(63198),o=function(){function e(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var r=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(r).clean():r.set(t);for(var s=0;s<r.length;s++)r[s]^=54;for(this._inner.update(r),s=0;s<r.length;s++)r[s]^=106;this._outer.update(r),n.isSerializableHash(this._inner)&&n.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),i.wipe(r)}return e.prototype.reset=function(){if(!n.isSerializableHash(this._inner)||!n.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},e.prototype.clean=function(){n.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),n.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},e.prototype.update=function(e){return this._inner.update(e),this},e.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},e.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},e.prototype.saveState=function(){if(!n.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},e.prototype.restoreState=function(e){if(!n.isSerializableHash(this._inner)||!n.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},e.prototype.cleanSavedState=function(e){if(!n.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},e}();t.HMAC=o,t.hmac=function(e,t,r){var n=new o(e,t);n.update(r);var s=n.digest();return n.clean(),s},t.equal=s.equal},87531:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mul=Math.imul||function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0},t.add=function(e,t){return e+t|0},t.sub=function(e,t){return e-t|0},t.rotl=function(e,t){return e<<t|e>>>32-t},t.rotr=function(e,t){return e<<32-t|e>>>t},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(e){return t.isInteger(e)&&e>=-t.MAX_SAFE_INTEGER&&e<=t.MAX_SAFE_INTEGER}},13664:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(19467),s=r(63198);t.DIGEST_LENGTH=16;var i=function(){function e(e){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var r=e[0]|e[1]<<8;this._r[0]=8191&r;var n=e[2]|e[3]<<8;this._r[1]=8191&(r>>>13|n<<3);var s=e[4]|e[5]<<8;this._r[2]=7939&(n>>>10|s<<6);var i=e[6]|e[7]<<8;this._r[3]=8191&(s>>>7|i<<9);var o=e[8]|e[9]<<8;this._r[4]=255&(i>>>4|o<<12),this._r[5]=o>>>1&8190;var a=e[10]|e[11]<<8;this._r[6]=8191&(o>>>14|a<<2);var c=e[12]|e[13]<<8;this._r[7]=8065&(a>>>11|c<<5);var l=e[14]|e[15]<<8;this._r[8]=8191&(c>>>8|l<<8),this._r[9]=l>>>5&127,this._pad[0]=e[16]|e[17]<<8,this._pad[1]=e[18]|e[19]<<8,this._pad[2]=e[20]|e[21]<<8,this._pad[3]=e[22]|e[23]<<8,this._pad[4]=e[24]|e[25]<<8,this._pad[5]=e[26]|e[27]<<8,this._pad[6]=e[28]|e[29]<<8,this._pad[7]=e[30]|e[31]<<8}return e.prototype._blocks=function(e,t,r){for(var n=this._fin?0:2048,s=this._h[0],i=this._h[1],o=this._h[2],a=this._h[3],c=this._h[4],l=this._h[5],h=this._h[6],u=this._h[7],d=this._h[8],p=this._h[9],f=this._r[0],y=this._r[1],g=this._r[2],m=this._r[3],w=this._r[4],b=this._r[5],v=this._r[6],E=this._r[7],_=this._r[8],S=this._r[9];r>=16;){var A=e[t+0]|e[t+1]<<8;s+=8191&A;var I=e[t+2]|e[t+3]<<8;i+=8191&(A>>>13|I<<3);var R=e[t+4]|e[t+5]<<8;o+=8191&(I>>>10|R<<6);var k=e[t+6]|e[t+7]<<8;a+=8191&(R>>>7|k<<9);var T=e[t+8]|e[t+9]<<8;c+=8191&(k>>>4|T<<12),l+=T>>>1&8191;var C=e[t+10]|e[t+11]<<8;h+=8191&(T>>>14|C<<2);var P=e[t+12]|e[t+13]<<8;u+=8191&(C>>>11|P<<5);var N=e[t+14]|e[t+15]<<8,D=0,O=D;O+=s*f,O+=i*(5*S),O+=o*(5*_),O+=a*(5*E),D=(O+=c*(5*v))>>>13,O&=8191,O+=l*(5*b),O+=h*(5*w),O+=u*(5*m),O+=(d+=8191&(P>>>8|N<<8))*(5*g);var x=D+=(O+=(p+=N>>>5|n)*(5*y))>>>13;x+=s*y,x+=i*f,x+=o*(5*S),x+=a*(5*_),D=(x+=c*(5*E))>>>13,x&=8191,x+=l*(5*v),x+=h*(5*b),x+=u*(5*w),x+=d*(5*m),D+=(x+=p*(5*g))>>>13,x&=8191;var L=D;L+=s*g,L+=i*y,L+=o*f,L+=a*(5*S),D=(L+=c*(5*_))>>>13,L&=8191,L+=l*(5*E),L+=h*(5*v),L+=u*(5*b),L+=d*(5*w);var B=D+=(L+=p*(5*m))>>>13;B+=s*m,B+=i*g,B+=o*y,B+=a*f,D=(B+=c*(5*S))>>>13,B&=8191,B+=l*(5*_),B+=h*(5*E),B+=u*(5*v),B+=d*(5*b);var M=D+=(B+=p*(5*w))>>>13;M+=s*w,M+=i*m,M+=o*g,M+=a*y,D=(M+=c*f)>>>13,M&=8191,M+=l*(5*S),M+=h*(5*_),M+=u*(5*E),M+=d*(5*v);var U=D+=(M+=p*(5*b))>>>13;U+=s*b,U+=i*w,U+=o*m,U+=a*g,D=(U+=c*y)>>>13,U&=8191,U+=l*f,U+=h*(5*S),U+=u*(5*_),U+=d*(5*E);var z=D+=(U+=p*(5*v))>>>13;z+=s*v,z+=i*b,z+=o*w,z+=a*m,D=(z+=c*g)>>>13,z&=8191,z+=l*y,z+=h*f,z+=u*(5*S),z+=d*(5*_);var V=D+=(z+=p*(5*E))>>>13;V+=s*E,V+=i*v,V+=o*b,V+=a*w,D=(V+=c*m)>>>13,V&=8191,V+=l*g,V+=h*y,V+=u*f,V+=d*(5*S);var F=D+=(V+=p*(5*_))>>>13;F+=s*_,F+=i*E,F+=o*v,F+=a*b,D=(F+=c*w)>>>13,F&=8191,F+=l*m,F+=h*g,F+=u*y,F+=d*f;var j=D+=(F+=p*(5*S))>>>13;j+=s*S,j+=i*_,j+=o*E,j+=a*v,D=(j+=c*b)>>>13,j&=8191,j+=l*w,j+=h*m,j+=u*g,j+=d*y,s=O=8191&(D=(D=((D+=(j+=p*f)>>>13)<<2)+D|0)+(O&=8191)|0),i=x+=D>>>=13,o=L&=8191,a=B&=8191,c=M&=8191,l=U&=8191,h=z&=8191,u=V&=8191,d=F&=8191,p=j&=8191,t+=16,r-=16}this._h[0]=s,this._h[1]=i,this._h[2]=o,this._h[3]=a,this._h[4]=c,this._h[5]=l,this._h[6]=h,this._h[7]=u,this._h[8]=d,this._h[9]=p},e.prototype.finish=function(e,t){void 0===t&&(t=0);var r,n,s,i,o=new Uint16Array(10);if(this._leftover){for(i=this._leftover,this._buffer[i++]=1;i<16;i++)this._buffer[i]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(r=this._h[1]>>>13,this._h[1]&=8191,i=2;i<10;i++)this._h[i]+=r,r=this._h[i]>>>13,this._h[i]&=8191;for(this._h[0]+=5*r,r=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=r,r=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=r,o[0]=this._h[0]+5,r=o[0]>>>13,o[0]&=8191,i=1;i<10;i++)o[i]=this._h[i]+r,r=o[i]>>>13,o[i]&=8191;for(o[9]-=8192,n=(1^r)-1,i=0;i<10;i++)o[i]&=n;for(n=~n,i=0;i<10;i++)this._h[i]=this._h[i]&n|o[i];for(this._h[0]=65535&(this._h[0]|this._h[1]<<13),this._h[1]=65535&(this._h[1]>>>3|this._h[2]<<10),this._h[2]=65535&(this._h[2]>>>6|this._h[3]<<7),this._h[3]=65535&(this._h[3]>>>9|this._h[4]<<4),this._h[4]=65535&(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14),this._h[5]=65535&(this._h[6]>>>2|this._h[7]<<11),this._h[6]=65535&(this._h[7]>>>5|this._h[8]<<8),this._h[7]=65535&(this._h[8]>>>8|this._h[9]<<5),s=this._h[0]+this._pad[0],this._h[0]=65535&s,i=1;i<8;i++)s=(this._h[i]+this._pad[i]|0)+(s>>>16)|0,this._h[i]=65535&s;return e[t+0]=this._h[0]>>>0,e[t+1]=this._h[0]>>>8,e[t+2]=this._h[1]>>>0,e[t+3]=this._h[1]>>>8,e[t+4]=this._h[2]>>>0,e[t+5]=this._h[2]>>>8,e[t+6]=this._h[3]>>>0,e[t+7]=this._h[3]>>>8,e[t+8]=this._h[4]>>>0,e[t+9]=this._h[4]>>>8,e[t+10]=this._h[5]>>>0,e[t+11]=this._h[5]>>>8,e[t+12]=this._h[6]>>>0,e[t+13]=this._h[6]>>>8,e[t+14]=this._h[7]>>>0,e[t+15]=this._h[7]>>>8,this._finished=!0,this},e.prototype.update=function(e){var t,r=0,n=e.length;if(this._leftover){(t=16-this._leftover)>n&&(t=n);for(var s=0;s<t;s++)this._buffer[this._leftover+s]=e[r+s];if(n-=t,r+=t,this._leftover+=t,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(n>=16&&(t=n-n%16,this._blocks(e,r,t),r+=t,n-=t),n){for(s=0;s<n;s++)this._buffer[this._leftover+s]=e[r+s];this._leftover+=n}return this},e.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var e=new Uint8Array(16);return this.finish(e),e},e.prototype.clean=function(){return s.wipe(this._buffer),s.wipe(this._r),s.wipe(this._h),s.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},e}();t.Poly1305=i,t.oneTimeAuth=function(e,t){var r=new i(e);r.update(t);var n=r.digest();return r.clean(),n},t.equal=function(e,r){return e.length===t.DIGEST_LENGTH&&r.length===t.DIGEST_LENGTH&&n.equal(e,r)}},61783:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const n=r(18609),s=r(8028),i=r(63198);function o(e,r=t.defaultRandomSource){return r.randomBytes(e)}t.defaultRandomSource=new n.SystemRandomSource,t.randomBytes=o,t.randomUint32=function(e=t.defaultRandomSource){const r=o(4,e),n=(0,s.readUint32LE)(r);return(0,i.wipe)(r),n};const a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(e,r=a,n=t.defaultRandomSource){if(r.length<2)throw new Error("randomString charset is too short");if(r.length>256)throw new Error("randomString charset is too long");let s="";const c=r.length,l=256-256%c;for(;e>0;){const t=o(Math.ceil(256*e/l),n);for(let n=0;n<t.length&&e>0;n++){const i=t[n];i<l&&(s+=r.charAt(i%c),e--)}(0,i.wipe)(t)}return s}t.randomString=c,t.randomStringForEntropy=function(e,r=a,n=t.defaultRandomSource){return c(Math.ceil(e/(Math.log(r.length)/Math.LN2)),r,n)}},37146:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserRandomSource=void 0,t.BrowserRandomSource=class{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e="undefined"!=typeof self?self.crypto||self.msCrypto:null;e&&void 0!==e.getRandomValues&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const t=new Uint8Array(e);for(let e=0;e<t.length;e+=65536)this._crypto.getRandomValues(t.subarray(e,e+Math.min(t.length-e,65536)));return t}}},61571:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NodeRandomSource=void 0;const n=r(63198);t.NodeRandomSource=class{constructor(){this.isAvailable=!1,this.isInstantiated=!1;{const e=r(35883);e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const r=new Uint8Array(e);for(let e=0;e<r.length;e++)r[e]=t[e];return(0,n.wipe)(t),r}}},18609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SystemRandomSource=void 0;const n=r(37146),s=r(61571);t.SystemRandomSource=class{constructor(){return this.isAvailable=!1,this.name="",this._source=new n.BrowserRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Browser")):(this._source=new s.NodeRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Node")):void 0)}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}},9020:(e,t,r)=>{"use strict";var n=r(8028),s=r(63198);t.k=32,t.cn=64;var i=function(){function e(){this.digestLength=t.k,this.blockSize=t.cn,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return e.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},e.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},e.prototype.clean=function(){s.wipe(this._buffer),s.wipe(this._temp),this.reset()},e.prototype.update=function(e,t){if(void 0===t&&(t=e.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var r=0;if(this._bytesHashed+=t,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&t>0;)this._buffer[this._bufferLength++]=e[r++],t--;this._bufferLength===this.blockSize&&(a(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(t>=this.blockSize&&(r=a(this._temp,this._state,e,r,t),t%=this.blockSize);t>0;)this._buffer[this._bufferLength++]=e[r++],t--;return this},e.prototype.finish=function(e){if(!this._finished){var t=this._bytesHashed,r=this._bufferLength,s=t/536870912|0,i=t<<3,o=t%64<56?64:128;this._buffer[r]=128;for(var c=r+1;c<o-8;c++)this._buffer[c]=0;n.writeUint32BE(s,this._buffer,o-8),n.writeUint32BE(i,this._buffer,o-4),a(this._temp,this._state,this._buffer,0,o),this._finished=!0}for(c=0;c<this.digestLength/4;c++)n.writeUint32BE(this._state[c],e,4*c);return this},e.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},e.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},e.prototype.restoreState=function(e){return this._state.set(e.state),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},e.prototype.cleanSavedState=function(e){s.wipe(e.state),e.buffer&&s.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},e}();t.mE=i;var o=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function a(e,t,r,s,i){for(;i>=64;){for(var a=t[0],c=t[1],l=t[2],h=t[3],u=t[4],d=t[5],p=t[6],f=t[7],y=0;y<16;y++){var g=s+4*y;e[y]=n.readUint32BE(r,g)}for(y=16;y<64;y++){var m=e[y-2],w=(m>>>17|m<<15)^(m>>>19|m<<13)^m>>>10,b=((m=e[y-15])>>>7|m<<25)^(m>>>18|m<<14)^m>>>3;e[y]=(w+e[y-7]|0)+(b+e[y-16]|0)}for(y=0;y<64;y++)w=(((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))+(u&d^~u&p)|0)+(f+(o[y]+e[y]|0)|0)|0,b=((a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10))+(a&c^a&l^c&l)|0,f=p,p=d,d=u,u=h+w|0,h=l,l=c,c=a,a=w+b|0;t[0]+=a,t[1]+=c,t[2]+=l,t[3]+=h,t[4]+=u,t[5]+=d,t[6]+=p,t[7]+=f,s+=64,i-=64}return s}t.vp=function(e){var t=new i;t.update(e);var r=t.digest();return t.clean(),r}},63198:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wipe=function(e){for(var t=0;t<e.length;t++)e[t]=0;return e}},22621:(e,t,r)=>{"use strict";t.gi=t.Au=t._w=t.KS=t.kz=void 0;const n=r(61783),s=r(63198);function i(e){const t=new Float64Array(16);if(e)for(let r=0;r<e.length;r++)t[r]=e[r];return t}t.kz=32,t.KS=32;const o=new Uint8Array(32);o[0]=9;const a=i([56129,1]);function c(e){let t=1;for(let r=0;r<16;r++){let n=e[r]+t+65535;t=Math.floor(n/65536),e[r]=n-65536*t}e[0]+=t-1+37*(t-1)}function l(e,t,r){const n=~(r-1);for(let r=0;r<16;r++){const s=n&(e[r]^t[r]);e[r]^=s,t[r]^=s}}function h(e,t,r){for(let n=0;n<16;n++)e[n]=t[n]+r[n]}function u(e,t,r){for(let n=0;n<16;n++)e[n]=t[n]-r[n]}function d(e,t,r){let n,s,i=0,o=0,a=0,c=0,l=0,h=0,u=0,d=0,p=0,f=0,y=0,g=0,m=0,w=0,b=0,v=0,E=0,_=0,S=0,A=0,I=0,R=0,k=0,T=0,C=0,P=0,N=0,D=0,O=0,x=0,L=0,B=r[0],M=r[1],U=r[2],z=r[3],V=r[4],F=r[5],j=r[6],K=r[7],$=r[8],H=r[9],q=r[10],G=r[11],W=r[12],Y=r[13],Z=r[14],Q=r[15];n=t[0],i+=n*B,o+=n*M,a+=n*U,c+=n*z,l+=n*V,h+=n*F,u+=n*j,d+=n*K,p+=n*$,f+=n*H,y+=n*q,g+=n*G,m+=n*W,w+=n*Y,b+=n*Z,v+=n*Q,n=t[1],o+=n*B,a+=n*M,c+=n*U,l+=n*z,h+=n*V,u+=n*F,d+=n*j,p+=n*K,f+=n*$,y+=n*H,g+=n*q,m+=n*G,w+=n*W,b+=n*Y,v+=n*Z,E+=n*Q,n=t[2],a+=n*B,c+=n*M,l+=n*U,h+=n*z,u+=n*V,d+=n*F,p+=n*j,f+=n*K,y+=n*$,g+=n*H,m+=n*q,w+=n*G,b+=n*W,v+=n*Y,E+=n*Z,_+=n*Q,n=t[3],c+=n*B,l+=n*M,h+=n*U,u+=n*z,d+=n*V,p+=n*F,f+=n*j,y+=n*K,g+=n*$,m+=n*H,w+=n*q,b+=n*G,v+=n*W,E+=n*Y,_+=n*Z,S+=n*Q,n=t[4],l+=n*B,h+=n*M,u+=n*U,d+=n*z,p+=n*V,f+=n*F,y+=n*j,g+=n*K,m+=n*$,w+=n*H,b+=n*q,v+=n*G,E+=n*W,_+=n*Y,S+=n*Z,A+=n*Q,n=t[5],h+=n*B,u+=n*M,d+=n*U,p+=n*z,f+=n*V,y+=n*F,g+=n*j,m+=n*K,w+=n*$,b+=n*H,v+=n*q,E+=n*G,_+=n*W,S+=n*Y,A+=n*Z,I+=n*Q,n=t[6],u+=n*B,d+=n*M,p+=n*U,f+=n*z,y+=n*V,g+=n*F,m+=n*j,w+=n*K,b+=n*$,v+=n*H,E+=n*q,_+=n*G,S+=n*W,A+=n*Y,I+=n*Z,R+=n*Q,n=t[7],d+=n*B,p+=n*M,f+=n*U,y+=n*z,g+=n*V,m+=n*F,w+=n*j,b+=n*K,v+=n*$,E+=n*H,_+=n*q,S+=n*G,A+=n*W,I+=n*Y,R+=n*Z,k+=n*Q,n=t[8],p+=n*B,f+=n*M,y+=n*U,g+=n*z,m+=n*V,w+=n*F,b+=n*j,v+=n*K,E+=n*$,_+=n*H,S+=n*q,A+=n*G,I+=n*W,R+=n*Y,k+=n*Z,T+=n*Q,n=t[9],f+=n*B,y+=n*M,g+=n*U,m+=n*z,w+=n*V,b+=n*F,v+=n*j,E+=n*K,_+=n*$,S+=n*H,A+=n*q,I+=n*G,R+=n*W,k+=n*Y,T+=n*Z,C+=n*Q,n=t[10],y+=n*B,g+=n*M,m+=n*U,w+=n*z,b+=n*V,v+=n*F,E+=n*j,_+=n*K,S+=n*$,A+=n*H,I+=n*q,R+=n*G,k+=n*W,T+=n*Y,C+=n*Z,P+=n*Q,n=t[11],g+=n*B,m+=n*M,w+=n*U,b+=n*z,v+=n*V,E+=n*F,_+=n*j,S+=n*K,A+=n*$,I+=n*H,R+=n*q,k+=n*G,T+=n*W,C+=n*Y,P+=n*Z,N+=n*Q,n=t[12],m+=n*B,w+=n*M,b+=n*U,v+=n*z,E+=n*V,_+=n*F,S+=n*j,A+=n*K,I+=n*$,R+=n*H,k+=n*q,T+=n*G,C+=n*W,P+=n*Y,N+=n*Z,D+=n*Q,n=t[13],w+=n*B,b+=n*M,v+=n*U,E+=n*z,_+=n*V,S+=n*F,A+=n*j,I+=n*K,R+=n*$,k+=n*H,T+=n*q,C+=n*G,P+=n*W,N+=n*Y,D+=n*Z,O+=n*Q,n=t[14],b+=n*B,v+=n*M,E+=n*U,_+=n*z,S+=n*V,A+=n*F,I+=n*j,R+=n*K,k+=n*$,T+=n*H,C+=n*q,P+=n*G,N+=n*W,D+=n*Y,O+=n*Z,x+=n*Q,n=t[15],v+=n*B,E+=n*M,_+=n*U,S+=n*z,A+=n*V,I+=n*F,R+=n*j,k+=n*K,T+=n*$,C+=n*H,P+=n*q,N+=n*G,D+=n*W,O+=n*Y,x+=n*Z,L+=n*Q,i+=38*E,o+=38*_,a+=38*S,c+=38*A,l+=38*I,h+=38*R,u+=38*k,d+=38*T,p+=38*C,f+=38*P,y+=38*N,g+=38*D,m+=38*O,w+=38*x,b+=38*L,s=1,n=i+s+65535,s=Math.floor(n/65536),i=n-65536*s,n=o+s+65535,s=Math.floor(n/65536),o=n-65536*s,n=a+s+65535,s=Math.floor(n/65536),a=n-65536*s,n=c+s+65535,s=Math.floor(n/65536),c=n-65536*s,n=l+s+65535,s=Math.floor(n/65536),l=n-65536*s,n=h+s+65535,s=Math.floor(n/65536),h=n-65536*s,n=u+s+65535,s=Math.floor(n/65536),u=n-65536*s,n=d+s+65535,s=Math.floor(n/65536),d=n-65536*s,n=p+s+65535,s=Math.floor(n/65536),p=n-65536*s,n=f+s+65535,s=Math.floor(n/65536),f=n-65536*s,n=y+s+65535,s=Math.floor(n/65536),y=n-65536*s,n=g+s+65535,s=Math.floor(n/65536),g=n-65536*s,n=m+s+65535,s=Math.floor(n/65536),m=n-65536*s,n=w+s+65535,s=Math.floor(n/65536),w=n-65536*s,n=b+s+65535,s=Math.floor(n/65536),b=n-65536*s,n=v+s+65535,s=Math.floor(n/65536),v=n-65536*s,i+=s-1+37*(s-1),s=1,n=i+s+65535,s=Math.floor(n/65536),i=n-65536*s,n=o+s+65535,s=Math.floor(n/65536),o=n-65536*s,n=a+s+65535,s=Math.floor(n/65536),a=n-65536*s,n=c+s+65535,s=Math.floor(n/65536),c=n-65536*s,n=l+s+65535,s=Math.floor(n/65536),l=n-65536*s,n=h+s+65535,s=Math.floor(n/65536),h=n-65536*s,n=u+s+65535,s=Math.floor(n/65536),u=n-65536*s,n=d+s+65535,s=Math.floor(n/65536),d=n-65536*s,n=p+s+65535,s=Math.floor(n/65536),p=n-65536*s,n=f+s+65535,s=Math.floor(n/65536),f=n-65536*s,n=y+s+65535,s=Math.floor(n/65536),y=n-65536*s,n=g+s+65535,s=Math.floor(n/65536),g=n-65536*s,n=m+s+65535,s=Math.floor(n/65536),m=n-65536*s,n=w+s+65535,s=Math.floor(n/65536),w=n-65536*s,n=b+s+65535,s=Math.floor(n/65536),b=n-65536*s,n=v+s+65535,s=Math.floor(n/65536),v=n-65536*s,i+=s-1+37*(s-1),e[0]=i,e[1]=o,e[2]=a,e[3]=c,e[4]=l,e[5]=h,e[6]=u,e[7]=d,e[8]=p,e[9]=f,e[10]=y,e[11]=g,e[12]=m,e[13]=w,e[14]=b,e[15]=v}function p(e,t){d(e,t,t)}function f(e,t){const r=new Uint8Array(32),n=new Float64Array(80),s=i(),o=i(),f=i(),y=i(),g=i(),m=i();for(let t=0;t<31;t++)r[t]=e[t];r[31]=127&e[31]|64,r[0]&=248,function(e,t){for(let r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}(n,t);for(let e=0;e<16;e++)o[e]=n[e];s[0]=y[0]=1;for(let e=254;e>=0;--e){const t=r[e>>>3]>>>(7&e)&1;l(s,o,t),l(f,y,t),h(g,s,f),u(s,s,f),h(f,o,y),u(o,o,y),p(y,g),p(m,s),d(s,f,s),d(f,o,g),h(g,s,f),u(s,s,f),p(o,s),u(f,y,m),d(s,f,a),h(s,s,y),d(f,f,s),d(s,y,m),d(y,o,n),p(o,g),l(s,o,t),l(f,y,t)}for(let e=0;e<16;e++)n[e+16]=s[e],n[e+32]=f[e],n[e+48]=o[e],n[e+64]=y[e];const w=n.subarray(32),b=n.subarray(16);!function(e,t){const r=i();for(let e=0;e<16;e++)r[e]=t[e];for(let e=253;e>=0;e--)p(r,r),2!==e&&4!==e&&d(r,r,t);for(let t=0;t<16;t++)e[t]=r[t]}(w,w),d(b,b,w);const v=new Uint8Array(32);return function(e,t){const r=i(),n=i();for(let e=0;e<16;e++)n[e]=t[e];c(n),c(n),c(n);for(let e=0;e<2;e++){r[0]=n[0]-65517;for(let e=1;e<15;e++)r[e]=n[e]-65535-(r[e-1]>>16&1),r[e-1]&=65535;r[15]=n[15]-32767-(r[14]>>16&1);const e=r[15]>>16&1;r[14]&=65535,l(n,r,1-e)}for(let t=0;t<16;t++)e[2*t]=255&n[t],e[2*t+1]=n[t]>>8}(v,b),v}function y(e){if(e.length!==t.KS)throw new Error(`x25519: seed must be ${t.KS} bytes`);const r=new Uint8Array(e);return{publicKey:(n=r,f(n,o)),secretKey:r};var n}t._w=y,t.Au=function(e){const t=(0,n.randomBytes)(32,e),r=y(t);return(0,s.wipe)(t),r},t.gi=function(e,r,n=!1){if(e.length!==t.kz)throw new Error("X25519: incorrect secret key length");if(r.length!==t.kz)throw new Error("X25519: incorrect public key length");const s=f(e,r);if(n){let e=0;for(let t=0;t<s.length;t++)e|=s[t];if(0===e)throw new Error("X25519: invalid shared key")}return s}},3024:(e,t)=>{"use strict";const r=Math.exp;e.exports=function(e){if("number"!=typeof e)throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let t,n,s=0,i=0,o=0,a={push:function(a,c){if(n){const l=1-r(-(a-n)/e),h=c-t;t=l*c+(1-l)*t,s=(1-l)*(s+h*(l*h)),i=Math.sqrt(s),o=t+l*h}else t=c;n=a},movingAverage:function(){return t},variance:function(){return s},deviation:function(){return i},forecast:function(){return o}};return a}},12618:(e,t,r)=>{"use strict";const{fromCallback:n}=r(39874),s=r(39296),{getCallback:i,getOptions:o}=r(53862),a=Symbol("promise"),c=Symbol("status"),l=Symbol("operations"),h=Symbol("finishClose"),u=Symbol("closeCallbacks");t.AbstractChainedBatch=class{constructor(e){if("object"!=typeof e||null===e)throw new TypeError("The first argument must be an abstract-level database, received "+(null===e?"null":typeof e));this[l]=[],this[u]=[],this[c]="open",this[h]=this[h].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[l].length}put(e,t,r){if("open"!==this[c])throw new s("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e)||this.db._checkValue(t);if(n)throw n;const i=r&&null!=r.sublevel?r.sublevel:this.db,o=r,a=i.keyEncoding(r&&r.keyEncoding),h=i.valueEncoding(r&&r.valueEncoding),u=a.format;r={...r,keyEncoding:u,valueEncoding:h.format},i!==this.db&&(r.sublevel=null);const d=i.prefixKey(a.encode(e),u),p=h.encode(t);return this._put(d,p,r),this[l].push({...o,type:"put",key:e,value:t}),this}_put(e,t,r){}del(e,t){if("open"!==this[c])throw new s("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const r=this.db._checkKey(e);if(r)throw r;const n=t&&null!=t.sublevel?t.sublevel:this.db,i=t,o=n.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},n!==this.db&&(t.sublevel=null),this._del(n.prefixKey(o.encode(e),a),t),this[l].push({...i,type:"del",key:e}),this}_del(e,t){}clear(){if("open"!==this[c])throw new s("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[l]=[],this}_clear(){}write(e,t){return t=i(e,t),t=n(t,a),e=o(e),"open"!==this[c]?this.nextTick(t,new s("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):0===this.length?this.close(t):(this[c]="writing",this._write(e,(e=>{this[c]="closing",this[u].push((()=>t(e))),e||this.db.emit("batch",this[l]),this._close(this[h])}))),t[a]}_write(e,t){}close(e){return e=n(e,a),"closing"===this[c]?this[u].push(e):"closed"===this[c]?this.nextTick(e):(this[u].push(e),"writing"!==this[c]&&(this[c]="closing",this._close(this[h]))),e[a]}_close(e){this.nextTick(e)}[h](){this[c]="closed",this.db.detachResource(this);const e=this[u];this[u]=[];for(const t of e)t()}}},40060:(e,t,r)=>{"use strict";var n=r(82784);const{fromCallback:s}=r(39874),i=r(39296),{getOptions:o,getCallback:a}=r(53862),c=Symbol("promise"),l=Symbol("callback"),h=Symbol("working"),u=Symbol("handleOne"),d=Symbol("handleMany"),p=Symbol("autoClose"),f=Symbol("finishWork"),y=Symbol("returnMany"),g=Symbol("closing"),m=Symbol("handleClose"),w=Symbol("closed"),b=Symbol("closeCallbacks"),v=Symbol("keyEncoding"),E=Symbol("valueEncoding"),_=Symbol("abortOnClose"),S=Symbol("legacy"),A=Symbol("keys"),I=Symbol("values"),R=Symbol("limit"),k=Symbol("count"),T=Object.freeze({}),C=()=>{};let P=!1;class N{constructor(e,t,r){if("object"!=typeof e||null===e)throw new TypeError("The first argument must be an abstract-level database, received "+(null===e?"null":typeof e));if("object"!=typeof t||null===t)throw new TypeError("The second argument must be an options object");this[w]=!1,this[b]=[],this[h]=!1,this[g]=!1,this[p]=!1,this[l]=null,this[u]=this[u].bind(this),this[d]=this[d].bind(this),this[m]=this[m].bind(this),this[v]=t[v],this[E]=t[E],this[S]=r,this[R]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[k]=0,this[_]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[k]}get limit(){return this[R]}next(e){let t;if(void 0===e)t=new Promise(((t,r)=>{e=(e,n,s)=>{e?r(e):this[S]?void 0===n&&void 0===s?t():t([n,s]):t(n)}}));else if("function"!=typeof e)throw new TypeError("Callback must be a function");return this[g]?this.nextTick(e,new i("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[h]?this.nextTick(e,new i("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[h]=!0,this[l]=e,this[k]>=this[R]?this.nextTick(this[u],null):this._next(this[u])),t}_next(e){this.nextTick(e)}nextv(e,t,r){return r=a(t,r),r=s(r,c),t=o(t,T),Number.isInteger(e)?(this[g]?this.nextTick(r,new i("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[h]?this.nextTick(r,new i("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[R]<1/0&&(e=Math.min(e,this[R]-this[k])),this[h]=!0,this[l]=r,e<=0?this.nextTick(this[d],null,[]):this._nextv(e,t,this[d])),r[c]):(this.nextTick(r,new TypeError("The first argument 'size' must be an integer")),r[c])}_nextv(e,t,r){const n=[],s=(t,i,o)=>t?r(t):(this[S]?void 0===i&&void 0===o:void 0===i)?r(null,n):(n.push(this[S]?[i,o]:i),void(n.length===e?r(null,n):this._next(s)));this._next(s)}all(e,t){return t=a(e,t),t=s(t,c),e=o(e,T),this[g]?this.nextTick(t,new i("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[h]?this.nextTick(t,new i("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[h]=!0,this[l]=t,this[p]=!0,this[k]>=this[R]?this.nextTick(this[d],null,[]):this._all(e,this[d])),t[c]}_all(e,t){let r=this[k];const n=[],s=()=>{const e=this[R]<1/0?Math.min(1e3,this[R]-r):1e3;e<=0?this.nextTick(t,null,n):this._nextv(e,T,i)},i=(e,i)=>{e?t(e):0===i.length?t(null,n):(n.push.apply(n,i),r+=i.length,s())};s()}[f](){const e=this[l];return this[_]&&null===e?C:(this[h]=!1,this[l]=null,this[g]&&this._close(this[m]),e)}[y](e,t,r){this[p]?this.close(e.bind(null,t,r)):e(t,r)}seek(e,t){if(t=o(t,T),this[g]);else{if(this[h])throw new i("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const r=this.db.keyEncoding(t.keyEncoding||this[v]),n=r.format;t.keyEncoding!==n&&(t={...t,keyEncoding:n});const s=this.db.prefixKey(r.encode(e),n);this._seek(s,t)}}}_seek(e,t){throw new i("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=s(e,c),this[w]?this.nextTick(e):this[g]?this[b].push(e):(this[g]=!0,this[b].push(e),this[h]?this[_]&&this[f]()(new i("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[m])),e[c]}_close(e){this.nextTick(e)}[m](){this[w]=!0,this.db.detachResource(this);const e=this[b];this[b]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;void 0!==(e=await this.next());)yield e}finally{this[w]||await this.close()}}}class D extends N{constructor(e,t){super(e,t,!0),this[A]=!1!==t.keys,this[I]=!1!==t.values}[u](e,t,r){const n=this[f]();if(e)return n(e);try{t=this[A]&&void 0!==t?this[v].decode(t):void 0,r=this[I]&&void 0!==r?this[E].decode(r):void 0}catch(e){return n(new O("entry",e))}void 0===t&&void 0===r||this[k]++,n(null,t,r)}[d](e,t){const r=this[f]();if(e)return this[y](r,e);try{for(const e of t){const t=e[0],r=e[1];e[0]=this[A]&&void 0!==t?this[v].decode(t):void 0,e[1]=this[I]&&void 0!==r?this[E].decode(r):void 0}}catch(e){return this[y](r,new O("entries",e))}this[k]+=t.length,this[y](r,null,t)}end(e){return P||void 0===n||(P=!0,n.warn(new i("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}}class O extends i{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const e of["_ended property","_nexting property","_end method"])Object.defineProperty(D.prototype,e.split(" ")[0],{get(){throw new i(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new i(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})}});D.keyEncoding=v,D.valueEncoding=E,t.AbstractIterator=D,t.AbstractKeyIterator=class extends N{constructor(e,t){super(e,t,!1)}[u](e,t){const r=this[f]();if(e)return r(e);try{t=void 0!==t?this[v].decode(t):void 0}catch(e){return r(new O("key",e))}void 0!==t&&this[k]++,r(null,t)}[d](e,t){const r=this[f]();if(e)return this[y](r,e);try{for(let e=0;e<t.length;e++){const r=t[e];t[e]=void 0!==r?this[v].decode(r):void 0}}catch(e){return this[y](r,new O("keys",e))}this[k]+=t.length,this[y](r,null,t)}},t.AbstractValueIterator=class extends N{constructor(e,t){super(e,t,!1)}[u](e,t){const r=this[f]();if(e)return r(e);try{t=void 0!==t?this[E].decode(t):void 0}catch(e){return r(new O("value",e))}void 0!==t&&this[k]++,r(null,t)}[d](e,t){const r=this[f]();if(e)return this[y](r,e);try{for(let e=0;e<t.length;e++){const r=t[e];t[e]=void 0!==r?this[E].decode(r):void 0}}catch(e){return this[y](r,new O("values",e))}this[k]+=t.length,this[y](r,null,t)}}},35028:(e,t,r)=>{"use strict";const{supports:n}=r(28976),{Transcoder:s}=r(29893),{EventEmitter:i}=r(3894),{fromCallback:o}=r(39874),a=r(39296),{AbstractIterator:c}=r(40060),{DefaultKeyIterator:l,DefaultValueIterator:h}=r(81350),{DeferredIterator:u,DeferredKeyIterator:d,DeferredValueIterator:p}=r(26760),{DefaultChainedBatch:f}=r(97341),{getCallback:y,getOptions:g}=r(53862),m=r(10646),w=Symbol("promise"),b=Symbol("landed"),v=Symbol("resources"),E=Symbol("closeResources"),_=Symbol("operations"),S=Symbol("undefer"),A=Symbol("deferOpen"),I=Symbol("options"),R=Symbol("status"),k=Symbol("defaultOptions"),T=Symbol("transcoder"),C=Symbol("keyEncoding"),P=Symbol("valueEncoding"),N=()=>{};class D extends i{constructor(e,t){if(super(),"object"!=typeof e||null===e)throw new TypeError("The first argument 'manifest' must be an object");t=g(t);const{keyEncoding:r,valueEncoding:i,passive:o,...a}=t;this[v]=new Set,this[_]=[],this[A]=!0,this[I]=a,this[R]="opening",this.supports=n(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:!1!==e.snapshots,permanence:!1!==e.permanence,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[T]=new s(L(this)),this[C]=this[T].encoding(r||"utf8"),this[P]=this[T].encoding(i||"utf8");for(const e of this[T].encodings())this.supports.encodings[e.commonName]||(this.supports.encodings[e.commonName]=!0);this[k]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[C].commonName,valueEncoding:this[P].commonName}),key:Object.freeze({keyEncoding:this[C].commonName})},this.nextTick((()=>{this[A]&&this.open({passive:!1},N)}))}get status(){return this[R]}keyEncoding(e){return this[T].encoding(null!=e?e:this[C])}valueEncoding(e){return this[T].encoding(null!=e?e:this[P])}open(e,t){t=y(e,t),t=o(t,w),(e={...this[I],...g(e)}).createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists;const r=e=>{"closing"===this[R]||"opening"===this[R]?this.once(b,e?()=>r(e):r):"open"!==this[R]?t(new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:e})):t()};return e.passive?"opening"===this[R]?this.once(b,r):this.nextTick(r):"closed"===this[R]||this[A]?(this[A]=!1,this[R]="opening",this.emit("opening"),this._open(e,(e=>{if(e)return this[R]="closed",this[E]((()=>{this.emit(b),r(e)})),void this[S]();this[R]="open",this[S](),this.emit(b),"open"===this[R]&&this.emit("open"),"open"===this[R]&&this.emit("ready"),r()}))):"open"===this[R]?this.nextTick(r):this.once(b,(()=>this.open(e,t))),t[w]}_open(e,t){this.nextTick(t)}close(e){e=o(e,w);const t=r=>{"opening"===this[R]||"closing"===this[R]?this.once(b,r?t(r):t):"closed"!==this[R]?e(new a("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:r})):e()};if("open"===this[R]){this[R]="closing",this.emit("closing");const e=e=>{this[R]="open",this[S](),this.emit(b),t(e)};this[E]((()=>{this._close((r=>{if(r)return e(r);this[R]="closed",this[S](),this.emit(b),"closed"===this[R]&&this.emit("closed"),t()}))}))}else"closed"===this[R]?this.nextTick(t):this.once(b,(()=>this.close(e)));return e[w]}[E](e){if(0===this[v].size)return this.nextTick(e);let t=this[v].size,r=!0;const n=()=>{0==--t&&(r?this.nextTick(e):e())};for(const e of this[v])e.close(n);r=!1,this[v].clear()}_close(e){this.nextTick(e)}get(e,t,r){if(r=y(t,r),r=o(r,w),t=g(t,this[k].entry),"opening"===this[R])return this.defer((()=>this.get(e,t,r))),r[w];if(x(this,r))return r[w];const n=this._checkKey(e);if(n)return this.nextTick(r,n),r[w];const s=this.keyEncoding(t.keyEncoding),i=this.valueEncoding(t.valueEncoding),c=s.format,l=i.format;return t.keyEncoding===c&&t.valueEncoding===l||(t=Object.assign({},t,{keyEncoding:c,valueEncoding:l})),this._get(this.prefixKey(s.encode(e),c),t,((e,t)=>{if(e)return("LEVEL_NOT_FOUND"===e.code||e.notFound||/NotFound/i.test(e))&&(e.code||(e.code="LEVEL_NOT_FOUND"),e.notFound||(e.notFound=!0),e.status||(e.status=404)),r(e);try{t=i.decode(t)}catch(e){return r(new a("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:e}))}r(null,t)})),r[w]}_get(e,t,r){this.nextTick(r,new Error("NotFound"))}getMany(e,t,r){if(r=y(t,r),r=o(r,w),t=g(t,this[k].entry),"opening"===this[R])return this.defer((()=>this.getMany(e,t,r))),r[w];if(x(this,r))return r[w];if(!Array.isArray(e))return this.nextTick(r,new TypeError("The first argument 'keys' must be an array")),r[w];if(0===e.length)return this.nextTick(r,null,[]),r[w];const n=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),i=n.format,c=s.format;t.keyEncoding===i&&t.valueEncoding===c||(t=Object.assign({},t,{keyEncoding:i,valueEncoding:c}));const l=new Array(e.length);for(let t=0;t<e.length;t++){const s=e[t],o=this._checkKey(s);if(o)return this.nextTick(r,o),r[w];l[t]=this.prefixKey(n.encode(s),i)}return this._getMany(l,t,((e,t)=>{if(e)return r(e);try{for(let e=0;e<t.length;e++)void 0!==t[e]&&(t[e]=s.decode(t[e]))}catch(e){return r(new a(`Could not decode one or more of ${t.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:e}))}r(null,t)})),r[w]}_getMany(e,t,r){this.nextTick(r,null,new Array(e.length).fill(void 0))}put(e,t,r,n){if(n=y(r,n),n=o(n,w),r=g(r,this[k].entry),"opening"===this[R])return this.defer((()=>this.put(e,t,r,n))),n[w];if(x(this,n))return n[w];const s=this._checkKey(e)||this._checkValue(t);if(s)return this.nextTick(n,s),n[w];const i=this.keyEncoding(r.keyEncoding),a=this.valueEncoding(r.valueEncoding),c=i.format,l=a.format;r.keyEncoding===c&&r.valueEncoding===l||(r=Object.assign({},r,{keyEncoding:c,valueEncoding:l}));const h=this.prefixKey(i.encode(e),c),u=a.encode(t);return this._put(h,u,r,(r=>{if(r)return n(r);this.emit("put",e,t),n()})),n[w]}_put(e,t,r,n){this.nextTick(n)}del(e,t,r){if(r=y(t,r),r=o(r,w),t=g(t,this[k].key),"opening"===this[R])return this.defer((()=>this.del(e,t,r))),r[w];if(x(this,r))return r[w];const n=this._checkKey(e);if(n)return this.nextTick(r,n),r[w];const s=this.keyEncoding(t.keyEncoding),i=s.format;return t.keyEncoding!==i&&(t=Object.assign({},t,{keyEncoding:i})),this._del(this.prefixKey(s.encode(e),i),t,(t=>{if(t)return r(t);this.emit("del",e),r()})),r[w]}_del(e,t,r){this.nextTick(r)}batch(e,t,r){if(!arguments.length){if("opening"===this[R])return new f(this);if("open"!==this[R])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(r="function"==typeof e?e:y(t,r),r=o(r,w),t=g(t,this[k].empty),"opening"===this[R])return this.defer((()=>this.batch(e,t,r))),r[w];if(x(this,r))return r[w];if(!Array.isArray(e))return this.nextTick(r,new TypeError("The first argument 'operations' must be an array")),r[w];if(0===e.length)return this.nextTick(r),r[w];const n=new Array(e.length),{keyEncoding:s,valueEncoding:i,...c}=t;for(let t=0;t<e.length;t++){if("object"!=typeof e[t]||null===e[t])return this.nextTick(r,new TypeError("A batch operation must be an object")),r[w];const o=Object.assign({},e[t]);if("put"!==o.type&&"del"!==o.type)return this.nextTick(r,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),r[w];const a=this._checkKey(o.key);if(a)return this.nextTick(r,a),r[w];const c=null!=o.sublevel?o.sublevel:this,l=c.keyEncoding(o.keyEncoding||s),h=l.format;if(o.key=c.prefixKey(l.encode(o.key),h),o.keyEncoding=h,"put"===o.type){const e=this._checkValue(o.value);if(e)return this.nextTick(r,e),r[w];const t=c.valueEncoding(o.valueEncoding||i);o.value=t.encode(o.value),o.valueEncoding=t.format}c!==this&&(o.sublevel=null),n[t]=o}return this._batch(n,c,(t=>{if(t)return r(t);this.emit("batch",e),r()})),r[w]}_batch(e,t,r){this.nextTick(r)}sublevel(e,t){return this._sublevel(e,O.defaults(t))}_sublevel(e,t){return new O(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=y(e,t),t=o(t,w),e=g(e,this[k].empty),"opening"===this[R])return this.defer((()=>this.clear(e,t))),t[w];if(x(this,t))return t[w];const r=e,n=this.keyEncoding(e.keyEncoding);return(e=m(e,n)).keyEncoding=n.format,0===e.limit?this.nextTick(t):this._clear(e,(e=>{if(e)return t(e);this.emit("clear",r),t()})),t[w]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=m(e,t)).keys=!1!==e.keys,e.values=!1!==e.values,e[c.keyEncoding]=t,e[c.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[R])return new u(this,e);if("open"!==this[R])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new c(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=m(e,t))[c.keyEncoding]=t,e[c.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[R])return new d(this,e);if("open"!==this[R])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new l(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=m(e,t))[c.keyEncoding]=t,e[c.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[R])return new p(this,e);if("open"!==this[R])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new h(this,e)}defer(e){if("function"!=typeof e)throw new TypeError("The first argument must be a function");this[_].push(e)}[S](){if(0===this[_].length)return;const e=this[_];this[_]=[];for(const t of e)t()}attachResource(e){if("object"!=typeof e||null===e||"function"!=typeof e.close)throw new TypeError("The first argument must be a resource object");this[v].add(e)}detachResource(e){this[v].delete(e)}_chainedBatch(){return new f(this)}_checkKey(e){if(null==e)return new a("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(null==e)return new a("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}}D.prototype.nextTick=r(30919);const{AbstractSublevel:O}=r(9728)({AbstractLevel:D});t.AbstractLevel=D,t.AbstractSublevel=O;const x=function(e,t){return"open"!==e[R]&&(e.nextTick(t,new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0)},L=function(e){return Object.keys(e.supports.encodings).filter((t=>!!e.supports.encodings[t]))}},61206:(e,t,r)=>{"use strict";t.AbstractLevel=r(35028).AbstractLevel,t.AbstractSublevel=r(35028).AbstractSublevel,t.AbstractIterator=r(40060).AbstractIterator,t.AbstractKeyIterator=r(40060).AbstractKeyIterator,t.AbstractValueIterator=r(40060).AbstractValueIterator,t.AbstractChainedBatch=r(12618).AbstractChainedBatch},12422:(e,t,r)=>{"use strict";const{AbstractIterator:n,AbstractKeyIterator:s,AbstractValueIterator:i}=r(40060),o=Symbol("unfix"),a=Symbol("iterator"),c=Symbol("handleOne"),l=Symbol("handleMany"),h=Symbol("callback");class u extends n{constructor(e,t,r,n){super(e,t),this[a]=r,this[o]=n,this[c]=this[c].bind(this),this[l]=this[l].bind(this),this[h]=null}[c](e,t,r){const n=this[h];if(e)return n(e);void 0!==t&&(t=this[o](t)),n(e,t,r)}[l](e,t){const r=this[h];if(e)return r(e);for(const e of t){const t=e[0];void 0!==t&&(e[0]=this[o](t))}r(e,t)}}class d extends s{constructor(e,t,r,n){super(e,t),this[a]=r,this[o]=n,this[c]=this[c].bind(this),this[l]=this[l].bind(this),this[h]=null}[c](e,t){const r=this[h];if(e)return r(e);void 0!==t&&(t=this[o](t)),r(e,t)}[l](e,t){const r=this[h];if(e)return r(e);for(let e=0;e<t.length;e++){const r=t[e];void 0!==r&&(t[e]=this[o](r))}r(e,t)}}class p extends i{constructor(e,t,r){super(e,t),this[a]=r}}for(const e of[u,d])e.prototype._next=function(e){this[h]=e,this[a].next(this[c])},e.prototype._nextv=function(e,t,r){this[h]=r,this[a].nextv(e,t,this[l])},e.prototype._all=function(e,t){this[h]=t,this[a].all(e,this[l])};for(const e of[p])e.prototype._next=function(e){this[a].next(e)},e.prototype._nextv=function(e,t,r){this[a].nextv(e,t,r)},e.prototype._all=function(e,t){this[a].all(e,t)};for(const e of[u,d,p])e.prototype._seek=function(e,t){this[a].seek(e,t)},e.prototype._close=function(e){this[a].close(e)};t.AbstractSublevelIterator=u,t.AbstractSublevelKeyIterator=d,t.AbstractSublevelValueIterator=p},9728:(e,t,r)=>{"use strict";const n=r(39296),{Buffer:s}=r(83107)||{},{AbstractSublevelIterator:i,AbstractSublevelKeyIterator:o,AbstractSublevelValueIterator:a}=r(12422),c=Symbol("prefix"),l=Symbol("upperBound"),h=Symbol("prefixRange"),u=Symbol("parent"),d=Symbol("unfix"),p=new TextEncoder,f={separator:"!"};e.exports=function({AbstractLevel:e}){class t extends e{static defaults(e){if("string"==typeof e)throw new n("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(e&&e.open)throw new n("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return null==e?f:e.separator?e:{...e,separator:"!"}}constructor(e,r,s){const{separator:i,manifest:o,...a}=t.defaults(s);r=b(r,i);const h=i.charCodeAt(0)+1,f=e[u]||e;if(!p.encode(r).every((e=>e>h&&e<127)))throw new n(`Prefix must use bytes > ${h} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(y(f,o),a);const g=(e.prefix||"")+i+r+i,v=g.slice(0,-1)+String.fromCharCode(h);this[u]=f,this[c]=new m(g),this[l]=new m(v),this[d]=new w,this.nextTick=f.nextTick}prefixKey(e,t){if("utf8"===t)return this[c].utf8+e;if(0===e.byteLength)return this[c][t];if("view"===t){const t=this[c].view,r=new Uint8Array(t.byteLength+e.byteLength);return r.set(t,0),r.set(e,t.byteLength),r}{const t=this[c].buffer;return s.concat([t,e],t.byteLength+e.byteLength)}}[h](e,t){void 0!==e.gte?e.gte=this.prefixKey(e.gte,t):void 0!==e.gt?e.gt=this.prefixKey(e.gt,t):e.gte=this[c][t],void 0!==e.lte?e.lte=this.prefixKey(e.lte,t):void 0!==e.lt?e.lt=this.prefixKey(e.lt,t):e.lte=this[l][t]}get prefix(){return this[c].utf8}get db(){return this[u]}_open(e,t){this[u].open({passive:!0},t)}_put(e,t,r,n){this[u].put(e,t,r,n)}_get(e,t,r){this[u].get(e,t,r)}_getMany(e,t,r){this[u].getMany(e,t,r)}_del(e,t,r){this[u].del(e,t,r)}_batch(e,t,r){this[u].batch(e,t,r)}_clear(e,t){this[h](e,e.keyEncoding),this[u].clear(e,t)}_iterator(e){this[h](e,e.keyEncoding);const t=this[u].iterator(e),r=this[d].get(this[c].utf8.length,e.keyEncoding);return new i(this,e,t,r)}_keys(e){this[h](e,e.keyEncoding);const t=this[u].keys(e),r=this[d].get(this[c].utf8.length,e.keyEncoding);return new o(this,e,t,r)}_values(e){this[h](e,e.keyEncoding);const t=this[u].values(e);return new a(this,e,t)}}return{AbstractSublevel:t}};const y=function(e,t){return{...e.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...t,encodings:{utf8:g(e,"utf8"),buffer:g(e,"buffer"),view:g(e,"view")}}},g=function(e,t){return!!e.supports.encodings[t]&&e.keyEncoding(t).name===t};class m{constructor(e){this.utf8=e,this.view=p.encode(e),this.buffer=s?s.from(this.view.buffer,0,this.view.byteLength):{}}}class w{constructor(){this.cache=new Map}get(e,t){let r=this.cache.get(t);return void 0===r&&(r="view"===t?function(e,t){return t.subarray(e)}.bind(null,e):function(e,t){return t.slice(e)}.bind(null,e),this.cache.set(t,r)),r}}const b=function(e,t){let r=0,n=e.length;for(;r<n&&e[r]===t;)r++;for(;n>r&&e[n-1]===t;)n--;return e.slice(r,n)}},53862:(e,t)=>{"use strict";t.getCallback=function(e,t){return"function"==typeof e?e:t},t.getOptions=function(e,t){return"object"==typeof e&&null!==e?e:void 0!==t?t:{}}},97341:(e,t,r)=>{"use strict";const{AbstractChainedBatch:n}=r(12618),s=r(39296),i=Symbol("encoded");t.DefaultChainedBatch=class extends n{constructor(e){super(e),this[i]=[]}_put(e,t,r){this[i].push({...r,type:"put",key:e,value:t})}_del(e,t){this[i].push({...t,type:"del",key:e})}_clear(){this[i]=[]}_write(e,t){"opening"===this.db.status?this.db.defer((()=>this._write(e,t))):"open"===this.db.status?0===this[i].length?this.nextTick(t):this.db._batch(this[i],e,t):this.nextTick(t,new s("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}}},81350:(e,t,r)=>{"use strict";const{AbstractKeyIterator:n,AbstractValueIterator:s}=r(40060),i=Symbol("iterator"),o=Symbol("callback"),a=Symbol("handleOne"),c=Symbol("handleMany");class l extends n{constructor(e,t){super(e,t),this[i]=e.iterator({...t,keys:!0,values:!1}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}class h extends s{constructor(e,t){super(e,t),this[i]=e.iterator({...t,keys:!1,values:!0}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}for(const e of[l,h]){const t=e===l,r=t?e=>e[0]:e=>e[1];e.prototype._next=function(e){this[o]=e,this[i].next(this[a])},e.prototype[a]=function(e,r,n){const s=this[o];e?s(e):s(null,t?r:n)},e.prototype._nextv=function(e,t,r){this[o]=r,this[i].nextv(e,t,this[c])},e.prototype._all=function(e,t){this[o]=t,this[i].all(e,this[c])},e.prototype[c]=function(e,t){const n=this[o];e?n(e):n(null,t.map(r))},e.prototype._seek=function(e,t){this[i].seek(e,t)},e.prototype._close=function(e){this[i].close(e)}}t.DefaultKeyIterator=l,t.DefaultValueIterator=h},26760:(e,t,r)=>{"use strict";const{AbstractIterator:n,AbstractKeyIterator:s,AbstractValueIterator:i}=r(40060),o=r(39296),a=Symbol("nut"),c=Symbol("undefer"),l=Symbol("factory");class h extends n{constructor(e,t){super(e,t),this[a]=null,this[l]=()=>e.iterator(t),this.db.defer((()=>this[c]()))}}class u extends s{constructor(e,t){super(e,t),this[a]=null,this[l]=()=>e.keys(t),this.db.defer((()=>this[c]()))}}class d extends i{constructor(e,t){super(e,t),this[a]=null,this[l]=()=>e.values(t),this.db.defer((()=>this[c]()))}}for(const e of[h,u,d])e.prototype[c]=function(){"open"===this.db.status&&(this[a]=this[l]())},e.prototype._next=function(e){null!==this[a]?this[a].next(e):"opening"===this.db.status?this.db.defer((()=>this._next(e))):this.nextTick(e,new o("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._nextv=function(e,t,r){null!==this[a]?this[a].nextv(e,t,r):"opening"===this.db.status?this.db.defer((()=>this._nextv(e,t,r))):this.nextTick(r,new o("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._all=function(e,t){null!==this[a]?this[a].all(t):"opening"===this.db.status?this.db.defer((()=>this._all(e,t))):this.nextTick(t,new o("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._seek=function(e,t){null!==this[a]?this[a]._seek(e,t):"opening"===this.db.status&&this.db.defer((()=>this._seek(e,t)))},e.prototype._close=function(e){null!==this[a]?this[a].close(e):"opening"===this.db.status?this.db.defer((()=>this._close(e))):this.nextTick(e)};t.DeferredIterator=h,t.DeferredKeyIterator=u,t.DeferredValueIterator=d},30919:(e,t,r)=>{"use strict";const n=r(94715);e.exports=function(e,...t){0===t.length?n(e):n((()=>e(...t)))}},10646:(e,t,r)=>{"use strict";const n=r(39296),s=Object.prototype.hasOwnProperty,i=new Set(["lt","lte","gt","gte"]);e.exports=function(e,t){const r={};for(const o in e)if(s.call(e,o)&&"keyEncoding"!==o&&"valueEncoding"!==o){if("start"===o||"end"===o)throw new n(`The legacy range option '${o}' has been removed`,{code:"LEVEL_LEGACY"});if("encoding"===o)throw new n("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});i.has(o)?r[o]=t.encode(e[o]):r[o]=e[o]}return r.reverse=!!r.reverse,r.limit=Number.isInteger(r.limit)&&r.limit>=0?r.limit:-1,r}},92360:e=>{function t(e){const t=new globalThis.AbortController;function r(){t.abort();for(const t of e)t&&t.removeEventListener&&t.removeEventListener("abort",r)}for(const t of e)if(t&&t.addEventListener){if(t.aborted){r();break}t.addEventListener("abort",r)}return t.signal}e.exports=t,e.exports.anySignal=t},18590:(e,t)=>{"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,i=c(e),o=i[0],a=i[1],l=new s(function(e,t,r){return 3*(t+r)/4-r}(0,o,a)),h=0,u=a>0?o-4:o;for(r=0;r<u;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],l[h++]=t>>16&255,l[h++]=t>>8&255,l[h++]=255&t;return 2===a&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,l[h++]=255&t),1===a&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,l[h++]=t>>8&255,l[h++]=255&t),l},t.fromByteArray=function(e){for(var t,n=e.length,s=n%3,i=[],o=16383,a=0,c=n-s;a<c;a+=o)i.push(l(e,a,a+o>c?c:a+o));return 1===s?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===s&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),i.join("")};for(var r=[],n=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=i.length;o<a;++o)r[o]=i[o],n[i.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,n){for(var s,i,o=[],a=t;a<n;a+=3)s=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(r[(i=s)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return o.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},16276:e=>{"use strict";e.exports=async e=>{const t=[];for await(const r of e)t.push(r);return t}},80630:e=>{"use strict";e.exports=async e=>{for await(const t of e);}},68274:(e,t,r)=>{"use strict";const{AbstractLevel:n}=r(61206),s=r(39296),i=r(25161),{fromCallback:o}=r(39874),{Iterator:a}=r(77655),c=r(64741),l=r(57034),h=r(5644),u="level-js-",d=Symbol("idb"),p=Symbol("namePrefix"),f=Symbol("location"),y=Symbol("version"),g=Symbol("store"),m=Symbol("onComplete"),w=Symbol("promise");class b extends n{constructor(e,t,r){if("function"==typeof t||"function"==typeof r)throw new s("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:n,version:i,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),"string"!=typeof e)throw new Error("constructor requires a location string argument");this[f]=e,this[p]=null==n?u:n,this[y]=parseInt(i||1,10),this[d]=null}get location(){return this[f]}get namePrefix(){return this[p]}get version(){return this[y]}get db(){return this[d]}get type(){return"browser-level"}_open(e,t){const r=indexedDB.open(this[p]+this[f],this[y]);r.onerror=function(){t(r.error||new Error("unknown error"))},r.onsuccess=()=>{this[d]=r.result,t()},r.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this[f])||t.createObjectStore(this[f])}}[g](e){return this[d].transaction([this[f]],e).objectStore(this[f])}[m](e,t){const r=e.transaction;r.onabort=function(){t(r.error||new Error("aborted by user"))},r.oncomplete=function(){t(null,e.result)}}_get(e,t,r){const n=this[g]("readonly");let i;try{i=n.get(e)}catch(e){return this.nextTick(r,e)}this[m](i,(function(e,t){return e?r(e):void 0===t?r(new s("Entry not found",{code:"LEVEL_NOT_FOUND"})):void r(null,c(t))}))}_getMany(e,t,r){const n=this[g]("readonly"),s=e.map((e=>t=>{let r;try{r=n.get(e)}catch(e){return t(e)}r.onsuccess=()=>{const e=r.result;t(null,void 0===e?e:c(e))},r.onerror=e=>{e.stopPropagation(),t(r.error)}}));i(s,16,r)}_del(e,t,r){const n=this[g]("readwrite");let s;try{s=n.delete(e)}catch(e){return this.nextTick(r,e)}this[m](s,r)}_put(e,t,r,n){const s=this[g]("readwrite");let i;try{i=s.put(t,e)}catch(e){return this.nextTick(n,e)}this[m](i,n)}_iterator(e){return new a(this,this[f],e)}_batch(e,t,r){const n=this[g]("readwrite"),s=n.transaction;let i,o=0;s.onabort=function(){r(i||s.error||new Error("aborted by user"))},s.oncomplete=function(){r()},function t(){const r=e[o++],a=r.key;let c;try{c="del"===r.type?n.delete(a):n.put(r.value,a)}catch(e){return i=e,void s.abort()}o<e.length?c.onsuccess=t:"function"==typeof s.commit&&s.commit()}()}_clear(e,t){let r,n;try{r=h(e)}catch(e){return this.nextTick(t)}if(e.limit>=0)return l(this,this[f],r,e,t);try{const e=this[g]("readwrite");n=r?e.delete(r):e.clear()}catch(e){return this.nextTick(t,e)}this[m](n,t)}_close(e){this[d].close(),this.nextTick(e)}}b.destroy=function(e,t,r){"function"==typeof t&&(r=t,t=u),r=o(r,w);const n=indexedDB.deleteDatabase(t+e);return n.onsuccess=function(){r()},n.onerror=function(e){r(e)},r[w]},t.BrowserLevel=b},77655:(e,t,r)=>{"use strict";const{AbstractIterator:n}=r(61206),s=r(5644),i=r(64741),o=Symbol("cache"),a=Symbol("finished"),c=Symbol("options"),l=Symbol("currentOptions"),h=Symbol("position"),u=Symbol("location"),d=Symbol("first"),p={};function f(e){"function"==typeof e.commit&&e.commit()}t.Iterator=class extends n{constructor(e,t,r){super(e,r),this[o]=[],this[a]=0===this.limit,this[c]=r,this[l]={...r},this[h]=void 0,this[u]=t,this[d]=!0}_nextv(e,t,r){if(this[d]=!1,this[a])return this.nextTick(r,null,[]);if(this[o].length>0)return e=Math.min(e,this[o].length),this.nextTick(r,null,this[o].splice(0,e));let n;void 0!==this[h]&&(this[c].reverse?(this[l].lt=this[h],this[l].lte=void 0):(this[l].gt=this[h],this[l].gte=void 0));try{n=s(this[l])}catch(e){return this[a]=!0,this.nextTick(r,null,[])}const p=this.db.db.transaction([this[u]],"readonly"),y=p.objectStore(this[u]),g=[];if(this[c].reverse)y[!this[c].values&&y.openKeyCursor?"openKeyCursor":"openCursor"](n,"prev").onsuccess=t=>{const r=t.target.result;if(r){const{key:t,value:n}=r;this[h]=t,g.push([this[c].keys&&void 0!==t?i(t):void 0,this[c].values&&void 0!==n?i(n):void 0]),g.length<e?r.continue():f(p)}else this[a]=!0};else{let t,r;const s=()=>{if(void 0===t||void 0===r)return;const n=Math.max(t.length,r.length);0===n||e===1/0?this[a]=!0:this[h]=t[n-1],g.length=n;for(let e=0;e<n;e++){const n=t[e],s=r[e];g[e]=[this[c].keys&&void 0!==n?i(n):void 0,this[c].values&&void 0!==s?i(s):void 0]}f(p)};this[c].keys||e<1/0?y.getAllKeys(n,e<1/0?e:void 0).onsuccess=e=>{t=e.target.result,s()}:(t=[],this.nextTick(s)),this[c].values?y.getAll(n,e<1/0?e:void 0).onsuccess=e=>{r=e.target.result,s()}:(r=[],this.nextTick(s))}p.onabort=()=>{r(p.error||new Error("aborted by user")),r=null},p.oncomplete=()=>{r(null,g),r=null}}_next(e){if(this[o].length>0){const[t,r]=this[o].shift();this.nextTick(e,null,t,r)}else if(this[a])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[d]&&(this[d]=!1,t=1),this._nextv(t,p,((t,r)=>{if(t)return e(t);this[o]=r,this._next(e)}))}}_all(e,t){this[d]=!1;const r=this[o].splice(0,this[o].length),n=this.limit-this.count-r.length;if(n<=0)return this.nextTick(t,null,r);this._nextv(n,p,((e,n)=>{if(e)return t(e);r.length>0&&(n=r.concat(n)),t(null,n)}))}_seek(e,t){let r;this[d]=!0,this[o]=[],this[a]=!1,this[h]=void 0,this[l]={...this[c]};try{r=s(this[c])}catch(e){return void(this[a]=!0)}null===r||r.includes(e)?this[c].reverse?this[l].lte=e:this[l].gte=e:this[a]=!0}}},57034:e=>{"use strict";e.exports=function(e,t,r,n,s){if(0===n.limit)return e.nextTick(s);const i=e.db.transaction([t],"readwrite"),o=i.objectStore(t);let a=0;i.oncomplete=function(){s()},i.onabort=function(){s(i.error||new Error("aborted by user"))};const c=o.openKeyCursor?"openKeyCursor":"openCursor",l=n.reverse?"prev":"next";o[c](r,l).onsuccess=function(e){const t=e.target.result;t&&(o.delete(t.key).onsuccess=function(){(n.limit<=0||++a<n.limit)&&t.continue()})}}},64741:e=>{"use strict";const t=new TextEncoder;e.exports=function(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):t.encode(e)}},5644:e=>{"use strict";e.exports=function(e){const t=void 0!==e.gte?e.gte:void 0!==e.gt?e.gt:void 0,r=void 0!==e.lte?e.lte:void 0!==e.lt?e.lt:void 0,n=void 0===e.gte,s=void 0===e.lte;return void 0!==t&&void 0!==r?IDBKeyRange.bound(t,r,n,s):void 0!==t?IDBKeyRange.lowerBound(t,n):void 0!==r?IDBKeyRange.upperBound(r,s):null}},83107:(e,t,r)=>{"use strict";var n=r(82784);const s=r(18590),i=r(87267),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50;const a=2147483647;function c(e){if(e>a)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return h(e,t,r)}function h(e,t,r){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|g(e,t);let n=c(r);const s=n.write(e,t);return s!==r&&(n=n.slice(0,s)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Z(e,Uint8Array)){const t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return p(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Z(e,ArrayBuffer)||e&&Z(e.buffer,ArrayBuffer))return f(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(Z(e,SharedArrayBuffer)||e&&Z(e.buffer,SharedArrayBuffer)))return f(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return l.from(n,t,r);const s=function(e){if(l.isBuffer(e)){const t=0|y(e.length),r=c(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||Q(e.length)?c(0):p(e):"Buffer"===e.type&&Array.isArray(e.data)?p(e.data):void 0}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return u(e),c(e<0?0:0|y(e))}function p(e){const t=e.length<0?0:0|y(e.length),r=c(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function f(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,l.prototype),n}function y(e){if(e>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|e}function g(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Z(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let s=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return W(e).length;default:if(s)return n?-1:G(e).length;t=(""+t).toLowerCase(),s=!0}}function m(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return N(this,t,r);case"utf8":case"utf-8":return k(this,t,r);case"ascii":return C(this,t,r);case"latin1":case"binary":return P(this,t,r);case"base64":return R(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function w(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function b(e,t,r,n,s){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),Q(r=+r)&&(r=s?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(s)return-1;r=e.length-1}else if(r<0){if(!s)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,s);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,s);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,s){let i,o=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(s){let n=-1;for(i=r;i<a;i++)if(l(e,i)===l(t,-1===n?0:i-n)){if(-1===n&&(n=i),i-n+1===c)return n*o}else-1!==n&&(i-=i-n),n=-1}else for(r+c>a&&(r=a-c),i=r;i>=0;i--){let r=!0;for(let n=0;n<c;n++)if(l(e,i+n)!==l(t,n)){r=!1;break}if(r)return i}return-1}function E(e,t,r,n){r=Number(r)||0;const s=e.length-r;n?(n=Number(n))>s&&(n=s):n=s;const i=t.length;let o;for(n>i/2&&(n=i/2),o=0;o<n;++o){const n=parseInt(t.substr(2*o,2),16);if(Q(n))return o;e[r+o]=n}return o}function _(e,t,r,n){return Y(G(t,e.length-r),e,r,n)}function S(e,t,r,n){return Y(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function A(e,t,r,n){return Y(W(t),e,r,n)}function I(e,t,r,n){return Y(function(e,t){let r,n,s;const i=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,s=r%256,i.push(s),i.push(n);return i}(t,e.length-r),e,r,n)}function R(e,t,r){return 0===t&&r===e.length?s.fromByteArray(e):s.fromByteArray(e.slice(t,r))}function k(e,t,r){r=Math.min(e.length,r);const n=[];let s=t;for(;s<r;){const t=e[s];let i=null,o=t>239?4:t>223?3:t>191?2:1;if(s+o<=r){let r,n,a,c;switch(o){case 1:t<128&&(i=t);break;case 2:r=e[s+1],128==(192&r)&&(c=(31&t)<<6|63&r,c>127&&(i=c));break;case 3:r=e[s+1],n=e[s+2],128==(192&r)&&128==(192&n)&&(c=(15&t)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:r=e[s+1],n=e[s+2],a=e[s+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),s+=o}return function(e){const t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=T));return r}(n)}t.kMaxLength=a,l.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||void 0===n||"function"!=typeof n.error||n.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,r){return h(e,t,r)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,r){return function(e,t,r){return u(e),e<=0?c(e):void 0!==t?"string"==typeof r?c(e).fill(t,r):c(e).fill(t):c(e)}(e,t,r)},l.allocUnsafe=function(e){return d(e)},l.allocUnsafeSlow=function(e){return d(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(Z(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),Z(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let s=0,i=Math.min(r,n);s<i;++s)if(e[s]!==t[s]){r=e[s],n=t[s];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=l.allocUnsafe(t);let s=0;for(r=0;r<e.length;++r){let t=e[r];if(Z(t,Uint8Array))s+t.length>n.length?(l.isBuffer(t)||(t=l.from(t)),t.copy(n,s)):Uint8Array.prototype.set.call(n,t,s);else{if(!l.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,s)}s+=t.length}return n},l.byteLength=g,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)w(this,t,t+1);return this},l.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)w(this,t,t+3),w(this,t+1,t+2);return this},l.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)w(this,t,t+7),w(this,t+1,t+6),w(this,t+2,t+5),w(this,t+3,t+4);return this},l.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?k(this,0,e):m.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){let e="";const r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},o&&(l.prototype[o]=l.prototype.inspect),l.prototype.compare=function(e,t,r,n,s){if(Z(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===s&&(s=this.length),t<0||r>e.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&t>=r)return 0;if(n>=s)return-1;if(t>=r)return 1;if(this===e)return 0;let i=(s>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0);const a=Math.min(i,o),c=this.slice(n,s),h=e.slice(t,r);for(let e=0;e<a;++e)if(c[e]!==h[e]){i=c[e],o=h[e];break}return i<o?-1:o<i?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return b(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return b(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const s=this.length-t;if((void 0===r||r>s)&&(r=s),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let i=!1;for(;;)switch(n){case"hex":return E(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":case"latin1":case"binary":return S(this,e,t,r);case"base64":return A(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const T=4096;function C(e,t,r){let n="";r=Math.min(e.length,r);for(let s=t;s<r;++s)n+=String.fromCharCode(127&e[s]);return n}function P(e,t,r){let n="";r=Math.min(e.length,r);for(let s=t;s<r;++s)n+=String.fromCharCode(e[s]);return n}function N(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let s="";for(let n=t;n<r;++n)s+=J[e[n]];return s}function D(e,t,r){const n=e.slice(t,r);let s="";for(let e=0;e<n.length-1;e+=2)s+=String.fromCharCode(n[e]+256*n[e+1]);return s}function O(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function x(e,t,r,n,s,i){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function L(e,t,r,n,s){K(t,n,s,e,r,7);let i=Number(t&BigInt(4294967295));e[r++]=i,i>>=8,e[r++]=i,i>>=8,e[r++]=i,i>>=8,e[r++]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function B(e,t,r,n,s){K(t,n,s,e,r,7);let i=Number(t&BigInt(4294967295));e[r+7]=i,i>>=8,e[r+6]=i,i>>=8,e[r+5]=i,i>>=8,e[r+4]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function M(e,t,r,n,s,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(e,t,r,n,s){return t=+t,r>>>=0,s||M(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function z(e,t,r,n,s){return t=+t,r>>>=0,s||M(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,l.prototype),n},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);let n=this[e],s=1,i=0;for(;++i<t&&(s*=256);)n+=this[e+i]*s;return n},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);let n=this[e+--t],s=1;for(;t>0&&(s*=256);)n+=this[e+--t]*s;return n},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=X((function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||H(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,s=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(s)<<BigInt(32))})),l.prototype.readBigUInt64BE=X((function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||H(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],s=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(s)})),l.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);let n=this[e],s=1,i=0;for(;++i<t&&(s*=256);)n+=this[e+i]*s;return s*=128,n>=s&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);let n=t,s=1,i=this[e+--n];for(;n>0&&(s*=256);)i+=this[e+--n]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i},l.prototype.readInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||O(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){e>>>=0,t||O(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=X((function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||H(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),l.prototype.readBigInt64BE=X((function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||H(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)})),l.prototype.readFloatLE=function(e,t){return e>>>=0,t||O(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||O(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||O(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||O(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||x(this,e,t,r,Math.pow(2,8*r)-1,0);let s=1,i=0;for(this[t]=255&e;++i<r&&(s*=256);)this[t+i]=e/s&255;return t+r},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||x(this,e,t,r,Math.pow(2,8*r)-1,0);let s=r-1,i=1;for(this[t+s]=255&e;--s>=0&&(i*=256);)this[t+s]=e/i&255;return t+r},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigUInt64LE=X((function(e,t=0){return L(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=X((function(e,t=0){return B(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);x(this,e,t,r,n-1,-n)}let s=0,i=1,o=0;for(this[t]=255&e;++s<r&&(i*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/i>>0)-o&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);x(this,e,t,r,n-1,-n)}let s=r-1,i=1,o=0;for(this[t+s]=255&e;--s>=0&&(i*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/i>>0)-o&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigInt64LE=X((function(e,t=0){return L(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=X((function(e,t=0){return B(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(e,t,r){return U(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return U(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return z(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return z(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const s=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),s},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{const i=l.isBuffer(e)?e:l.from(e,n),o=i.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<r-t;++s)this[s+t]=i[s%o]}return this};const V={};function F(e,t,r){V[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function j(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function K(e,t,r,n,s,i){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let s;throw s=i>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(i+1)}${n}`:`>= -(2${n} ** ${8*(i+1)-1}${n}) and < 2 ** ${8*(i+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new V.ERR_OUT_OF_RANGE("value",s,e)}!function(e,t,r){$(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||H(t,e.length-(r+1))}(n,s,i)}function $(e,t){if("number"!=typeof e)throw new V.ERR_INVALID_ARG_TYPE(t,"number",e)}function H(e,t,r){if(Math.floor(e)!==e)throw $(e,r),new V.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new V.ERR_BUFFER_OUT_OF_BOUNDS;throw new V.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}F("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),F("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),F("ERR_OUT_OF_RANGE",(function(e,t,r){let n=`The value of "${e}" is out of range.`,s=r;return Number.isInteger(r)&&Math.abs(r)>2**32?s=j(String(r)):"bigint"==typeof r&&(s=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(s=j(s)),s+="n"),n+=` It must be ${t}. Received ${s}`,n}),RangeError);const q=/[^+/0-9A-Za-z-_]/g;function G(e,t){let r;t=t||1/0;const n=e.length;let s=null;const i=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!s){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&i.push(239,191,189);continue}s=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),s=r;continue}r=65536+(s-55296<<10|r-56320)}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function W(e){return s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(q,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Y(e,t,r,n){let s;for(s=0;s<n&&!(s+r>=t.length||s>=e.length);++s)t[s+r]=e[s];return s}function Z(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Q(e){return e!=e}const J=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let s=0;s<16;++s)t[n+s]=e[r]+e[s]}return t}();function X(e){return"undefined"==typeof BigInt?ee:e}function ee(){throw new Error("BigInt not supported")}},13434:e=>{"use strict";e.exports=function(e,t){return"string"==typeof e?o(e):"number"==typeof e?i(e,t):null},e.exports.format=i,e.exports.parse=o;var t=/\B(?=(\d{3})+(?!\d))/g,r=/(?:\.0*|(\.[^0]+)0+)$/,n={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},s=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function i(e,s){if(!Number.isFinite(e))return null;var i=Math.abs(e),o=s&&s.thousandsSeparator||"",a=s&&s.unitSeparator||"",c=s&&void 0!==s.decimalPlaces?s.decimalPlaces:2,l=Boolean(s&&s.fixedDecimals),h=s&&s.unit||"";h&&n[h.toLowerCase()]||(h=i>=n.pb?"PB":i>=n.tb?"TB":i>=n.gb?"GB":i>=n.mb?"MB":i>=n.kb?"KB":"B");var u=(e/n[h.toLowerCase()]).toFixed(c);return l||(u=u.replace(r,"$1")),o&&(u=u.split(".").map((function(e,r){return 0===r?e.replace(t,o):e})).join(".")),u+a+h}function o(e){if("number"==typeof e&&!isNaN(e))return e;if("string"!=typeof e)return null;var t,r=s.exec(e),i="b";return r?(t=parseFloat(r[1]),i=r[4].toLowerCase()):(t=parseInt(e,10),i="b"),isNaN(t)?null:Math.floor(n[i]*t)}},39874:(e,t,r)=>{"use strict";var n=r(31728);t.fromCallback=function(e,t){if(void 0===e){var r=new Promise((function(t,r){e=function(e,n){e?r(e):t(n)}}));e[void 0!==t?t:"promise"]=r}else if("function"!=typeof e)throw new TypeError("Callback must be a function");return e},t.fromPromise=function(e,t){if(void 0===t)return e;e.then((function(e){n((()=>t(null,e)))})).catch((function(e){n((()=>t(e)))}))}},31728:e=>{e.exports="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e)},96342:(e,t,r)=>{"use strict";var n=r(53641),s=r(32175),i=TypeError,o=Object.getOwnPropertyDescriptor,a=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=a?function(e,t){if(s(e)&&!o(e,"length").writable)throw i("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},13578:(e,t,r)=>{var n=r(31639),s=r(89837);e.exports=function(e,t,r){return r.get&&n(r.get,t,{getter:!0}),r.set&&n(r.set,t,{setter:!0}),s.f(e,t,r)}},19515:(e,t,r)=>{"use strict";var n=r(28052),s=r(98413),i=r(75892),o=r(41015),a=r(20774),c=r(86630),l=Function,h=n([].concat),u=n([].join),d={},p=function(e,t,r){if(!o(d,t)){for(var n=[],s=0;s<t;s++)n[s]="a["+s+"]";d[t]=l("C,a","return new C("+u(n,",")+")")}return d[t](e,r)};e.exports=c?l.bind:function(e){var t=s(this),r=t.prototype,n=a(arguments,1),o=function(){var r=h(n,a(arguments));return this instanceof o?p(t,r.length,r):t.apply(e,r)};return i(r)&&(o.prototype=r),o}},87594:(e,t,r)=>{"use strict";var n=r(28052),s=2147483647,i=/[^\0-\u007E]/,o=/[.\u3002\uFF0E\uFF61]/g,a="Overflow: input needs wider integers to process",c=RangeError,l=n(o.exec),h=Math.floor,u=String.fromCharCode,d=n("".charCodeAt),p=n([].join),f=n([].push),y=n("".replace),g=n("".split),m=n("".toLowerCase),w=function(e){return e+22+75*(e<26)},b=function(e,t,r){var n=0;for(e=r?h(e/700):e>>1,e+=h(e/t);e>455;)e=h(e/35),n+=36;return h(n+36*e/(e+38))},v=function(e){var t=[];e=function(e){for(var t=[],r=0,n=e.length;r<n;){var s=d(e,r++);if(s>=55296&&s<=56319&&r<n){var i=d(e,r++);56320==(64512&i)?f(t,((1023&s)<<10)+(1023&i)+65536):(f(t,s),r--)}else f(t,s)}return t}(e);var r,n,i=e.length,o=128,l=0,y=72;for(r=0;r<e.length;r++)(n=e[r])<128&&f(t,u(n));var g=t.length,m=g;for(g&&f(t,"-");m<i;){var v=s;for(r=0;r<e.length;r++)(n=e[r])>=o&&n<v&&(v=n);var E=m+1;if(v-o>h((s-l)/E))throw c(a);for(l+=(v-o)*E,o=v,r=0;r<e.length;r++){if((n=e[r])<o&&++l>s)throw c(a);if(n==o){for(var _=l,S=36;;){var A=S<=y?1:S>=y+26?26:S-y;if(_<A)break;var I=_-A,R=36-A;f(t,u(w(A+I%R))),_=h(I/R),S+=36}f(t,u(w(_))),y=b(l,E,m==g),l=0,m++}}l++,o++}return p(t,"")};e.exports=function(e){var t,r,n=[],s=g(y(m(e),o,"."),".");for(t=0;t<s.length;t++)r=s[t],f(n,l(i,r)?"xn--"+v(r):r);return p(n,".")}},41905:(e,t,r)=>{var n=r(91073),s=r(11001),i=r(99845),o=s("iterator");e.exports=!n((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),i&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[o]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://").host||"#%D0%B1"!==new URL("http://a#").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host}))},75014:(e,t,r)=>{var n=r(9429),s=r(26955),i=r(46215);n({target:"Array",proto:!0},{fill:s}),i("fill")},98290:(e,t,r)=>{"use strict";var n=r(9429),s=r(84033),i=r(58657),o=r(48749),a=r(20078),c=r(96342),l=r(1949),h=r(21992),u=r(52853),d=r(21025),p=r(87798)("splice"),f=Math.max,y=Math.min;n({target:"Array",proto:!0,forced:!p},{splice:function(e,t){var r,n,p,g,m,w,b=s(this),v=a(b),E=i(e,v),_=arguments.length;for(0===_?r=n=0:1===_?(r=0,n=v-E):(r=_-2,n=y(f(o(t),0),v-E)),l(v+r-n),p=h(b,n),g=0;g<n;g++)(m=E+g)in b&&u(p,g,b[m]);if(p.length=n,r<n){for(g=E;g<v-n;g++)w=g+r,(m=g+n)in b?b[w]=b[m]:d(b,w);for(g=v;g>v-n+r;g--)d(b,g-1)}else if(r>n)for(g=v-n;g>E;g--)w=g+r-1,(m=g+n-1)in b?b[w]=b[m]:d(b,w);for(g=0;g<r;g++)b[g+E]=arguments[g+2];return c(b,v-n+r),p}})},37616:(e,t,r)=>{var n=r(9429),s=r(99744),i=r(39345),o=r(19515),a=r(79374),c=r(48127),l=r(75892),h=r(79064),u=r(91073),d=s("Reflect","construct"),p=Object.prototype,f=[].push,y=u((function(){function e(){}return!(d((function(){}),[],e)instanceof e)})),g=!u((function(){d((function(){}))})),m=y||g;n({target:"Reflect",stat:!0,forced:m,sham:m},{construct:function(e,t){a(e),c(t);var r=arguments.length<3?e:a(arguments[2]);if(g&&!y)return d(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return i(f,n,t),new(i(o,e,n))}var s=r.prototype,u=h(l(s)?s:p),m=i(e,u,t);return l(m)?m:u}})},51337:(e,t,r)=>{"use strict";r(75243);var n=r(9429),s=r(41333),i=r(86189),o=r(28052),a=r(53641),c=r(41905),l=r(94678),h=r(56858),u=r(17620),d=r(58161),p=r(40832),f=r(86258),y=r(58068),g=r(41015),m=r(17587),w=r(72023),b=r(48127),v=r(75892),E=r(48303),_=r(79064),S=r(53974),A=r(95981),I=r(43992),R=r(74486),k=r(11001),T=r(98004),C=k("iterator"),P="URLSearchParams",N="URLSearchParamsIterator",D=p.set,O=p.getterFor(P),x=p.getterFor(N),L=Object.getOwnPropertyDescriptor,B=function(e){if(!a)return s[e];var t=L(s,e);return t&&t.value},M=B("fetch"),U=B("Request"),z=B("Headers"),V=U&&U.prototype,F=z&&z.prototype,j=s.RegExp,K=s.TypeError,$=s.decodeURIComponent,H=s.encodeURIComponent,q=o("".charAt),G=o([].join),W=o([].push),Y=o("".replace),Z=o([].shift),Q=o([].splice),J=o("".split),X=o("".slice),ee=/\+/g,te=Array(4),re=function(e){return te[e-1]||(te[e-1]=j("((?:%[\\da-f]{2}){"+e+"})","gi"))},ne=function(e){try{return $(e)}catch(t){return e}},se=function(e){var t=Y(e,ee," "),r=4;try{return $(t)}catch(e){for(;r;)t=Y(t,re(r--),ne);return t}},ie=/[!'()~]|%20/g,oe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},ae=function(e){return oe[e]},ce=function(e){return Y(H(e),ie,ae)},le=d((function(e,t){D(this,{type:N,iterator:A(O(e).entries),kind:t})}),"Iterator",(function(){var e=x(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),r}),!0),he=function(e){this.entries=[],this.url=null,void 0!==e&&(v(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===q(e,0)?X(e,1):e:E(e)))};he.prototype={type:P,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,s,o,a,c,l=I(e);if(l)for(r=(t=A(e,l)).next;!(n=i(r,t)).done;){if(o=(s=A(b(n.value))).next,(a=i(o,s)).done||(c=i(o,s)).done||!i(o,s).done)throw K("Expected sequence with length 2");W(this.entries,{key:E(a.value),value:E(c.value)})}else for(var h in e)g(e,h)&&W(this.entries,{key:h,value:E(e[h])})},parseQuery:function(e){if(e)for(var t,r,n=J(e,"&"),s=0;s<n.length;)(t=n[s++]).length&&(r=J(t,"="),W(this.entries,{key:se(Z(r)),value:se(G(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],W(r,ce(e.key)+"="+ce(e.value));return G(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ue=function(){f(this,de);var e=arguments.length>0?arguments[0]:void 0;D(this,new he(e))},de=ue.prototype;if(h(de,{append:function(e,t){R(arguments.length,2);var r=O(this);W(r.entries,{key:E(e),value:E(t)}),r.updateURL()},delete:function(e){R(arguments.length,1);for(var t=O(this),r=t.entries,n=E(e),s=0;s<r.length;)r[s].key===n?Q(r,s,1):s++;t.updateURL()},get:function(e){R(arguments.length,1);for(var t=O(this).entries,r=E(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){R(arguments.length,1);for(var t=O(this).entries,r=E(e),n=[],s=0;s<t.length;s++)t[s].key===r&&W(n,t[s].value);return n},has:function(e){R(arguments.length,1);for(var t=O(this).entries,r=E(e),n=0;n<t.length;)if(t[n++].key===r)return!0;return!1},set:function(e,t){R(arguments.length,1);for(var r,n=O(this),s=n.entries,i=!1,o=E(e),a=E(t),c=0;c<s.length;c++)(r=s[c]).key===o&&(i?Q(s,c--,1):(i=!0,r.value=a));i||W(s,{key:o,value:a}),n.updateURL()},sort:function(){var e=O(this);T(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=O(this).entries,n=m(e,arguments.length>1?arguments[1]:void 0),s=0;s<r.length;)n((t=r[s++]).value,t.key,this)},keys:function(){return new le(this,"keys")},values:function(){return new le(this,"values")},entries:function(){return new le(this,"entries")}},{enumerable:!0}),l(de,C,de.entries,{name:"entries"}),l(de,"toString",(function(){return O(this).serialize()}),{enumerable:!0}),u(ue,P),n({global:!0,constructor:!0,forced:!c},{URLSearchParams:ue}),!c&&y(z)){var pe=o(F.has),fe=o(F.set),ye=function(e){if(v(e)){var t,r=e.body;if(w(r)===P)return t=e.headers?new z(e.headers):new z,pe(t,"content-type")||fe(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),_(e,{body:S(0,E(r)),headers:S(0,t)})}return e};if(y(M)&&n({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return M(e,arguments.length>1?ye(arguments[1]):{})}}),y(U)){var ge=function(e){return f(this,V),new U(e,arguments.length>1?ye(arguments[1]):{})};V.constructor=ge,ge.prototype=V,n({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:ge})}}e.exports={URLSearchParams:ue,getState:O}},89805:(e,t,r)=>{r(51337)},10510:(e,t,r)=>{"use strict";r(79457);var n,s=r(9429),i=r(53641),o=r(41905),a=r(41333),c=r(17587),l=r(28052),h=r(94678),u=r(13578),d=r(86258),p=r(41015),f=r(77730),y=r(64066),g=r(43519),m=r(79530).codeAt,w=r(87594),b=r(48303),v=r(17620),E=r(74486),_=r(51337),S=r(40832),A=S.set,I=S.getterFor("URL"),R=_.URLSearchParams,k=_.getState,T=a.URL,C=a.TypeError,P=a.parseInt,N=Math.floor,D=Math.pow,O=l("".charAt),x=l(/./.exec),L=l([].join),B=l(1..toString),M=l([].pop),U=l([].push),z=l("".replace),V=l([].shift),F=l("".split),j=l("".slice),K=l("".toLowerCase),$=l([].unshift),H="Invalid scheme",q="Invalid host",G="Invalid port",W=/[a-z]/i,Y=/[\d+-.a-z]/i,Z=/\d/,Q=/^0x/i,J=/^[0-7]+$/,X=/^\d+$/,ee=/^[\da-f]+$/i,te=/[\0\t\n\r #%/:<>?@[\\\]^|]/,re=/[\0\t\n\r #/:<>?@[\\\]^|]/,ne=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,se=/[\t\n\r]/g,ie=function(e){var t,r,n,s;if("number"==typeof e){for(t=[],r=0;r<4;r++)$(t,e%256),e=N(e/256);return L(t,".")}if("object"==typeof e){for(t="",n=function(e){for(var t=null,r=1,n=null,s=0,i=0;i<8;i++)0!==e[i]?(s>r&&(t=n,r=s),n=null,s=0):(null===n&&(n=i),++s);return s>r&&(t=n,r=s),t}(e),r=0;r<8;r++)s&&0===e[r]||(s&&(s=!1),n===r?(t+=r?":":"::",s=!0):(t+=B(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},oe={},ae=f({},oe,{" ":1,'"':1,"<":1,">":1,"`":1}),ce=f({},ae,{"#":1,"?":1,"{":1,"}":1}),le=f({},ce,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),he=function(e,t){var r=m(e,0);return r>32&&r<127&&!p(t,e)?e:encodeURIComponent(e)},ue={ftp:21,file:null,http:80,https:443,ws:80,wss:443},de=function(e,t){var r;return 2==e.length&&x(W,O(e,0))&&(":"==(r=O(e,1))||!t&&"|"==r)},pe=function(e){var t;return e.length>1&&de(j(e,0,2))&&(2==e.length||"/"===(t=O(e,2))||"\\"===t||"?"===t||"#"===t)},fe=function(e){return"."===e||"%2e"===K(e)},ye={},ge={},me={},we={},be={},ve={},Ee={},_e={},Se={},Ae={},Ie={},Re={},ke={},Te={},Ce={},Pe={},Ne={},De={},Oe={},xe={},Le={},Be=function(e,t,r){var n,s,i,o=b(e);if(t){if(s=this.parse(o))throw C(s);this.searchParams=null}else{if(void 0!==r&&(n=new Be(r,!0)),s=this.parse(o,null,n))throw C(s);(i=k(new R)).bindURL(this),this.searchParams=i}};Be.prototype={type:"URL",parse:function(e,t,r){var s,i,o,a,c,l=this,h=t||ye,u=0,d="",f=!1,m=!1,w=!1;for(e=b(e),t||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,e=z(e,ne,"")),e=z(e,se,""),s=y(e);u<=s.length;){switch(i=s[u],h){case ye:if(!i||!x(W,i)){if(t)return H;h=me;continue}d+=K(i),h=ge;break;case ge:if(i&&(x(Y,i)||"+"==i||"-"==i||"."==i))d+=K(i);else{if(":"!=i){if(t)return H;d="",h=me,u=0;continue}if(t&&(l.isSpecial()!=p(ue,d)||"file"==d&&(l.includesCredentials()||null!==l.port)||"file"==l.scheme&&!l.host))return;if(l.scheme=d,t)return void(l.isSpecial()&&ue[l.scheme]==l.port&&(l.port=null));d="","file"==l.scheme?h=Te:l.isSpecial()&&r&&r.scheme==l.scheme?h=we:l.isSpecial()?h=_e:"/"==s[u+1]?(h=be,u++):(l.cannotBeABaseURL=!0,U(l.path,""),h=Oe)}break;case me:if(!r||r.cannotBeABaseURL&&"#"!=i)return H;if(r.cannotBeABaseURL&&"#"==i){l.scheme=r.scheme,l.path=g(r.path),l.query=r.query,l.fragment="",l.cannotBeABaseURL=!0,h=Le;break}h="file"==r.scheme?Te:ve;continue;case we:if("/"!=i||"/"!=s[u+1]){h=ve;continue}h=Se,u++;break;case be:if("/"==i){h=Ae;break}h=De;continue;case ve:if(l.scheme=r.scheme,i==n)l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,l.path=g(r.path),l.query=r.query;else if("/"==i||"\\"==i&&l.isSpecial())h=Ee;else if("?"==i)l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,l.path=g(r.path),l.query="",h=xe;else{if("#"!=i){l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,l.path=g(r.path),l.path.length--,h=De;continue}l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,l.path=g(r.path),l.query=r.query,l.fragment="",h=Le}break;case Ee:if(!l.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,h=De;continue}h=Ae}else h=Se;break;case _e:if(h=Se,"/"!=i||"/"!=O(d,u+1))continue;u++;break;case Se:if("/"!=i&&"\\"!=i){h=Ae;continue}break;case Ae:if("@"==i){f&&(d="%40"+d),f=!0,o=y(d);for(var v=0;v<o.length;v++){var E=o[v];if(":"!=E||w){var _=he(E,le);w?l.password+=_:l.username+=_}else w=!0}d=""}else if(i==n||"/"==i||"?"==i||"#"==i||"\\"==i&&l.isSpecial()){if(f&&""==d)return"Invalid authority";u-=y(d).length+1,d="",h=Ie}else d+=i;break;case Ie:case Re:if(t&&"file"==l.scheme){h=Pe;continue}if(":"!=i||m){if(i==n||"/"==i||"?"==i||"#"==i||"\\"==i&&l.isSpecial()){if(l.isSpecial()&&""==d)return q;if(t&&""==d&&(l.includesCredentials()||null!==l.port))return;if(a=l.parseHost(d))return a;if(d="",h=Ne,t)return;continue}"["==i?m=!0:"]"==i&&(m=!1),d+=i}else{if(""==d)return q;if(a=l.parseHost(d))return a;if(d="",h=ke,t==Re)return}break;case ke:if(!x(Z,i)){if(i==n||"/"==i||"?"==i||"#"==i||"\\"==i&&l.isSpecial()||t){if(""!=d){var S=P(d,10);if(S>65535)return G;l.port=l.isSpecial()&&S===ue[l.scheme]?null:S,d=""}if(t)return;h=Ne;continue}return G}d+=i;break;case Te:if(l.scheme="file","/"==i||"\\"==i)h=Ce;else{if(!r||"file"!=r.scheme){h=De;continue}if(i==n)l.host=r.host,l.path=g(r.path),l.query=r.query;else if("?"==i)l.host=r.host,l.path=g(r.path),l.query="",h=xe;else{if("#"!=i){pe(L(g(s,u),""))||(l.host=r.host,l.path=g(r.path),l.shortenPath()),h=De;continue}l.host=r.host,l.path=g(r.path),l.query=r.query,l.fragment="",h=Le}}break;case Ce:if("/"==i||"\\"==i){h=Pe;break}r&&"file"==r.scheme&&!pe(L(g(s,u),""))&&(de(r.path[0],!0)?U(l.path,r.path[0]):l.host=r.host),h=De;continue;case Pe:if(i==n||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&de(d))h=De;else if(""==d){if(l.host="",t)return;h=Ne}else{if(a=l.parseHost(d))return a;if("localhost"==l.host&&(l.host=""),t)return;d="",h=Ne}continue}d+=i;break;case Ne:if(l.isSpecial()){if(h=De,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=n&&(h=De,"/"!=i))continue}else l.fragment="",h=Le;else l.query="",h=xe;break;case De:if(i==n||"/"==i||"\\"==i&&l.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(c=K(c=d))||"%2e."===c||".%2e"===c||"%2e%2e"===c?(l.shortenPath(),"/"==i||"\\"==i&&l.isSpecial()||U(l.path,"")):fe(d)?"/"==i||"\\"==i&&l.isSpecial()||U(l.path,""):("file"==l.scheme&&!l.path.length&&de(d)&&(l.host&&(l.host=""),d=O(d,0)+":"),U(l.path,d)),d="","file"==l.scheme&&(i==n||"?"==i||"#"==i))for(;l.path.length>1&&""===l.path[0];)V(l.path);"?"==i?(l.query="",h=xe):"#"==i&&(l.fragment="",h=Le)}else d+=he(i,ce);break;case Oe:"?"==i?(l.query="",h=xe):"#"==i?(l.fragment="",h=Le):i!=n&&(l.path[0]+=he(i,oe));break;case xe:t||"#"!=i?i!=n&&("'"==i&&l.isSpecial()?l.query+="%27":l.query+="#"==i?"%23":he(i,oe)):(l.fragment="",h=Le);break;case Le:i!=n&&(l.fragment+=he(i,ae))}u++}},parseHost:function(e){var t,r,n;if("["==O(e,0)){if("]"!=O(e,e.length-1))return q;if(t=function(e){var t,r,n,s,i,o,a,c=[0,0,0,0,0,0,0,0],l=0,h=null,u=0,d=function(){return O(e,u)};if(":"==d()){if(":"!=O(e,1))return;u+=2,h=++l}for(;d();){if(8==l)return;if(":"!=d()){for(t=r=0;r<4&&x(ee,d());)t=16*t+P(d(),16),u++,r++;if("."==d()){if(0==r)return;if(u-=r,l>6)return;for(n=0;d();){if(s=null,n>0){if(!("."==d()&&n<4))return;u++}if(!x(Z,d()))return;for(;x(Z,d());){if(i=P(d(),10),null===s)s=i;else{if(0==s)return;s=10*s+i}if(s>255)return;u++}c[l]=256*c[l]+s,2!=++n&&4!=n||l++}if(4!=n)return;break}if(":"==d()){if(u++,!d())return}else if(d())return;c[l++]=t}else{if(null!==h)return;u++,h=++l}}if(null!==h)for(o=l-h,l=7;0!=l&&o>0;)a=c[l],c[l--]=c[h+o-1],c[h+--o]=a;else if(8!=l)return;return c}(j(e,1,-1)),!t)return q;this.host=t}else if(this.isSpecial()){if(e=w(e),x(te,e))return q;if(t=function(e){var t,r,n,s,i,o,a,c=F(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(r=[],n=0;n<t;n++){if(""==(s=c[n]))return e;if(i=10,s.length>1&&"0"==O(s,0)&&(i=x(Q,s)?16:8,s=j(s,8==i?1:2)),""===s)o=0;else{if(!x(10==i?X:8==i?J:ee,s))return e;o=P(s,i)}U(r,o)}for(n=0;n<t;n++)if(o=r[n],n==t-1){if(o>=D(256,5-t))return null}else if(o>255)return null;for(a=M(r),n=0;n<r.length;n++)a+=r[n]*D(256,3-n);return a}(e),null===t)return q;this.host=t}else{if(x(re,e))return q;for(t="",r=y(e),n=0;n<r.length;n++)t+=he(r[n],oe);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return p(ue,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&de(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,s=e.host,i=e.port,o=e.path,a=e.query,c=e.fragment,l=t+":";return null!==s?(l+="//",e.includesCredentials()&&(l+=r+(n?":"+n:"")+"@"),l+=ie(s),null!==i&&(l+=":"+i)):"file"==t&&(l+="//"),l+=e.cannotBeABaseURL?o[0]:o.length?"/"+L(o,"/"):"",null!==a&&(l+="?"+a),null!==c&&(l+="#"+c),l},setHref:function(e){var t=this.parse(e);if(t)throw C(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new Me(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+ie(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(b(e)+":",ye)},getUsername:function(){return this.username},setUsername:function(e){var t=y(b(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=he(t[r],le)}},getPassword:function(){return this.password},setPassword:function(e){var t=y(b(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=he(t[r],le)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?ie(e):ie(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Ie)},getHostname:function(){var e=this.host;return null===e?"":ie(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Re)},getPort:function(){var e=this.port;return null===e?"":b(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=b(e))?this.port=null:this.parse(e,ke))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+L(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Ne))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=b(e))?this.query=null:("?"==O(e,0)&&(e=j(e,1)),this.query="",this.parse(e,xe)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=b(e))?("#"==O(e,0)&&(e=j(e,1)),this.fragment="",this.parse(e,Le)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Me=function(e){var t=d(this,Ue),r=E(arguments.length,1)>1?arguments[1]:void 0,n=A(t,new Be(e,!1,r));i||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},Ue=Me.prototype,ze=function(e,t){return{get:function(){return I(this)[e]()},set:t&&function(e){return I(this)[t](e)},configurable:!0,enumerable:!0}};if(i&&(u(Ue,"href",ze("serialize","setHref")),u(Ue,"origin",ze("getOrigin")),u(Ue,"protocol",ze("getProtocol","setProtocol")),u(Ue,"username",ze("getUsername","setUsername")),u(Ue,"password",ze("getPassword","setPassword")),u(Ue,"host",ze("getHost","setHost")),u(Ue,"hostname",ze("getHostname","setHostname")),u(Ue,"port",ze("getPort","setPort")),u(Ue,"pathname",ze("getPathname","setPathname")),u(Ue,"search",ze("getSearch","setSearch")),u(Ue,"searchParams",ze("getSearchParams")),u(Ue,"hash",ze("getHash","setHash"))),h(Ue,"toJSON",(function(){return I(this).serialize()}),{enumerable:!0}),h(Ue,"toString",(function(){return I(this).serialize()}),{enumerable:!0}),T){var Ve=T.createObjectURL,Fe=T.revokeObjectURL;Ve&&h(Me,"createObjectURL",c(Ve,T)),Fe&&h(Me,"revokeObjectURL",c(Fe,T))}v(Me,"URL"),s({global:!0,constructor:!0,forced:!o,sham:!i},{URL:Me})},57668:(e,t,r)=>{r(10510)},68071:e=>{"use strict";e.exports=async e=>{const t=[];for await(const r of e)t.push(r);return t}},5075:e=>{"use strict";e.exports=async e=>{for await(const t of e);}},63246:e=>{"use strict";e.exports=async function*(e,t){for await(const r of e)yield t(r)}},86119:(e,t,r)=>{"use strict";const n=r(53204);e.exports=async function*(...e){const t=n();setTimeout((async()=>{try{await Promise.all(e.map((async e=>{for await(const r of e)t.push(r)}))),t.end()}catch(e){t.end(e)}}),0),yield*t}},53204:(e,t,r)=>{const n=r(98502);e.exports=e=>{let t;"function"==typeof(e=e||{})?(t=e,e={}):t=e.onEnd;let r,s,i,o=new n;const a=e=>s?s(e):(o.push(e),r),c=e=>i?r:a({done:!1,value:e}),l=e=>i?r:(i=!0,e?(e=>(o=new n,s?s({error:e}):(o.push({error:e}),r)))(e):a({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:()=>{if(!o.isEmpty()){if(e.writev){let e;const t=[];for(;!o.isEmpty();){if(e=o.shift(),e.error)throw e.error;t.push(e.value)}return{done:e.done,value:t}}const t=o.shift();if(t.error)throw t.error;return t}return i?{done:!0}:new Promise(((t,n)=>{s=i=>(s=null,i.error?n(i.error):e.writev&&!i.done?t({done:i.done,value:[i.value]}):t(i),r)}))},return:()=>(o=new n,l(),{done:!0}),throw:e=>(l(e),{done:!0}),push:c,end:l},!t)return r;const h=r;return r={[Symbol.asyncIterator](){return this},next:()=>h.next(),throw:e=>(h.throw(e),t&&(t(e),t=null),{done:!0}),return:()=>(h.return(),t&&(t(),t=null),{done:!0}),push:c,end:e=>(h.end(e),t&&(t(e),t=null),r)},r}},33360:e=>{var t=1e3,r=60*t,n=60*r,s=24*n;function i(e,t,r,n){var s=t>=1.5*r;return Math.round(e/r)+" "+n+(s?"s":"")}e.exports=function(e,o){o=o||{};var a,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(i){var o=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*n;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===l&&isFinite(e))return o.long?(a=e,(c=Math.abs(a))>=s?i(a,c,s,"day"):c>=n?i(a,c,n,"hour"):c>=r?i(a,c,r,"minute"):c>=t?i(a,c,t,"second"):a+" ms"):function(e){var i=Math.abs(e);return i>=s?Math.round(e/s)+"d":i>=n?Math.round(e/n)+"h":i>=r?Math.round(e/r)+"m":i>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},2402:(e,t,r)=>{var n=r(82784),s=r(46039);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(s=n))})),t.splice(s,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==s&&"env"in s&&(e=s.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,n.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=n.debug||n.log||(()=>{}),e.exports=r(83881)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},83881:(e,t,r)=>{var n=r(82784);e.exports=function(e){function t(e){let r,n,i,o=null;function a(...e){if(!a.enabled)return;const n=a,s=Number(new Date),i=s-(r||s);n.diff=i,n.prev=r,n.curr=s,r=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,s)=>{if("%%"===r)return"%";o++;const i=t.formatters[s];if("function"==typeof i){const t=e[o];r=i.call(n,t),e.splice(o,1),o--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=s,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(n!==t.namespaces&&(n=t.namespaces,i=t.enabled(e)),i),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function s(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),s=n.length;for(r=0;r<s;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(33360),t.destroy=function(){n.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},41063:e=>{"use strict";const t=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},r=({clearTimeout:e,setTimeout:r,willResolve:n})=>(s,{value:i,signal:o}={})=>{if(o&&o.aborted)return Promise.reject(t());let a,c,l;const h=e||clearTimeout,u=()=>{h(a),l(t())},d=new Promise(((e,t)=>{c=()=>{o&&o.removeEventListener("abort",u),n?e(i):t(i)},l=t,a=(r||setTimeout)(c,s)}));return o&&o.addEventListener("abort",u,{once:!0}),d.clear=()=>{h(a),a=null,c()},d},n=e=>{const t=r({...e,willResolve:!0});return t.reject=r({...e,willResolve:!1}),t.range=(e,r,n)=>t(((e,t)=>Math.floor(Math.random()*(t-e+1)+e))(e,r),n),t},s=n();s.createWithTimers=n,e.exports=s,e.exports.default=s},19301:e=>{"use strict";function t(e,t){t=t||{},this._head=0,this._tail=0,this._capacity=t.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(e)&&this._fromArray(e)}t.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var r=this.size();if(!(t>=r||t<-r))return t<0&&(t+=r),t=this._head+t&this._capacityMask,this._list[t]}},t.prototype.get=function(e){return this.peekAt(e)},t.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},t.prototype.peekFront=function(){return this.peek()},t.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(t.prototype,"length",{get:function(){return this.size()}}),t.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.unshift=function(e){if(void 0===e)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},t.prototype.push=function(e){if(void 0===e)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var r=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),r}},t.prototype.removeOne=function(e){var t=e;if(t===(0|t)&&this._head!==this._tail){var r=this.size(),n=this._list.length;if(!(t>=r||t<-r)){t<0&&(t+=r),t=this._head+t&this._capacityMask;var s,i=this._list[t];if(e<r/2){for(s=e;s>0;s--)this._list[t]=this._list[t=t-1+n&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+n&this._capacityMask}else{for(s=r-1-e;s>0;s--)this._list[t]=this._list[t=t+1+n&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+n&this._capacityMask}return i}}},t.prototype.remove=function(e,t){var r,n=e,s=t;if(n===(0|n)&&this._head!==this._tail){var i=this.size(),o=this._list.length;if(!(n>=i||n<-i||t<1)){if(n<0&&(n+=i),1===t||!t)return(r=new Array(1))[0]=this.removeOne(n),r;if(0===n&&n+t>=i)return r=this.toArray(),this.clear(),r;var a;for(n+t>i&&(t=i-n),r=new Array(t),a=0;a<t;a++)r[a]=this._list[this._head+n+a&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===i){for(this._tail=this._tail-t+o&this._capacityMask,a=t;a>0;a--)this._list[n=n+1+o&this._capacityMask]=void 0;return r}if(0===e){for(this._head=this._head+t+o&this._capacityMask,a=t-1;a>0;a--)this._list[n=n+1+o&this._capacityMask]=void 0;return r}if(n<i/2){for(this._head=this._head+e+t+o&this._capacityMask,a=e;a>0;a--)this.unshift(this._list[n=n-1+o&this._capacityMask]);for(n=this._head-1+o&this._capacityMask;s>0;)this._list[n=n-1+o&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+o&this._capacityMask,a=i-(t+e);a>0;a--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+o&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=o>>>2&&this._shrinkArray(),r}}},t.prototype.splice=function(e,t){var r=e;if(r===(0|r)){var n=this.size();if(r<0&&(r+=n),!(r>n)){if(arguments.length>2){var s,i,o,a=arguments.length,c=this._list.length,l=2;if(!n||r<n/2){for(i=new Array(r),s=0;s<r;s++)i[s]=this._list[this._head+s&this._capacityMask];for(0===t?(o=[],r>0&&(this._head=this._head+r+c&this._capacityMask)):(o=this.remove(r,t),this._head=this._head+r+c&this._capacityMask);a>l;)this.unshift(arguments[--a]);for(s=r;s>0;s--)this.unshift(i[s-1])}else{var h=(i=new Array(n-(r+t))).length;for(s=0;s<h;s++)i[s]=this._list[this._head+r+t+s&this._capacityMask];for(0===t?(o=[],r!=n&&(this._tail=this._head+r+c&this._capacityMask)):(o=this.remove(r,t),this._tail=this._tail-h+c&this._capacityMask);l<a;)this.push(arguments[l++]);for(s=0;s<h;s++)this.push(i[s])}return o}return this.remove(r,t)}}},t.prototype.clear=function(){this._head=0,this._tail=0},t.prototype.isEmpty=function(){return this._head===this._tail},t.prototype.toArray=function(){return this._copyArray(!1)},t.prototype._fromArray=function(e){for(var t=0;t<e.length;t++)this.push(e[t])},t.prototype._copyArray=function(e){var t,r=[],n=this._list,s=n.length;if(e||this._head>this._tail){for(t=this._head;t<s;t++)r.push(n[t]);for(t=0;t<this._tail;t++)r.push(n[t])}else for(t=this._head;t<this._tail;t++)r.push(n[t]);return r},t.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1},t.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},e.exports=t},93765:function(e){e.exports=function(e,t,r,n,s){for(t=t.split?t.split("."):t,n=0;n<t.length;n++)e=e?e[t[n]]:s;return e===s?r:e}},77514:e=>{"use strict";function t(e,t){for(const r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}e.exports=function(e,r,n){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");n||(n={}),"object"==typeof r&&(n=r,r=""),r&&(n.code=r);try{return t(e,n)}catch(r){n.message=e.message,n.stack=e.stack;const s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(e)),t(new s,n)}}},42929:(e,t,r)=>{"use strict";const n=r(95905);t.zN=n.EventIterator,n.EventIterator},95905:(e,t,r)=>{"use strict";var n=r(82784);Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const e=this.pullQueue.shift();e&&e.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():n&&n.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch((()=>{})),this.pushQueue.push(t)}}remove(){Promise.resolve().then((()=>{this.removeCallback&&this.removeCallback()}))}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise(((e,t)=>{this.pullQueue.push({resolve:e,reject:t})}))},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class i{constructor(e,{highWaterMark:t=100,lowWaterMark:r=1}={}){const n=new s;n.highWaterMark=t,n.lowWaterMark=r,n.removeCallback=e({push:e=>n.push(e),stop:()=>n.stop(),fail:e=>n.fail(e),on:(e,t)=>{n.eventHandlers[e]=t}})||(()=>{}),this[Symbol.asyncIterator]=()=>n[Symbol.asyncIterator](),Object.freeze(this)}}t.EventIterator=i,t.default=i},33579:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,n,i,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,i||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,s=[];if(0===this._eventsCount)return s;for(n in e=this._events)t.call(e,n)&&s.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,i=n.length,o=new Array(i);s<i;s++)o[s]=n[s].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,s,i,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,l,h=this._events[a],u=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,n),!0;case 4:return h.fn.call(h.context,t,n,s),!0;case 5:return h.fn.call(h.context,t,n,s,i),!0;case 6:return h.fn.call(h.context,t,n,s,i,o),!0}for(l=1,c=new Array(u-1);l<u;l++)c[l-1]=arguments[l];h.fn.apply(h.context,c)}else{var d,p=h.length;for(l=0;l<p;l++)switch(h[l].once&&this.removeListener(e,h[l].fn,void 0,!0),u){case 1:h[l].fn.call(h[l].context);break;case 2:h[l].fn.call(h[l].context,t);break;case 3:h[l].fn.call(h[l].context,t,n);break;case 4:h[l].fn.call(h[l].context,t,n,s);break;default:if(!c)for(d=1,c=new Array(u-1);d<u;d++)c[d-1]=arguments[d];h[l].fn.apply(h[l].context,c)}}return!0},a.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,s){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return o(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||s&&!a.once||n&&a.context!==n||o(this,i);else{for(var c=0,l=[],h=a.length;c<h;c++)(a[c].fn!==t||s&&!a[c].once||n&&a[c].context!==n)&&l.push(a[c]);l.length?this._events[i]=1===l.length?l[0]:l:o(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},3894:(e,t,r)=>{"use strict";var n,s=r(82784),i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function c(){c.init.call(this)}e.exports=c,e.exports.once=function(e,t){return new Promise((function(r,n){function s(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",s),r([].slice.call(arguments))}w(e,t,i,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&w(e,"error",t,{once:!0})}(e,s)}))},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var l=10;function h(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var i,o,a,c;if(h(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=u(e))>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,c=l,s&&s.warn&&s.warn(c)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},s=p.bind(n);return s.listener=r,n.wrapFn=s,s}function y(e,t,r){var n=e._events;if(void 0===n)return[];var s=n[t];return void 0===s?[]:"function"==typeof s?r?[s.listener||s]:[s]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(s):m(s,s.length)}function g(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function m(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function w(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function s(i){n.once&&e.removeEventListener(t,s),r(i)}))}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return u(this)},c.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var a=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw a.context=i,a}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var l=c.length,h=m(c,l);for(r=0;r<l;++r)o(h[r],this,t)}return!0},c.prototype.addListener=function(e,t){return d(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return d(this,e,t,!0)},c.prototype.once=function(e,t){return h(t),this.on(e,f(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return h(t),this.prependListener(e,f(this,e,t)),this},c.prototype.removeListener=function(e,t){var r,n,s,i,o;if(h(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(s=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){o=r[i].listener,s=i;break}if(s<0)return this;0===s?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,s),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var s,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(s=i[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},c.prototype.listeners=function(e){return y(this,e,!0)},c.prototype.rawListeners=function(e){return y(this,e,!1)},c.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},c.prototype.listenerCount=g,c.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},88358:e=>{e.exports=class{constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}}},98502:(e,t,r)=>{const n=r(88358);e.exports=class{constructor(e){this.hwm=e||16,this.head=new n(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){const t=this.head;this.head=t.next=new n(2*this.head.buffer.length),this.head.push(e)}}shift(){const e=this.tail.shift();if(void 0===e&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}},122:(e,t)=>{"use strict";function r(e,t=r.BASE){const n=e.length;for(let r=0;r<n;r++)t^=e.charCodeAt(r),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}Object.defineProperty(t,"__esModule",{value:!0}),r.BASE=2166136261,t.default=r,e.exports=r},26205:e=>{e.exports=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,r=Object.create(null),n=Object.create(null);function s(s,i){r[s]=i,++t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(e){return void 0!==r[e]||void 0!==n[e]},remove:function(e){void 0!==r[e]&&(r[e]=void 0),void 0!==n[e]&&(n[e]=void 0)},get:function(e){var t=r[e];return void 0!==t?t:void 0!==(t=n[e])?(s(e,t),t):void 0},set:function(e,t){void 0!==r[e]?r[e]=t:s(e,t)},clear:function(){r=Object.create(null),n=Object.create(null)}}}},87267:(e,t)=>{t.read=function(e,t,r,n,s){var i,o,a=8*s-n-1,c=(1<<a)-1,l=c>>1,h=-7,u=r?s-1:0,d=r?-1:1,p=e[t+u];for(u+=d,i=p&(1<<-h)-1,p>>=-h,h+=a;h>0;i=256*i+e[t+u],u+=d,h-=8);for(o=i&(1<<-h)-1,i>>=-h,h+=n;h>0;o=256*o+e[t+u],u+=d,h-=8);if(0===i)i=1-l;else{if(i===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),i-=l}return(p?-1:1)*o*Math.pow(2,i-n)},t.write=function(e,t,r,n,s,i){var o,a,c,l=8*i-s-1,h=(1<<l)-1,u=h>>1,d=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:i-1,f=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+u>=1?d/c:d*Math.pow(2,1-u))*c>=2&&(o++,c/=2),o+u>=h?(a=0,o=h):o+u>=1?(a=(t*c-1)*Math.pow(2,s),o+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,s),o=0));s>=8;e[r+p]=255&a,p+=f,a/=256,s-=8);for(o=o<<s|a,l+=s;l>0;e[r+p]=255&o,p+=f,o/=256,l-=8);e[r+p-f]|=128*y}},47399:e=>{"use strict";const t="[a-fA-F\\d:]",r=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${t})|(?<=${t})(?=\\s|$))`:"",n="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",s="[a-fA-F\\d]{1,4}",i=`\n(?:\n(?:${s}:){7}(?:${s}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${s}:){6}(?:${n}|:${s}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${s}:){5}(?::${n}|(?::${s}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${s}:){4}(?:(?::${s}){0,1}:${n}|(?::${s}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${s}:){3}(?:(?::${s}){0,2}:${n}|(?::${s}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${s}:){2}(?:(?::${s}){0,3}:${n}|(?::${s}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${s}:){1}(?:(?::${s}){0,4}:${n}|(?::${s}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${s}){0,5}:${n}|(?::${s}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),o=new RegExp(`(?:^${n}$)|(?:^${i}$)`),a=new RegExp(`^${n}$`),c=new RegExp(`^${i}$`),l=e=>e&&e.exact?o:new RegExp(`(?:${r(e)}${n}${r(e)})|(?:${r(e)}${i}${r(e)})`,"g");l.v4=e=>e&&e.exact?a:new RegExp(`${r(e)}${n}${r(e)}`,"g"),l.v6=e=>e&&e.exact?c:new RegExp(`${r(e)}${i}${r(e)}`,"g"),e.exports=l},27697:(e,t,r)=>{"use strict";var n=r(46039);const s=r(66830),i="object"==typeof window&&"object"==typeof document&&9===document.nodeType,o=s(),a=i&&!o,c=o&&!i,l=o&&i,h=void 0!==n&&void 0!==n.release&&"node"===n.release.name&&!o,u="function"==typeof importScripts&&"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,d=void 0!==n&&void 0!==n.env&&!1,p="undefined"!=typeof navigator&&"ReactNative"===navigator.product;e.exports={isTest:d,isElectron:o,isElectronMain:c,isElectronRenderer:l,isNode:h,isBrowser:a,isWebWorker:u,isEnvWithDom:i,isReactNative:p}},97119:(e,t,r)=>{"use strict";e.exports=r(81661)},36074:(e,t,r)=>{"use strict";const n=r(6963);async function*s(e,t){const r=new n,s=await r.get(e,t);yield*s.iterator()}e.exports=(e,t)=>({path:decodeURIComponent(new URL(e).pathname.split("/").pop()||""),content:s(e,t)})},6963:(e,t,r)=>{"use strict";const{fetch:n,Request:s,Headers:i}=r(72349),{TimeoutError:o,HTTPError:a}=r(2228),c=r(76768).bind({ignoreUndefined:!0}),{URL:l,URLSearchParams:h}=r(21963),u=r(92360),d={throwHttpErrors:!0,credentials:"same-origin"};class p{constructor(e={}){this.opts=c(d,e)}async fetch(e,t={}){const r=c(this.opts,t),d=new i(r.headers);if("string"!=typeof e&&!(e instanceof l||e instanceof s))throw new TypeError("`resource` must be a string, URL, or Request");const p=new l(e.toString(),r.base),{searchParams:g,transformSearchParams:m,json:w}=r;g&&(p.search="function"==typeof m?m(new h(r.searchParams)):new h(r.searchParams)),w&&(r.body=JSON.stringify(r.json),d.set("content-type","application/json"));const b=new AbortController,v=u([b.signal,r.signal]),E=await((e,t,r)=>{if(void 0===t)return e;const n=Date.now(),s=()=>Date.now()-n>=t;return new Promise(((n,i)=>{const a=setTimeout((()=>{s()&&(i(new o),r.abort())}),t),c=e=>t=>{clearTimeout(a),s()?i(new o):e(t)};e.then(c(n),c(i))}))})(n(p.toString(),{...r,signal:v,timeout:void 0,headers:d}),r.timeout,b);if(!E.ok&&r.throwHttpErrors)throw r.handleError&&await r.handleError(E),new a(E);return E.iterator=async function*(){yield*y(E.body)},E.ndjson=async function*(){for await(const e of f(E.iterator()))t.transform?yield t.transform(e):yield e},E}post(e,t={}){return this.fetch(e,{...t,method:"POST"})}get(e,t={}){return this.fetch(e,{...t,method:"GET"})}put(e,t={}){return this.fetch(e,{...t,method:"PUT"})}delete(e,t={}){return this.fetch(e,{...t,method:"DELETE"})}options(e,t={}){return this.fetch(e,{...t,method:"OPTIONS"})}}const f=async function*(e){const t=new TextDecoder;let r="";for await(const n of e){r+=t.decode(n,{stream:!0});const e=r.split(/\r?\n/);for(let t=0;t<e.length-1;t++){const r=e[t].trim();r.length>0&&(yield JSON.parse(r))}r=e[e.length-1]}r+=t.decode(),r=r.trim(),0!==r.length&&(yield JSON.parse(r))},y=e=>{if(w(e)){const t=e[Symbol.asyncIterator]();return{[Symbol.asyncIterator]:()=>({next:t.next.bind(t),return:r=>(e.destroy(),"function"==typeof t.return?t.return():Promise.resolve({done:!0,value:r}))})}}if(m(e)){const t=e.getReader();return async function*(){try{for(;;){const{done:e,value:r}=await t.read();if(e)return;r&&(yield r)}}finally{t.releaseLock()}}()}if(g(e))return e;throw new TypeError("Body can't be converted to AsyncIterable")},g=e=>"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator],m=e=>e&&"function"==typeof e.getReader,w=e=>Object.prototype.hasOwnProperty.call(e,"readable")&&Object.prototype.hasOwnProperty.call(e,"writable");p.HTTPError=a,p.TimeoutError=o,p.streamToAsyncIterator=y,p.post=(e,t)=>new p(t).post(e,t),p.get=(e,t)=>new p(t).get(e,t),p.put=(e,t)=>new p(t).put(e,t),p.delete=(e,t)=>new p(t).delete(e,t),p.options=(e,t)=>new p(t).options(e,t),e.exports=p},2228:(e,t)=>{"use strict";class r extends Error{constructor(e="Request timed out"){super(e),this.name="TimeoutError"}}t.TimeoutError=r;class n extends Error{constructor(e="The operation was aborted."){super(e),this.name="AbortError"}}t.AbortError=n;class s extends Error{constructor(e){super(e.statusText),this.name="HTTPError",this.response=e}}t.HTTPError=s},72349:(e,t,r)=>{"use strict";const{TimeoutError:n,AbortError:s}=r(2228),{Response:i,Request:o,Headers:a,default:c}=r(97119),l=c,h=e=>{const t=new a;for(const r of e.trim().split(/[\r\n]+/)){const e=r.indexOf(": ");e>0&&t.set(r.slice(0,e),r.slice(e+1))}return t};class u extends i{constructor(e,t,r){super(t,r),Object.defineProperty(this,"url",{value:e})}}e.exports={fetch:(e,t={})=>null!=t.onUploadProgress?((e,t={})=>{const r=new XMLHttpRequest;r.open(t.method||"GET",e.toString(),!0);const{timeout:o,headers:c}=t;if(o&&o>0&&o<1/0&&(r.timeout=o),null!=t.overrideMimeType&&r.overrideMimeType(t.overrideMimeType),c)for(const[e,t]of new a(c))r.setRequestHeader(e,t);return t.signal&&(t.signal.onabort=()=>r.abort()),t.onUploadProgress&&(r.upload.onprogress=t.onUploadProgress),r.responseType="arraybuffer",new Promise(((e,o)=>{const a=t=>{switch(t.type){case"error":e(i.error());break;case"load":e(new u(r.responseURL,r.response,{status:r.status,statusText:r.statusText,headers:h(r.getAllResponseHeaders())}));break;case"timeout":o(new n);break;case"abort":o(new s)}};r.onerror=a,r.onload=a,r.ontimeout=a,r.onabort=a,r.send(t.body)}))})(e,t):l(e,t),Request:o,Headers:a}},20757:e=>{"use strict";var t=/^(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9])?\.){0,126}(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9]))\.?$/i;e.exports=function(e,r){if(null==r&&(r=!1),e.length<2)return!1;if(e.length>255)return!1;var n=e[e.length-1];if(r){if("."!==n)return!1}else if("."===n)return!1;return t.test(e)}},66830:(e,t,r)=>{var n=r(46039);e.exports=function(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!(void 0===n||"object"!=typeof n.versions||!n.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}},27422:(e,t,r)=>{"use strict";const n=r(47399),s=e=>n({exact:!0}).test(e);s.v4=e=>n.v4({exact:!0}).test(e),s.v6=e=>n.v6({exact:!0}).test(e),s.version=e=>s(e)?s.v4(e)?4:6:void 0,e.exports=s},95972:e=>{"use strict";e.exports=e=>{if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}},78814:e=>{"use strict";e.exports={E2BIG:7,EACCES:13,EADDRINUSE:100,EADDRNOTAVAIL:101,EAFNOSUPPORT:102,EAGAIN:11,EALREADY:103,EBADF:9,EBADMSG:104,EBUSY:16,ECANCELED:105,ECHILD:10,ECONNABORTED:106,ECONNREFUSED:107,ECONNRESET:108,EDEADLK:36,EDESTADDRREQ:109,EDOM:33,EEXIST:17,EFAULT:14,EFBIG:27,EHOSTUNREACH:110,EIDRM:111,EILSEQ:42,EINPROGRESS:112,EINTR:4,EINVAL:22,EIO:5,EISCONN:113,EISDIR:21,ELOOP:114,EMFILE:24,EMLINK:31,EMSGSIZE:115,ENAMETOOLONG:38,ENETDOWN:116,ENETRESET:117,ENETUNREACH:118,ENFILE:23,ENOBUFS:119,ENODATA:120,ENODEV:19,ENOENT:2,ENOEXEC:8,ENOLCK:39,ENOLINK:121,ENOMEM:12,ENOMSG:122,ENOPROTOOPT:123,ENOSPC:28,ENOSR:124,ENOSTR:125,ENOSYS:40,ENOTCONN:126,ENOTDIR:20,ENOTEMPTY:41,ENOTSOCK:128,ENOTSUP:129,ENOTTY:25,ENXIO:6,EOPNOTSUPP:130,EOVERFLOW:132,EPERM:1,EPIPE:32,EPROTO:134,EPROTONOSUPPORT:135,EPROTOTYPE:136,ERANGE:34,EROFS:30,ESPIPE:29,ESRCH:3,ETIME:137,ETIMEDOUT:138,ETXTBSY:139,EWOULDBLOCK:140,EXDEV:18,WSAEINTR:10004,WSAEBADF:10009,WSAEACCES:10013,WSAEFAULT:10014,WSAEINVAL:10022,WSAEMFILE:10024,WSAEWOULDBLOCK:10035,WSAEINPROGRESS:10036,WSAEALREADY:10037,WSAENOTSOCK:10038,WSAEDESTADDRREQ:10039,WSAEMSGSIZE:10040,WSAEPROTOTYPE:10041,WSAENOPROTOOPT:10042,WSAEPROTONOSUPPORT:10043,WSAESOCKTNOSUPPORT:10044,WSAEOPNOTSUPP:10045,WSAEPFNOSUPPORT:10046,WSAEAFNOSUPPORT:10047,WSAEADDRINUSE:10048,WSAEADDRNOTAVAIL:10049,WSAENETDOWN:10050,WSAENETUNREACH:10051,WSAENETRESET:10052,WSAECONNABORTED:10053,WSAECONNRESET:10054,WSAENOBUFS:10055,WSAEISCONN:10056,WSAENOTCONN:10057,WSAESHUTDOWN:10058,WSAETOOMANYREFS:10059,WSAETIMEDOUT:10060,WSAECONNREFUSED:10061,WSAELOOP:10062,WSAENAMETOOLONG:10063,WSAEHOSTDOWN:10064,WSAEHOSTUNREACH:10065,WSAENOTEMPTY:10066,WSAEPROCLIM:10067,WSAEUSERS:10068,WSAEDQUOT:10069,WSAESTALE:10070,WSAEREMOTE:10071,WSASYSNOTREADY:10091,WSAVERNOTSUPPORTED:10092,WSANOTINITIALISED:10093,WSAEDISCON:10101,WSAENOMORE:10102,WSAECANCELLED:10103,WSAEINVALIDPROCTABLE:10104,WSAEINVALIDPROVIDER:10105,WSAEPROVIDERFAILEDINIT:10106,WSASYSCALLFAILURE:10107,WSASERVICE_NOT_FOUND:10108,WSATYPE_NOT_FOUND:10109,WSA_E_NO_MORE:10110,WSA_E_CANCELLED:10111,WSAEREFUSED:10112,PRIORITY_LOW:19,PRIORITY_BELOW_NORMAL:10,PRIORITY_NORMAL:0,PRIORITY_ABOVE_NORMAL:-7,PRIORITY_HIGH:-14,PRIORITY_HIGHEST:-20,SIGHUP:1,SIGINT:2,SIGILL:4,SIGABRT:22,SIGFPE:8,SIGKILL:9,SIGSEGV:11,SIGTERM:15,SIGBREAK:21,SIGWINCH:28,UV_FS_SYMLINK_DIR:1,UV_FS_SYMLINK_JUNCTION:2,O_RDONLY:0,O_WRONLY:1,O_RDWR:2,UV_DIRENT_UNKNOWN:0,UV_DIRENT_FILE:1,UV_DIRENT_DIR:2,UV_DIRENT_LINK:3,UV_DIRENT_FIFO:4,UV_DIRENT_SOCKET:5,UV_DIRENT_CHAR:6,UV_DIRENT_BLOCK:7,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFLNK:40960,O_CREAT:256,O_EXCL:1024,UV_FS_O_FILEMAP:536870912,O_TRUNC:512,O_APPEND:8,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1,UV_FS_COPYFILE_FICLONE:2,COPYFILE_FICLONE:2,UV_FS_COPYFILE_FICLONE_FORCE:4,COPYFILE_FICLONE_FORCE:4,OPENSSL_VERSION_NUMBER:269488383,SSL_OP_ALL:2147485780,SSL_OP_ALLOW_NO_DHE_KEX:1024,SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION:262144,SSL_OP_CIPHER_SERVER_PREFERENCE:4194304,SSL_OP_CISCO_ANYCONNECT:32768,SSL_OP_COOKIE_EXCHANGE:8192,SSL_OP_CRYPTOPRO_TLSEXT_BUG:2147483648,SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS:2048,SSL_OP_EPHEMERAL_RSA:0,SSL_OP_LEGACY_SERVER_CONNECT:4,SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER:0,SSL_OP_MICROSOFT_SESS_ID_BUG:0,SSL_OP_MSIE_SSLV2_RSA_PADDING:0,SSL_OP_NETSCAPE_CA_DN_BUG:0,SSL_OP_NETSCAPE_CHALLENGE_BUG:0,SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG:0,SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG:0,SSL_OP_NO_COMPRESSION:131072,SSL_OP_NO_ENCRYPT_THEN_MAC:524288,SSL_OP_NO_QUERY_MTU:4096,SSL_OP_NO_RENEGOTIATION:1073741824,SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION:65536,SSL_OP_NO_SSLv2:0,SSL_OP_NO_SSLv3:33554432,SSL_OP_NO_TICKET:16384,SSL_OP_NO_TLSv1:67108864,SSL_OP_NO_TLSv1_1:268435456,SSL_OP_NO_TLSv1_2:134217728,SSL_OP_NO_TLSv1_3:536870912,SSL_OP_PKCS1_CHECK_1:0,SSL_OP_PKCS1_CHECK_2:0,SSL_OP_PRIORITIZE_CHACHA:2097152,SSL_OP_SINGLE_DH_USE:0,SSL_OP_SINGLE_ECDH_USE:0,SSL_OP_SSLEAY_080_CLIENT_DH_BUG:0,SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG:0,SSL_OP_TLS_BLOCK_PADDING_BUG:0,SSL_OP_TLS_D5_BUG:0,SSL_OP_TLS_ROLLBACK_BUG:8388608,ENGINE_METHOD_RSA:1,ENGINE_METHOD_DSA:2,ENGINE_METHOD_DH:4,ENGINE_METHOD_RAND:8,ENGINE_METHOD_EC:2048,ENGINE_METHOD_CIPHERS:64,ENGINE_METHOD_DIGESTS:128,ENGINE_METHOD_PKEY_METHS:512,ENGINE_METHOD_PKEY_ASN1_METHS:1024,ENGINE_METHOD_ALL:65535,ENGINE_METHOD_NONE:0,DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,RSA_PSS_SALTLEN_DIGEST:-1,RSA_PSS_SALTLEN_MAX_SIGN:-2,RSA_PSS_SALTLEN_AUTO:-2,defaultCoreCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA",TLS1_VERSION:769,TLS1_1_VERSION:770,TLS1_2_VERSION:771,TLS1_3_VERSION:772,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}},86085:e=>{"use strict";const t=65536;e.exports=function(e){const r=new Uint8Array(e);let n=0;if(e>0)if(e>t)for(;n<e;)n+t>e?(crypto.getRandomValues(r.subarray(n,n+(e-n))),n+=e-n):(crypto.getRandomValues(r.subarray(n,n+t)),n+=t);else crypto.getRandomValues(r);return r}},21963:(e,t,r)=>{"use strict";const{URLWithLegacySupport:n,format:s,URLSearchParams:i,defaultBase:o}=r(3359),a=r(10367);e.exports={URL:n,URLSearchParams:i,format:s,relative:a,defaultBase:o}},10367:(e,t,r)=>{"use strict";const{URLWithLegacySupport:n,format:s}=r(3359);e.exports=(e,t={},r={},i)=>{let o,a=t.protocol?t.protocol.replace(":",""):"http";a=(r[a]||i||a)+":";try{o=new n(e)}catch(e){o={}}const c=Object.assign({},t,{protocol:a||o.protocol,host:t.host||o.host});return new n(e,s(c)).toString()}},3359:e=>{"use strict";const t="undefined"!=typeof navigator&&"ReactNative"===navigator.product,r=self.URL,n=t?"http://localhost":self.location?self.location.protocol+"//"+self.location.host:"";e.exports={URLWithLegacySupport:class{constructor(e="",t=n){this.super=new r(e,t),this.path=this.pathname+this.search,this.auth=this.username&&this.password?this.username+":"+this.password:null,this.query=this.search&&this.search.startsWith("?")?this.search.slice(1):null}get hash(){return this.super.hash}get host(){return this.super.host}get hostname(){return this.super.hostname}get href(){return this.super.href}get origin(){return this.super.origin}get password(){return this.super.password}get pathname(){return this.super.pathname}get port(){return this.super.port}get protocol(){return this.super.protocol}get search(){return this.super.search}get searchParams(){return this.super.searchParams}get username(){return this.super.username}set hash(e){this.super.hash=e}set host(e){this.super.host=e}set hostname(e){this.super.hostname=e}set href(e){this.super.href=e}set password(e){this.super.password=e}set pathname(e){this.super.pathname=e}set port(e){this.super.port=e}set protocol(e){this.super.protocol=e}set search(e){this.super.search=e}set username(e){this.super.username=e}static createObjectURL(e){return r.createObjectURL(e)}static revokeObjectURL(e){r.revokeObjectURL(e)}toJSON(){return this.super.toJSON()}toString(){return this.super.toString()}format(){return this.toString()}},URLSearchParams:self.URLSearchParams,defaultBase:n,format:function(e){if("string"==typeof e)return new r(e).toString();if(!(e instanceof r)){const t=e.username&&e.password?`${e.username}:${e.password}@`:"",r=e.auth?e.auth+"@":"",n=e.port?":"+e.port:"",s=e.protocol?e.protocol+"//":"",i=e.host||"",o=e.hostname||"",a=e.search||(e.query?"?"+e.query:""),c=e.hash||"",l=e.pathname||"";return`${s}${t||r}${i||o+n}${e.path||l+a}${c}`}}}},8293:e=>{"use strict";e.exports=async function*(e,t){for await(const r of e)await t(r)&&(yield r)}},20253:e=>{"use strict";e.exports=async function*(e,t){for await(const r of e)await t(r),yield r}},59274:(e,t,r)=>{"use strict";const n=r(12937);e.exports=async function*(...e){const t=n();setTimeout((async()=>{try{await Promise.all(e.map((async e=>{for await(const r of e)t.push(r)}))),t.end()}catch(e){t.end(e)}}),0),yield*t}},12937:(e,t,r)=>{const n=r(98502);e.exports=e=>{let t;"function"==typeof(e=e||{})?(t=e,e={}):t=e.onEnd;let r,s,i,o=new n;const a=e=>s?s(e):(o.push(e),r),c=e=>i?r:a({done:!1,value:e}),l=e=>i?r:(i=!0,e?(e=>(o=new n,s?s({error:e}):(o.push({error:e}),r)))(e):a({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:()=>{if(!o.isEmpty()){if(e.writev){let e;const t=[];for(;!o.isEmpty();){if(e=o.shift(),e.error)throw e.error;t.push(e.value)}return{done:e.done,value:t}}const t=o.shift();if(t.error)throw t.error;return t}return i?{done:!0}:new Promise(((t,n)=>{s=i=>(s=null,i.error?n(i.error):e.writev&&!i.done?t({done:i.done,value:[i.value]}):t(i),r)}))},return:()=>(o=new n,l(),{done:!0}),throw:e=>(l(e),{done:!0}),push:c,end:l},!t)return r;const h=r;return r={[Symbol.asyncIterator](){return this},next:()=>h.next(),throw:e=>(h.throw(e),t&&(t(e),t=null),{done:!0}),return:()=>(h.return(),t&&(t(),t=null),{done:!0}),push:c,end:e=>(h.end(e),t&&(t(e),t=null),r)},r}},6043:e=>{"use strict";e.exports=async function*(e,t){let r=0;if(!(t<1))for await(const n of e)if(yield n,r++,r===t)return}},26665:(e,t,r)=>{"use strict";const n=r(68239),{EventEmitter:s}=r(3894);function i(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function o(e,t){if(!(t instanceof Uint8Array))throw new TypeError(e+" is not a Uint8Array")}class a extends s{constructor(e={}){super(),this.localNodeId=e.localNodeId||n(20),this.numberOfNodesPerKBucket=e.numberOfNodesPerKBucket||20,this.numberOfNodesToPing=e.numberOfNodesToPing||3,this.distance=e.distance||a.distance,this.arbiter=e.arbiter||a.arbiter,this.metadata=Object.assign({},e.metadata),o("option.localNodeId as parameter 1",this.localNodeId),this.root={contacts:[],dontSplit:!1,left:null,right:null}}static arbiter(e,t){return e.vectorClock>t.vectorClock?e:t}static distance(e,t){let r=0,n=0;const s=Math.min(e.length,t.length),i=Math.max(e.length,t.length);for(;n<s;++n)r=256*r+(e[n]^t[n]);for(;n<i;++n)r=256*r+255;return r}add(e){o("contact.id",(e||{}).id);let t=0,r=this.root;for(;null===r.contacts;)r=this._determineNode(r,e.id,t++);const n=this._indexOf(r,e.id);return n>=0?(this._update(r,n,e),this):r.contacts.length<this.numberOfNodesPerKBucket?(r.contacts.push(e),this.emit("added",e),this):r.dontSplit?(this.emit("ping",r.contacts.slice(0,this.numberOfNodesToPing),e),this):(this._split(r,t),this.add(e))}closest(e,t=1/0){if(o("id",e),!Number.isInteger(t)&&t!==1/0||t<=0)throw new TypeError("n is not positive number");let r=[];for(let n=[this.root],s=0;n.length>0&&r.length<t;){const t=n.pop();if(null===t.contacts){const r=this._determineNode(t,e,s++);n.push(t.left===r?t.right:t.left),n.push(r)}else r=r.concat(t.contacts)}return r.map((t=>[this.distance(t.id,e),t])).sort(((e,t)=>e[0]-t[0])).slice(0,t).map((e=>e[1]))}count(){let e=0;for(const t=[this.root];t.length>0;){const r=t.pop();null===r.contacts?t.push(r.right,r.left):e+=r.contacts.length}return e}_determineNode(e,t,r){const n=r>>3,s=r%8;return t.length<=n&&0!==s?e.left:t[n]&1<<7-s?e.right:e.left}get(e){o("id",e);let t=0,r=this.root;for(;null===r.contacts;)r=this._determineNode(r,e,t++);const n=this._indexOf(r,e);return n>=0?r.contacts[n]:null}_indexOf(e,t){for(let r=0;r<e.contacts.length;++r)if(i(e.contacts[r].id,t))return r;return-1}remove(e){o("the id as parameter 1",e);let t=0,r=this.root;for(;null===r.contacts;)r=this._determineNode(r,e,t++);const n=this._indexOf(r,e);if(n>=0){const e=r.contacts.splice(n,1)[0];this.emit("removed",e)}return this}_split(e,t){e.left={contacts:[],dontSplit:!1,left:null,right:null},e.right={contacts:[],dontSplit:!1,left:null,right:null};for(const r of e.contacts)this._determineNode(e,r.id,t).contacts.push(r);e.contacts=null;const r=this._determineNode(e,this.localNodeId,t);(e.left===r?e.right:e.left).dontSplit=!0}toArray(){let e=[];for(const t=[this.root];t.length>0;){const r=t.pop();null===r.contacts?t.push(r.right,r.left):e=e.concat(r.contacts)}return e}*toIterable(){for(const e=[this.root];e.length>0;){const t=e.pop();null===t.contacts?e.push(t.right,t.left):yield*t.contacts}}_update(e,t,r){if(!i(e.contacts[t].id,r.id))throw new Error("wrong index for _update");const n=e.contacts[t],s=this.arbiter(n,r);s===n&&n!==r||(e.contacts.splice(t,1),e.contacts.push(s),this.emit("updated",n,s))}}e.exports=a},28976:(e,t)=>{"use strict";t.supports=function(...e){const t=e.reduce(((e,t)=>Object.assign(e,t)),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})}},29893:(e,t,r)=>{"use strict";const n=r(39296),s=r(94697),{Encoding:i}=r(2333),{BufferFormat:o,ViewFormat:a,UTF8Format:c}=r(50396),l=Symbol("formats"),h=Symbol("encodings"),u=new Set(["buffer","view","utf8"]);t.Transcoder=class{constructor(e){if(!Array.isArray(e))throw new TypeError("The first argument 'formats' must be an array");if(!e.every((e=>u.has(e))))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'");this[h]=new Map,this[l]=new Set(e);for(const e in s)try{this.encoding(e)}catch(e){if("LEVEL_ENCODING_NOT_SUPPORTED"!==e.code)throw e}}encodings(){return Array.from(new Set(this[h].values()))}encoding(e){let t=this[h].get(e);if(void 0===t){if("string"==typeof e&&""!==e){if(t=p[e],!t)throw new n(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if("object"!=typeof e||null===e)throw new TypeError("First argument 'encoding' must be a string or object");t=function(e){if(e instanceof i)return e;const t="type"in e&&"string"==typeof e.type?e.type:void 0,r=e.name||t||"anonymous-"+f++;switch(function(e){return"format"in e&&void 0!==e.format?e.format:"buffer"in e&&"boolean"==typeof e.buffer?e.buffer?"buffer":"utf8":"code"in e&&Number.isInteger(e.code)?"view":"buffer"}(e)){case"view":return new a({...e,name:r});case"utf8":return new c({...e,name:r});case"buffer":return new o({...e,name:r});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}(e)}const{name:r,format:s}=t;if(!this[l].has(s))if(this[l].has("view"))t=t.createViewTranscoder();else if(this[l].has("buffer"))t=t.createBufferTranscoder();else{if(!this[l].has("utf8"))throw new n(`Encoding '${r}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});t=t.createUTF8Transcoder()}for(const n of[e,r,t.name,t.commonName])this[h].set(n,t)}return t}};const d={binary:s.buffer,"utf-8":s.utf8},p={...s,...d};let f=0},2333:(e,t,r)=>{"use strict";const n=r(39296),s=new Set(["buffer","view","utf8"]);t.Encoding=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,"function"!=typeof this.encode)throw new TypeError("The 'encode' property must be a function");if("function"!=typeof this.decode)throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),"string"!=typeof this.name||""===this.name)throw new TypeError("The 'name' property must be a string");if("string"!=typeof this.format||!s.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new n(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new n(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new n(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}}},94697:(e,t,r)=>{"use strict";const{Buffer:n}=r(83107)||{Buffer:{isBuffer:()=>!1}},{textEncoder:s,textDecoder:i}=r(58833)(),{BufferFormat:o,ViewFormat:a,UTF8Format:c}=r(50396),l=e=>e;t.utf8=new c({encode:function(e){return n.isBuffer(e)?e.toString("utf8"):ArrayBuffer.isView(e)?i.decode(e):String(e)},decode:l,name:"utf8",createViewTranscoder(){return new a({encode:function(e){return ArrayBuffer.isView(e)?e:s.encode(e)},decode:function(e){return i.decode(e)},name:`${this.name}+view`})},createBufferTranscoder(){return new o({encode:function(e){return n.isBuffer(e)?e:ArrayBuffer.isView(e)?n.from(e.buffer,e.byteOffset,e.byteLength):n.from(String(e),"utf8")},decode:function(e){return e.toString("utf8")},name:`${this.name}+buffer`})}}),t.json=new c({encode:JSON.stringify,decode:JSON.parse,name:"json"}),t.buffer=new o({encode:function(e){return n.isBuffer(e)?e:ArrayBuffer.isView(e)?n.from(e.buffer,e.byteOffset,e.byteLength):n.from(String(e),"utf8")},decode:l,name:"buffer",createViewTranscoder(){return new a({encode:function(e){return ArrayBuffer.isView(e)?e:n.from(String(e),"utf8")},decode:function(e){return n.from(e.buffer,e.byteOffset,e.byteLength)},name:`${this.name}+view`})}}),t.view=new a({encode:function(e){return ArrayBuffer.isView(e)?e:s.encode(e)},decode:l,name:"view",createBufferTranscoder(){return new o({encode:function(e){return n.isBuffer(e)?e:ArrayBuffer.isView(e)?n.from(e.buffer,e.byteOffset,e.byteLength):n.from(String(e),"utf8")},decode:l,name:`${this.name}+buffer`})}}),t.hex=new o({encode:function(e){return n.isBuffer(e)?e:n.from(String(e),"hex")},decode:function(e){return e.toString("hex")},name:"hex"}),t.base64=new o({encode:function(e){return n.isBuffer(e)?e:n.from(String(e),"base64")},decode:function(e){return e.toString("base64")},name:"base64"})},50396:(e,t,r)=>{"use strict";const{Buffer:n}=r(83107)||{},{Encoding:s}=r(2333),i=r(58833);class o extends s{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new a({encode:this.encode,decode:e=>this.decode(n.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}}class a extends s{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new o({encode:e=>{const t=this.encode(e);return n.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}}t.BufferFormat=o,t.ViewFormat=a,t.UTF8Format=class extends s{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new o({encode:e=>n.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:t}=i();return new a({encode:t=>e.encode(this.encode(t)),decode:e=>this.decode(t.decode(e)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}}},58833:e=>{"use strict";let t=null;e.exports=function(){return null===t&&(t={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),t}},35562:(e,t,r)=>{t.Level=r(68274).BrowserLevel},76768:function(e,t,r){"use strict";const n=r(95972),{hasOwnProperty:s}=Object.prototype,{propertyIsEnumerable:i}=Object,o=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0}),a=this,c={concatArrays:!1,ignoreUndefined:!1},l=e=>{const t=[];for(const r in e)s.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols){const r=Object.getOwnPropertySymbols(e);for(const n of r)i.call(e,n)&&t.push(n)}return t};function h(e){return Array.isArray(e)?function(e){const t=e.slice(0,0);return l(e).forEach((r=>{o(t,r,h(e[r]))})),t}(e):n(e)?function(e){const t=null===Object.getPrototypeOf(e)?Object.create(null):{};return l(e).forEach((r=>{o(t,r,h(e[r]))})),t}(e):e}const u=(e,t,r,n)=>(r.forEach((r=>{void 0===t[r]&&n.ignoreUndefined||(r in e&&e[r]!==Object.getPrototypeOf(e)?o(e,r,d(e[r],t[r],n)):o(e,r,h(t[r])))})),e);function d(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?((e,t,r)=>{let n=e.slice(0,0),i=0;return[e,t].forEach((t=>{const a=[];for(let r=0;r<t.length;r++)s.call(t,r)&&(a.push(String(r)),o(n,i++,t===e?t[r]:h(t[r])));n=u(n,t,l(t).filter((e=>!a.includes(e))),r)})),n})(e,t,r):n(t)&&n(e)?u(e,t,l(t),r):h(t)}e.exports=function(...e){const t=d(h(c),this!==a&&this||{},c);let r={_:{}};for(const s of e)if(void 0!==s){if(!n(s))throw new TypeError("`"+s+"` is not an Option Object");r=d(r,{_:s},t)}return r._}},39296:e=>{"use strict";e.exports=class extends Error{constructor(e,t){super(e||""),"object"==typeof t&&null!==t&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}},8645:e=>{var t=1e3,r=60*t,n=60*r,s=24*n;function i(e,t,r,n){var s=t>=1.5*r;return Math.round(e/r)+" "+n+(s?"s":"")}e.exports=function(e,o){o=o||{};var a,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(i){var o=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*n;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===l&&isFinite(e))return o.long?(a=e,(c=Math.abs(a))>=s?i(a,c,s,"day"):c>=n?i(a,c,n,"hour"):c>=r?i(a,c,r,"minute"):c>=t?i(a,c,t,"second"):a+" ms"):function(e){var i=Math.abs(e);return i>=s?Math.round(e/s)+"d":i>=n?Math.round(e/n)+"h":i>=r?Math.round(e/r)+"m":i>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},11042:(e,t,r)=>{e.exports=r(16822)},16822:function(e,t){!function(r,n){"use strict";var s={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function i(e){if(!Array.isArray(e)&&!ArrayBuffer.isView(e))return!1;for(var t=0;t<e.length;t++)if(!Number.isInteger(e[t])||e[t]<0||e[t]>255)return!1;return!0}function o(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function a(e,t){return e<<t|e>>>32-t}function c(e){return e=o(e^=e>>>16,2246822507),(e=o(e^=e>>>13,3266489909))^e>>>16}function l(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function h(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function u(e,t){return 32==(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function d(e,t){return 0==(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function p(e,t){return[e[0]^t[0],e[1]^t[1]]}function f(e){return e=p(e,[0,e[0]>>>1]),e=p(e=h(e,[4283543511,3981806797]),[0,e[0]>>>1]),p(e=h(e,[3301882366,444984403]),[0,e[0]>>>1])}s.x86.hash32=function(e,t){if(s.inputValidation&&!i(e))return n;t=t||0;for(var r=e.length%4,l=e.length-r,h=t,u=0,d=3432918353,p=461845907,f=0;f<l;f+=4)u=o(u=e[f]|e[f+1]<<8|e[f+2]<<16|e[f+3]<<24,d),u=o(u=a(u,15),p),h=o(h=a(h^=u,13),5)+3864292196;switch(u=0,r){case 3:u^=e[f+2]<<16;case 2:u^=e[f+1]<<8;case 1:u=o(u^=e[f],d),h^=u=o(u=a(u,15),p)}return(h=c(h^=e.length))>>>0},s.x86.hash128=function(e,t){if(s.inputValidation&&!i(e))return n;t=t||0;for(var r=e.length%16,l=e.length-r,h=t,u=t,d=t,p=t,f=0,y=0,g=0,m=0,w=597399067,b=2869860233,v=951274213,E=2716044179,_=0;_<l;_+=16)f=e[_]|e[_+1]<<8|e[_+2]<<16|e[_+3]<<24,y=e[_+4]|e[_+5]<<8|e[_+6]<<16|e[_+7]<<24,g=e[_+8]|e[_+9]<<8|e[_+10]<<16|e[_+11]<<24,m=e[_+12]|e[_+13]<<8|e[_+14]<<16|e[_+15]<<24,f=a(f=o(f,w),15),h=a(h^=f=o(f,b),19),h=o(h+=u,5)+1444728091,y=a(y=o(y,b),16),u=a(u^=y=o(y,v),17),u=o(u+=d,5)+197830471,g=a(g=o(g,v),17),d=a(d^=g=o(g,E),15),d=o(d+=p,5)+2530024501,m=a(m=o(m,E),18),p=a(p^=m=o(m,w),13),p=o(p+=h,5)+850148119;switch(f=0,y=0,g=0,m=0,r){case 15:m^=e[_+14]<<16;case 14:m^=e[_+13]<<8;case 13:m=o(m^=e[_+12],E),p^=m=o(m=a(m,18),w);case 12:g^=e[_+11]<<24;case 11:g^=e[_+10]<<16;case 10:g^=e[_+9]<<8;case 9:g=o(g^=e[_+8],v),d^=g=o(g=a(g,17),E);case 8:y^=e[_+7]<<24;case 7:y^=e[_+6]<<16;case 6:y^=e[_+5]<<8;case 5:y=o(y^=e[_+4],b),u^=y=o(y=a(y,16),v);case 4:f^=e[_+3]<<24;case 3:f^=e[_+2]<<16;case 2:f^=e[_+1]<<8;case 1:f=o(f^=e[_],w),h^=f=o(f=a(f,15),b)}return h^=e.length,h+=u^=e.length,h+=d^=e.length,u+=h+=p^=e.length,d+=h,p+=h,h=c(h),h+=u=c(u),h+=d=c(d),u+=h+=p=c(p),d+=h,p+=h,("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(u>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(p>>>0).toString(16)).slice(-8)},s.x64.hash128=function(e,t){if(s.inputValidation&&!i(e))return n;t=t||0;for(var r=e.length%16,o=e.length-r,a=[0,t],c=[0,t],y=[0,0],g=[0,0],m=[2277735313,289559509],w=[1291169091,658871167],b=0;b<o;b+=16)y=[e[b+4]|e[b+5]<<8|e[b+6]<<16|e[b+7]<<24,e[b]|e[b+1]<<8|e[b+2]<<16|e[b+3]<<24],g=[e[b+12]|e[b+13]<<8|e[b+14]<<16|e[b+15]<<24,e[b+8]|e[b+9]<<8|e[b+10]<<16|e[b+11]<<24],y=u(y=h(y,m),31),a=l(a=u(a=p(a,y=h(y,w)),27),c),a=l(h(a,[0,5]),[0,1390208809]),g=u(g=h(g,w),33),c=l(c=u(c=p(c,g=h(g,m)),31),a),c=l(h(c,[0,5]),[0,944331445]);switch(y=[0,0],g=[0,0],r){case 15:g=p(g,d([0,e[b+14]],48));case 14:g=p(g,d([0,e[b+13]],40));case 13:g=p(g,d([0,e[b+12]],32));case 12:g=p(g,d([0,e[b+11]],24));case 11:g=p(g,d([0,e[b+10]],16));case 10:g=p(g,d([0,e[b+9]],8));case 9:g=h(g=p(g,[0,e[b+8]]),w),c=p(c,g=h(g=u(g,33),m));case 8:y=p(y,d([0,e[b+7]],56));case 7:y=p(y,d([0,e[b+6]],48));case 6:y=p(y,d([0,e[b+5]],40));case 5:y=p(y,d([0,e[b+4]],32));case 4:y=p(y,d([0,e[b+3]],24));case 3:y=p(y,d([0,e[b+2]],16));case 2:y=p(y,d([0,e[b+1]],8));case 1:y=h(y=p(y,[0,e[b]]),m),a=p(a,y=h(y=u(y,31),w))}return a=l(a=p(a,[0,e.length]),c=p(c,[0,e.length])),c=l(c,a),a=l(a=f(a),c=f(c)),c=l(c,a),("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)+("00000000"+(c[0]>>>0).toString(16)).slice(-8)+("00000000"+(c[1]>>>0).toString(16)).slice(-8)},e.exports&&(t=e.exports=s),t.murmurHash3=s}()},97975:e=>{"use strict";function t(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}e.exports=function(e){var r=void 0,n=void 0;function s(e){if(!(e instanceof Object))throw new Error('Target "'+e+'" is not an object');n=e}function i(e){Object.keys(e).forEach((function(t){var r=e[t];if("function"!=typeof r)throw new Error('Trap "'+t+": "+r+'" is not a function');if(!Reflect[t])throw new Error('Trap "'+t+": "+r+'" is not a valid trap')})),r=e}s((function(){})),e&&s(e),i(Reflect);var o=new Proxy({},{get:function(e,s){return function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return r[s].apply(null,[n].concat(t(i.slice(1))))}}});return{setTarget:s,setHandler:i,getTarget:function(){return n},getHandler:function(){return r},proxy:new Proxy(n,o)}}},81661:(e,t,r)=>{"use strict";globalThis.fetch&&globalThis.Headers&&globalThis.Request&&globalThis.Response?e.exports={default:globalThis.fetch,Headers:globalThis.Headers,Request:globalThis.Request,Response:globalThis.Response}:e.exports={default:r(52515).default,Headers:r(52515).Headers,Request:r(52515).Request,Response:r(52515).Response}},30349:function(e,t){(function(){var e,r,n,s,i,o,a,c;c=function(e){return[(e&255<<24)>>>24,(e&255<<16)>>>16,(65280&e)>>>8,255&e].join(".")},a=function(e){var t,n,s,i,o,a;for(t=[],s=i=0;i<=3&&0!==e.length;s=++i){if(s>0){if("."!==e[0])throw new Error("Invalid IP");e=e.substring(1)}o=(a=r(e))[0],n=a[1],e=e.substring(n),t.push(o)}if(0!==e.length)throw new Error("Invalid IP");switch(t.length){case 1:if(t[0]>4294967295)throw new Error("Invalid IP");return t[0]>>>0;case 2:if(t[0]>255||t[1]>16777215)throw new Error("Invalid IP");return(t[0]<<24|t[1])>>>0;case 3:if(t[0]>255||t[1]>255||t[2]>65535)throw new Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2])>>>0;case 4:if(t[0]>255||t[1]>255||t[2]>255||t[3]>255)throw new Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0;default:throw new Error("Invalid IP")}},s=(n=function(e){return e.charCodeAt(0)})("0"),o=n("a"),i=n("A"),r=function(e){var t,r,a,c,l;for(c=0,t=10,r="9",a=0,e.length>1&&"0"===e[a]&&("x"===e[a+1]||"X"===e[a+1]?(a+=2,t=16):"0"<=e[a+1]&&e[a+1]<="9"&&(a++,t=8,r="7")),l=a;a<e.length;){if("0"<=e[a]&&e[a]<=r)c=c*t+(n(e[a])-s)>>>0;else{if(16!==t)break;if("a"<=e[a]&&e[a]<="f")c=c*t+(10+n(e[a])-o)>>>0;else{if(!("A"<=e[a]&&e[a]<="F"))break;c=c*t+(10+n(e[a])-i)>>>0}}if(c>4294967295)throw new Error("too large");a++}if(a===l)throw new Error("empty octet");return[c,a]},e=function(){function e(e,t){var r,n,s;if("string"!=typeof e)throw new Error("Missing `net' parameter");if(t||(s=e.split("/",2),e=s[0],t=s[1]),t||(t=32),"string"==typeof t&&t.indexOf(".")>-1){try{this.maskLong=a(t)}catch(e){throw new Error("Invalid mask: "+t)}for(r=n=32;n>=0;r=--n)if(this.maskLong===4294967295<<32-r>>>0){this.bitmask=r;break}}else{if(!t&&0!==t)throw new Error("Invalid mask: empty");this.bitmask=parseInt(t,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0)}try{this.netLong=(a(e)&this.maskLong)>>>0}catch(t){throw new Error("Invalid net address: "+e)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+t);this.size=Math.pow(2,32-this.bitmask),this.base=c(this.netLong),this.mask=c(this.maskLong),this.hostmask=c(~this.maskLong),this.first=this.bitmask<=30?c(this.netLong+1):this.base,this.last=this.bitmask<=30?c(this.netLong+this.size-2):c(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?c(this.netLong+this.size-1):void 0}return e.prototype.contains=function(t){return"string"==typeof t&&(t.indexOf("/")>0||4!==t.split(".").length)&&(t=new e(t)),t instanceof e?this.contains(t.base)&&this.contains(t.broadcast||t.last):(a(t)&this.maskLong)>>>0==(this.netLong&this.maskLong)>>>0},e.prototype.next=function(t){return null==t&&(t=1),new e(c(this.netLong+this.size*t),this.mask)},e.prototype.forEach=function(e){var t,r,n;for(n=a(this.first),r=a(this.last),t=0;n<=r;)e(c(n),n,t),t++,n++},e.prototype.toString=function(){return this.base+"/"+this.bitmask},e}(),t.ip2long=a,t.long2ip=c,t.Netmask=e}).call(this)},52515:(e,t)=>{"use strict";var r=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r)return r;throw new Error("unable to locate global object")}();e.exports=t=r.fetch,r.fetch&&(t.default=r.fetch.bind(r)),t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response},35564:(e,t,r)=>{var n=r(72900);function s(e,t){n.cipher.registerAlgorithm(e,(function(){return new n.aes.Algorithm(e,t)}))}r(79922),r(56337),r(33229),e.exports=n.aes=n.aes||{},n.aes.startEncrypting=function(e,t,r,n){var s=f({key:e,output:r,decrypt:!1,mode:n});return s.start(t),s},n.aes.createEncryptionCipher=function(e,t){return f({key:e,output:null,decrypt:!1,mode:t})},n.aes.startDecrypting=function(e,t,r,n){var s=f({key:e,output:r,decrypt:!0,mode:n});return s.start(t),s},n.aes.createDecryptionCipher=function(e,t){return f({key:e,output:null,decrypt:!0,mode:t})},n.aes.Algorithm=function(e,t){h||u();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return p(r._w,e,t,!1)},decrypt:function(e,t){return p(r._w,e,t,!0)}}}),r._init=!1},n.aes.Algorithm.prototype.initialize=function(e){if(!this._init){var t,r=e.key;if("string"!=typeof r||16!==r.length&&24!==r.length&&32!==r.length){if(n.util.isArray(r)&&(16===r.length||24===r.length||32===r.length)){t=r,r=n.util.createBuffer();for(var s=0;s<t.length;++s)r.putByte(t[s])}}else r=n.util.createBuffer(r);if(!n.util.isArray(r)){t=r,r=[];var i=t.length();if(16===i||24===i||32===i)for(i>>>=2,s=0;s<i;++s)r.push(t.getInt32())}if(!n.util.isArray(r)||4!==r.length&&6!==r.length&&8!==r.length)throw new Error("Invalid key parameter.");var o=this.mode.name,a=-1!==["CFB","OFB","CTR","GCM"].indexOf(o);this._w=d(r,e.decrypt&&!a),this._init=!0}},n.aes._expandKey=function(e,t){return h||u(),d(e,t)},n.aes._updateBlock=p,s("AES-ECB",n.cipher.modes.ecb),s("AES-CBC",n.cipher.modes.cbc),s("AES-CFB",n.cipher.modes.cfb),s("AES-OFB",n.cipher.modes.ofb),s("AES-CTR",n.cipher.modes.ctr),s("AES-GCM",n.cipher.modes.gcm);var i,o,a,c,l,h=!1;function u(){h=!0,a=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;for(i=new Array(256),o=new Array(256),c=new Array(4),l=new Array(4),t=0;t<4;++t)c[t]=new Array(256),l[t]=new Array(256);var r,n,s,u,d,p,f,y=0,g=0;for(t=0;t<256;++t){u=(u=g^g<<1^g<<2^g<<3^g<<4)>>8^255&u^99,i[y]=u,o[u]=y,p=(d=e[u])<<24^u<<16^u<<8^u^d,f=((r=e[y])^(n=e[r])^(s=e[n]))<<24^(y^s)<<16^(y^n^s)<<8^y^r^s;for(var m=0;m<4;++m)c[m][y]=p,l[m][u]=f,p=p<<24|p>>>8,f=f<<24|f>>>8;0===y?y=g=1:(y=r^e[e[e[r^s]]],g^=e[e[g]])}}function d(e,t){for(var r,n=e.slice(0),s=1,o=n.length,c=4*(o+6+1),h=o;h<c;++h)r=n[h-1],h%o==0?(r=i[r>>>16&255]<<24^i[r>>>8&255]<<16^i[255&r]<<8^i[r>>>24]^a[s]<<24,s++):o>6&&h%o==4&&(r=i[r>>>24]<<24^i[r>>>16&255]<<16^i[r>>>8&255]<<8^i[255&r]),n[h]=n[h-o]^r;if(t){for(var u,d=l[0],p=l[1],f=l[2],y=l[3],g=n.slice(0),m=(h=0,(c=n.length)-4);h<c;h+=4,m-=4)if(0===h||h===c-4)g[h]=n[m],g[h+1]=n[m+3],g[h+2]=n[m+2],g[h+3]=n[m+1];else for(var w=0;w<4;++w)u=n[m+w],g[h+(3&-w)]=d[i[u>>>24]]^p[i[u>>>16&255]]^f[i[u>>>8&255]]^y[i[255&u]];n=g}return n}function p(e,t,r,n){var s,a,h,u,d,p,f,y,g,m,w,b,v=e.length/4-1;n?(s=l[0],a=l[1],h=l[2],u=l[3],d=o):(s=c[0],a=c[1],h=c[2],u=c[3],d=i),p=t[0]^e[0],f=t[n?3:1]^e[1],y=t[2]^e[2],g=t[n?1:3]^e[3];for(var E=3,_=1;_<v;++_)m=s[p>>>24]^a[f>>>16&255]^h[y>>>8&255]^u[255&g]^e[++E],w=s[f>>>24]^a[y>>>16&255]^h[g>>>8&255]^u[255&p]^e[++E],b=s[y>>>24]^a[g>>>16&255]^h[p>>>8&255]^u[255&f]^e[++E],g=s[g>>>24]^a[p>>>16&255]^h[f>>>8&255]^u[255&y]^e[++E],p=m,f=w,y=b;r[0]=d[p>>>24]<<24^d[f>>>16&255]<<16^d[y>>>8&255]<<8^d[255&g]^e[++E],r[n?3:1]=d[f>>>24]<<24^d[y>>>16&255]<<16^d[g>>>8&255]<<8^d[255&p]^e[++E],r[2]=d[y>>>24]<<24^d[g>>>16&255]<<16^d[p>>>8&255]<<8^d[255&f]^e[++E],r[n?1:3]=d[g>>>24]<<24^d[p>>>16&255]<<16^d[f>>>8&255]<<8^d[255&y]^e[++E]}function f(e){var t,r="AES-"+((e=e||{}).mode||"CBC").toUpperCase(),s=(t=e.decrypt?n.cipher.createDecipher(r,e.key):n.cipher.createCipher(r,e.key)).start;return t.start=function(e,r){var i=null;r instanceof n.util.ByteBuffer&&(i=r,r={}),(r=r||{}).output=i,r.iv=e,s.call(t,r)},t}},69522:(e,t,r)=>{var n=r(72900);r(33229),r(8579);var s=e.exports=n.asn1=n.asn1||{};function i(e,t,r){if(r>t){var n=new Error("Too few bytes to parse DER.");throw n.available=e.length(),n.remaining=t,n.requested=r,n}}function o(e,t,r,n){var a;i(e,t,2);var c=e.getByte();t--;var l=192&c,h=31&c;a=e.length();var u,d,p=function(e,t){var r=e.getByte();if(t--,128!==r){var n;if(128&r){var s=127&r;i(e,t,s),n=e.getInt(s<<3)}else n=r;if(n<0)throw new Error("Negative length: "+n);return n}}(e,t);if(t-=a-e.length(),void 0!==p&&p>t){if(n.strict){var f=new Error("Too few bytes to read ASN.1 value.");throw f.available=e.length(),f.remaining=t,f.requested=p,f}p=t}var y=32==(32&c);if(y)if(u=[],void 0===p)for(;;){if(i(e,t,2),e.bytes(2)===String.fromCharCode(0,0)){e.getBytes(2),t-=2;break}a=e.length(),u.push(o(e,t,r+1,n)),t-=a-e.length()}else for(;p>0;)a=e.length(),u.push(o(e,p,r+1,n)),t-=a-e.length(),p-=a-e.length();if(void 0===u&&l===s.Class.UNIVERSAL&&h===s.Type.BITSTRING&&(d=e.bytes(p)),void 0===u&&n.decodeBitStrings&&l===s.Class.UNIVERSAL&&h===s.Type.BITSTRING&&p>1){var g=e.read,m=t,w=0;if(h===s.Type.BITSTRING&&(i(e,t,1),w=e.getByte(),t--),0===w)try{a=e.length();var b=o(e,t,r+1,{strict:!0,decodeBitStrings:!0}),v=a-e.length();t-=v,h==s.Type.BITSTRING&&v++;var E=b.tagClass;v!==p||E!==s.Class.UNIVERSAL&&E!==s.Class.CONTEXT_SPECIFIC||(u=[b])}catch(e){}void 0===u&&(e.read=g,t=m)}if(void 0===u){if(void 0===p){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");p=t}if(h===s.Type.BMPSTRING)for(u="";p>0;p-=2)i(e,t,2),u+=String.fromCharCode(e.getInt16()),t-=2;else u=e.getBytes(p),t-=p}var _=void 0===d?null:{bitStringContents:d};return s.create(l,h,y,u,_)}s.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},s.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},s.create=function(e,t,r,i,o){if(n.util.isArray(i)){for(var a=[],c=0;c<i.length;++c)void 0!==i[c]&&a.push(i[c]);i=a}var l={tagClass:e,type:t,constructed:r,composed:r||n.util.isArray(i),value:i};return o&&"bitStringContents"in o&&(l.bitStringContents=o.bitStringContents,l.original=s.copy(l)),l},s.copy=function(e,t){var r;if(n.util.isArray(e)){r=[];for(var i=0;i<e.length;++i)r.push(s.copy(e[i],t));return r}return"string"==typeof e?e:(r={tagClass:e.tagClass,type:e.type,constructed:e.constructed,composed:e.composed,value:s.copy(e.value,t)},t&&!t.excludeBitStringContents&&(r.bitStringContents=e.bitStringContents),r)},s.equals=function(e,t,r){if(n.util.isArray(e)){if(!n.util.isArray(t))return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(!s.equals(e[i],t[i]))return!1;return!0}if(typeof e!=typeof t)return!1;if("string"==typeof e)return e===t;var o=e.tagClass===t.tagClass&&e.type===t.type&&e.constructed===t.constructed&&e.composed===t.composed&&s.equals(e.value,t.value);return r&&r.includeBitStringContents&&(o=o&&e.bitStringContents===t.bitStringContents),o},s.getBerValueLength=function(e){var t=e.getByte();if(128!==t)return 128&t?e.getInt((127&t)<<3):t},s.fromDer=function(e,t){void 0===t&&(t={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),"boolean"==typeof t&&(t={strict:t,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in t||(t.strict=!0),"parseAllBytes"in t||(t.parseAllBytes=!0),"decodeBitStrings"in t||(t.decodeBitStrings=!0),"string"==typeof e&&(e=n.util.createBuffer(e));var r=e.length(),s=o(e,e.length(),0,t);if(t.parseAllBytes&&0!==e.length()){var i=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw i.byteCount=r,i.remaining=e.length(),i}return s},s.toDer=function(e){var t=n.util.createBuffer(),r=e.tagClass|e.type,i=n.util.createBuffer(),o=!1;if("bitStringContents"in e&&(o=!0,e.original&&(o=s.equals(e,e.original))),o)i.putBytes(e.bitStringContents);else if(e.composed){e.constructed?r|=32:i.putByte(0);for(var a=0;a<e.value.length;++a)void 0!==e.value[a]&&i.putBuffer(s.toDer(e.value[a]))}else if(e.type===s.Type.BMPSTRING)for(a=0;a<e.value.length;++a)i.putInt16(e.value.charCodeAt(a));else e.type===s.Type.INTEGER&&e.value.length>1&&(0===e.value.charCodeAt(0)&&0==(128&e.value.charCodeAt(1))||255===e.value.charCodeAt(0)&&128==(128&e.value.charCodeAt(1)))?i.putBytes(e.value.substr(1)):i.putBytes(e.value);if(t.putByte(r),i.length()<=127)t.putByte(127&i.length());else{var c=i.length(),l="";do{l+=String.fromCharCode(255&c),c>>>=8}while(c>0);for(t.putByte(128|l.length),a=l.length-1;a>=0;--a)t.putByte(l.charCodeAt(a))}return t.putBuffer(i),t},s.oidToDer=function(e){var t,r,s,i,o=e.split("."),a=n.util.createBuffer();a.putByte(40*parseInt(o[0],10)+parseInt(o[1],10));for(var c=2;c<o.length;++c){t=!0,r=[],s=parseInt(o[c],10);do{i=127&s,s>>>=7,t||(i|=128),r.push(i),t=!1}while(s>0);for(var l=r.length-1;l>=0;--l)a.putByte(r[l])}return a},s.derToOid=function(e){var t;"string"==typeof e&&(e=n.util.createBuffer(e));var r=e.getByte();t=Math.floor(r/40)+"."+r%40;for(var s=0;e.length()>0;)s<<=7,128&(r=e.getByte())?s+=127&r:(t+="."+(s+r),s=0);return t},s.utcTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,2),10);r=r>=50?1900+r:2e3+r;var n=parseInt(e.substr(2,2),10)-1,s=parseInt(e.substr(4,2),10),i=parseInt(e.substr(6,2),10),o=parseInt(e.substr(8,2),10),a=0;if(e.length>11){var c=e.charAt(10),l=10;"+"!==c&&"-"!==c&&(a=parseInt(e.substr(10,2),10),l+=2)}if(t.setUTCFullYear(r,n,s),t.setUTCHours(i,o,a,0),l&&("+"===(c=e.charAt(l))||"-"===c)){var h=60*parseInt(e.substr(l+1,2),10)+parseInt(e.substr(l+4,2),10);h*=6e4,"+"===c?t.setTime(+t-h):t.setTime(+t+h)}return t},s.generalizedTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,4),10),n=parseInt(e.substr(4,2),10)-1,s=parseInt(e.substr(6,2),10),i=parseInt(e.substr(8,2),10),o=parseInt(e.substr(10,2),10),a=parseInt(e.substr(12,2),10),c=0,l=0,h=!1;"Z"===e.charAt(e.length-1)&&(h=!0);var u=e.length-5,d=e.charAt(u);return"+"!==d&&"-"!==d||(l=60*parseInt(e.substr(u+1,2),10)+parseInt(e.substr(u+4,2),10),l*=6e4,"+"===d&&(l*=-1),h=!0),"."===e.charAt(14)&&(c=1e3*parseFloat(e.substr(14),10)),h?(t.setUTCFullYear(r,n,s),t.setUTCHours(i,o,a,c),t.setTime(+t+l)):(t.setFullYear(r,n,s),t.setHours(i,o,a,c)),t},s.dateToUtcTime=function(e){if("string"==typeof e)return e;var t="",r=[];r.push((""+e.getUTCFullYear()).substr(2)),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(t+="0"),t+=r[n];return t+"Z"},s.dateToGeneralizedTime=function(e){if("string"==typeof e)return e;var t="",r=[];r.push(""+e.getUTCFullYear()),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(t+="0"),t+=r[n];return t+"Z"},s.integerToDer=function(e){var t=n.util.createBuffer();if(e>=-128&&e<128)return t.putSignedInt(e,8);if(e>=-32768&&e<32768)return t.putSignedInt(e,16);if(e>=-8388608&&e<8388608)return t.putSignedInt(e,24);if(e>=-2147483648&&e<2147483648)return t.putSignedInt(e,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=e,r},s.derToInteger=function(e){"string"==typeof e&&(e=n.util.createBuffer(e));var t=8*e.length();if(t>32)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},s.validate=function(e,t,r,i){var o=!1;if(e.tagClass!==t.tagClass&&void 0!==t.tagClass||e.type!==t.type&&void 0!==t.type)i&&(e.tagClass!==t.tagClass&&i.push("["+t.name+'] Expected tag class "'+t.tagClass+'", got "'+e.tagClass+'"'),e.type!==t.type&&i.push("["+t.name+'] Expected type "'+t.type+'", got "'+e.type+'"'));else if(e.constructed===t.constructed||void 0===t.constructed){if(o=!0,t.value&&n.util.isArray(t.value))for(var a=0,c=0;o&&c<t.value.length;++c)o=t.value[c].optional||!1,e.value[a]&&((o=s.validate(e.value[a],t.value[c],r,i))?++a:t.value[c].optional&&(o=!0)),!o&&i&&i.push("["+t.name+'] Tag class "'+t.tagClass+'", type "'+t.type+'" expected value length "'+t.value.length+'", got "'+e.value.length+'"');if(o&&r&&(t.capture&&(r[t.capture]=e.value),t.captureAsn1&&(r[t.captureAsn1]=e),t.captureBitStringContents&&"bitStringContents"in e&&(r[t.captureBitStringContents]=e.bitStringContents),t.captureBitStringValue&&"bitStringContents"in e))if(e.bitStringContents.length<2)r[t.captureBitStringValue]="";else{if(0!==e.bitStringContents.charCodeAt(0))throw new Error("captureBitStringValue only supported for zero unused bits");r[t.captureBitStringValue]=e.bitStringContents.slice(1)}}else i&&i.push("["+t.name+'] Expected constructed "'+t.constructed+'", got "'+e.constructed+'"');return o};var a=/[^\\u0000-\\u00ff]/;s.prettyPrint=function(e,t,r){var i="";r=r||2,(t=t||0)>0&&(i+="\n");for(var o="",c=0;c<t*r;++c)o+=" ";switch(i+=o+"Tag: ",e.tagClass){case s.Class.UNIVERSAL:i+="Universal:";break;case s.Class.APPLICATION:i+="Application:";break;case s.Class.CONTEXT_SPECIFIC:i+="Context-Specific:";break;case s.Class.PRIVATE:i+="Private:"}if(e.tagClass===s.Class.UNIVERSAL)switch(i+=e.type,e.type){case s.Type.NONE:i+=" (None)";break;case s.Type.BOOLEAN:i+=" (Boolean)";break;case s.Type.INTEGER:i+=" (Integer)";break;case s.Type.BITSTRING:i+=" (Bit string)";break;case s.Type.OCTETSTRING:i+=" (Octet string)";break;case s.Type.NULL:i+=" (Null)";break;case s.Type.OID:i+=" (Object Identifier)";break;case s.Type.ODESC:i+=" (Object Descriptor)";break;case s.Type.EXTERNAL:i+=" (External or Instance of)";break;case s.Type.REAL:i+=" (Real)";break;case s.Type.ENUMERATED:i+=" (Enumerated)";break;case s.Type.EMBEDDED:i+=" (Embedded PDV)";break;case s.Type.UTF8:i+=" (UTF8)";break;case s.Type.ROID:i+=" (Relative Object Identifier)";break;case s.Type.SEQUENCE:i+=" (Sequence)";break;case s.Type.SET:i+=" (Set)";break;case s.Type.PRINTABLESTRING:i+=" (Printable String)";break;case s.Type.IA5String:i+=" (IA5String (ASCII))";break;case s.Type.UTCTIME:i+=" (UTC time)";break;case s.Type.GENERALIZEDTIME:i+=" (Generalized time)";break;case s.Type.BMPSTRING:i+=" (BMP String)"}else i+=e.type;if(i+="\n",i+=o+"Constructed: "+e.constructed+"\n",e.composed){var l=0,h="";for(c=0;c<e.value.length;++c)void 0!==e.value[c]&&(l+=1,h+=s.prettyPrint(e.value[c],t+1,r),c+1<e.value.length&&(h+=","));i+=o+"Sub values: "+l+h}else{if(i+=o+"Value: ",e.type===s.Type.OID){var u=s.derToOid(e.value);i+=u,n.pki&&n.pki.oids&&u in n.pki.oids&&(i+=" ("+n.pki.oids[u]+") ")}if(e.type===s.Type.INTEGER)try{i+=s.derToInteger(e.value)}catch(t){i+="0x"+n.util.bytesToHex(e.value)}else if(e.type===s.Type.BITSTRING){if(e.value.length>1?i+="0x"+n.util.bytesToHex(e.value.slice(1)):i+="(none)",e.value.length>0){var d=e.value.charCodeAt(0);1==d?i+=" (1 unused bit shown)":d>1&&(i+=" ("+d+" unused bits shown)")}}else if(e.type===s.Type.OCTETSTRING)a.test(e.value)||(i+="("+e.value+") "),i+="0x"+n.util.bytesToHex(e.value);else if(e.type===s.Type.UTF8)try{i+=n.util.decodeUtf8(e.value)}catch(t){if("URI malformed"!==t.message)throw t;i+="0x"+n.util.bytesToHex(e.value)+" (malformed UTF8)"}else e.type===s.Type.PRINTABLESTRING||e.type===s.Type.IA5String?i+=e.value:a.test(e.value)?i+="0x"+n.util.bytesToHex(e.value):0===e.value.length?i+="[null]":i+=e.value}return i}},41996:(e,t,r)=>{var n=r(62678).Buffer,s={};e.exports=s;var i={};s.encode=function(e,t,r){if("string"!=typeof t)throw new TypeError('"alphabet" must be a string.');if(void 0!==r&&"number"!=typeof r)throw new TypeError('"maxline" must be a number.');var n="";if(e instanceof Uint8Array){var s=0,i=t.length,o=t.charAt(0),a=[0];for(s=0;s<e.length;++s){for(var c=0,l=e[s];c<a.length;++c)l+=a[c]<<8,a[c]=l%i,l=l/i|0;for(;l>0;)a.push(l%i),l=l/i|0}for(s=0;0===e[s]&&s<e.length-1;++s)n+=o;for(s=a.length-1;s>=0;--s)n+=t[a[s]]}else n=function(e,t){var r=0,n=t.length,s=t.charAt(0),i=[0];for(r=0;r<e.length();++r){for(var o=0,a=e.at(r);o<i.length;++o)a+=i[o]<<8,i[o]=a%n,a=a/n|0;for(;a>0;)i.push(a%n),a=a/n|0}var c="";for(r=0;0===e.at(r)&&r<e.length()-1;++r)c+=s;for(r=i.length-1;r>=0;--r)c+=t[i[r]];return c}(e,t);if(r){var h=new RegExp(".{1,"+r+"}","g");n=n.match(h).join("\r\n")}return n},s.decode=function(e,t){if("string"!=typeof e)throw new TypeError('"input" must be a string.');if("string"!=typeof t)throw new TypeError('"alphabet" must be a string.');var r=i[t];if(!r){r=i[t]=[];for(var s=0;s<t.length;++s)r[t.charCodeAt(s)]=s}e=e.replace(/\s/g,"");var o=t.length,a=t.charAt(0),c=[0];for(s=0;s<e.length;s++){var l=r[e.charCodeAt(s)];if(void 0===l)return;for(var h=0,u=l;h<c.length;++h)u+=c[h]*o,c[h]=255&u,u>>=8;for(;u>0;)c.push(255&u),u>>=8}for(var d=0;e[d]===a&&d<e.length-1;++d)c.push(0);return void 0!==n?n.from(c.reverse()):new Uint8Array(c.reverse())}},79922:(e,t,r)=>{var n=r(72900);r(33229),e.exports=n.cipher=n.cipher||{},n.cipher.algorithms=n.cipher.algorithms||{},n.cipher.createCipher=function(e,t){var r=e;if("string"==typeof r&&(r=n.cipher.getAlgorithm(r))&&(r=r()),!r)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:r,key:t,decrypt:!1})},n.cipher.createDecipher=function(e,t){var r=e;if("string"==typeof r&&(r=n.cipher.getAlgorithm(r))&&(r=r()),!r)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:r,key:t,decrypt:!0})},n.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),n.cipher.algorithms[e]=t},n.cipher.getAlgorithm=function(e){return(e=e.toUpperCase())in n.cipher.algorithms?n.cipher.algorithms[e]:null};var s=n.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};s.prototype.start=function(e){e=e||{};var t={};for(var r in e)t[r]=e[r];t.decrypt=this._decrypt,this._finish=!1,this._input=n.util.createBuffer(),this.output=e.output||n.util.createBuffer(),this.mode.start(t)},s.prototype.update=function(e){for(e&&this._input.putBuffer(e);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},s.prototype.finish=function(e){!e||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(t){return e(this.blockSize,t,!1)},this.mode.unpad=function(t){return e(this.blockSize,t,!0)});var t={};return t.decrypt=this._decrypt,t.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,t)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t)||this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)))}},56337:(e,t,r)=>{var n=r(72900);r(33229),n.cipher=n.cipher||{};var s=e.exports=n.cipher.modes=n.cipher.modes||{};function i(e,t){if("string"==typeof e&&(e=n.util.createBuffer(e)),n.util.isArray(e)&&e.length>4){var r=e;e=n.util.createBuffer();for(var s=0;s<r.length;++s)e.putByte(r[s])}if(e.length()<t)throw new Error("Invalid IV length; got "+e.length()+" bytes and expected "+t+" bytes.");if(!n.util.isArray(e)){var i=[],o=t/4;for(s=0;s<o;++s)i.push(e.getInt32());e=i}return e}function o(e){e[e.length-1]=e[e.length-1]+1&4294967295}function a(e){return[e/4294967296|0,4294967295&e]}s.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},s.ecb.prototype.start=function(e){},s.ecb.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();for(this.cipher.encrypt(this._inBlock,this._outBlock),n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},s.ecb.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();for(this.cipher.decrypt(this._inBlock,this._outBlock),n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},s.ecb.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},s.ecb.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var r=e.length(),n=e.at(r-1);return!(n>this.blockSize<<2||(e.truncate(n),0))},s.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},s.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=i(e.iv,this.blockSize),this._prev=this._iv.slice(0)}},s.cbc.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^e.getInt32();for(this.cipher.encrypt(this._inBlock,this._outBlock),n=0;n<this._ints;++n)t.putInt32(this._outBlock[n]);this._prev=this._outBlock},s.cbc.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();for(this.cipher.decrypt(this._inBlock,this._outBlock),n=0;n<this._ints;++n)t.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)},s.cbc.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},s.cbc.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var r=e.length(),n=e.at(r-1);return!(n>this.blockSize<<2||(e.truncate(n),0))},s.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},s.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=i(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},s.cfb.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var s=0;s<this._ints;++s)this._inBlock[s]=e.getInt32()^this._outBlock[s],t.putInt32(this._inBlock[s]);else{var i=(this.blockSize-n)%this.blockSize;for(i>0&&(i=this.blockSize-i),this._partialOutput.clear(),s=0;s<this._ints;++s)this._partialBlock[s]=e.getInt32()^this._outBlock[s],this._partialOutput.putInt32(this._partialBlock[s]);if(i>0)e.read-=this.blockSize;else for(s=0;s<this._ints;++s)this._inBlock[s]=this._partialBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},s.cfb.prototype.decrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var s=0;s<this._ints;++s)this._inBlock[s]=e.getInt32(),t.putInt32(this._inBlock[s]^this._outBlock[s]);else{var i=(this.blockSize-n)%this.blockSize;for(i>0&&(i=this.blockSize-i),this._partialOutput.clear(),s=0;s<this._ints;++s)this._partialBlock[s]=e.getInt32(),this._partialOutput.putInt32(this._partialBlock[s]^this._outBlock[s]);if(i>0)e.read-=this.blockSize;else for(s=0;s<this._ints;++s)this._inBlock[s]=this._partialBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},s.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},s.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=i(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},s.ofb.prototype.encrypt=function(e,t,r){var n=e.length();if(0===e.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var s=0;s<this._ints;++s)t.putInt32(e.getInt32()^this._outBlock[s]),this._inBlock[s]=this._outBlock[s];else{var i=(this.blockSize-n)%this.blockSize;for(i>0&&(i=this.blockSize-i),this._partialOutput.clear(),s=0;s<this._ints;++s)this._partialOutput.putInt32(e.getInt32()^this._outBlock[s]);if(i>0)e.read-=this.blockSize;else for(s=0;s<this._ints;++s)this._inBlock[s]=this._outBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},s.ofb.prototype.decrypt=s.ofb.prototype.encrypt,s.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},s.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=i(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},s.ctr.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var s=0;s<this._ints;++s)t.putInt32(e.getInt32()^this._outBlock[s]);else{var i=(this.blockSize-n)%this.blockSize;for(i>0&&(i=this.blockSize-i),this._partialOutput.clear(),s=0;s<this._ints;++s)this._partialOutput.putInt32(e.getInt32()^this._outBlock[s]);if(i>0&&(e.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}o(this._inBlock)},s.ctr.prototype.decrypt=s.ctr.prototype.encrypt,s.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0,this._R=3774873600},s.gcm.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");var t,r=n.util.createBuffer(e.iv);if(this._cipherLength=0,t="additionalData"in e?n.util.createBuffer(e.additionalData):n.util.createBuffer(),this._tagLength="tagLength"in e?e.tagLength:128,this._tag=null,e.decrypt&&(this._tag=n.util.createBuffer(e.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var s=r.length();if(12===s)this._j0=[r.getInt32(),r.getInt32(),r.getInt32(),1];else{for(this._j0=[0,0,0,0];r.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[r.getInt32(),r.getInt32(),r.getInt32(),r.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(a(8*s)))}this._inBlock=this._j0.slice(0),o(this._inBlock),this._partialBytes=0,t=n.util.createBuffer(t),this._aDataLength=a(8*t.length());var i=t.length()%this.blockSize;for(i&&t.fillWithByte(0,this.blockSize-i),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])},s.gcm.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize){for(var s=0;s<this._ints;++s)t.putInt32(this._outBlock[s]^=e.getInt32());this._cipherLength+=this.blockSize}else{var i=(this.blockSize-n)%this.blockSize;for(i>0&&(i=this.blockSize-i),this._partialOutput.clear(),s=0;s<this._ints;++s)this._partialOutput.putInt32(e.getInt32()^this._outBlock[s]);if(i<=0||r){if(r){var a=n%this.blockSize;this._cipherLength+=a,this._partialOutput.truncate(this.blockSize-a)}else this._cipherLength+=this.blockSize;for(s=0;s<this._ints;++s)this._outBlock[s]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return e.read-=this.blockSize,t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),o(this._inBlock)},s.gcm.prototype.decrypt=function(e,t,r){var n=e.length();if(n<this.blockSize&&!(r&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),o(this._inBlock),this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var s=0;s<this._ints;++s)t.putInt32(this._outBlock[s]^this._hashBlock[s]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize},s.gcm.prototype.afterFinish=function(e,t){var r=!0;t.decrypt&&t.overflow&&e.truncate(this.blockSize-t.overflow),this.tag=n.util.createBuffer();var s=this._aDataLength.concat(a(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,s);var i=[];this.cipher.encrypt(this._j0,i);for(var o=0;o<this._ints;++o)this.tag.putInt32(this._s[o]^i[o]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),t.decrypt&&this.tag.bytes()!==this._tag&&(r=!1),r},s.gcm.prototype.multiply=function(e,t){for(var r=[0,0,0,0],n=t.slice(0),s=0;s<128;++s)e[s/32|0]&1<<31-s%32&&(r[0]^=n[0],r[1]^=n[1],r[2]^=n[2],r[3]^=n[3]),this.pow(n,n);return r},s.gcm.prototype.pow=function(e,t){for(var r=1&e[3],n=3;n>0;--n)t[n]=e[n]>>>1|(1&e[n-1])<<31;t[0]=e[0]>>>1,r&&(t[0]^=this._R)},s.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],r=0;r<32;++r){var n=e[r/8|0]>>>4*(7-r%8)&15,s=this._m[r][n];t[0]^=s[0],t[1]^=s[1],t[2]^=s[2],t[3]^=s[3]}return t},s.gcm.prototype.ghash=function(e,t,r){return t[0]^=r[0],t[1]^=r[1],t[2]^=r[2],t[3]^=r[3],this.tableMultiply(t)},s.gcm.prototype.generateHashTable=function(e,t){for(var r=8/t,n=4*r,s=16*r,i=new Array(s),o=0;o<s;++o){var a=[0,0,0,0],c=(n-1-o%n)*t;a[o/n|0]=1<<t-1<<c,i[o]=this.generateSubHashTable(this.multiply(a,e),t)}return i},s.gcm.prototype.generateSubHashTable=function(e,t){var r=1<<t,n=r>>>1,s=new Array(r);s[n]=e.slice(0);for(var i=n>>>1;i>0;)this.pow(s[2*i],s[i]=[]),i>>=1;for(i=2;i<n;){for(var o=1;o<i;++o){var a=s[i],c=s[o];s[i+o]=[a[0]^c[0],a[1]^c[1],a[2]^c[2],a[3]^c[3]]}i*=2}for(s[0]=[0,0,0,0],i=n+1;i<r;++i){var l=s[i^n];s[i]=[e[0]^l[0],e[1]^l[1],e[2]^l[2],e[3]^l[3]]}return s}},9891:(e,t,r)=>{var n=r(72900);function s(e,t){n.cipher.registerAlgorithm(e,(function(){return new n.des.Algorithm(e,t)}))}r(79922),r(56337),r(33229),e.exports=n.des=n.des||{},n.des.startEncrypting=function(e,t,r,n){var s=f({key:e,output:r,decrypt:!1,mode:n||(null===t?"ECB":"CBC")});return s.start(t),s},n.des.createEncryptionCipher=function(e,t){return f({key:e,output:null,decrypt:!1,mode:t})},n.des.startDecrypting=function(e,t,r,n){var s=f({key:e,output:r,decrypt:!0,mode:n||(null===t?"ECB":"CBC")});return s.start(t),s},n.des.createDecryptionCipher=function(e,t){return f({key:e,output:null,decrypt:!0,mode:t})},n.des.Algorithm=function(e,t){var r=this;r.name=e,r.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return p(r._keys,e,t,!1)},decrypt:function(e,t){return p(r._keys,e,t,!0)}}}),r._init=!1},n.des.Algorithm.prototype.initialize=function(e){if(!this._init){var t=n.util.createBuffer(e.key);if(0===this.name.indexOf("3DES")&&24!==t.length())throw new Error("Invalid Triple-DES key size: "+8*t.length());this._keys=function(e){for(var t,r=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],n=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],s=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],i=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],o=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],a=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],c=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],l=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],h=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],u=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],d=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],p=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],f=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],y=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],g=e.length()>8?3:1,m=[],w=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],b=0,v=0;v<g;v++){var E=e.getInt32(),_=e.getInt32();E^=(t=252645135&(E>>>4^_))<<4,E^=t=65535&((_^=t)>>>-16^E),E^=(t=858993459&(E>>>2^(_^=t<<-16)))<<2,E^=t=65535&((_^=t)>>>-16^E),E^=(t=1431655765&(E>>>1^(_^=t<<-16)))<<1,E^=t=16711935&((_^=t)>>>8^E),t=(E^=(t=1431655765&(E>>>1^(_^=t<<8)))<<1)<<8|(_^=t)>>>20&240,E=_<<24|_<<8&16711680|_>>>8&65280|_>>>24&240,_=t;for(var S=0;S<w.length;++S){w[S]?(E=E<<2|E>>>26,_=_<<2|_>>>26):(E=E<<1|E>>>27,_=_<<1|_>>>27);var A=r[(E&=-15)>>>28]|n[E>>>24&15]|s[E>>>20&15]|i[E>>>16&15]|o[E>>>12&15]|a[E>>>8&15]|c[E>>>4&15],I=l[(_&=-15)>>>28]|h[_>>>24&15]|u[_>>>20&15]|d[_>>>16&15]|p[_>>>12&15]|f[_>>>8&15]|y[_>>>4&15];t=65535&(I>>>16^A),m[b++]=A^t,m[b++]=I^t<<16}}return m}(t),this._init=!0}},s("DES-ECB",n.cipher.modes.ecb),s("DES-CBC",n.cipher.modes.cbc),s("DES-CFB",n.cipher.modes.cfb),s("DES-OFB",n.cipher.modes.ofb),s("DES-CTR",n.cipher.modes.ctr),s("3DES-ECB",n.cipher.modes.ecb),s("3DES-CBC",n.cipher.modes.cbc),s("3DES-CFB",n.cipher.modes.cfb),s("3DES-OFB",n.cipher.modes.ofb),s("3DES-CTR",n.cipher.modes.ctr);var i=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],o=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],a=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],c=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],l=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],h=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],u=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],d=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function p(e,t,r,n){var s,p,f=32===e.length?3:9;s=3===f?n?[30,-2,-2]:[0,32,2]:n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var y=t[0],g=t[1];y^=(p=252645135&(y>>>4^g))<<4,y^=(p=65535&(y>>>16^(g^=p)))<<16,y^=p=858993459&((g^=p)>>>2^y),y^=p=16711935&((g^=p<<2)>>>8^y),y=(y^=(p=1431655765&(y>>>1^(g^=p<<8)))<<1)<<1|y>>>31,g=(g^=p)<<1|g>>>31;for(var m=0;m<f;m+=3){for(var w=s[m+1],b=s[m+2],v=s[m];v!=w;v+=b){var E=g^e[v],_=(g>>>4|g<<28)^e[v+1];p=y,y=g,g=p^(o[E>>>24&63]|c[E>>>16&63]|h[E>>>8&63]|d[63&E]|i[_>>>24&63]|a[_>>>16&63]|l[_>>>8&63]|u[63&_])}p=y,y=g,g=p}g=g>>>1|g<<31,g^=p=1431655765&((y=y>>>1|y<<31)>>>1^g),g^=(p=16711935&(g>>>8^(y^=p<<1)))<<8,g^=(p=858993459&(g>>>2^(y^=p)))<<2,g^=p=65535&((y^=p)>>>16^g),g^=p=252645135&((y^=p<<16)>>>4^g),y^=p<<4,r[0]=y,r[1]=g}function f(e){var t,r="DES-"+((e=e||{}).mode||"CBC").toUpperCase(),s=(t=e.decrypt?n.cipher.createDecipher(r,e.key):n.cipher.createCipher(r,e.key)).start;return t.start=function(e,r){var i=null;r instanceof n.util.ByteBuffer&&(i=r,r={}),(r=r||{}).output=i,r.iv=e,s.call(t,r)},t}},72900:e=>{e.exports={options:{usePureJavaScript:!1}}},30669:(e,t,r)=>{var n=r(72900);r(20119),r(33229),(e.exports=n.hmac=n.hmac||{}).create=function(){var e=null,t=null,r=null,s=null,i={start:function(i,o){if(null!==i)if("string"==typeof i){if(!((i=i.toLowerCase())in n.md.algorithms))throw new Error('Unknown hash algorithm "'+i+'"');t=n.md.algorithms[i].create()}else t=i;if(null===o)o=e;else{if("string"==typeof o)o=n.util.createBuffer(o);else if(n.util.isArray(o)){var a=o;o=n.util.createBuffer();for(var c=0;c<a.length;++c)o.putByte(a[c])}var l=o.length();for(l>t.blockLength&&(t.start(),t.update(o.bytes()),o=t.digest()),r=n.util.createBuffer(),s=n.util.createBuffer(),l=o.length(),c=0;c<l;++c)a=o.at(c),r.putByte(54^a),s.putByte(92^a);if(l<t.blockLength)for(a=t.blockLength-l,c=0;c<a;++c)r.putByte(54),s.putByte(92);e=o,r=r.bytes(),s=s.bytes()}t.start(),t.update(r)},update:function(e){t.update(e)},getMac:function(){var e=t.digest().bytes();return t.start(),t.update(s),t.update(e),t.digest()}};return i.digest=i.getMac,i}},67161:(e,t,r)=>{var n,s=r(72900);function i(e,t,r){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function o(){return new i(null)}function a(e,t,r,n,s,i){for(var o=16383&t,a=t>>14;--i>=0;){var c=16383&this.data[e],l=this.data[e++]>>14,h=a*c+l*o;s=((c=o*c+((16383&h)<<14)+r.data[n]+s)>>28)+(h>>14)+a*l,r.data[n++]=268435455&c}return s}e.exports=s.jsbn=s.jsbn||{},s.jsbn.BigInteger=i,"undefined"==typeof navigator?(i.prototype.am=a,n=28):"Microsoft Internet Explorer"==navigator.appName?(i.prototype.am=function(e,t,r,n,s,i){for(var o=32767&t,a=t>>15;--i>=0;){var c=32767&this.data[e],l=this.data[e++]>>15,h=a*c+l*o;s=((c=o*c+((32767&h)<<15)+r.data[n]+(1073741823&s))>>>30)+(h>>>15)+a*l+(s>>>30),r.data[n++]=1073741823&c}return s},n=30):"Netscape"!=navigator.appName?(i.prototype.am=function(e,t,r,n,s,i){for(;--i>=0;){var o=t*this.data[e++]+r.data[n]+s;s=Math.floor(o/67108864),r.data[n++]=67108863&o}return s},n=26):(i.prototype.am=a,n=28),i.prototype.DB=n,i.prototype.DM=(1<<n)-1,i.prototype.DV=1<<n,i.prototype.FV=Math.pow(2,52),i.prototype.F1=52-n,i.prototype.F2=2*n-52;var c,l,h=new Array;for(c="0".charCodeAt(0),l=0;l<=9;++l)h[c++]=l;for(c="a".charCodeAt(0),l=10;l<36;++l)h[c++]=l;for(c="A".charCodeAt(0),l=10;l<36;++l)h[c++]=l;function u(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function d(e,t){var r=h[e.charCodeAt(t)];return null==r?-1:r}function p(e){var t=o();return t.fromInt(e),t}function f(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function y(e){this.m=e}function g(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function m(e,t){return e&t}function w(e,t){return e|t}function b(e,t){return e^t}function v(e,t){return e&~t}function E(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function _(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function S(){}function A(e){return e}function I(e){this.r2=o(),this.q3=o(),i.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}y.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},y.prototype.revert=function(e){return e},y.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},y.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},y.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},g.prototype.convert=function(e){var t=o();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(i.ZERO)>0&&this.m.subTo(t,t),t},g.prototype.revert=function(e){var t=o();return e.copyTo(t),this.reduce(t),t},g.prototype.reduce=function(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e.data[t],n=r*this.mpl+((r*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(r=t+this.m.t,e.data[r]+=this.m.am(0,n,e,t,0,this.m.t);e.data[r]>=e.DV;)e.data[r]-=e.DV,e.data[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},g.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},g.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},i.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s},i.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this.data[0]=e:e<-1?this.data[0]=e+this.DV:this.t=0},i.prototype.fromString=function(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var n=e.length,s=!1,o=0;--n>=0;){var a=8==r?255&e[n]:d(e,n);a<0?"-"==e.charAt(n)&&(s=!0):(s=!1,0==o?this.data[this.t++]=a:o+r>this.DB?(this.data[this.t-1]|=(a&(1<<this.DB-o)-1)<<o,this.data[this.t++]=a>>this.DB-o):this.data[this.t-1]|=a<<o,(o+=r)>=this.DB&&(o-=this.DB))}8==r&&0!=(128&e[0])&&(this.s=-1,o>0&&(this.data[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),s&&i.ZERO.subTo(this,this)},i.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this.data[this.t-1]==e;)--this.t},i.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;r>=0;--r)t.data[r+e]=this.data[r];for(r=e-1;r>=0;--r)t.data[r]=0;t.t=this.t+e,t.s=this.s},i.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t.data[r-e]=this.data[r];t.t=Math.max(this.t-e,0),t.s=this.s},i.prototype.lShiftTo=function(e,t){var r,n=e%this.DB,s=this.DB-n,i=(1<<s)-1,o=Math.floor(e/this.DB),a=this.s<<n&this.DM;for(r=this.t-1;r>=0;--r)t.data[r+o+1]=this.data[r]>>s|a,a=(this.data[r]&i)<<n;for(r=o-1;r>=0;--r)t.data[r]=0;t.data[o]=a,t.t=this.t+o+1,t.s=this.s,t.clamp()},i.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,s=this.DB-n,i=(1<<n)-1;t.data[0]=this.data[r]>>n;for(var o=r+1;o<this.t;++o)t.data[o-r-1]|=(this.data[o]&i)<<s,t.data[o-r]=this.data[o]>>n;n>0&&(t.data[this.t-r-1]|=(this.s&i)<<s),t.t=this.t-r,t.clamp()}},i.prototype.subTo=function(e,t){for(var r=0,n=0,s=Math.min(e.t,this.t);r<s;)n+=this.data[r]-e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t.data[r++]=this.DV+n:n>0&&(t.data[r++]=n),t.t=r,t.clamp()},i.prototype.multiplyTo=function(e,t){var r=this.abs(),n=e.abs(),s=r.t;for(t.t=s+n.t;--s>=0;)t.data[s]=0;for(s=0;s<n.t;++s)t.data[s+r.t]=r.am(0,n.data[s],t,s,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&i.ZERO.subTo(t,t)},i.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e.data[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t.data[r],e,2*r,0,1);(e.data[r+t.t]+=t.am(r+1,2*t.data[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e.data[r+t.t]-=t.DV,e.data[r+t.t+1]=1)}e.t>0&&(e.data[e.t-1]+=t.am(r,t.data[r],e,2*r,0,1)),e.s=0,e.clamp()},i.prototype.divRemTo=function(e,t,r){var n=e.abs();if(!(n.t<=0)){var s=this.abs();if(s.t<n.t)return null!=t&&t.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=o());var a=o(),c=this.s,l=e.s,h=this.DB-f(n.data[n.t-1]);h>0?(n.lShiftTo(h,a),s.lShiftTo(h,r)):(n.copyTo(a),s.copyTo(r));var u=a.t,d=a.data[u-1];if(0!=d){var p=d*(1<<this.F1)+(u>1?a.data[u-2]>>this.F2:0),y=this.FV/p,g=(1<<this.F1)/p,m=1<<this.F2,w=r.t,b=w-u,v=null==t?o():t;for(a.dlShiftTo(b,v),r.compareTo(v)>=0&&(r.data[r.t++]=1,r.subTo(v,r)),i.ONE.dlShiftTo(u,v),v.subTo(a,a);a.t<u;)a.data[a.t++]=0;for(;--b>=0;){var E=r.data[--w]==d?this.DM:Math.floor(r.data[w]*y+(r.data[w-1]+m)*g);if((r.data[w]+=a.am(0,E,r,b,0,u))<E)for(a.dlShiftTo(b,v),r.subTo(v,r);r.data[w]<--E;)r.subTo(v,r)}null!=t&&(r.drShiftTo(u,t),c!=l&&i.ZERO.subTo(t,t)),r.t=u,r.clamp(),h>0&&r.rShiftTo(h,r),c<0&&i.ZERO.subTo(r,r)}}},i.prototype.invDigit=function(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},i.prototype.isEven=function(){return 0==(this.t>0?1&this.data[0]:this.s)},i.prototype.exp=function(e,t){if(e>4294967295||e<1)return i.ONE;var r=o(),n=o(),s=t.convert(this),a=f(e)-1;for(s.copyTo(r);--a>=0;)if(t.sqrTo(r,n),(e&1<<a)>0)t.mulTo(n,s,r);else{var c=r;r=n,n=c}return t.revert(r)},i.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,s=!1,i="",o=this.t,a=this.DB-o*this.DB%t;if(o-- >0)for(a<this.DB&&(r=this.data[o]>>a)>0&&(s=!0,i=u(r));o>=0;)a<t?(r=(this.data[o]&(1<<a)-1)<<t-a,r|=this.data[--o]>>(a+=this.DB-t)):(r=this.data[o]>>(a-=t)&n,a<=0&&(a+=this.DB,--o)),r>0&&(s=!0),s&&(i+=u(r));return s?i:"0"},i.prototype.negate=function(){var e=o();return i.ZERO.subTo(this,e),e},i.prototype.abs=function(){return this.s<0?this.negate():this},i.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this.data[r]-e.data[r]))return t;return 0},i.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+f(this.data[this.t-1]^this.s&this.DM)},i.prototype.mod=function(e){var t=o();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(i.ZERO)>0&&e.subTo(t,t),t},i.prototype.modPowInt=function(e,t){var r;return r=e<256||t.isEven()?new y(t):new g(t),this.exp(e,r)},i.ZERO=p(0),i.ONE=p(1),S.prototype.convert=A,S.prototype.revert=A,S.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},S.prototype.sqrTo=function(e,t){e.squareTo(t)},I.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=o();return e.copyTo(t),this.reduce(t),t},I.prototype.revert=function(e){return e},I.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},I.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},I.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var R=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],k=(1<<26)/R[R.length-1];i.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},i.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),n=p(r),s=o(),i=o(),a="";for(this.divRemTo(n,s,i);s.signum()>0;)a=(r+i.intValue()).toString(e).substr(1)+a,s.divRemTo(n,s,i);return i.intValue().toString(e)+a},i.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var r=this.chunkSize(t),n=Math.pow(t,r),s=!1,o=0,a=0,c=0;c<e.length;++c){var l=d(e,c);l<0?"-"==e.charAt(c)&&0==this.signum()&&(s=!0):(a=t*a+l,++o>=r&&(this.dMultiply(n),this.dAddOffset(a,0),o=0,a=0))}o>0&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(a,0)),s&&i.ZERO.subTo(this,this)},i.prototype.fromNumber=function(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(i.ONE.shiftLeft(e-1),w,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(i.ONE.shiftLeft(e-1),this);else{var n=new Array,s=7&e;n.length=1+(e>>3),t.nextBytes(n),s>0?n[0]&=(1<<s)-1:n[0]=0,this.fromString(n,256)}},i.prototype.bitwiseTo=function(e,t,r){var n,s,i=Math.min(e.t,this.t);for(n=0;n<i;++n)r.data[n]=t(this.data[n],e.data[n]);if(e.t<this.t){for(s=e.s&this.DM,n=i;n<this.t;++n)r.data[n]=t(this.data[n],s);r.t=this.t}else{for(s=this.s&this.DM,n=i;n<e.t;++n)r.data[n]=t(s,e.data[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},i.prototype.changeBit=function(e,t){var r=i.ONE.shiftLeft(e);return this.bitwiseTo(r,t,r),r},i.prototype.addTo=function(e,t){for(var r=0,n=0,s=Math.min(e.t,this.t);r<s;)n+=this.data[r]+e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t.data[r++]=n:n<-1&&(t.data[r++]=this.DV+n),t.t=r,t.clamp()},i.prototype.dMultiply=function(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},i.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}},i.prototype.multiplyLowerTo=function(e,t,r){var n,s=Math.min(this.t+e.t,t);for(r.s=0,r.t=s;s>0;)r.data[--s]=0;for(n=r.t-this.t;s<n;++s)r.data[s+this.t]=this.am(0,e.data[s],r,s,0,this.t);for(n=Math.min(e.t,t);s<n;++s)this.am(0,e.data[s],r,s,0,t-s);r.clamp()},i.prototype.multiplyUpperTo=function(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;--n>=0;)r.data[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r.data[this.t+n-t]=this.am(t-n,e.data[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},i.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this.data[0]%e;else for(var n=this.t-1;n>=0;--n)r=(t*r+this.data[n])%e;return r},i.prototype.millerRabin=function(e){var t=this.subtract(i.ONE),r=t.getLowestSetBit();if(r<=0)return!1;for(var n,s=t.shiftRight(r),o={nextBytes:function(e){for(var t=0;t<e.length;++t)e[t]=Math.floor(256*Math.random())}},a=0;a<e;++a){do{n=new i(this.bitLength(),o)}while(n.compareTo(i.ONE)<=0||n.compareTo(t)>=0);var c=n.modPow(s,this);if(0!=c.compareTo(i.ONE)&&0!=c.compareTo(t)){for(var l=1;l++<r&&0!=c.compareTo(t);)if(0==(c=c.modPowInt(2,this)).compareTo(i.ONE))return!1;if(0!=c.compareTo(t))return!1}}return!0},i.prototype.clone=function(){var e=o();return this.copyTo(e),e},i.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]},i.prototype.byteValue=function(){return 0==this.t?this.s:this.data[0]<<24>>24},i.prototype.shortValue=function(){return 0==this.t?this.s:this.data[0]<<16>>16},i.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1},i.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,s=0;if(e-- >0)for(n<this.DB&&(r=this.data[e]>>n)!=(this.s&this.DM)>>n&&(t[s++]=r|this.s<<this.DB-n);e>=0;)n<8?(r=(this.data[e]&(1<<n)-1)<<8-n,r|=this.data[--e]>>(n+=this.DB-8)):(r=this.data[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==s&&(128&this.s)!=(128&r)&&++s,(s>0||r!=this.s)&&(t[s++]=r);return t},i.prototype.equals=function(e){return 0==this.compareTo(e)},i.prototype.min=function(e){return this.compareTo(e)<0?this:e},i.prototype.max=function(e){return this.compareTo(e)>0?this:e},i.prototype.and=function(e){var t=o();return this.bitwiseTo(e,m,t),t},i.prototype.or=function(e){var t=o();return this.bitwiseTo(e,w,t),t},i.prototype.xor=function(e){var t=o();return this.bitwiseTo(e,b,t),t},i.prototype.andNot=function(e){var t=o();return this.bitwiseTo(e,v,t),t},i.prototype.not=function(){for(var e=o(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e},i.prototype.shiftLeft=function(e){var t=o();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},i.prototype.shiftRight=function(e){var t=o();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},i.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+E(this.data[e]);return this.s<0?this.t*this.DB:-1},i.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=_(this.data[r]^t);return e},i.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)},i.prototype.setBit=function(e){return this.changeBit(e,w)},i.prototype.clearBit=function(e){return this.changeBit(e,v)},i.prototype.flipBit=function(e){return this.changeBit(e,b)},i.prototype.add=function(e){var t=o();return this.addTo(e,t),t},i.prototype.subtract=function(e){var t=o();return this.subTo(e,t),t},i.prototype.multiply=function(e){var t=o();return this.multiplyTo(e,t),t},i.prototype.divide=function(e){var t=o();return this.divRemTo(e,t,null),t},i.prototype.remainder=function(e){var t=o();return this.divRemTo(e,null,t),t},i.prototype.divideAndRemainder=function(e){var t=o(),r=o();return this.divRemTo(e,t,r),new Array(t,r)},i.prototype.modPow=function(e,t){var r,n,s=e.bitLength(),i=p(1);if(s<=0)return i;r=s<18?1:s<48?3:s<144?4:s<768?5:6,n=s<8?new y(t):t.isEven()?new I(t):new g(t);var a=new Array,c=3,l=r-1,h=(1<<r)-1;if(a[1]=n.convert(this),r>1){var u=o();for(n.sqrTo(a[1],u);c<=h;)a[c]=o(),n.mulTo(u,a[c-2],a[c]),c+=2}var d,m,w=e.t-1,b=!0,v=o();for(s=f(e.data[w])-1;w>=0;){for(s>=l?d=e.data[w]>>s-l&h:(d=(e.data[w]&(1<<s+1)-1)<<l-s,w>0&&(d|=e.data[w-1]>>this.DB+s-l)),c=r;0==(1&d);)d>>=1,--c;if((s-=c)<0&&(s+=this.DB,--w),b)a[d].copyTo(i),b=!1;else{for(;c>1;)n.sqrTo(i,v),n.sqrTo(v,i),c-=2;c>0?n.sqrTo(i,v):(m=i,i=v,v=m),n.mulTo(v,a[d],i)}for(;w>=0&&0==(e.data[w]&1<<s);)n.sqrTo(i,v),m=i,i=v,v=m,--s<0&&(s=this.DB-1,--w)}return n.revert(i)},i.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return i.ZERO;for(var r=e.clone(),n=this.clone(),s=p(1),o=p(0),a=p(0),c=p(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?(s.isEven()&&o.isEven()||(s.addTo(this,s),o.subTo(e,o)),s.rShiftTo(1,s)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;n.isEven();)n.rShiftTo(1,n),t?(a.isEven()&&c.isEven()||(a.addTo(this,a),c.subTo(e,c)),a.rShiftTo(1,a)):c.isEven()||c.subTo(e,c),c.rShiftTo(1,c);r.compareTo(n)>=0?(r.subTo(n,r),t&&s.subTo(a,s),o.subTo(c,o)):(n.subTo(r,n),t&&a.subTo(s,a),c.subTo(o,c))}return 0!=n.compareTo(i.ONE)?i.ZERO:c.compareTo(e)>=0?c.subtract(e):c.signum()<0?(c.addTo(e,c),c.signum()<0?c.add(e):c):c},i.prototype.pow=function(e){return this.exp(e,new S)},i.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r,r=n}var s=t.getLowestSetBit(),i=r.getLowestSetBit();if(i<0)return t;for(s<i&&(i=s),i>0&&(t.rShiftTo(i,t),r.rShiftTo(i,r));t.signum()>0;)(s=t.getLowestSetBit())>0&&t.rShiftTo(s,t),(s=r.getLowestSetBit())>0&&r.rShiftTo(s,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return i>0&&r.lShiftTo(i,r),r},i.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r.data[0]<=R[R.length-1]){for(t=0;t<R.length;++t)if(r.data[0]==R[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<R.length;){for(var n=R[t],s=t+1;s<R.length&&n<k;)n*=R[s++];for(n=r.modInt(n);t<s;)if(n%R[t++]==0)return!1}return r.millerRabin(e)}},20119:(e,t,r)=>{var n=r(72900);e.exports=n.md=n.md||{},n.md.algorithms=n.md.algorithms||{}},45256:(e,t,r)=>{var n=r(72900);r(32249),e.exports=n.mgf=n.mgf||{},n.mgf.mgf1=n.mgf1},32249:(e,t,r)=>{var n=r(72900);r(33229),n.mgf=n.mgf||{},(e.exports=n.mgf.mgf1=n.mgf1=n.mgf1||{}).create=function(e){return{generate:function(t,r){for(var s=new n.util.ByteBuffer,i=Math.ceil(r/e.digestLength),o=0;o<i;o++){var a=new n.util.ByteBuffer;a.putInt32(o),e.start(),e.update(t+a.getBytes()),s.putBuffer(e.digest())}return s.truncate(s.length()-r),s.getBytes()}}}},8579:(e,t,r)=>{var n=r(72900);n.pki=n.pki||{};var s=e.exports=n.pki.oids=n.oids=n.oids||{};function i(e,t){s[e]=t,s[t]=e}function o(e,t){s[e]=t}i("1.2.840.113549.1.1.1","rsaEncryption"),i("1.2.840.113549.1.1.4","md5WithRSAEncryption"),i("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),i("1.2.840.113549.1.1.7","RSAES-OAEP"),i("1.2.840.113549.1.1.8","mgf1"),i("1.2.840.113549.1.1.9","pSpecified"),i("1.2.840.113549.1.1.10","RSASSA-PSS"),i("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),i("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),i("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),i("1.3.101.112","EdDSA25519"),i("1.2.840.10040.4.3","dsa-with-sha1"),i("1.3.14.3.2.7","desCBC"),i("1.3.14.3.2.26","sha1"),i("1.3.14.3.2.29","sha1WithRSASignature"),i("2.16.840.1.101.3.4.2.1","sha256"),i("2.16.840.1.101.3.4.2.2","sha384"),i("2.16.840.1.101.3.4.2.3","sha512"),i("2.16.840.1.101.3.4.2.4","sha224"),i("2.16.840.1.101.3.4.2.5","sha512-224"),i("2.16.840.1.101.3.4.2.6","sha512-256"),i("1.2.840.113549.2.2","md2"),i("1.2.840.113549.2.5","md5"),i("1.2.840.113549.1.7.1","data"),i("1.2.840.113549.1.7.2","signedData"),i("1.2.840.113549.1.7.3","envelopedData"),i("1.2.840.113549.1.7.4","signedAndEnvelopedData"),i("1.2.840.113549.1.7.5","digestedData"),i("1.2.840.113549.1.7.6","encryptedData"),i("1.2.840.113549.1.9.1","emailAddress"),i("1.2.840.113549.1.9.2","unstructuredName"),i("1.2.840.113549.1.9.3","contentType"),i("1.2.840.113549.1.9.4","messageDigest"),i("1.2.840.113549.1.9.5","signingTime"),i("1.2.840.113549.1.9.6","counterSignature"),i("1.2.840.113549.1.9.7","challengePassword"),i("1.2.840.113549.1.9.8","unstructuredAddress"),i("1.2.840.113549.1.9.14","extensionRequest"),i("1.2.840.113549.1.9.20","friendlyName"),i("1.2.840.113549.1.9.21","localKeyId"),i("1.2.840.113549.1.9.22.1","x509Certificate"),i("1.2.840.113549.1.12.10.1.1","keyBag"),i("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),i("1.2.840.113549.1.12.10.1.3","certBag"),i("1.2.840.113549.1.12.10.1.4","crlBag"),i("1.2.840.113549.1.12.10.1.5","secretBag"),i("1.2.840.113549.1.12.10.1.6","safeContentsBag"),i("1.2.840.113549.1.5.13","pkcs5PBES2"),i("1.2.840.113549.1.5.12","pkcs5PBKDF2"),i("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),i("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),i("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),i("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),i("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),i("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),i("1.2.840.113549.2.7","hmacWithSHA1"),i("1.2.840.113549.2.8","hmacWithSHA224"),i("1.2.840.113549.2.9","hmacWithSHA256"),i("1.2.840.113549.2.10","hmacWithSHA384"),i("1.2.840.113549.2.11","hmacWithSHA512"),i("1.2.840.113549.3.7","des-EDE3-CBC"),i("2.16.840.1.101.3.4.1.2","aes128-CBC"),i("2.16.840.1.101.3.4.1.22","aes192-CBC"),i("2.16.840.1.101.3.4.1.42","aes256-CBC"),i("2.5.4.3","commonName"),i("2.5.4.4","surname"),i("2.5.4.5","serialNumber"),i("2.5.4.6","countryName"),i("2.5.4.7","localityName"),i("2.5.4.8","stateOrProvinceName"),i("2.5.4.9","streetAddress"),i("2.5.4.10","organizationName"),i("2.5.4.11","organizationalUnitName"),i("2.5.4.12","title"),i("2.5.4.13","description"),i("2.5.4.15","businessCategory"),i("2.5.4.17","postalCode"),i("2.5.4.42","givenName"),i("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName"),i("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName"),i("2.16.840.1.113730.1.1","nsCertType"),i("2.16.840.1.113730.1.13","nsComment"),o("2.5.29.1","authorityKeyIdentifier"),o("2.5.29.2","keyAttributes"),o("2.5.29.3","certificatePolicies"),o("2.5.29.4","keyUsageRestriction"),o("2.5.29.5","policyMapping"),o("2.5.29.6","subtreesConstraint"),o("2.5.29.7","subjectAltName"),o("2.5.29.8","issuerAltName"),o("2.5.29.9","subjectDirectoryAttributes"),o("2.5.29.10","basicConstraints"),o("2.5.29.11","nameConstraints"),o("2.5.29.12","policyConstraints"),o("2.5.29.13","basicConstraints"),i("2.5.29.14","subjectKeyIdentifier"),i("2.5.29.15","keyUsage"),o("2.5.29.16","privateKeyUsagePeriod"),i("2.5.29.17","subjectAltName"),i("2.5.29.18","issuerAltName"),i("2.5.29.19","basicConstraints"),o("2.5.29.20","cRLNumber"),o("2.5.29.21","cRLReason"),o("2.5.29.22","expirationDate"),o("2.5.29.23","instructionCode"),o("2.5.29.24","invalidityDate"),o("2.5.29.25","cRLDistributionPoints"),o("2.5.29.26","issuingDistributionPoint"),o("2.5.29.27","deltaCRLIndicator"),o("2.5.29.28","issuingDistributionPoint"),o("2.5.29.29","certificateIssuer"),o("2.5.29.30","nameConstraints"),i("2.5.29.31","cRLDistributionPoints"),i("2.5.29.32","certificatePolicies"),o("2.5.29.33","policyMappings"),o("2.5.29.34","policyConstraints"),i("2.5.29.35","authorityKeyIdentifier"),o("2.5.29.36","policyConstraints"),i("2.5.29.37","extKeyUsage"),o("2.5.29.46","freshestCRL"),o("2.5.29.54","inhibitAnyPolicy"),i("1.3.6.1.4.1.11129.2.4.2","timestampList"),i("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),i("1.3.6.1.5.5.7.3.1","serverAuth"),i("1.3.6.1.5.5.7.3.2","clientAuth"),i("1.3.6.1.5.5.7.3.3","codeSigning"),i("1.3.6.1.5.5.7.3.4","emailProtection"),i("1.3.6.1.5.5.7.3.8","timeStamping")},4676:(e,t,r)=>{var n=r(72900);if(r(35564),r(69522),r(9891),r(20119),r(8579),r(28584),r(44129),r(88093),r(60523),r(83635),r(33229),void 0===s)var s=n.jsbn.BigInteger;var i=n.asn1,o=n.pki=n.pki||{};e.exports=o.pbe=n.pbe=n.pbe||{};var a=o.oids,c={name:"EncryptedPrivateKeyInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},l={name:"PBES2Algorithms",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},h={name:"pkcs-12PbeParams",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"iterations"}]};function u(e,t){return e.start().update(t).digest().getBytes()}function d(e){var t;if(e){if(!(t=o.oids[i.derToOid(e)])){var r=new Error("Unsupported PRF OID.");throw r.oid=e,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}}else t="hmacWithSHA1";return p(t)}function p(e){var t=n.md;switch(e){case"hmacWithSHA224":t=n.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":e=e.substr(8).toLowerCase();break;default:var r=new Error("Unsupported PRF algorithm.");throw r.algorithm=e,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}if(!t||!(e in t))throw new Error("Unknown hash algorithm: "+e);return t[e].create()}o.encryptPrivateKeyInfo=function(e,t,r){(r=r||{}).saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||"aes128",r.prfAlgorithm=r.prfAlgorithm||"sha1";var s,c,l,h=n.random.getBytesSync(r.saltSize),u=r.count,d=i.integerToDer(u);if(0===r.algorithm.indexOf("aes")||"des"===r.algorithm){var f,y,g;switch(r.algorithm){case"aes128":s=16,f=16,y=a["aes128-CBC"],g=n.aes.createEncryptionCipher;break;case"aes192":s=24,f=16,y=a["aes192-CBC"],g=n.aes.createEncryptionCipher;break;case"aes256":s=32,f=16,y=a["aes256-CBC"],g=n.aes.createEncryptionCipher;break;case"des":s=8,f=8,y=a.desCBC,g=n.des.createEncryptionCipher;break;default:throw(_=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=r.algorithm,_}var m="hmacWith"+r.prfAlgorithm.toUpperCase(),w=p(m),b=n.pkcs5.pbkdf2(t,h,u,s,w),v=n.random.getBytesSync(f);(S=g(b)).start(v),S.update(i.toDer(e)),S.finish(),l=S.output.getBytes();var E=function(e,t,r,s){var a=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,e),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,t.getBytes())]);return"hmacWithSHA1"!==s&&a.value.push(i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,n.util.hexToBytes(r.toString(16))),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(o.oids[s]).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])),a}(h,d,s,m);c=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(a.pkcs5PBES2).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(a.pkcs5PBKDF2).getBytes()),E]),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(y).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,v)])])])}else{var _;if("3des"!==r.algorithm)throw(_=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=r.algorithm,_;s=24;var S,A=new n.util.ByteBuffer(h);b=o.pbe.generatePkcs12Key(t,A,1,u,s),v=o.pbe.generatePkcs12Key(t,A,2,u,s),(S=n.des.createEncryptionCipher(b)).start(v),S.update(i.toDer(e)),S.finish(),l=S.output.getBytes(),c=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(a["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,h),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,d.getBytes())])])}return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[c,i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,l)])},o.decryptPrivateKeyInfo=function(e,t){var r=null,s={},a=[];if(!i.validate(e,c,s,a)){var l=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw l.errors=a,l}var h=i.derToOid(s.encryptionOid),u=o.pbe.getCipher(h,s.encryptionParams,t),d=n.util.createBuffer(s.encryptedData);return u.update(d),u.finish()&&(r=i.fromDer(u.output)),r},o.encryptedPrivateKeyToPem=function(e,t){var r={type:"ENCRYPTED PRIVATE KEY",body:i.toDer(e).getBytes()};return n.pem.encode(r,{maxline:t})},o.encryptedPrivateKeyFromPem=function(e){var t=n.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==t.type){var r=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return i.fromDer(t.body)},o.encryptRsaPrivateKey=function(e,t,r){if(!(r=r||{}).legacy){var s=o.wrapRsaPrivateKey(o.privateKeyToAsn1(e));return s=o.encryptPrivateKeyInfo(s,t,r),o.encryptedPrivateKeyToPem(s)}var a,c,l,h;switch(r.algorithm){case"aes128":a="AES-128-CBC",l=16,c=n.random.getBytesSync(16),h=n.aes.createEncryptionCipher;break;case"aes192":a="AES-192-CBC",l=24,c=n.random.getBytesSync(16),h=n.aes.createEncryptionCipher;break;case"aes256":a="AES-256-CBC",l=32,c=n.random.getBytesSync(16),h=n.aes.createEncryptionCipher;break;case"3des":a="DES-EDE3-CBC",l=24,c=n.random.getBytesSync(8),h=n.des.createEncryptionCipher;break;case"des":a="DES-CBC",l=8,c=n.random.getBytesSync(8),h=n.des.createEncryptionCipher;break;default:var u=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw u.algorithm=r.algorithm,u}var d=h(n.pbe.opensslDeriveBytes(t,c.substr(0,8),l));d.start(c),d.update(i.toDer(o.privateKeyToAsn1(e))),d.finish();var p={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:a,parameters:n.util.bytesToHex(c).toUpperCase()},body:d.output.getBytes()};return n.pem.encode(p)},o.decryptRsaPrivateKey=function(e,t){var r=null,s=n.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==s.type&&"PRIVATE KEY"!==s.type&&"RSA PRIVATE KEY"!==s.type)throw(l=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".')).headerType=l,l;if(s.procType&&"ENCRYPTED"===s.procType.type){var a,c;switch(s.dekInfo.algorithm){case"DES-CBC":a=8,c=n.des.createDecryptionCipher;break;case"DES-EDE3-CBC":a=24,c=n.des.createDecryptionCipher;break;case"AES-128-CBC":a=16,c=n.aes.createDecryptionCipher;break;case"AES-192-CBC":a=24,c=n.aes.createDecryptionCipher;break;case"AES-256-CBC":a=32,c=n.aes.createDecryptionCipher;break;case"RC2-40-CBC":a=5,c=function(e){return n.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":a=8,c=function(e){return n.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":a=16,c=function(e){return n.rc2.createDecryptionCipher(e,128)};break;default:var l;throw(l=new Error('Could not decrypt private key; unsupported encryption algorithm "'+s.dekInfo.algorithm+'".')).algorithm=s.dekInfo.algorithm,l}var h=n.util.hexToBytes(s.dekInfo.parameters),u=c(n.pbe.opensslDeriveBytes(t,h.substr(0,8),a));if(u.start(h),u.update(n.util.createBuffer(s.body)),!u.finish())return r;r=u.output.getBytes()}else r=s.body;return null!==(r="ENCRYPTED PRIVATE KEY"===s.type?o.decryptPrivateKeyInfo(i.fromDer(r),t):i.fromDer(r))&&(r=o.privateKeyFromAsn1(r)),r},o.pbe.generatePkcs12Key=function(e,t,r,s,i,o){var a,c;if(null==o){if(!("sha1"in n.md))throw new Error('"sha1" hash algorithm unavailable.');o=n.md.sha1.create()}var l=o.digestLength,h=o.blockLength,u=new n.util.ByteBuffer,d=new n.util.ByteBuffer;if(null!=e){for(c=0;c<e.length;c++)d.putInt16(e.charCodeAt(c));d.putInt16(0)}var p=d.length(),f=t.length(),y=new n.util.ByteBuffer;y.fillWithByte(r,h);var g=h*Math.ceil(f/h),m=new n.util.ByteBuffer;for(c=0;c<g;c++)m.putByte(t.at(c%f));var w=h*Math.ceil(p/h),b=new n.util.ByteBuffer;for(c=0;c<w;c++)b.putByte(d.at(c%p));var v=m;v.putBuffer(b);for(var E=Math.ceil(i/l),_=1;_<=E;_++){var S=new n.util.ByteBuffer;S.putBytes(y.bytes()),S.putBytes(v.bytes());for(var A=0;A<s;A++)o.start(),o.update(S.getBytes()),S=o.digest();var I=new n.util.ByteBuffer;for(c=0;c<h;c++)I.putByte(S.at(c%l));var R=Math.ceil(f/h)+Math.ceil(p/h),k=new n.util.ByteBuffer;for(a=0;a<R;a++){var T=new n.util.ByteBuffer(v.getBytes(h)),C=511;for(c=I.length()-1;c>=0;c--)C>>=8,C+=I.at(c)+T.at(c),T.setAt(c,255&C);k.putBuffer(T)}v=k,u.putBuffer(S)}return u.truncate(u.length()-i),u},o.pbe.getCipher=function(e,t,r){switch(e){case o.oids.pkcs5PBES2:return o.pbe.getCipherForPBES2(e,t,r);case o.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case o.oids["pbewithSHAAnd40BitRC2-CBC"]:return o.pbe.getCipherForPKCS12PBE(e,t,r);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=e,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}},o.pbe.getCipherForPBES2=function(e,t,r){var s,a={},c=[];if(!i.validate(t,l,a,c))throw(s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=c,s;if((e=i.derToOid(a.kdfOid))!==o.oids.pkcs5PBKDF2)throw(s=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=e,s.supportedOids=["pkcs5PBKDF2"],s;if((e=i.derToOid(a.encOid))!==o.oids["aes128-CBC"]&&e!==o.oids["aes192-CBC"]&&e!==o.oids["aes256-CBC"]&&e!==o.oids["des-EDE3-CBC"]&&e!==o.oids.desCBC)throw(s=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.")).oid=e,s.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],s;var h,u,p=a.kdfSalt,f=n.util.createBuffer(a.kdfIterationCount);switch(f=f.getInt(f.length()<<3),o.oids[e]){case"aes128-CBC":h=16,u=n.aes.createDecryptionCipher;break;case"aes192-CBC":h=24,u=n.aes.createDecryptionCipher;break;case"aes256-CBC":h=32,u=n.aes.createDecryptionCipher;break;case"des-EDE3-CBC":h=24,u=n.des.createDecryptionCipher;break;case"desCBC":h=8,u=n.des.createDecryptionCipher}var y=d(a.prfOid),g=n.pkcs5.pbkdf2(r,p,f,h,y),m=a.encIv,w=u(g);return w.start(m),w},o.pbe.getCipherForPKCS12PBE=function(e,t,r){var s={},a=[];if(!i.validate(t,h,s,a))throw(y=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=a,y;var c,l,u,p=n.util.createBuffer(s.salt),f=n.util.createBuffer(s.iterations);switch(f=f.getInt(f.length()<<3),e){case o.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:c=24,l=8,u=n.des.startDecrypting;break;case o.oids["pbewithSHAAnd40BitRC2-CBC"]:c=5,l=8,u=function(e,t){var r=n.rc2.createDecryptionCipher(e,40);return r.start(t,null),r};break;default:var y;throw(y=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=e,y}var g=d(s.prfOid),m=o.pbe.generatePkcs12Key(r,p,1,f,c,g);return g.start(),u(m,o.pbe.generatePkcs12Key(r,p,2,f,l,g))},o.pbe.opensslDeriveBytes=function(e,t,r,s){if(null==s){if(!("md5"in n.md))throw new Error('"md5" hash algorithm unavailable.');s=n.md.md5.create()}null===t&&(t="");for(var i=[u(s,e+t)],o=16,a=1;o<r;++a,o+=16)i.push(u(s,i[a-1]+e+t));return i.join("").substr(0,r)}},28584:(e,t,r)=>{var n=r(62678).Buffer,s=r(72900);r(30669),r(20119),r(33229);var i,o=s.pkcs5=s.pkcs5||{};s.util.isNodejs&&!s.options.usePureJavaScript&&(i=r(25819)),e.exports=s.pbkdf2=o.pbkdf2=function(e,t,r,o,a,c){if("function"==typeof a&&(c=a,a=null),s.util.isNodejs&&!s.options.usePureJavaScript&&i.pbkdf2&&(null===a||"object"!=typeof a)&&(i.pbkdf2Sync.length>4||!a||"sha1"===a))return"string"!=typeof a&&(a="sha1"),e=n.from(e,"binary"),t=n.from(t,"binary"),c?4===i.pbkdf2Sync.length?i.pbkdf2(e,t,r,o,(function(e,t){if(e)return c(e);c(null,t.toString("binary"))})):i.pbkdf2(e,t,r,o,a,(function(e,t){if(e)return c(e);c(null,t.toString("binary"))})):4===i.pbkdf2Sync.length?i.pbkdf2Sync(e,t,r,o).toString("binary"):i.pbkdf2Sync(e,t,r,o,a).toString("binary");if(null==a&&(a="sha1"),"string"==typeof a){if(!(a in s.md.algorithms))throw new Error("Unknown hash algorithm: "+a);a=s.md[a].create()}var l=a.digestLength;if(o>4294967295*l){var h=new Error("Derived key is too long.");if(c)return c(h);throw h}var u=Math.ceil(o/l),d=o-(u-1)*l,p=s.hmac.create();p.start(a,e);var f,y,g,m="";if(!c){for(var w=1;w<=u;++w){p.start(null,null),p.update(t),p.update(s.util.int32ToBytes(w)),f=g=p.digest().getBytes();for(var b=2;b<=r;++b)p.start(null,null),p.update(g),y=p.digest().getBytes(),f=s.util.xorBytes(f,y,l),g=y;m+=w<u?f:f.substr(0,d)}return m}function v(){if(w>u)return c(null,m);p.start(null,null),p.update(t),p.update(s.util.int32ToBytes(w)),f=g=p.digest().getBytes(),b=2,E()}function E(){if(b<=r)return p.start(null,null),p.update(g),y=p.digest().getBytes(),f=s.util.xorBytes(f,y,l),g=y,++b,s.util.setImmediate(E);m+=w<u?f:f.substr(0,d),++w,v()}w=1,v()}},44129:(e,t,r)=>{var n=r(72900);r(33229);var s=e.exports=n.pem=n.pem||{};function i(e){for(var t=e.name+": ",r=[],n=function(e,t){return" "+t},s=0;s<e.values.length;++s)r.push(e.values[s].replace(/^(\S+\r\n)/,n));t+=r.join(",")+"\r\n";var i=0,o=-1;for(s=0;s<t.length;++s,++i)if(i>65&&-1!==o){var a=t[o];","===a?(++o,t=t.substr(0,o)+"\r\n "+t.substr(o)):t=t.substr(0,o)+"\r\n"+a+t.substr(o+1),i=s-o-1,o=-1,++s}else" "!==t[s]&&"\t"!==t[s]&&","!==t[s]||(o=s);return t}function o(e){return e.replace(/^\s+/,"")}s.encode=function(e,t){t=t||{};var r,s="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(s+=i(r={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]})),e.contentDomain&&(s+=i(r={name:"Content-Domain",values:[e.contentDomain]})),e.dekInfo&&(r={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&r.values.push(e.dekInfo.parameters),s+=i(r)),e.headers)for(var o=0;o<e.headers.length;++o)s+=i(e.headers[o]);return e.procType&&(s+="\r\n"),(s+=n.util.encode64(e.body,t.maxline||64)+"\r\n")+"-----END "+e.type+"-----\r\n"},s.decode=function(e){for(var t,r=[],s=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,i=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,a=/\r?\n/;t=s.exec(e);){var c=t[1];"NEW CERTIFICATE REQUEST"===c&&(c="CERTIFICATE REQUEST");var l={type:c,procType:null,contentDomain:null,dekInfo:null,headers:[],body:n.util.decode64(t[3])};if(r.push(l),t[2]){for(var h=t[2].split(a),u=0;t&&u<h.length;){for(var d=h[u].replace(/\s+$/,""),p=u+1;p<h.length;++p){var f=h[p];if(!/\s/.test(f[0]))break;d+=f,u=p}if(t=d.match(i)){for(var y={name:t[1],values:[]},g=t[2].split(","),m=0;m<g.length;++m)y.values.push(o(g[m]));if(l.procType)if(l.contentDomain||"Content-Domain"!==y.name)if(l.dekInfo||"DEK-Info"!==y.name)l.headers.push(y);else{if(0===y.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');l.dekInfo={algorithm:g[0],parameters:g[1]||null}}else l.contentDomain=g[0]||"";else{if("Proc-Type"!==y.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==y.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');l.procType={version:g[0],type:g[1]}}}++u}if("ENCRYPTED"===l.procType&&!l.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===r.length)throw new Error("Invalid PEM formatted message.");return r}},46732:(e,t,r)=>{var n=r(72900);r(33229),r(88093),r(61244);var s=e.exports=n.pkcs1=n.pkcs1||{};function i(e,t,r){r||(r=n.md.sha1.create());for(var s="",i=Math.ceil(t/r.digestLength),o=0;o<i;++o){var a=String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,255&o);r.start(),r.update(e+a),s+=r.digest().getBytes()}return s.substring(0,t)}s.encode_rsa_oaep=function(e,t,r){var s,o,a,c;"string"==typeof r?(s=r,o=arguments[3]||void 0,a=arguments[4]||void 0):r&&(s=r.label||void 0,o=r.seed||void 0,a=r.md||void 0,r.mgf1&&r.mgf1.md&&(c=r.mgf1.md)),a?a.start():a=n.md.sha1.create(),c||(c=a);var l=Math.ceil(e.n.bitLength()/8),h=l-2*a.digestLength-2;if(t.length>h)throw(g=new Error("RSAES-OAEP input message length is too long.")).length=t.length,g.maxLength=h,g;s||(s=""),a.update(s,"raw");for(var u=a.digest(),d="",p=h-t.length,f=0;f<p;f++)d+="\0";var y=u.getBytes()+d+""+t;if(o){if(o.length!==a.digestLength){var g;throw(g=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.")).seedLength=o.length,g.digestLength=a.digestLength,g}}else o=n.random.getBytes(a.digestLength);var m=i(o,l-a.digestLength-1,c),w=n.util.xorBytes(y,m,y.length),b=i(w,a.digestLength,c),v=n.util.xorBytes(o,b,o.length);return"\0"+v+w},s.decode_rsa_oaep=function(e,t,r){var s,o,a;"string"==typeof r?(s=r,o=arguments[3]||void 0):r&&(s=r.label||void 0,o=r.md||void 0,r.mgf1&&r.mgf1.md&&(a=r.mgf1.md));var c=Math.ceil(e.n.bitLength()/8);if(t.length!==c)throw(w=new Error("RSAES-OAEP encoded message length is invalid.")).length=t.length,w.expectedLength=c,w;if(void 0===o?o=n.md.sha1.create():o.start(),a||(a=o),c<2*o.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");s||(s=""),o.update(s,"raw");for(var l=o.digest().getBytes(),h=t.charAt(0),u=t.substring(1,o.digestLength+1),d=t.substring(1+o.digestLength),p=i(d,o.digestLength,a),f=n.util.xorBytes(u,p,u.length),y=i(f,c-o.digestLength-1,a),g=n.util.xorBytes(d,y,d.length),m=g.substring(0,o.digestLength),w="\0"!==h,b=0;b<o.digestLength;++b)w|=l.charAt(b)!==m.charAt(b);for(var v=1,E=o.digestLength,_=o.digestLength;_<g.length;_++){var S=g.charCodeAt(_),A=1&S^1,I=v?65534:0;w|=S&I,E+=v&=A}if(w||1!==g.charCodeAt(E))throw new Error("Invalid RSAES-OAEP padding.");return g.substring(E+1)}},29222:(e,t,r)=>{var n=r(72900);r(35564),r(69522),r(9891),r(8579),r(44129),r(38228),r(88093),r(33229),r(41486);var s=n.asn1,i=e.exports=n.pkcs7=n.pkcs7||{};function o(e){var t={},r=[];if(!s.validate(e,i.asn1.recipientInfoValidator,t,r)){var o=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw o.errors=r,o}return{version:t.version.charCodeAt(0),issuer:n.pki.RDNAttributesAsArray(t.issuer),serialNumber:n.util.createBuffer(t.serial).toHex(),encryptedContent:{algorithm:s.derToOid(t.encAlgorithm),parameter:t.encParameter?t.encParameter.value:void 0,content:t.encKey}}}function a(e){for(var t,r=[],i=0;i<e.length;++i)r.push((t=e[i],s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(t.version).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[n.pki.distinguishedNameToAsn1({attributes:t.issuer}),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,n.util.hexToBytes(t.serialNumber))]),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(t.encryptedContent.algorithm).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]),s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,t.encryptedContent.content)])));return r}function c(e){var t=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.version).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[n.pki.distinguishedNameToAsn1({attributes:e.issuer}),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,n.util.hexToBytes(e.serialNumber))]),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.digestAlgorithm).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")])]);if(e.authenticatedAttributesAsn1&&t.value.push(e.authenticatedAttributesAsn1),t.value.push(s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.signatureAlgorithm).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")])),t.value.push(s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,e.signature)),e.unauthenticatedAttributes.length>0){for(var r=s.create(s.Class.CONTEXT_SPECIFIC,1,!0,[]),i=0;i<e.unauthenticatedAttributes.length;++i){var o=e.unauthenticatedAttributes[i];r.values.push(l(o))}t.value.push(r)}return t}function l(e){var t;if(e.type===n.pki.oids.contentType)t=s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.value).getBytes());else if(e.type===n.pki.oids.messageDigest)t=s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,e.value.bytes());else if(e.type===n.pki.oids.signingTime){var r=new Date("1950-01-01T00:00:00Z"),i=new Date("2050-01-01T00:00:00Z"),o=e.value;if("string"==typeof o){var a=Date.parse(o);o=isNaN(a)?13===o.length?s.utcTimeToDate(o):s.generalizedTimeToDate(o):new Date(a)}t=o>=r&&o<i?s.create(s.Class.UNIVERSAL,s.Type.UTCTIME,!1,s.dateToUtcTime(o)):s.create(s.Class.UNIVERSAL,s.Type.GENERALIZEDTIME,!1,s.dateToGeneralizedTime(o))}return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.type).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SET,!0,[t])])}function h(e,t,r){var i={};if(!s.validate(t,r,i,[])){var o=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw o.errors=o,o}if(s.derToOid(i.contentType)!==n.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(i.encryptedContent){var a="";if(n.util.isArray(i.encryptedContent))for(var c=0;c<i.encryptedContent.length;++c){if(i.encryptedContent[c].type!==s.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");a+=i.encryptedContent[c].value}else a=i.encryptedContent;e.encryptedContent={algorithm:s.derToOid(i.encAlgorithm),parameter:n.util.createBuffer(i.encParameter.value),content:n.util.createBuffer(a)}}if(i.content){if(a="",n.util.isArray(i.content))for(c=0;c<i.content.length;++c){if(i.content[c].type!==s.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");a+=i.content[c].value}else a=i.content;e.content=n.util.createBuffer(a)}return e.version=i.version.charCodeAt(0),e.rawCapture=i,i}function u(e){if(void 0===e.encryptedContent.key)throw new Error("Symmetric key not available.");if(void 0===e.content){var t;switch(e.encryptedContent.algorithm){case n.pki.oids["aes128-CBC"]:case n.pki.oids["aes192-CBC"]:case n.pki.oids["aes256-CBC"]:t=n.aes.createDecryptionCipher(e.encryptedContent.key);break;case n.pki.oids.desCBC:case n.pki.oids["des-EDE3-CBC"]:t=n.des.createDecryptionCipher(e.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+e.encryptedContent.algorithm)}if(t.start(e.encryptedContent.parameter),t.update(e.encryptedContent.content),!t.finish())throw new Error("Symmetric decryption failed.");e.content=t.output}}i.messageFromPem=function(e){var t=n.pem.decode(e)[0];if("PKCS7"!==t.type){var r=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var o=s.fromDer(t.body);return i.messageFromAsn1(o)},i.messageToPem=function(e,t){var r={type:"PKCS7",body:s.toDer(e.toAsn1()).getBytes()};return n.pem.encode(r,{maxline:t})},i.messageFromAsn1=function(e){var t={},r=[];if(!s.validate(e,i.asn1.contentInfoValidator,t,r)){var o=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw o.errors=r,o}var a,c=s.derToOid(t.contentType);switch(c){case n.pki.oids.envelopedData:a=i.createEnvelopedData();break;case n.pki.oids.encryptedData:a=i.createEncryptedData();break;case n.pki.oids.signedData:a=i.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+c+" is not (yet) supported.")}return a.fromAsn1(t.content.value[0]),a},i.createSignedData=function(){var e=null;return e={type:n.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(t){if(h(e,t,i.asn1.signedDataValidator),e.certificates=[],e.crls=[],e.digestAlgorithmIdentifiers=[],e.contentInfo=null,e.signerInfos=[],e.rawCapture.certificates)for(var r=e.rawCapture.certificates.value,s=0;s<r.length;++s)e.certificates.push(n.pki.certificateFromAsn1(r[s]))},toAsn1:function(){e.contentInfo||e.sign();for(var t=[],r=0;r<e.certificates.length;++r)t.push(n.pki.certificateToAsn1(e.certificates[r]));var i=[],o=s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.version).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SET,!0,e.digestAlgorithmIdentifiers),e.contentInfo])]);return t.length>0&&o.value[0].value.push(s.create(s.Class.CONTEXT_SPECIFIC,0,!0,t)),i.length>0&&o.value[0].value.push(s.create(s.Class.CONTEXT_SPECIFIC,1,!0,i)),o.value[0].value.push(s.create(s.Class.UNIVERSAL,s.Type.SET,!0,e.signerInfos)),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.type).getBytes()),o])},addSigner:function(t){var r=t.issuer,s=t.serialNumber;if(t.certificate){var i=t.certificate;"string"==typeof i&&(i=n.pki.certificateFromPem(i)),r=i.issuer.attributes,s=i.serialNumber}var o=t.key;if(!o)throw new Error("Could not add PKCS#7 signer; no private key specified.");"string"==typeof o&&(o=n.pki.privateKeyFromPem(o));var a=t.digestAlgorithm||n.pki.oids.sha1;switch(a){case n.pki.oids.sha1:case n.pki.oids.sha256:case n.pki.oids.sha384:case n.pki.oids.sha512:case n.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+a)}var c=t.authenticatedAttributes||[];if(c.length>0){for(var l=!1,h=!1,u=0;u<c.length;++u){var d=c[u];if(l||d.type!==n.pki.oids.contentType){if(h||d.type!==n.pki.oids.messageDigest);else if(h=!0,l)break}else if(l=!0,h)break}if(!l||!h)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}e.signers.push({key:o,version:1,issuer:r,serialNumber:s,digestAlgorithm:a,signatureAlgorithm:n.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:c,unauthenticatedAttributes:[]})},sign:function(t){var r;t=t||{},("object"!=typeof e.content||null===e.contentInfo)&&(e.contentInfo=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(n.pki.oids.data).getBytes())]),"content"in e&&(e.content instanceof n.util.ByteBuffer?r=e.content.bytes():"string"==typeof e.content&&(r=n.util.encodeUtf8(e.content)),t.detached?e.detachedContent=s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,r):e.contentInfo.value.push(s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,r)])))),0!==e.signers.length&&function(t){var r;if(!(r=e.detachedContent?e.detachedContent:(r=e.contentInfo.value[1]).value[0]))throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var i=s.derToOid(e.contentInfo.value[0].value),o=s.toDer(r);for(var a in o.getByte(),s.getBerValueLength(o),o=o.getBytes(),t)t[a].start().update(o);for(var h=new Date,u=0;u<e.signers.length;++u){var d=e.signers[u];if(0===d.authenticatedAttributes.length){if(i!==n.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{d.authenticatedAttributesAsn1=s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var p=s.create(s.Class.UNIVERSAL,s.Type.SET,!0,[]),f=0;f<d.authenticatedAttributes.length;++f){var y=d.authenticatedAttributes[f];y.type===n.pki.oids.messageDigest?y.value=t[d.digestAlgorithm].digest():y.type===n.pki.oids.signingTime&&(y.value||(y.value=h)),p.value.push(l(y)),d.authenticatedAttributesAsn1.value.push(l(y))}o=s.toDer(p).getBytes(),d.md.start().update(o)}d.signature=d.key.sign(d.md,"RSASSA-PKCS1-V1_5")}e.signerInfos=function(e){for(var t=[],r=0;r<e.length;++r)t.push(c(e[r]));return t}(e.signers)}(function(){for(var t={},r=0;r<e.signers.length;++r){var i=e.signers[r];(o=i.digestAlgorithm)in t||(t[o]=n.md[n.pki.oids[o]].create()),0===i.authenticatedAttributes.length?i.md=t[o]:i.md=n.md[n.pki.oids[o]].create()}for(var o in e.digestAlgorithmIdentifiers=[],t)e.digestAlgorithmIdentifiers.push(s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]));return t}())},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(t){"string"==typeof t&&(t=n.pki.certificateFromPem(t)),e.certificates.push(t)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")}}},i.createEncryptedData=function(){var e=null;return e={type:n.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:n.pki.oids["aes256-CBC"]},fromAsn1:function(t){h(e,t,i.asn1.encryptedDataValidator)},decrypt:function(t){void 0!==t&&(e.encryptedContent.key=t),u(e)}}},i.createEnvelopedData=function(){var e=null;return e={type:n.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:n.pki.oids["aes256-CBC"]},fromAsn1:function(t){var r=h(e,t,i.asn1.envelopedDataValidator);e.recipients=function(e){for(var t=[],r=0;r<e.length;++r)t.push(o(e[r]));return t}(r.recipientInfos.value)},toAsn1:function(){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.type).getBytes()),s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.version).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SET,!0,a(e.recipients)),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,(t=e.encryptedContent,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(n.pki.oids.data).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(t.algorithm).getBytes()),t.parameter?s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,t.parameter.getBytes()):void 0]),s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,t.content.getBytes())])]))])])]);var t},findRecipient:function(t){for(var r=t.issuer.attributes,n=0;n<e.recipients.length;++n){var s=e.recipients[n],i=s.issuer;if(s.serialNumber===t.serialNumber&&i.length===r.length){for(var o=!0,a=0;a<r.length;++a)if(i[a].type!==r[a].type||i[a].value!==r[a].value){o=!1;break}if(o)return s}}return null},decrypt:function(t,r){if(void 0===e.encryptedContent.key&&void 0!==t&&void 0!==r)switch(t.encryptedContent.algorithm){case n.pki.oids.rsaEncryption:case n.pki.oids.desCBC:var s=r.decrypt(t.encryptedContent.content);e.encryptedContent.key=n.util.createBuffer(s);break;default:throw new Error("Unsupported asymmetric cipher, OID "+t.encryptedContent.algorithm)}u(e)},addRecipient:function(t){e.recipients.push({version:0,issuer:t.issuer.attributes,serialNumber:t.serialNumber,encryptedContent:{algorithm:n.pki.oids.rsaEncryption,key:t.publicKey}})},encrypt:function(t,r){if(void 0===e.encryptedContent.content){var s,i,o;switch(r=r||e.encryptedContent.algorithm,t=t||e.encryptedContent.key,r){case n.pki.oids["aes128-CBC"]:s=16,i=16,o=n.aes.createEncryptionCipher;break;case n.pki.oids["aes192-CBC"]:s=24,i=16,o=n.aes.createEncryptionCipher;break;case n.pki.oids["aes256-CBC"]:s=32,i=16,o=n.aes.createEncryptionCipher;break;case n.pki.oids["des-EDE3-CBC"]:s=24,i=8,o=n.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+r)}if(void 0===t)t=n.util.createBuffer(n.random.getBytes(s));else if(t.length()!=s)throw new Error("Symmetric key has wrong length; got "+t.length()+" bytes, expected "+s+".");e.encryptedContent.algorithm=r,e.encryptedContent.key=t,e.encryptedContent.parameter=n.util.createBuffer(n.random.getBytes(i));var a=o(t);if(a.start(e.encryptedContent.parameter.copy()),a.update(e.content),!a.finish())throw new Error("Symmetric encryption failed.");e.encryptedContent.content=a.output}for(var c=0;c<e.recipients.length;++c){var l=e.recipients[c];if(void 0===l.encryptedContent.content){if(l.encryptedContent.algorithm!==n.pki.oids.rsaEncryption)throw new Error("Unsupported asymmetric cipher, OID "+l.encryptedContent.algorithm);l.encryptedContent.content=l.encryptedContent.key.encrypt(e.encryptedContent.key.data)}}}}}},38228:(e,t,r)=>{var n=r(72900);r(69522),r(33229);var s=n.asn1,i=e.exports=n.pkcs7asn1=n.pkcs7asn1||{};n.pkcs7=n.pkcs7||{},n.pkcs7.asn1=i;var o={name:"ContentInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};i.contentInfoValidator=o;var a={name:"EncryptedContentInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:s.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};i.envelopedDataValidator={name:"EnvelopedData",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:s.Class.UNIVERSAL,type:s.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(a)},i.encryptedDataValidator={name:"EncryptedData",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"version"}].concat(a)};var c={name:"SignerInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:s.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:s.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};i.signedDataValidator={name:"SignedData",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:s.Class.UNIVERSAL,type:s.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},o,{name:"SignedData.Certificates",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:s.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:s.Class.UNIVERSAL,type:s.Type.SET,capture:"signerInfos",optional:!0,value:[c]}]},i.recipientInfoValidator={name:"RecipientInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:s.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}},3665:(e,t,r)=>{var n=r(72900);r(33229),r(67161),r(88093),function(){if(n.prime)e.exports=n.prime;else{var t=e.exports=n.prime=n.prime||{},r=n.jsbn.BigInteger,s=[6,4,2,4,2,4,6,2],i=new r(null);i.fromInt(30);var o=function(e,t){return e|t};t.generateProbablePrime=function(e,t,s){"function"==typeof t&&(s=t,t={});var i=(t=t||{}).algorithm||"PRIMEINC";"string"==typeof i&&(i={name:i}),i.options=i.options||{};var o=t.prng||n.random,c={nextBytes:function(e){for(var t=o.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}};if("PRIMEINC"===i.name)return function(e,t,s,i){return"workers"in s?function(e,t,s,i){if("undefined"==typeof Worker)return a(e,t,s,i);var o=l(e,t),c=s.workers,h=s.workLoad||100,u=30*h/8,d=s.workerScript||"forge/prime.worker.js";if(-1===c)return n.util.estimateCores((function(e,t){e&&(t=2),c=t-1,p()}));function p(){c=Math.max(1,c);for(var n=[],s=0;s<c;++s)n[s]=new Worker(d);for(s=0;s<c;++s)n[s].addEventListener("message",p);var a=!1;function p(s){if(!a){var c=s.data;if(c.found){for(var d=0;d<n.length;++d)n[d].terminate();return a=!0,i(null,new r(c.prime,16))}o.bitLength()>e&&(o=l(e,t));var p=o.toString(16);s.target.postMessage({hex:p,workLoad:h}),o.dAddOffset(u,0)}}}p()}(e,t,s,i):a(e,t,s,i)}(e,c,i.options,s);throw new Error("Invalid prime generation algorithm: "+i.name)}}function a(e,t,r,n){var s=l(e,t),i=function(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}(s.bitLength());"millerRabinTests"in r&&(i=r.millerRabinTests);var o=10;"maxBlockTime"in r&&(o=r.maxBlockTime),c(s,e,t,0,i,o,n)}function c(e,t,r,i,o,a,h){var u=+new Date;do{if(e.bitLength()>t&&(e=l(t,r)),e.isProbablePrime(o))return h(null,e);e.dAddOffset(s[i++%8],0)}while(a<0||+new Date-u<a);n.util.setImmediate((function(){c(e,t,r,i,o,a,h)}))}function l(e,t){var n=new r(e,t),s=e-1;return n.testBit(s)||n.bitwiseTo(r.ONE.shiftLeft(s),o,n),n.dAddOffset(31-n.mod(i).byteValue(),0),n}}()},56351:(e,t,r)=>{var n=r(46039),s=r(72900);r(33229);var i=null;!s.util.isNodejs||s.options.usePureJavaScript||n.versions["node-webkit"]||(i=r(25819)),(e.exports=s.prng=s.prng||{}).create=function(e){for(var t={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},r=e.md,n=new Array(32),o=0;o<32;++o)n[o]=r.create();function a(){if(t.pools[0].messageLength>=32)return c();var e=32-t.pools[0].messageLength<<5;t.collect(t.seedFileSync(e)),c()}function c(){t.reseeds=4294967295===t.reseeds?0:t.reseeds+1;var e=t.plugin.md.create();e.update(t.keyBytes);for(var r=1,n=0;n<32;++n)t.reseeds%r==0&&(e.update(t.pools[n].digest().getBytes()),t.pools[n].start()),r<<=1;t.keyBytes=e.digest().getBytes(),e.start(),e.update(t.keyBytes);var s=e.digest().getBytes();t.key=t.plugin.formatKey(t.keyBytes),t.seed=t.plugin.formatSeed(s),t.generated=0}function l(e){var t=null,r=s.util.globalScope,n=r.crypto||r.msCrypto;n&&n.getRandomValues&&(t=function(e){return n.getRandomValues(e)});var i=s.util.createBuffer();if(t)for(;i.length()<e;){var o=Math.max(1,Math.min(e-i.length(),65536)/4),a=new Uint32Array(Math.floor(o));try{t(a);for(var c=0;c<a.length;++c)i.putInt32(a[c])}catch(e){if(!("undefined"!=typeof QuotaExceededError&&e instanceof QuotaExceededError))throw e}}if(i.length()<e)for(var l,h,u,d=Math.floor(65536*Math.random());i.length()<e;)for(h=16807*(65535&d),h+=(32767&(l=16807*(d>>16)))<<16,d=4294967295&(h=(2147483647&(h+=l>>15))+(h>>31)),c=0;c<3;++c)u=d>>>(c<<3),u^=Math.floor(256*Math.random()),i.putByte(255&u);return i.getBytes(e)}return t.pools=n,t.pool=0,t.generate=function(e,r){if(!r)return t.generateSync(e);var n=t.plugin.cipher,i=t.plugin.increment,o=t.plugin.formatKey,a=t.plugin.formatSeed,l=s.util.createBuffer();t.key=null,function h(u){if(u)return r(u);if(l.length()>=e)return r(null,l.getBytes(e));if(t.generated>1048575&&(t.key=null),null===t.key)return s.util.nextTick((function(){!function(e){if(t.pools[0].messageLength>=32)return c(),e();var r=32-t.pools[0].messageLength<<5;t.seedFile(r,(function(r,n){if(r)return e(r);t.collect(n),c(),e()}))}(h)}));var d=n(t.key,t.seed);t.generated+=d.length,l.putBytes(d),t.key=o(n(t.key,i(t.seed))),t.seed=a(n(t.key,t.seed)),s.util.setImmediate(h)}()},t.generateSync=function(e){var r=t.plugin.cipher,n=t.plugin.increment,i=t.plugin.formatKey,o=t.plugin.formatSeed;t.key=null;for(var c=s.util.createBuffer();c.length()<e;){t.generated>1048575&&(t.key=null),null===t.key&&a();var l=r(t.key,t.seed);t.generated+=l.length,c.putBytes(l),t.key=i(r(t.key,n(t.seed))),t.seed=o(r(t.key,t.seed))}return c.getBytes(e)},i?(t.seedFile=function(e,t){i.randomBytes(e,(function(e,r){if(e)return t(e);t(null,r.toString())}))},t.seedFileSync=function(e){return i.randomBytes(e).toString()}):(t.seedFile=function(e,t){try{t(null,l(e))}catch(e){t(e)}},t.seedFileSync=l),t.collect=function(e){for(var r=e.length,n=0;n<r;++n)t.pools[t.pool].update(e.substr(n,1)),t.pool=31===t.pool?0:t.pool+1},t.collectInt=function(e,r){for(var n="",s=0;s<r;s+=8)n+=String.fromCharCode(e>>s&255);t.collect(n)},t.registerWorker=function(e){e===self?t.seedFile=function(e,t){self.addEventListener("message",(function e(r){var n=r.data;n.forge&&n.forge.prng&&(self.removeEventListener("message",e),t(n.forge.prng.err,n.forge.prng.bytes))})),self.postMessage({forge:{prng:{needed:e}}})}:e.addEventListener("message",(function(r){var n=r.data;n.forge&&n.forge.prng&&t.seedFile(n.forge.prng.needed,(function(t,r){e.postMessage({forge:{prng:{err:t,bytes:r}}})}))}))},t}},48590:(e,t,r)=>{var n=r(72900);r(88093),r(33229),(e.exports=n.pss=n.pss||{}).create=function(e){3===arguments.length&&(e={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var t,r=e.md,s=e.mgf,i=r.digestLength,o=e.salt||null;if("string"==typeof o&&(o=n.util.createBuffer(o)),"saltLength"in e)t=e.saltLength;else{if(null===o)throw new Error("Salt length not specified or specific salt not given.");t=o.length()}if(null!==o&&o.length()!==t)throw new Error("Given salt length does not match length of given salt.");var a=e.prng||n.random,c={encode:function(e,c){var l,h,u=c-1,d=Math.ceil(u/8),p=e.digest().getBytes();if(d<i+t+2)throw new Error("Message is too long to encrypt.");h=null===o?a.getBytesSync(t):o.bytes();var f=new n.util.ByteBuffer;f.fillWithByte(0,8),f.putBytes(p),f.putBytes(h),r.start(),r.update(f.getBytes());var y=r.digest().getBytes(),g=new n.util.ByteBuffer;g.fillWithByte(0,d-t-i-2),g.putByte(1),g.putBytes(h);var m=g.getBytes(),w=d-i-1,b=s.generate(y,w),v="";for(l=0;l<w;l++)v+=String.fromCharCode(m.charCodeAt(l)^b.charCodeAt(l));var E=65280>>8*d-u&255;return(v=String.fromCharCode(v.charCodeAt(0)&~E)+v.substr(1))+y+String.fromCharCode(188)},verify:function(e,o,a){var c,l=a-1,h=Math.ceil(l/8);if(o=o.substr(-h),h<i+t+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(188!==o.charCodeAt(h-1))throw new Error("Encoded message does not end in 0xBC.");var u=h-i-1,d=o.substr(0,u),p=o.substr(u,i),f=65280>>8*h-l&255;if(0!=(d.charCodeAt(0)&f))throw new Error("Bits beyond keysize not zero as expected.");var y=s.generate(p,u),g="";for(c=0;c<u;c++)g+=String.fromCharCode(d.charCodeAt(c)^y.charCodeAt(c));g=String.fromCharCode(g.charCodeAt(0)&~f)+g.substr(1);var m=h-i-t-2;for(c=0;c<m;c++)if(0!==g.charCodeAt(c))throw new Error("Leftmost octets not zero as expected");if(1!==g.charCodeAt(m))throw new Error("Inconsistent PSS signature, 0x01 marker not found");var w=g.substr(-t),b=new n.util.ByteBuffer;return b.fillWithByte(0,8),b.putBytes(e),b.putBytes(w),r.start(),r.update(b.getBytes()),p===r.digest().getBytes()}};return c}},88093:(e,t,r)=>{var n=r(72900);r(35564),r(7405),r(56351),r(33229),n.random&&n.random.getBytes?e.exports=n.random:function(t){var r={},s=new Array(4),i=n.util.createBuffer();function o(){var e=n.prng.create(r);return e.getBytes=function(t,r){return e.generate(t,r)},e.getBytesSync=function(t){return e.generate(t)},e}r.formatKey=function(e){var t=n.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),n.aes._expandKey(e,!1)},r.formatSeed=function(e){var t=n.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),e},r.cipher=function(e,t){return n.aes._updateBlock(e,t,s,!1),i.putInt32(s[0]),i.putInt32(s[1]),i.putInt32(s[2]),i.putInt32(s[3]),i.getBytes()},r.increment=function(e){return++e[3],e},r.md=n.md.sha256;var a=o(),c=null,l=n.util.globalScope,h=l.crypto||l.msCrypto;if(h&&h.getRandomValues&&(c=function(e){return h.getRandomValues(e)}),n.options.usePureJavaScript||!n.util.isNodejs&&!c){if("undefined"==typeof window||window.document,a.collectInt(+new Date,32),"undefined"!=typeof navigator){var u="";for(var d in navigator)try{"string"==typeof navigator[d]&&(u+=navigator[d])}catch(e){}a.collect(u),u=null}t&&(t().mousemove((function(e){a.collectInt(e.clientX,16),a.collectInt(e.clientY,16)})),t().keypress((function(e){a.collectInt(e.charCode,8)})))}if(n.random)for(var d in a)n.random[d]=a[d];else n.random=a;n.random.createInstance=o,e.exports=n.random}("undefined"!=typeof jQuery?jQuery:null)},60523:(e,t,r)=>{var n=r(72900);r(33229);var s=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],i=[1,2,3,5],o=function(e,t){return e<<t&65535|(65535&e)>>16-t},a=function(e,t){return(65535&e)>>t|e<<16-t&65535};e.exports=n.rc2=n.rc2||{},n.rc2.expandKey=function(e,t){"string"==typeof e&&(e=n.util.createBuffer(e)),t=t||128;var r,i=e,o=e.length(),a=t,c=Math.ceil(a/8),l=255>>(7&a);for(r=o;r<128;r++)i.putByte(s[i.at(r-1)+i.at(r-o)&255]);for(i.setAt(128-c,s[i.at(128-c)&l]),r=127-c;r>=0;r--)i.setAt(r,s[i.at(r+1)^i.at(r+c)]);return i};var c=function(e,t,r){var s,c,l,h,u=!1,d=null,p=null,f=null,y=[];for(e=n.rc2.expandKey(e,t),l=0;l<64;l++)y.push(e.getInt16Le());r?(s=function(e){for(l=0;l<4;l++)e[l]+=y[h]+(e[(l+3)%4]&e[(l+2)%4])+(~e[(l+3)%4]&e[(l+1)%4]),e[l]=o(e[l],i[l]),h++},c=function(e){for(l=0;l<4;l++)e[l]+=y[63&e[(l+3)%4]]}):(s=function(e){for(l=3;l>=0;l--)e[l]=a(e[l],i[l]),e[l]-=y[h]+(e[(l+3)%4]&e[(l+2)%4])+(~e[(l+3)%4]&e[(l+1)%4]),h--},c=function(e){for(l=3;l>=0;l--)e[l]-=y[63&e[(l+3)%4]]});var g=function(e){var t=[];for(l=0;l<4;l++){var n=d.getInt16Le();null!==f&&(r?n^=f.getInt16Le():f.putInt16Le(n)),t.push(65535&n)}h=r?0:63;for(var s=0;s<e.length;s++)for(var i=0;i<e[s][0];i++)e[s][1](t);for(l=0;l<4;l++)null!==f&&(r?f.putInt16Le(t[l]):t[l]^=f.getInt16Le()),p.putInt16Le(t[l])},m=null;return m={start:function(e,t){e&&"string"==typeof e&&(e=n.util.createBuffer(e)),u=!1,d=n.util.createBuffer(),p=t||new n.util.createBuffer,f=e,m.output=p},update:function(e){for(u||d.putBuffer(e);d.length()>=8;)g([[5,s],[1,c],[6,s],[1,c],[5,s]])},finish:function(e){var t=!0;if(r)if(e)t=e(8,d,!r);else{var n=8===d.length()?8:8-d.length();d.fillWithByte(n,n)}if(t&&(u=!0,m.update()),!r&&(t=0===d.length()))if(e)t=e(8,p,!r);else{var s=p.length(),i=p.at(s-1);i>s?t=!1:p.truncate(i)}return t}}};n.rc2.startEncrypting=function(e,t,r){var s=n.rc2.createEncryptionCipher(e,128);return s.start(t,r),s},n.rc2.createEncryptionCipher=function(e,t){return c(e,t,!0)},n.rc2.startDecrypting=function(e,t,r){var s=n.rc2.createDecryptionCipher(e,128);return s.start(t,r),s},n.rc2.createDecryptionCipher=function(e,t){return c(e,t,!1)}},83635:(e,t,r)=>{var n=r(72900);if(r(69522),r(67161),r(8579),r(46732),r(3665),r(88093),r(33229),void 0===s)var s=n.jsbn.BigInteger;var i=n.util.isNodejs?r(25819):null,o=n.asn1,a=n.util;n.pki=n.pki||{},e.exports=n.pki.rsa=n.rsa=n.rsa||{};var c=n.pki,l=[6,4,2,4,2,4,6,2],h={name:"PrivateKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},u={name:"RSAPrivateKey",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},d={name:"RSAPublicKey",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},p=n.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:o.Class.UNIVERSAL,type:o.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},f={name:"DigestInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:o.Class.UNIVERSAL,type:o.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},y=function(e){var t;if(!(e.algorithm in c.oids)){var r=new Error("Unknown message digest algorithm.");throw r.algorithm=e.algorithm,r}t=c.oids[e.algorithm];var n=o.oidToDer(t).getBytes(),s=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[]),i=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[]);i.value.push(o.create(o.Class.UNIVERSAL,o.Type.OID,!1,n)),i.value.push(o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,""));var a=o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,e.digest().getBytes());return s.value.push(i),s.value.push(a),o.toDer(s).getBytes()},g=function(e,t,r){if(r)return e.modPow(t.e,t.n);if(!t.p||!t.q)return e.modPow(t.d,t.n);var i;t.dP||(t.dP=t.d.mod(t.p.subtract(s.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(s.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));do{i=new s(n.util.bytesToHex(n.random.getBytes(t.n.bitLength()/8)),16)}while(i.compareTo(t.n)>=0||!i.gcd(t.n).equals(s.ONE));for(var o=(e=e.multiply(i.modPow(t.e,t.n)).mod(t.n)).mod(t.p).modPow(t.dP,t.p),a=e.mod(t.q).modPow(t.dQ,t.q);o.compareTo(a)<0;)o=o.add(t.p);var c=o.subtract(a).multiply(t.qInv).mod(t.p).multiply(t.q).add(a);return c.multiply(i.modInverse(t.n)).mod(t.n)};function m(e,t,r){var s=n.util.createBuffer(),i=Math.ceil(t.n.bitLength()/8);if(e.length>i-11){var o=new Error("Message is too long for PKCS#1 v1.5 padding.");throw o.length=e.length,o.max=i-11,o}s.putByte(0),s.putByte(r);var a,c=i-3-e.length;if(0===r||1===r){a=0===r?0:255;for(var l=0;l<c;++l)s.putByte(a)}else for(;c>0;){var h=0,u=n.random.getBytes(c);for(l=0;l<c;++l)0===(a=u.charCodeAt(l))?++h:s.putByte(a);c=h}return s.putByte(0),s.putBytes(e),s}function w(e,t,r,s){var i=Math.ceil(t.n.bitLength()/8),o=n.util.createBuffer(e),a=o.getByte(),c=o.getByte();if(0!==a||r&&0!==c&&1!==c||!r&&2!=c||r&&0===c&&void 0===s)throw new Error("Encryption block is invalid.");var l=0;if(0===c){l=i-3-s;for(var h=0;h<l;++h)if(0!==o.getByte())throw new Error("Encryption block is invalid.")}else if(1===c)for(l=0;o.length()>1;){if(255!==o.getByte()){--o.read;break}++l}else if(2===c)for(l=0;o.length()>1;){if(0===o.getByte()){--o.read;break}++l}if(0!==o.getByte()||l!==i-3-o.length())throw new Error("Encryption block is invalid.");return o.getBytes()}function b(e,t,r){"function"==typeof t&&(r=t,t={});var i={algorithm:{name:(t=t||{}).algorithm||"PRIMEINC",options:{workers:t.workers||2,workLoad:t.workLoad||100,workerScript:t.workerScript}}};function o(){a(e.pBits,(function(t,n){return t?r(t):(e.p=n,null!==e.q?l(t,e.q):void a(e.qBits,l))}))}function a(e,t){n.prime.generateProbablePrime(e,i,t)}function l(t,n){if(t)return r(t);if(e.q=n,e.p.compareTo(e.q)<0){var i=e.p;e.p=e.q,e.q=i}if(0!==e.p.subtract(s.ONE).gcd(e.e).compareTo(s.ONE))return e.p=null,void o();if(0!==e.q.subtract(s.ONE).gcd(e.e).compareTo(s.ONE))return e.q=null,void a(e.qBits,l);if(e.p1=e.p.subtract(s.ONE),e.q1=e.q.subtract(s.ONE),e.phi=e.p1.multiply(e.q1),0!==e.phi.gcd(e.e).compareTo(s.ONE))return e.p=e.q=null,void o();if(e.n=e.p.multiply(e.q),e.n.bitLength()!==e.bits)return e.q=null,void a(e.qBits,l);var h=e.e.modInverse(e.phi);e.keys={privateKey:c.rsa.setPrivateKey(e.n,e.e,h,e.p,e.q,h.mod(e.p1),h.mod(e.q1),e.q.modInverse(e.p)),publicKey:c.rsa.setPublicKey(e.n,e.e)},r(null,e.keys)}"prng"in t&&(i.prng=t.prng),o()}function v(e){var t=e.toString(16);t[0]>="8"&&(t="00"+t);var r=n.util.hexToBytes(t);return r.length>1&&(0===r.charCodeAt(0)&&0==(128&r.charCodeAt(1))||255===r.charCodeAt(0)&&128==(128&r.charCodeAt(1)))?r.substr(1):r}function E(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}function _(e){return n.util.isNodejs&&"function"==typeof i[e]}function S(e){return void 0!==a.globalScope&&"object"==typeof a.globalScope.crypto&&"object"==typeof a.globalScope.crypto.subtle&&"function"==typeof a.globalScope.crypto.subtle[e]}function A(e){return void 0!==a.globalScope&&"object"==typeof a.globalScope.msCrypto&&"object"==typeof a.globalScope.msCrypto.subtle&&"function"==typeof a.globalScope.msCrypto.subtle[e]}function I(e){for(var t=n.util.hexToBytes(e.toString(16)),r=new Uint8Array(t.length),s=0;s<t.length;++s)r[s]=t.charCodeAt(s);return r}c.rsa.encrypt=function(e,t,r){var i,o=r,a=Math.ceil(t.n.bitLength()/8);!1!==r&&!0!==r?(o=2===r,i=m(e,t,r)):(i=n.util.createBuffer()).putBytes(e);for(var c=new s(i.toHex(),16),l=g(c,t,o).toString(16),h=n.util.createBuffer(),u=a-Math.ceil(l.length/2);u>0;)h.putByte(0),--u;return h.putBytes(n.util.hexToBytes(l)),h.getBytes()},c.rsa.decrypt=function(e,t,r,i){var o=Math.ceil(t.n.bitLength()/8);if(e.length!==o){var a=new Error("Encrypted message length is invalid.");throw a.length=e.length,a.expected=o,a}var c=new s(n.util.createBuffer(e).toHex(),16);if(c.compareTo(t.n)>=0)throw new Error("Encrypted message is invalid.");for(var l=g(c,t,r).toString(16),h=n.util.createBuffer(),u=o-Math.ceil(l.length/2);u>0;)h.putByte(0),--u;return h.putBytes(n.util.hexToBytes(l)),!1!==i?w(h.getBytes(),t,r):h.getBytes()},c.rsa.createKeyPairGenerationState=function(e,t,r){"string"==typeof e&&(e=parseInt(e,10)),e=e||2048;var i,o=(r=r||{}).prng||n.random,a={nextBytes:function(e){for(var t=o.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}},c=r.algorithm||"PRIMEINC";if("PRIMEINC"!==c)throw new Error("Invalid key generation algorithm: "+c);return(i={algorithm:c,state:0,bits:e,rng:a,eInt:t||65537,e:new s(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(i.eInt),i},c.rsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var r=new s(null);r.fromInt(30);for(var n,i=0,o=function(e,t){return e|t},a=+new Date,h=0;null===e.keys&&(t<=0||h<t);){if(0===e.state){var u=null===e.p?e.pBits:e.qBits,d=u-1;0===e.pqState?(e.num=new s(u,e.rng),e.num.testBit(d)||e.num.bitwiseTo(s.ONE.shiftLeft(d),o,e.num),e.num.dAddOffset(31-e.num.mod(r).byteValue(),0),i=0,++e.pqState):1===e.pqState?e.num.bitLength()>u?e.pqState=0:e.num.isProbablePrime(E(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(l[i++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(s.ONE).gcd(e.e).compareTo(s.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(s.ONE),e.q1=e.q.subtract(s.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(s.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var p=e.e.modInverse(e.phi);e.keys={privateKey:c.rsa.setPrivateKey(e.n,e.e,p,e.p,e.q,p.mod(e.p1),p.mod(e.q1),e.q.modInverse(e.p)),publicKey:c.rsa.setPublicKey(e.n,e.e)}}h+=(n=+new Date)-a,a=n}return null!==e.keys},c.rsa.generateKeyPair=function(e,t,r,s){if(1===arguments.length?"object"==typeof e?(r=e,e=void 0):"function"==typeof e&&(s=e,e=void 0):2===arguments.length?"number"==typeof e?"function"==typeof t?(s=t,t=void 0):"number"!=typeof t&&(r=t,t=void 0):(r=e,s=t,e=void 0,t=void 0):3===arguments.length&&("number"==typeof t?"function"==typeof r&&(s=r,r=void 0):(s=r,r=t,t=void 0)),r=r||{},void 0===e&&(e=r.bits||2048),void 0===t&&(t=r.e||65537),!n.options.usePureJavaScript&&!r.prng&&e>=256&&e<=16384&&(65537===t||3===t))if(s){if(_("generateKeyPair"))return i.generateKeyPair("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},(function(e,t,r){if(e)return s(e);s(null,{privateKey:c.privateKeyFromPem(r),publicKey:c.publicKeyFromPem(t)})}));if(S("generateKey")&&S("exportKey"))return a.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:I(t),hash:{name:"SHA-256"}},!0,["sign","verify"]).then((function(e){return a.globalScope.crypto.subtle.exportKey("pkcs8",e.privateKey)})).then(void 0,(function(e){s(e)})).then((function(e){if(e){var t=c.privateKeyFromAsn1(o.fromDer(n.util.createBuffer(e)));s(null,{privateKey:t,publicKey:c.setRsaPublicKey(t.n,t.e)})}}));if(A("generateKey")&&A("exportKey")){var l=a.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:I(t),hash:{name:"SHA-256"}},!0,["sign","verify"]);return l.oncomplete=function(e){var t=e.target.result,r=a.globalScope.msCrypto.subtle.exportKey("pkcs8",t.privateKey);r.oncomplete=function(e){var t=e.target.result,r=c.privateKeyFromAsn1(o.fromDer(n.util.createBuffer(t)));s(null,{privateKey:r,publicKey:c.setRsaPublicKey(r.n,r.e)})},r.onerror=function(e){s(e)}},void(l.onerror=function(e){s(e)})}}else if(_("generateKeyPairSync")){var h=i.generateKeyPairSync("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:c.privateKeyFromPem(h.privateKey),publicKey:c.publicKeyFromPem(h.publicKey)}}var u=c.rsa.createKeyPairGenerationState(e,t,r);if(!s)return c.rsa.stepKeyPairGenerationState(u,0),u.keys;b(u,r,s)},c.setRsaPublicKey=c.rsa.setPublicKey=function(e,t){var r={n:e,e:t,encrypt:function(e,t,s){if("string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===t)t={encode:function(e,t,r){return m(e,t,2).getBytes()}};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={encode:function(e,t){return n.pkcs1.encode_rsa_oaep(t,e,s)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(t))t={encode:function(e){return e}};else if("string"==typeof t)throw new Error('Unsupported encryption scheme: "'+t+'".');var i=t.encode(e,r,!0);return c.rsa.encrypt(i,r,!0)},verify:function(e,t,s,i){"string"==typeof s?s=s.toUpperCase():void 0===s&&(s="RSASSA-PKCS1-V1_5"),void 0===i&&(i={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in i||(i._parseAllDigestBytes=!0),"RSASSA-PKCS1-V1_5"===s?s={verify:function(e,t){t=w(t,r,!0);var s=o.fromDer(t,{parseAllBytes:i._parseAllDigestBytes}),a={},c=[];if(!o.validate(s,f,a,c))throw(l=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.")).errors=c,l;var l,h=o.derToOid(a.algorithmIdentifier);if(h!==n.oids.md2&&h!==n.oids.md5&&h!==n.oids.sha1&&h!==n.oids.sha224&&h!==n.oids.sha256&&h!==n.oids.sha384&&h!==n.oids.sha512&&h!==n.oids["sha512-224"]&&h!==n.oids["sha512-256"])throw(l=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.")).oid=h,l;if((h===n.oids.md2||h===n.oids.md5)&&!("parameters"in a))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return e===a.digest}}:"NONE"!==s&&"NULL"!==s&&null!==s||(s={verify:function(e,t){return e===w(t,r,!0)}});var a=c.rsa.decrypt(t,r,!0,!1);return s.verify(e,a,r.n.bitLength())}};return r},c.setRsaPrivateKey=c.rsa.setPrivateKey=function(e,t,r,s,i,o,a,l){var h={n:e,e:t,d:r,p:s,q:i,dP:o,dQ:a,qInv:l,decrypt:function(e,t,r){"string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5");var s=c.rsa.decrypt(e,h,!1,!1);if("RSAES-PKCS1-V1_5"===t)t={decode:w};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={decode:function(e,t){return n.pkcs1.decode_rsa_oaep(t,e,r)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(t))throw new Error('Unsupported encryption scheme: "'+t+'".');t={decode:function(e){return e}}}return t.decode(s,h,!1)},sign:function(e,t){var r=!1;"string"==typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:y},r=1):"NONE"!==t&&"NULL"!==t&&null!==t||(t={encode:function(){return e}},r=1);var n=t.encode(e,h.n.bitLength());return c.rsa.encrypt(n,h,r)}};return h},c.wrapRsaPrivateKey=function(e){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,o.integerToDer(0).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(c.oids.rsaEncryption).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,"")]),o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,o.toDer(e).getBytes())])},c.privateKeyFromAsn1=function(e){var t,r,i,a,l,d,p,f,y={},g=[];if(o.validate(e,h,y,g)&&(e=o.fromDer(n.util.createBuffer(y.privateKey))),y={},g=[],!o.validate(e,u,y,g)){var m=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw m.errors=g,m}return t=n.util.createBuffer(y.privateKeyModulus).toHex(),r=n.util.createBuffer(y.privateKeyPublicExponent).toHex(),i=n.util.createBuffer(y.privateKeyPrivateExponent).toHex(),a=n.util.createBuffer(y.privateKeyPrime1).toHex(),l=n.util.createBuffer(y.privateKeyPrime2).toHex(),d=n.util.createBuffer(y.privateKeyExponent1).toHex(),p=n.util.createBuffer(y.privateKeyExponent2).toHex(),f=n.util.createBuffer(y.privateKeyCoefficient).toHex(),c.setRsaPrivateKey(new s(t,16),new s(r,16),new s(i,16),new s(a,16),new s(l,16),new s(d,16),new s(p,16),new s(f,16))},c.privateKeyToAsn1=c.privateKeyToRSAPrivateKey=function(e){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,o.integerToDer(0).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.n)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.e)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.d)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.p)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.q)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.dP)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.dQ)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.qInv))])},c.publicKeyFromAsn1=function(e){var t={},r=[];if(o.validate(e,p,t,r)){var i,a=o.derToOid(t.publicKeyOid);if(a!==c.oids.rsaEncryption)throw(i=new Error("Cannot read public key. Unknown OID.")).oid=a,i;e=t.rsaPublicKey}if(r=[],!o.validate(e,d,t,r))throw(i=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.")).errors=r,i;var l=n.util.createBuffer(t.publicKeyModulus).toHex(),h=n.util.createBuffer(t.publicKeyExponent).toHex();return c.setRsaPublicKey(new s(l,16),new s(h,16))},c.publicKeyToAsn1=c.publicKeyToSubjectPublicKeyInfo=function(e){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(c.oids.rsaEncryption).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,"")]),o.create(o.Class.UNIVERSAL,o.Type.BITSTRING,!1,[c.publicKeyToRSAPublicKey(e)])])},c.publicKeyToRSAPublicKey=function(e){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.n)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.e))])}},61244:(e,t,r)=>{var n=r(72900);r(20119),r(33229);var s=e.exports=n.sha1=n.sha1||{};n.md.sha1=n.md.algorithms.sha1=s,s.create=function(){o||(i=String.fromCharCode(128),i+=n.util.fillString(String.fromCharCode(0),64),o=!0);var e=null,t=n.util.createBuffer(),r=new Array(80),s={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){s.messageLength=0,s.fullMessageLength=s.messageLength64=[];for(var r=s.messageLengthSize/4,i=0;i<r;++i)s.fullMessageLength.push(0);return t=n.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},s}};return s.start(),s.update=function(i,o){"utf8"===o&&(i=n.util.encodeUtf8(i));var c=i.length;s.messageLength+=c,c=[c/4294967296>>>0,c>>>0];for(var l=s.fullMessageLength.length-1;l>=0;--l)s.fullMessageLength[l]+=c[1],c[1]=c[0]+(s.fullMessageLength[l]/4294967296>>>0),s.fullMessageLength[l]=s.fullMessageLength[l]>>>0,c[0]=c[1]/4294967296>>>0;return t.putBytes(i),a(e,r,t),(t.read>2048||0===t.length())&&t.compact(),s},s.digest=function(){var o=n.util.createBuffer();o.putBytes(t.bytes());var c,l=s.fullMessageLength[s.fullMessageLength.length-1]+s.messageLengthSize&s.blockLength-1;o.putBytes(i.substr(0,s.blockLength-l));for(var h=8*s.fullMessageLength[0],u=0;u<s.fullMessageLength.length-1;++u)h+=(c=8*s.fullMessageLength[u+1])/4294967296>>>0,o.putInt32(h>>>0),h=c>>>0;o.putInt32(h);var d={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};a(d,r,o);var p=n.util.createBuffer();return p.putInt32(d.h0),p.putInt32(d.h1),p.putInt32(d.h2),p.putInt32(d.h3),p.putInt32(d.h4),p},s};var i=null,o=!1;function a(e,t,r){for(var n,s,i,o,a,c,l,h=r.length();h>=64;){for(s=e.h0,i=e.h1,o=e.h2,a=e.h3,c=e.h4,l=0;l<16;++l)n=r.getInt32(),t[l]=n,n=(s<<5|s>>>27)+(a^i&(o^a))+c+1518500249+n,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;l<20;++l)n=(n=t[l-3]^t[l-8]^t[l-14]^t[l-16])<<1|n>>>31,t[l]=n,n=(s<<5|s>>>27)+(a^i&(o^a))+c+1518500249+n,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;l<32;++l)n=(n=t[l-3]^t[l-8]^t[l-14]^t[l-16])<<1|n>>>31,t[l]=n,n=(s<<5|s>>>27)+(i^o^a)+c+1859775393+n,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;l<40;++l)n=(n=t[l-6]^t[l-16]^t[l-28]^t[l-32])<<2|n>>>30,t[l]=n,n=(s<<5|s>>>27)+(i^o^a)+c+1859775393+n,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;l<60;++l)n=(n=t[l-6]^t[l-16]^t[l-28]^t[l-32])<<2|n>>>30,t[l]=n,n=(s<<5|s>>>27)+(i&o|a&(i^o))+c+2400959708+n,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;l<80;++l)n=(n=t[l-6]^t[l-16]^t[l-28]^t[l-32])<<2|n>>>30,t[l]=n,n=(s<<5|s>>>27)+(i^o^a)+c+3395469782+n,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;e.h0=e.h0+s|0,e.h1=e.h1+i|0,e.h2=e.h2+o|0,e.h3=e.h3+a|0,e.h4=e.h4+c|0,h-=64}}},7405:(e,t,r)=>{var n=r(72900);r(20119),r(33229);var s=e.exports=n.sha256=n.sha256||{};n.md.sha256=n.md.algorithms.sha256=s,s.create=function(){o||(i=String.fromCharCode(128),i+=n.util.fillString(String.fromCharCode(0),64),a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=!0);var e=null,t=n.util.createBuffer(),r=new Array(64),s={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){s.messageLength=0,s.fullMessageLength=s.messageLength64=[];for(var r=s.messageLengthSize/4,i=0;i<r;++i)s.fullMessageLength.push(0);return t=n.util.createBuffer(),e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},s}};return s.start(),s.update=function(i,o){"utf8"===o&&(i=n.util.encodeUtf8(i));var a=i.length;s.messageLength+=a,a=[a/4294967296>>>0,a>>>0];for(var l=s.fullMessageLength.length-1;l>=0;--l)s.fullMessageLength[l]+=a[1],a[1]=a[0]+(s.fullMessageLength[l]/4294967296>>>0),s.fullMessageLength[l]=s.fullMessageLength[l]>>>0,a[0]=a[1]/4294967296>>>0;return t.putBytes(i),c(e,r,t),(t.read>2048||0===t.length())&&t.compact(),s},s.digest=function(){var o=n.util.createBuffer();o.putBytes(t.bytes());var a,l=s.fullMessageLength[s.fullMessageLength.length-1]+s.messageLengthSize&s.blockLength-1;o.putBytes(i.substr(0,s.blockLength-l));for(var h=8*s.fullMessageLength[0],u=0;u<s.fullMessageLength.length-1;++u)h+=(a=8*s.fullMessageLength[u+1])/4294967296>>>0,o.putInt32(h>>>0),h=a>>>0;o.putInt32(h);var d={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4,h5:e.h5,h6:e.h6,h7:e.h7};c(d,r,o);var p=n.util.createBuffer();return p.putInt32(d.h0),p.putInt32(d.h1),p.putInt32(d.h2),p.putInt32(d.h3),p.putInt32(d.h4),p.putInt32(d.h5),p.putInt32(d.h6),p.putInt32(d.h7),p},s};var i=null,o=!1,a=null;function c(e,t,r){for(var n,s,i,o,c,l,h,u,d,p,f,y,g,m=r.length();m>=64;){for(c=0;c<16;++c)t[c]=r.getInt32();for(;c<64;++c)n=((n=t[c-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,s=((s=t[c-15])>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,t[c]=n+t[c-7]+s+t[c-16]|0;for(l=e.h0,h=e.h1,u=e.h2,d=e.h3,p=e.h4,f=e.h5,y=e.h6,g=e.h7,c=0;c<64;++c)i=(l>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),o=l&h|u&(l^h),n=g+((p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(y^p&(f^y))+a[c]+t[c],g=y,y=f,f=p,p=d+n>>>0,d=u,u=h,h=l,l=n+(s=i+o)>>>0;e.h0=e.h0+l|0,e.h1=e.h1+h|0,e.h2=e.h2+u|0,e.h3=e.h3+d|0,e.h4=e.h4+p|0,e.h5=e.h5+f|0,e.h6=e.h6+y|0,e.h7=e.h7+g|0,m-=64}}},63099:(e,t,r)=>{var n=r(72900);r(20119),r(33229);var s=e.exports=n.sha512=n.sha512||{};n.md.sha512=n.md.algorithms.sha512=s;var i=n.sha384=n.sha512.sha384=n.sha512.sha384||{};i.create=function(){return s.create("SHA-384")},n.md.sha384=n.md.algorithms.sha384=i,n.sha512.sha256=n.sha512.sha256||{create:function(){return s.create("SHA-512/256")}},n.md["sha512/256"]=n.md.algorithms["sha512/256"]=n.sha512.sha256,n.sha512.sha224=n.sha512.sha224||{create:function(){return s.create("SHA-512/224")}},n.md["sha512/224"]=n.md.algorithms["sha512/224"]=n.sha512.sha224,s.create=function(e){if(a||(o=String.fromCharCode(128),o+=n.util.fillString(String.fromCharCode(0),128),c=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],(l={})["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],l["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],l["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],l["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],a=!0),void 0===e&&(e="SHA-512"),!(e in l))throw new Error("Invalid SHA-512 algorithm: "+e);for(var t=l[e],r=null,s=n.util.createBuffer(),i=new Array(80),u=0;u<80;++u)i[u]=new Array(2);var d=64;switch(e){case"SHA-384":d=48;break;case"SHA-512/256":d=32;break;case"SHA-512/224":d=28}var p={algorithm:e.replace("-","").toLowerCase(),blockLength:128,digestLength:d,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){p.messageLength=0,p.fullMessageLength=p.messageLength128=[];for(var e=p.messageLengthSize/4,i=0;i<e;++i)p.fullMessageLength.push(0);for(s=n.util.createBuffer(),r=new Array(t.length),i=0;i<t.length;++i)r[i]=t[i].slice(0);return p}};return p.start(),p.update=function(e,t){"utf8"===t&&(e=n.util.encodeUtf8(e));var o=e.length;p.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=p.fullMessageLength.length-1;a>=0;--a)p.fullMessageLength[a]+=o[1],o[1]=o[0]+(p.fullMessageLength[a]/4294967296>>>0),p.fullMessageLength[a]=p.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return s.putBytes(e),h(r,i,s),(s.read>2048||0===s.length())&&s.compact(),p},p.digest=function(){var t=n.util.createBuffer();t.putBytes(s.bytes());var a,c=p.fullMessageLength[p.fullMessageLength.length-1]+p.messageLengthSize&p.blockLength-1;t.putBytes(o.substr(0,p.blockLength-c));for(var l=8*p.fullMessageLength[0],u=0;u<p.fullMessageLength.length-1;++u)l+=(a=8*p.fullMessageLength[u+1])/4294967296>>>0,t.putInt32(l>>>0),l=a>>>0;t.putInt32(l);var d=new Array(r.length);for(u=0;u<r.length;++u)d[u]=r[u].slice(0);h(d,i,t);var f,y=n.util.createBuffer();for(f="SHA-512"===e?d.length:"SHA-384"===e?d.length-2:d.length-4,u=0;u<f;++u)y.putInt32(d[u][0]),u===f-1&&"SHA-512/224"===e||y.putInt32(d[u][1]);return y},p};var o=null,a=!1,c=null,l=null;function h(e,t,r){for(var n,s,i,o,a,l,h,u,d,p,f,y,g,m,w,b,v,E,_,S,A,I,R,k,T,C,P,N,D,O,x,L,B,M=r.length();M>=128;){for(P=0;P<16;++P)t[P][0]=r.getInt32()>>>0,t[P][1]=r.getInt32()>>>0;for(;P<80;++P)n=(((N=(O=t[P-2])[0])>>>19|(D=O[1])<<13)^(D>>>29|N<<3)^N>>>6)>>>0,s=((N<<13|D>>>19)^(D<<3|N>>>29)^(N<<26|D>>>6))>>>0,i=(((N=(L=t[P-15])[0])>>>1|(D=L[1])<<31)^(N>>>8|D<<24)^N>>>7)>>>0,o=((N<<31|D>>>1)^(N<<24|D>>>8)^(N<<25|D>>>7))>>>0,x=t[P-7],B=t[P-16],D=s+x[1]+o+B[1],t[P][0]=n+x[0]+i+B[0]+(D/4294967296>>>0)>>>0,t[P][1]=D>>>0;for(f=e[0][0],y=e[0][1],g=e[1][0],m=e[1][1],w=e[2][0],b=e[2][1],v=e[3][0],E=e[3][1],_=e[4][0],S=e[4][1],A=e[5][0],I=e[5][1],R=e[6][0],k=e[6][1],T=e[7][0],C=e[7][1],P=0;P<80;++P)h=((_>>>14|S<<18)^(_>>>18|S<<14)^(S>>>9|_<<23))>>>0,u=(R^_&(A^R))>>>0,a=((f>>>28|y<<4)^(y>>>2|f<<30)^(y>>>7|f<<25))>>>0,l=((f<<4|y>>>28)^(y<<30|f>>>2)^(y<<25|f>>>7))>>>0,d=(f&g|w&(f^g))>>>0,p=(y&m|b&(y^m))>>>0,D=C+(((_<<18|S>>>14)^(_<<14|S>>>18)^(S<<23|_>>>9))>>>0)+((k^S&(I^k))>>>0)+c[P][1]+t[P][1],n=T+h+u+c[P][0]+t[P][0]+(D/4294967296>>>0)>>>0,s=D>>>0,i=a+d+((D=l+p)/4294967296>>>0)>>>0,o=D>>>0,T=R,C=k,R=A,k=I,A=_,I=S,_=v+n+((D=E+s)/4294967296>>>0)>>>0,S=D>>>0,v=w,E=b,w=g,b=m,g=f,m=y,f=n+i+((D=s+o)/4294967296>>>0)>>>0,y=D>>>0;D=e[0][1]+y,e[0][0]=e[0][0]+f+(D/4294967296>>>0)>>>0,e[0][1]=D>>>0,D=e[1][1]+m,e[1][0]=e[1][0]+g+(D/4294967296>>>0)>>>0,e[1][1]=D>>>0,D=e[2][1]+b,e[2][0]=e[2][0]+w+(D/4294967296>>>0)>>>0,e[2][1]=D>>>0,D=e[3][1]+E,e[3][0]=e[3][0]+v+(D/4294967296>>>0)>>>0,e[3][1]=D>>>0,D=e[4][1]+S,e[4][0]=e[4][0]+_+(D/4294967296>>>0)>>>0,e[4][1]=D>>>0,D=e[5][1]+I,e[5][0]=e[5][0]+A+(D/4294967296>>>0)>>>0,e[5][1]=D>>>0,D=e[6][1]+k,e[6][0]=e[6][0]+R+(D/4294967296>>>0)>>>0,e[6][1]=D>>>0,D=e[7][1]+C,e[7][0]=e[7][0]+T+(D/4294967296>>>0)>>>0,e[7][1]=D>>>0,M-=128}}},33229:(e,t,r)=>{var n=r(46039),s=r(62678).Buffer,i=r(72900),o=r(41996),a=e.exports=i.util=i.util||{};function c(e){if(8!==e&&16!==e&&24!==e&&32!==e)throw new Error("Only 8, 16, 24, or 32 bits supported: "+e)}function l(e){if(this.data="",this.read=0,"string"==typeof e)this.data=e;else if(a.isArrayBuffer(e)||a.isArrayBufferView(e))if(void 0!==s&&e instanceof s)this.data=e.toString("binary");else{var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(e){for(var r=0;r<t.length;++r)this.putByte(t[r])}}else(e instanceof l||"object"==typeof e&&"string"==typeof e.data&&"number"==typeof e.read)&&(this.data=e.data,this.read=e.read);this._constructedStringLength=0}!function(){if(void 0!==n&&n.nextTick&&!n.browser)return a.nextTick=n.nextTick,void("function"==typeof setImmediate?a.setImmediate=setImmediate:a.setImmediate=a.nextTick);if("function"==typeof setImmediate)return a.setImmediate=function(){return setImmediate.apply(void 0,arguments)},void(a.nextTick=function(e){return setImmediate(e)});if(a.setImmediate=function(e){setTimeout(e,0)},"undefined"!=typeof window&&"function"==typeof window.postMessage){var e="forge.setImmediate",t=[];a.setImmediate=function(r){t.push(r),1===t.length&&window.postMessage(e,"*")},window.addEventListener("message",(function(r){if(r.source===window&&r.data===e){r.stopPropagation();var n=t.slice();t.length=0,n.forEach((function(e){e()}))}}),!0)}if("undefined"!=typeof MutationObserver){var r=Date.now(),s=!0,i=document.createElement("div");t=[],new MutationObserver((function(){var e=t.slice();t.length=0,e.forEach((function(e){e()}))})).observe(i,{attributes:!0});var o=a.setImmediate;a.setImmediate=function(e){Date.now()-r>15?(r=Date.now(),o(e)):(t.push(e),1===t.length&&i.setAttribute("a",s=!s))}}a.nextTick=a.setImmediate}(),a.isNodejs=void 0!==n&&n.versions&&n.versions.node,a.globalScope=a.isNodejs?r.g:"undefined"==typeof self?window:self,a.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a.isArrayBuffer=function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer},a.isArrayBufferView=function(e){return e&&a.isArrayBuffer(e.buffer)&&void 0!==e.byteLength},a.ByteBuffer=l,a.ByteStringBuffer=l,a.ByteStringBuffer.prototype._optimizeConstructedString=function(e){this._constructedStringLength+=e,this._constructedStringLength>4096&&(this.data.substr(0,1),this._constructedStringLength=0)},a.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},a.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},a.ByteStringBuffer.prototype.putByte=function(e){return this.putBytes(String.fromCharCode(e))},a.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var r=this.data;t>0;)1&t&&(r+=e),(t>>>=1)>0&&(e+=e);return this.data=r,this._optimizeConstructedString(t),this},a.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this._optimizeConstructedString(e.length),this},a.ByteStringBuffer.prototype.putString=function(e){return this.putBytes(a.encodeUtf8(e))},a.ByteStringBuffer.prototype.putInt16=function(e){return this.putBytes(String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},a.ByteStringBuffer.prototype.putInt24=function(e){return this.putBytes(String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},a.ByteStringBuffer.prototype.putInt32=function(e){return this.putBytes(String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},a.ByteStringBuffer.prototype.putInt16Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255))},a.ByteStringBuffer.prototype.putInt24Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255))},a.ByteStringBuffer.prototype.putInt32Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255))},a.ByteStringBuffer.prototype.putInt=function(e,t){c(t);var r="";do{t-=8,r+=String.fromCharCode(e>>t&255)}while(t>0);return this.putBytes(r)},a.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},a.ByteStringBuffer.prototype.putBuffer=function(e){return this.putBytes(e.getBytes())},a.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},a.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},a.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},a.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},a.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},a.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},a.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},a.ByteStringBuffer.prototype.getInt=function(e){c(e);var t=0;do{t=(t<<8)+this.data.charCodeAt(this.read++),e-=8}while(e>0);return t},a.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return t>=r&&(t-=r<<1),t},a.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},a.ByteStringBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},a.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},a.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},a.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},a.ByteStringBuffer.prototype.copy=function(){var e=a.createBuffer(this.data);return e.read=this.read,e},a.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},a.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},a.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},a.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var r=this.data.charCodeAt(t);r<16&&(e+="0"),e+=r.toString(16)}return e},a.ByteStringBuffer.prototype.toString=function(){return a.decodeUtf8(this.bytes())},a.DataBuffer=function(e,t){t=t||{},this.read=t.readOffset||0,this.growSize=t.growSize||1024;var r=a.isArrayBuffer(e),n=a.isArrayBufferView(e);if(r||n)return this.data=r?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!=e&&this.putBytes(e),"writeOffset"in t&&(this.write=t.writeOffset)},a.DataBuffer.prototype.length=function(){return this.write-this.read},a.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},a.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+t);return n.set(r),this.data=new DataView(n.buffer),this},a.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},a.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var r=0;r<t;++r)this.data.setUint8(e);return this},a.DataBuffer.prototype.putBytes=function(e,t){if(a.isArrayBufferView(e)){var r=(n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).byteLength-n.byteOffset;return this.accommodate(r),new Uint8Array(this.data.buffer,this.write).set(n),this.write+=r,this}if(a.isArrayBuffer(e)){var n=new Uint8Array(e);return this.accommodate(n.byteLength),new Uint8Array(this.data.buffer).set(n,this.write),this.write+=n.byteLength,this}if(e instanceof a.DataBuffer||"object"==typeof e&&"number"==typeof e.read&&"number"==typeof e.write&&a.isArrayBufferView(e.data))return n=new Uint8Array(e.data.byteLength,e.read,e.length()),this.accommodate(n.byteLength),new Uint8Array(e.data.byteLength,this.write).set(n),this.write+=n.byteLength,this;if(e instanceof a.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"==typeof e){var s;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),s=new Uint8Array(this.data.buffer,this.write),this.write+=a.binary.hex.decode(e,s,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),s=new Uint8Array(this.data.buffer,this.write),this.write+=a.binary.base64.decode(e,s,this.write),this;if("utf8"===t&&(e=a.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),s=new Uint8Array(this.data.buffer,this.write),this.write+=a.binary.raw.decode(s),this;if("utf16"===t)return this.accommodate(2*e.length),s=new Uint16Array(this.data.buffer,this.write),this.write+=a.text.utf16.encode(s),this;throw new Error("Invalid encoding: "+t)}throw Error("Invalid parameter: "+e)},a.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},a.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},a.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},a.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},a.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},a.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},a.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},a.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},a.DataBuffer.prototype.putInt=function(e,t){c(t),this.accommodate(t/8);do{t-=8,this.data.setInt8(this.write++,e>>t&255)}while(t>0);return this},a.DataBuffer.prototype.putSignedInt=function(e,t){return c(t),this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},a.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},a.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},a.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},a.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},a.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},a.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},a.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},a.DataBuffer.prototype.getInt=function(e){c(e);var t=0;do{t=(t<<8)+this.data.getInt8(this.read++),e-=8}while(e>0);return t},a.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return t>=r&&(t-=r<<1),t},a.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},a.DataBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},a.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},a.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},a.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},a.DataBuffer.prototype.copy=function(){return new a.DataBuffer(this)},a.DataBuffer.prototype.compact=function(){if(this.read>0){var e=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(e.byteLength);t.set(e),this.data=new DataView(t),this.write-=this.read,this.read=0}return this},a.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},a.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},a.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var r=this.data.getUint8(t);r<16&&(e+="0"),e+=r.toString(16)}return e},a.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if("binary"===(e=e||"utf8")||"raw"===e)return a.binary.raw.encode(t);if("hex"===e)return a.binary.hex.encode(t);if("base64"===e)return a.binary.base64.encode(t);if("utf8"===e)return a.text.utf8.decode(t);if("utf16"===e)return a.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},a.createBuffer=function(e,t){return t=t||"raw",void 0!==e&&"utf8"===t&&(e=a.encodeUtf8(e)),new a.ByteBuffer(e)},a.fillString=function(e,t){for(var r="";t>0;)1&t&&(r+=e),(t>>>=1)>0&&(e+=e);return r},a.xorBytes=function(e,t,r){for(var n="",s="",i="",o=0,a=0;r>0;--r,++o)s=e.charCodeAt(o)^t.charCodeAt(o),a>=10&&(n+=i,i="",a=0),i+=String.fromCharCode(s),++a;return n+i},a.hexToBytes=function(e){var t="",r=0;for(!0&e.length&&(r=1,t+=String.fromCharCode(parseInt(e[0],16)));r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t},a.bytesToHex=function(e){return a.createBuffer(e).toHex()},a.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],d="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";a.encode64=function(e,t){for(var r,n,s,i="",o="",a=0;a<e.length;)r=e.charCodeAt(a++),n=e.charCodeAt(a++),s=e.charCodeAt(a++),i+=h.charAt(r>>2),i+=h.charAt((3&r)<<4|n>>4),isNaN(n)?i+="==":(i+=h.charAt((15&n)<<2|s>>6),i+=isNaN(s)?"=":h.charAt(63&s)),t&&i.length>t&&(o+=i.substr(0,t)+"\r\n",i=i.substr(t));return o+i},a.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,r,n,s,i="",o=0;o<e.length;)t=u[e.charCodeAt(o++)-43],r=u[e.charCodeAt(o++)-43],n=u[e.charCodeAt(o++)-43],s=u[e.charCodeAt(o++)-43],i+=String.fromCharCode(t<<2|r>>4),64!==n&&(i+=String.fromCharCode((15&r)<<4|n>>2),64!==s&&(i+=String.fromCharCode((3&n)<<6|s)));return i},a.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},a.decodeUtf8=function(e){return decodeURIComponent(escape(e))},a.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:o.encode,decode:o.decode}},a.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},a.binary.raw.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(e.length));for(var s=r=r||0,i=0;i<e.length;++i)n[s++]=e.charCodeAt(i);return t?s-r:n},a.binary.hex.encode=a.bytesToHex,a.binary.hex.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(Math.ceil(e.length/2)));var s=0,i=r=r||0;for(1&e.length&&(s=1,n[i++]=parseInt(e[0],16));s<e.length;s+=2)n[i++]=parseInt(e.substr(s,2),16);return t?i-r:n},a.binary.base64.encode=function(e,t){for(var r,n,s,i="",o="",a=0;a<e.byteLength;)r=e[a++],n=e[a++],s=e[a++],i+=h.charAt(r>>2),i+=h.charAt((3&r)<<4|n>>4),isNaN(n)?i+="==":(i+=h.charAt((15&n)<<2|s>>6),i+=isNaN(s)?"=":h.charAt(63&s)),t&&i.length>t&&(o+=i.substr(0,t)+"\r\n",i=i.substr(t));return o+i},a.binary.base64.decode=function(e,t,r){var n,s,i,o,a=t;a||(a=new Uint8Array(3*Math.ceil(e.length/4))),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var c=0,l=r=r||0;c<e.length;)n=u[e.charCodeAt(c++)-43],s=u[e.charCodeAt(c++)-43],i=u[e.charCodeAt(c++)-43],o=u[e.charCodeAt(c++)-43],a[l++]=n<<2|s>>4,64!==i&&(a[l++]=(15&s)<<4|i>>2,64!==o&&(a[l++]=(3&i)<<6|o));return t?l-r:a.subarray(0,l)},a.binary.base58.encode=function(e,t){return a.binary.baseN.encode(e,d,t)},a.binary.base58.decode=function(e,t){return a.binary.baseN.decode(e,d,t)},a.text={utf8:{},utf16:{}},a.text.utf8.encode=function(e,t,r){e=a.encodeUtf8(e);var n=t;n||(n=new Uint8Array(e.length));for(var s=r=r||0,i=0;i<e.length;++i)n[s++]=e.charCodeAt(i);return t?s-r:n},a.text.utf8.decode=function(e){return a.decodeUtf8(String.fromCharCode.apply(null,e))},a.text.utf16.encode=function(e,t,r){var n=t;n||(n=new Uint8Array(2*e.length));for(var s=new Uint16Array(n.buffer),i=r=r||0,o=r,a=0;a<e.length;++a)s[o++]=e.charCodeAt(a),i+=2;return t?i-r:n},a.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},a.deflate=function(e,t,r){if(t=a.decode64(e.deflate(a.encode64(t)).rval),r){var n=2;32&t.charCodeAt(1)&&(n=6),t=t.substring(n,t.length-4)}return t},a.inflate=function(e,t,r){var n=e.inflate(a.encode64(t)).rval;return null===n?null:a.decode64(n)};var p=function(e,t,r){if(!e)throw new Error("WebStorage not available.");var n;if(null===r?n=e.removeItem(t):(r=a.encode64(JSON.stringify(r)),n=e.setItem(t,r)),void 0!==n&&!0!==n.rval){var s=new Error(n.error.message);throw s.id=n.error.id,s.name=n.error.name,s}},f=function(e,t){if(!e)throw new Error("WebStorage not available.");var r=e.getItem(t);if(e.init)if(null===r.rval){if(r.error){var n=new Error(r.error.message);throw n.id=r.error.id,n.name=r.error.name,n}r=null}else r=r.rval;return null!==r&&(r=JSON.parse(a.decode64(r))),r},y=function(e,t,r,n){var s=f(e,t);null===s&&(s={}),s[r]=n,p(e,t,s)},g=function(e,t,r){var n=f(e,t);return null!==n&&(n=r in n?n[r]:null),n},m=function(e,t,r){var n=f(e,t);if(null!==n&&r in n){delete n[r];var s=!0;for(var i in n){s=!1;break}s&&(n=null),p(e,t,n)}},w=function(e,t){p(e,t,null)},b=function(e,t,r){var n,s=null;void 0===r&&(r=["web","flash"]);var i=!1,o=null;for(var a in r){n=r[a];try{if("flash"===n||"both"===n){if(null===t[0])throw new Error("Flash local storage not available.");s=e.apply(this,t),i="flash"===n}"web"!==n&&"both"!==n||(t[0]=localStorage,s=e.apply(this,t),i=!0)}catch(e){o=e}if(i)break}if(!i)throw o;return s};a.setItem=function(e,t,r,n,s){b(y,arguments,s)},a.getItem=function(e,t,r,n){return b(g,arguments,n)},a.removeItem=function(e,t,r,n){b(m,arguments,n)},a.clearItems=function(e,t,r){b(w,arguments,r)},a.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},a.format=function(e){for(var t,r,n=/%./g,s=0,i=[],o=0;t=n.exec(e);){(r=e.substring(o,n.lastIndex-2)).length>0&&i.push(r),o=n.lastIndex;var a=t[0][1];switch(a){case"s":case"o":s<arguments.length?i.push(arguments[1+s++]):i.push("<?>");break;case"%":i.push("%");break;default:i.push("<%"+a+"?>")}}return i.push(e.substring(o)),i.join("")},a.formatNumber=function(e,t,r,n){var s=e,i=isNaN(t=Math.abs(t))?2:t,o=void 0===r?",":r,a=void 0===n?".":n,c=s<0?"-":"",l=parseInt(s=Math.abs(+s||0).toFixed(i),10)+"",h=l.length>3?l.length%3:0;return c+(h?l.substr(0,h)+a:"")+l.substr(h).replace(/(\d{3})(?=\d)/g,"$1"+a)+(i?o+Math.abs(s-l).toFixed(i).slice(2):"")},a.formatSize=function(e){return e>=1073741824?a.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?a.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?a.formatNumber(e/1024,0)+" KiB":a.formatNumber(e,0)+" bytes"},a.bytesFromIP=function(e){return-1!==e.indexOf(".")?a.bytesFromIPv4(e):-1!==e.indexOf(":")?a.bytesFromIPv6(e):null},a.bytesFromIPv4=function(e){if(4!==(e=e.split(".")).length)return null;for(var t=a.createBuffer(),r=0;r<e.length;++r){var n=parseInt(e[r],10);if(isNaN(n))return null;t.putByte(n)}return t.getBytes()},a.bytesFromIPv6=function(e){for(var t=0,r=2*(8-(e=e.split(":").filter((function(e){return 0===e.length&&++t,!0}))).length+t),n=a.createBuffer(),s=0;s<8;++s)if(e[s]&&0!==e[s].length){var i=a.hexToBytes(e[s]);i.length<2&&n.putByte(0),n.putBytes(i)}else n.fillWithByte(0,r),r=0;return n.getBytes()},a.bytesToIP=function(e){return 4===e.length?a.bytesToIPv4(e):16===e.length?a.bytesToIPv6(e):null},a.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t.join(".")},a.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t=[],r=[],n=0,s=0;s<e.length;s+=2){for(var i=a.bytesToHex(e[s]+e[s+1]);"0"===i[0]&&"0"!==i;)i=i.substr(1);if("0"===i){var o=r[r.length-1],c=t.length;o&&c===o.end+1?(o.end=c,o.end-o.start>r[n].end-r[n].start&&(n=r.length-1)):r.push({start:c,end:c})}t.push(i)}if(r.length>0){var l=r[n];l.end-l.start>0&&(t.splice(l.start,l.end-l.start+1,""),0===l.start&&t.unshift(""),7===l.end&&t.push(""))}return t.join(":")},a.estimateCores=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},"cores"in a&&!e.update)return t(null,a.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return a.cores=navigator.hardwareConcurrency,t(null,a.cores);if("undefined"==typeof Worker)return a.cores=1,t(null,a.cores);if("undefined"==typeof Blob)return a.cores=2,t(null,a.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",(function(e){for(var t=Date.now(),r=t+4;Date.now()<r;);self.postMessage({st:t,et:r})}))}.toString(),")()"],{type:"application/javascript"}));!function e(n,s,i){if(0===s){var o=Math.floor(n.reduce((function(e,t){return e+t}),0)/n.length);return a.cores=Math.max(1,o),URL.revokeObjectURL(r),t(null,a.cores)}!function(e,t){for(var n=[],s=[],i=0;i<e;++i){var o=new Worker(r);o.addEventListener("message",(function(r){if(s.push(r.data),s.length===e){for(var i=0;i<e;++i)n[i].terminate();t(0,s)}})),n.push(o)}for(i=0;i<e;++i)n[i].postMessage(i)}(i,(function(t,r){n.push(function(e,t){for(var r=[],n=0;n<e;++n)for(var s=t[n],i=r[n]=[],o=0;o<e;++o)if(n!==o){var a=t[o];(s.st>a.st&&s.st<a.et||a.st>s.st&&a.st<s.et)&&i.push(o)}return r.reduce((function(e,t){return Math.max(e,t.length)}),0)}(i,r)),e(n,s-1,i)}))}([],5,16)}},41486:(e,t,r)=>{var n=r(72900);r(35564),r(69522),r(9891),r(20119),r(45256),r(8579),r(44129),r(48590),r(83635),r(33229);var s=n.asn1,i=e.exports=n.pki=n.pki||{},o=i.oids,a={};a.CN=o.commonName,a.commonName="CN",a.C=o.countryName,a.countryName="C",a.L=o.localityName,a.localityName="L",a.ST=o.stateOrProvinceName,a.stateOrProvinceName="ST",a.O=o.organizationName,a.organizationName="O",a.OU=o.organizationalUnitName,a.organizationalUnitName="OU",a.E=o.emailAddress,a.emailAddress="E";var c=n.pki.rsa.publicKeyValidator,l={name:"Certificate",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:s.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:s.Class.UNIVERSAL,type:s.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:s.Class.UNIVERSAL,type:s.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:s.Class.UNIVERSAL,type:s.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:s.Class.UNIVERSAL,type:s.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},c,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:s.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:s.Class.UNIVERSAL,type:s.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:s.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:s.Class.UNIVERSAL,type:s.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:s.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:s.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:s.Class.UNIVERSAL,type:s.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},h={name:"rsapss",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:s.Class.UNIVERSAL,type:s.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:s.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:s.Class.UNIVERSAL,type:s.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:s.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:s.Class.UNIVERSAL,type:s.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:s.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:s.Class.UNIVERSAL,type:s.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},u={name:"CertificationRequestInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},c,{name:"CertificationRequestInfo.attributes",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:s.Class.UNIVERSAL,type:s.Type.SET,constructed:!0}]}]}]},d={name:"CertificationRequest",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[u,{name:"CertificationRequest.signatureAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:s.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:s.Class.UNIVERSAL,type:s.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};function p(e,t){"string"==typeof t&&(t={shortName:t});for(var r,n=null,s=0;null===n&&s<e.attributes.length;++s)r=e.attributes[s],(t.type&&t.type===r.type||t.name&&t.name===r.name||t.shortName&&t.shortName===r.shortName)&&(n=r);return n}i.RDNAttributesAsArray=function(e,t){for(var r,n,i,c=[],l=0;l<e.value.length;++l){r=e.value[l];for(var h=0;h<r.value.length;++h)i={},n=r.value[h],i.type=s.derToOid(n.value[0].value),i.value=n.value[1].value,i.valueTagClass=n.value[1].type,i.type in o&&(i.name=o[i.type],i.name in a&&(i.shortName=a[i.name])),t&&(t.update(i.type),t.update(i.value)),c.push(i)}return c},i.CRIAttributesAsArray=function(e){for(var t=[],r=0;r<e.length;++r)for(var n=e[r],c=s.derToOid(n.value[0].value),l=n.value[1].value,h=0;h<l.length;++h){var u={};if(u.type=c,u.value=l[h].value,u.valueTagClass=l[h].type,u.type in o&&(u.name=o[u.type],u.name in a&&(u.shortName=a[u.name])),u.type===o.extensionRequest){u.extensions=[];for(var d=0;d<u.value.length;++d)u.extensions.push(i.certificateExtensionFromAsn1(u.value[d]))}t.push(u)}return t};var f=function(e,t,r){var n={};if(e!==o["RSASSA-PSS"])return n;r&&(n={hash:{algorithmOid:o.sha1},mgf:{algorithmOid:o.mgf1,hash:{algorithmOid:o.sha1}},saltLength:20});var i={},a=[];if(!s.validate(t,h,i,a)){var c=new Error("Cannot read RSASSA-PSS parameter block.");throw c.errors=a,c}return void 0!==i.hashOid&&(n.hash=n.hash||{},n.hash.algorithmOid=s.derToOid(i.hashOid)),void 0!==i.maskGenOid&&(n.mgf=n.mgf||{},n.mgf.algorithmOid=s.derToOid(i.maskGenOid),n.mgf.hash=n.mgf.hash||{},n.mgf.hash.algorithmOid=s.derToOid(i.maskGenHashOid)),void 0!==i.saltLength&&(n.saltLength=i.saltLength.charCodeAt(0)),n},y=function(e){switch(o[e.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return n.md.sha1.create();case"md5WithRSAEncryption":return n.md.md5.create();case"sha256WithRSAEncryption":case"RSASSA-PSS":return n.md.sha256.create();case"sha384WithRSAEncryption":return n.md.sha384.create();case"sha512WithRSAEncryption":return n.md.sha512.create();default:var t=new Error("Could not compute "+e.type+" digest. Unknown signature OID.");throw t.signatureOid=e.signatureOid,t}},g=function(e){var t,r=e.certificate;switch(r.signatureOid){case o.sha1WithRSAEncryption:case o.sha1WithRSASignature:break;case o["RSASSA-PSS"]:var s,i,a;if(void 0===(s=o[r.signatureParameters.mgf.hash.algorithmOid])||void 0===n.md[s])throw(a=new Error("Unsupported MGF hash function.")).oid=r.signatureParameters.mgf.hash.algorithmOid,a.name=s,a;if(void 0===(i=o[r.signatureParameters.mgf.algorithmOid])||void 0===n.mgf[i])throw(a=new Error("Unsupported MGF function.")).oid=r.signatureParameters.mgf.algorithmOid,a.name=i,a;if(i=n.mgf[i].create(n.md[s].create()),void 0===(s=o[r.signatureParameters.hash.algorithmOid])||void 0===n.md[s])throw(a=new Error("Unsupported RSASSA-PSS hash function.")).oid=r.signatureParameters.hash.algorithmOid,a.name=s,a;t=n.pss.create(n.md[s].create(),i,r.signatureParameters.saltLength)}return r.publicKey.verify(e.md.digest().getBytes(),e.signature,t)};function m(e){for(var t,r,i=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]),o=e.attributes,a=0;a<o.length;++a){var c=(t=o[a]).value,l=s.Type.PRINTABLESTRING;"valueTagClass"in t&&(l=t.valueTagClass)===s.Type.UTF8&&(c=n.util.encodeUtf8(c)),r=s.create(s.Class.UNIVERSAL,s.Type.SET,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(t.type).getBytes()),s.create(s.Class.UNIVERSAL,l,!1,c)])]),i.value.push(r)}return i}function w(e){for(var t,r=0;r<e.length;++r){if(void 0===(t=e[r]).name&&(t.type&&t.type in i.oids?t.name=i.oids[t.type]:t.shortName&&t.shortName in a&&(t.name=i.oids[a[t.shortName]])),void 0===t.type){if(!t.name||!(t.name in i.oids))throw(c=new Error("Attribute type not specified.")).attribute=t,c;t.type=i.oids[t.name]}if(void 0===t.shortName&&t.name&&t.name in a&&(t.shortName=a[t.name]),t.type===o.extensionRequest&&(t.valueConstructed=!0,t.valueTagClass=s.Type.SEQUENCE,!t.value&&t.extensions)){t.value=[];for(var n=0;n<t.extensions.length;++n)t.value.push(i.certificateExtensionToAsn1(b(t.extensions[n])))}var c;if(void 0===t.value)throw(c=new Error("Attribute value not specified.")).attribute=t,c}}function b(e,t){if(t=t||{},void 0===e.name&&e.id&&e.id in i.oids&&(e.name=i.oids[e.id]),void 0===e.id){if(!e.name||!(e.name in i.oids))throw(E=new Error("Extension ID not specified.")).extension=e,E;e.id=i.oids[e.name]}if(void 0!==e.value)return e;if("keyUsage"===e.name){var r=0,a=0,c=0;e.digitalSignature&&(a|=128,r=7),e.nonRepudiation&&(a|=64,r=6),e.keyEncipherment&&(a|=32,r=5),e.dataEncipherment&&(a|=16,r=4),e.keyAgreement&&(a|=8,r=3),e.keyCertSign&&(a|=4,r=2),e.cRLSign&&(a|=2,r=1),e.encipherOnly&&(a|=1,r=0),e.decipherOnly&&(c|=128,r=7);var l=String.fromCharCode(r);0!==c?l+=String.fromCharCode(a)+String.fromCharCode(c):0!==a&&(l+=String.fromCharCode(a)),e.value=s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,l)}else if("basicConstraints"===e.name)e.value=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]),e.cA&&e.value.value.push(s.create(s.Class.UNIVERSAL,s.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in e&&e.value.value.push(s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.pathLenConstraint).getBytes()));else if("extKeyUsage"===e.name){e.value=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);var h=e.value.value;for(var u in e)!0===e[u]&&(u in o?h.push(s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o[u]).getBytes())):-1!==u.indexOf(".")&&h.push(s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(u).getBytes())))}else if("nsCertType"===e.name)r=0,a=0,e.client&&(a|=128,r=7),e.server&&(a|=64,r=6),e.email&&(a|=32,r=5),e.objsign&&(a|=16,r=4),e.reserved&&(a|=8,r=3),e.sslCA&&(a|=4,r=2),e.emailCA&&(a|=2,r=1),e.objCA&&(a|=1,r=0),l=String.fromCharCode(r),0!==a&&(l+=String.fromCharCode(a)),e.value=s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,l);else if("subjectAltName"===e.name||"issuerAltName"===e.name){e.value=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);for(var d=0;d<e.altNames.length;++d){if(l=(w=e.altNames[d]).value,7===w.type&&w.ip){if(null===(l=n.util.bytesFromIP(w.ip)))throw(E=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,E}else 8===w.type&&(l=w.oid?s.oidToDer(s.oidToDer(w.oid)):s.oidToDer(l));e.value.value.push(s.create(s.Class.CONTEXT_SPECIFIC,w.type,!1,l))}}else if("nsComment"===e.name&&t.cert){if(!/^[\x00-\x7F]*$/.test(e.comment)||e.comment.length<1||e.comment.length>128)throw new Error('Invalid "nsComment" content.');e.value=s.create(s.Class.UNIVERSAL,s.Type.IA5STRING,!1,e.comment)}else if("subjectKeyIdentifier"===e.name&&t.cert){var p=t.cert.generateSubjectKeyIdentifier();e.subjectKeyIdentifier=p.toHex(),e.value=s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,p.getBytes())}else if("authorityKeyIdentifier"===e.name&&t.cert){if(e.value=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]),h=e.value.value,e.keyIdentifier){var f=!0===e.keyIdentifier?t.cert.generateSubjectKeyIdentifier().getBytes():e.keyIdentifier;h.push(s.create(s.Class.CONTEXT_SPECIFIC,0,!1,f))}if(e.authorityCertIssuer){var y=[s.create(s.Class.CONTEXT_SPECIFIC,4,!0,[m(!0===e.authorityCertIssuer?t.cert.issuer:e.authorityCertIssuer)])];h.push(s.create(s.Class.CONTEXT_SPECIFIC,1,!0,y))}if(e.serialNumber){var g=n.util.hexToBytes(!0===e.serialNumber?t.cert.serialNumber:e.serialNumber);h.push(s.create(s.Class.CONTEXT_SPECIFIC,2,!1,g))}}else if("cRLDistributionPoints"===e.name){e.value=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]),h=e.value.value;var w,b=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]),v=s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[]);for(d=0;d<e.altNames.length;++d){if(l=(w=e.altNames[d]).value,7===w.type&&w.ip){if(null===(l=n.util.bytesFromIP(w.ip)))throw(E=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,E}else 8===w.type&&(l=w.oid?s.oidToDer(s.oidToDer(w.oid)):s.oidToDer(l));v.value.push(s.create(s.Class.CONTEXT_SPECIFIC,w.type,!1,l))}b.value.push(s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[v])),h.push(b)}var E;if(void 0===e.value)throw(E=new Error("Extension value not specified.")).extension=e,E;return e}function v(e,t){if(e===o["RSASSA-PSS"]){var r=[];return void 0!==t.hash.algorithmOid&&r.push(s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(t.hash.algorithmOid).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")])])),void 0!==t.mgf.algorithmOid&&r.push(s.create(s.Class.CONTEXT_SPECIFIC,1,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(t.mgf.algorithmOid).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(t.mgf.hash.algorithmOid).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")])])])),void 0!==t.saltLength&&r.push(s.create(s.Class.CONTEXT_SPECIFIC,2,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(t.saltLength).getBytes())])),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,r)}return s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")}function E(e){var t=s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===e.attributes.length)return t;for(var r=e.attributes,i=0;i<r.length;++i){var o=r[i],a=o.value,c=s.Type.UTF8;"valueTagClass"in o&&(c=o.valueTagClass),c===s.Type.UTF8&&(a=n.util.encodeUtf8(a));var l=!1;"valueConstructed"in o&&(l=o.valueConstructed);var h=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.type).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SET,!0,[s.create(s.Class.UNIVERSAL,c,l,a)])]);t.value.push(h)}return t}i.certificateFromPem=function(e,t,r){var o=n.pem.decode(e)[0];if("CERTIFICATE"!==o.type&&"X509 CERTIFICATE"!==o.type&&"TRUSTED CERTIFICATE"!==o.type){var a=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw a.headerType=o.type,a}if(o.procType&&"ENCRYPTED"===o.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var c=s.fromDer(o.body,r);return i.certificateFromAsn1(c,t)},i.certificateToPem=function(e,t){var r={type:"CERTIFICATE",body:s.toDer(i.certificateToAsn1(e)).getBytes()};return n.pem.encode(r,{maxline:t})},i.publicKeyFromPem=function(e){var t=n.pem.decode(e)[0];if("PUBLIC KEY"!==t.type&&"RSA PUBLIC KEY"!==t.type){var r=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");var o=s.fromDer(t.body);return i.publicKeyFromAsn1(o)},i.publicKeyToPem=function(e,t){var r={type:"PUBLIC KEY",body:s.toDer(i.publicKeyToAsn1(e)).getBytes()};return n.pem.encode(r,{maxline:t})},i.publicKeyToRSAPublicKeyPem=function(e,t){var r={type:"RSA PUBLIC KEY",body:s.toDer(i.publicKeyToRSAPublicKey(e)).getBytes()};return n.pem.encode(r,{maxline:t})},i.getPublicKeyFingerprint=function(e,t){var r,o=(t=t||{}).md||n.md.sha1.create();switch(t.type||"RSAPublicKey"){case"RSAPublicKey":r=s.toDer(i.publicKeyToRSAPublicKey(e)).getBytes();break;case"SubjectPublicKeyInfo":r=s.toDer(i.publicKeyToAsn1(e)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+t.type+'".')}o.start(),o.update(r);var a=o.digest();if("hex"===t.encoding){var c=a.toHex();return t.delimiter?c.match(/.{2}/g).join(t.delimiter):c}if("binary"===t.encoding)return a.getBytes();if(t.encoding)throw new Error('Unknown encoding "'+t.encoding+'".');return a},i.certificationRequestFromPem=function(e,t,r){var o=n.pem.decode(e)[0];if("CERTIFICATE REQUEST"!==o.type){var a=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw a.headerType=o.type,a}if(o.procType&&"ENCRYPTED"===o.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var c=s.fromDer(o.body,r);return i.certificationRequestFromAsn1(c,t)},i.certificationRequestToPem=function(e,t){var r={type:"CERTIFICATE REQUEST",body:s.toDer(i.certificationRequestToAsn1(e)).getBytes()};return n.pem.encode(r,{maxline:t})},i.createCertificate=function(){var e={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.validity={},e.validity.notBefore=new Date,e.validity.notAfter=new Date,e.issuer={},e.issuer.getField=function(t){return p(e.issuer,t)},e.issuer.addField=function(t){w([t]),e.issuer.attributes.push(t)},e.issuer.attributes=[],e.issuer.hash=null,e.subject={},e.subject.getField=function(t){return p(e.subject,t)},e.subject.addField=function(t){w([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.extensions=[],e.publicKey=null,e.md=null,e.setSubject=function(t,r){w(t),e.subject.attributes=t,delete e.subject.uniqueId,r&&(e.subject.uniqueId=r),e.subject.hash=null},e.setIssuer=function(t,r){w(t),e.issuer.attributes=t,delete e.issuer.uniqueId,r&&(e.issuer.uniqueId=r),e.issuer.hash=null},e.setExtensions=function(t){for(var r=0;r<t.length;++r)b(t[r],{cert:e});e.extensions=t},e.getExtension=function(t){"string"==typeof t&&(t={name:t});for(var r,n=null,s=0;null===n&&s<e.extensions.length;++s)r=e.extensions[s],(t.id&&r.id===t.id||t.name&&r.name===t.name)&&(n=r);return n},e.sign=function(t,r){e.md=r||n.md.sha1.create();var a=o[e.md.algorithm+"WithRSAEncryption"];if(!a){var c=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw c.algorithm=e.md.algorithm,c}e.signatureOid=e.siginfo.algorithmOid=a,e.tbsCertificate=i.getTBSCertificate(e);var l=s.toDer(e.tbsCertificate);e.md.update(l.getBytes()),e.signature=t.sign(e.md)},e.verify=function(t){var r=!1;if(!e.issued(t)){var n=t.issuer,o=e.subject,a=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw a.expectedIssuer=o.attributes,a.actualIssuer=n.attributes,a}var c=t.md;if(null===c){c=y({signatureOid:t.signatureOid,type:"certificate"});var l=t.tbsCertificate||i.getTBSCertificate(t),h=s.toDer(l);c.update(h.getBytes())}return null!==c&&(r=g({certificate:e,md:c,signature:t.signature})),r},e.isIssuer=function(t){var r=!1,n=e.issuer,s=t.subject;if(n.hash&&s.hash)r=n.hash===s.hash;else if(n.attributes.length===s.attributes.length){var i,o;r=!0;for(var a=0;r&&a<n.attributes.length;++a)i=n.attributes[a],o=s.attributes[a],i.type===o.type&&i.value===o.value||(r=!1)}return r},e.issued=function(t){return t.isIssuer(e)},e.generateSubjectKeyIdentifier=function(){return i.getPublicKeyFingerprint(e.publicKey,{type:"RSAPublicKey"})},e.verifySubjectKeyIdentifier=function(){for(var t=o.subjectKeyIdentifier,r=0;r<e.extensions.length;++r){var s=e.extensions[r];if(s.id===t){var i=e.generateSubjectKeyIdentifier().getBytes();return n.util.hexToBytes(s.subjectKeyIdentifier)===i}}return!1},e},i.certificateFromAsn1=function(e,t){var r={},o=[];if(!s.validate(e,l,r,o)){var a=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw a.errors=o,a}if(s.derToOid(r.publicKeyOid)!==i.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var c=i.createCertificate();c.version=r.certVersion?r.certVersion.charCodeAt(0):0;var h=n.util.createBuffer(r.certSerialNumber);c.serialNumber=h.toHex(),c.signatureOid=n.asn1.derToOid(r.certSignatureOid),c.signatureParameters=f(c.signatureOid,r.certSignatureParams,!0),c.siginfo.algorithmOid=n.asn1.derToOid(r.certinfoSignatureOid),c.siginfo.parameters=f(c.siginfo.algorithmOid,r.certinfoSignatureParams,!1),c.signature=r.certSignature;var u=[];if(void 0!==r.certValidity1UTCTime&&u.push(s.utcTimeToDate(r.certValidity1UTCTime)),void 0!==r.certValidity2GeneralizedTime&&u.push(s.generalizedTimeToDate(r.certValidity2GeneralizedTime)),void 0!==r.certValidity3UTCTime&&u.push(s.utcTimeToDate(r.certValidity3UTCTime)),void 0!==r.certValidity4GeneralizedTime&&u.push(s.generalizedTimeToDate(r.certValidity4GeneralizedTime)),u.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(u.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(c.validity.notBefore=u[0],c.validity.notAfter=u[1],c.tbsCertificate=r.tbsCertificate,t){c.md=y({signatureOid:c.signatureOid,type:"certificate"});var d=s.toDer(c.tbsCertificate);c.md.update(d.getBytes())}var g=n.md.sha1.create(),m=s.toDer(r.certIssuer);g.update(m.getBytes()),c.issuer.getField=function(e){return p(c.issuer,e)},c.issuer.addField=function(e){w([e]),c.issuer.attributes.push(e)},c.issuer.attributes=i.RDNAttributesAsArray(r.certIssuer),r.certIssuerUniqueId&&(c.issuer.uniqueId=r.certIssuerUniqueId),c.issuer.hash=g.digest().toHex();var b=n.md.sha1.create(),v=s.toDer(r.certSubject);return b.update(v.getBytes()),c.subject.getField=function(e){return p(c.subject,e)},c.subject.addField=function(e){w([e]),c.subject.attributes.push(e)},c.subject.attributes=i.RDNAttributesAsArray(r.certSubject),r.certSubjectUniqueId&&(c.subject.uniqueId=r.certSubjectUniqueId),c.subject.hash=b.digest().toHex(),r.certExtensions?c.extensions=i.certificateExtensionsFromAsn1(r.certExtensions):c.extensions=[],c.publicKey=i.publicKeyFromAsn1(r.subjectPublicKeyInfo),c},i.certificateExtensionsFromAsn1=function(e){for(var t=[],r=0;r<e.value.length;++r)for(var n=e.value[r],s=0;s<n.value.length;++s)t.push(i.certificateExtensionFromAsn1(n.value[s]));return t},i.certificateExtensionFromAsn1=function(e){var t={};if(t.id=s.derToOid(e.value[0].value),t.critical=!1,e.value[1].type===s.Type.BOOLEAN?(t.critical=0!==e.value[1].value.charCodeAt(0),t.value=e.value[2].value):t.value=e.value[1].value,t.id in o)if(t.name=o[t.id],"keyUsage"===t.name){var r=0,i=0;(c=s.fromDer(t.value)).value.length>1&&(r=c.value.charCodeAt(1),i=c.value.length>2?c.value.charCodeAt(2):0),t.digitalSignature=128==(128&r),t.nonRepudiation=64==(64&r),t.keyEncipherment=32==(32&r),t.dataEncipherment=16==(16&r),t.keyAgreement=8==(8&r),t.keyCertSign=4==(4&r),t.cRLSign=2==(2&r),t.encipherOnly=1==(1&r),t.decipherOnly=128==(128&i)}else if("basicConstraints"===t.name){(c=s.fromDer(t.value)).value.length>0&&c.value[0].type===s.Type.BOOLEAN?t.cA=0!==c.value[0].value.charCodeAt(0):t.cA=!1;var a=null;c.value.length>0&&c.value[0].type===s.Type.INTEGER?a=c.value[0].value:c.value.length>1&&(a=c.value[1].value),null!==a&&(t.pathLenConstraint=s.derToInteger(a))}else if("extKeyUsage"===t.name)for(var c=s.fromDer(t.value),l=0;l<c.value.length;++l){var h=s.derToOid(c.value[l].value);h in o?t[o[h]]=!0:t[h]=!0}else if("nsCertType"===t.name)r=0,(c=s.fromDer(t.value)).value.length>1&&(r=c.value.charCodeAt(1)),t.client=128==(128&r),t.server=64==(64&r),t.email=32==(32&r),t.objsign=16==(16&r),t.reserved=8==(8&r),t.sslCA=4==(4&r),t.emailCA=2==(2&r),t.objCA=1==(1&r);else if("subjectAltName"===t.name||"issuerAltName"===t.name){var u;t.altNames=[],c=s.fromDer(t.value);for(var d=0;d<c.value.length;++d){var p={type:(u=c.value[d]).type,value:u.value};switch(t.altNames.push(p),u.type){case 1:case 2:case 6:break;case 7:p.ip=n.util.bytesToIP(u.value);break;case 8:p.oid=s.derToOid(u.value)}}}else"subjectKeyIdentifier"===t.name&&(c=s.fromDer(t.value),t.subjectKeyIdentifier=n.util.bytesToHex(c.value));return t},i.certificationRequestFromAsn1=function(e,t){var r={},o=[];if(!s.validate(e,d,r,o)){var a=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw a.errors=o,a}if(s.derToOid(r.publicKeyOid)!==i.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var c=i.createCertificationRequest();if(c.version=r.csrVersion?r.csrVersion.charCodeAt(0):0,c.signatureOid=n.asn1.derToOid(r.csrSignatureOid),c.signatureParameters=f(c.signatureOid,r.csrSignatureParams,!0),c.siginfo.algorithmOid=n.asn1.derToOid(r.csrSignatureOid),c.siginfo.parameters=f(c.siginfo.algorithmOid,r.csrSignatureParams,!1),c.signature=r.csrSignature,c.certificationRequestInfo=r.certificationRequestInfo,t){c.md=y({signatureOid:c.signatureOid,type:"certification request"});var l=s.toDer(c.certificationRequestInfo);c.md.update(l.getBytes())}var h=n.md.sha1.create();return c.subject.getField=function(e){return p(c.subject,e)},c.subject.addField=function(e){w([e]),c.subject.attributes.push(e)},c.subject.attributes=i.RDNAttributesAsArray(r.certificationRequestInfoSubject,h),c.subject.hash=h.digest().toHex(),c.publicKey=i.publicKeyFromAsn1(r.subjectPublicKeyInfo),c.getAttribute=function(e){return p(c,e)},c.addAttribute=function(e){w([e]),c.attributes.push(e)},c.attributes=i.CRIAttributesAsArray(r.certificationRequestInfoAttributes||[]),c},i.createCertificationRequest=function(){var e={version:0,signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.subject={},e.subject.getField=function(t){return p(e.subject,t)},e.subject.addField=function(t){w([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.publicKey=null,e.attributes=[],e.getAttribute=function(t){return p(e,t)},e.addAttribute=function(t){w([t]),e.attributes.push(t)},e.md=null,e.setSubject=function(t){w(t),e.subject.attributes=t,e.subject.hash=null},e.setAttributes=function(t){w(t),e.attributes=t},e.sign=function(t,r){e.md=r||n.md.sha1.create();var a=o[e.md.algorithm+"WithRSAEncryption"];if(!a){var c=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw c.algorithm=e.md.algorithm,c}e.signatureOid=e.siginfo.algorithmOid=a,e.certificationRequestInfo=i.getCertificationRequestInfo(e);var l=s.toDer(e.certificationRequestInfo);e.md.update(l.getBytes()),e.signature=t.sign(e.md)},e.verify=function(){var t=!1,r=e.md;if(null===r){r=y({signatureOid:e.signatureOid,type:"certification request"});var n=e.certificationRequestInfo||i.getCertificationRequestInfo(e),o=s.toDer(n);r.update(o.getBytes())}return null!==r&&(t=g({certificate:e,md:r,signature:e.signature})),t},e};var _=new Date("1950-01-01T00:00:00Z"),S=new Date("2050-01-01T00:00:00Z");function A(e){return e>=_&&e<S?s.create(s.Class.UNIVERSAL,s.Type.UTCTIME,!1,s.dateToUtcTime(e)):s.create(s.Class.UNIVERSAL,s.Type.GENERALIZEDTIME,!1,s.dateToGeneralizedTime(e))}i.getTBSCertificate=function(e){var t=A(e.validity.notBefore),r=A(e.validity.notAfter),o=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.version).getBytes())]),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,n.util.hexToBytes(e.serialNumber)),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.siginfo.algorithmOid).getBytes()),v(e.siginfo.algorithmOid,e.siginfo.parameters)]),m(e.issuer),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[t,r]),m(e.subject),i.publicKeyToAsn1(e.publicKey)]);return e.issuer.uniqueId&&o.value.push(s.create(s.Class.CONTEXT_SPECIFIC,1,!0,[s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,String.fromCharCode(0)+e.issuer.uniqueId)])),e.subject.uniqueId&&o.value.push(s.create(s.Class.CONTEXT_SPECIFIC,2,!0,[s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,String.fromCharCode(0)+e.subject.uniqueId)])),e.extensions.length>0&&o.value.push(i.certificateExtensionsToAsn1(e.extensions)),o},i.getCertificationRequestInfo=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.version).getBytes()),m(e.subject),i.publicKeyToAsn1(e.publicKey),E(e)])},i.distinguishedNameToAsn1=function(e){return m(e)},i.certificateToAsn1=function(e){var t=e.tbsCertificate||i.getTBSCertificate(e);return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[t,s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.signatureOid).getBytes()),v(e.signatureOid,e.signatureParameters)]),s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},i.certificateExtensionsToAsn1=function(e){var t=s.create(s.Class.CONTEXT_SPECIFIC,3,!0,[]),r=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);t.value.push(r);for(var n=0;n<e.length;++n)r.value.push(i.certificateExtensionToAsn1(e[n]));return t},i.certificateExtensionToAsn1=function(e){var t=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);t.value.push(s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.id).getBytes())),e.critical&&t.value.push(s.create(s.Class.UNIVERSAL,s.Type.BOOLEAN,!1,String.fromCharCode(255)));var r=e.value;return"string"!=typeof e.value&&(r=s.toDer(r).getBytes()),t.value.push(s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,r)),t},i.certificationRequestToAsn1=function(e){var t=e.certificationRequestInfo||i.getCertificationRequestInfo(e);return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[t,s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.signatureOid).getBytes()),v(e.signatureOid,e.signatureParameters)]),s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},i.createCaStore=function(e){var t={certs:{}};function r(e){return o(e),t.certs[e.hash]||null}function o(e){if(!e.hash){var t=n.md.sha1.create();e.attributes=i.RDNAttributesAsArray(m(e),t),e.hash=t.digest().toHex()}}if(t.getIssuer=function(e){return r(e.issuer)},t.addCertificate=function(e){if("string"==typeof e&&(e=n.pki.certificateFromPem(e)),o(e.subject),!t.hasCertificate(e))if(e.subject.hash in t.certs){var r=t.certs[e.subject.hash];n.util.isArray(r)||(r=[r]),r.push(e),t.certs[e.subject.hash]=r}else t.certs[e.subject.hash]=e},t.hasCertificate=function(e){"string"==typeof e&&(e=n.pki.certificateFromPem(e));var t=r(e.subject);if(!t)return!1;n.util.isArray(t)||(t=[t]);for(var o=s.toDer(i.certificateToAsn1(e)).getBytes(),a=0;a<t.length;++a)if(o===s.toDer(i.certificateToAsn1(t[a])).getBytes())return!0;return!1},t.listAllCertificates=function(){var e=[];for(var r in t.certs)if(t.certs.hasOwnProperty(r)){var s=t.certs[r];if(n.util.isArray(s))for(var i=0;i<s.length;++i)e.push(s[i]);else e.push(s)}return e},t.removeCertificate=function(e){var a;if("string"==typeof e&&(e=n.pki.certificateFromPem(e)),o(e.subject),!t.hasCertificate(e))return null;var c=r(e.subject);if(!n.util.isArray(c))return a=t.certs[e.subject.hash],delete t.certs[e.subject.hash],a;for(var l=s.toDer(i.certificateToAsn1(e)).getBytes(),h=0;h<c.length;++h)l===s.toDer(i.certificateToAsn1(c[h])).getBytes()&&(a=c[h],c.splice(h,1));return 0===c.length&&delete t.certs[e.subject.hash],a},e)for(var a=0;a<e.length;++a){var c=e[a];t.addCertificate(c)}return t},i.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},i.verifyCertificateChain=function(e,t,r){"function"==typeof r&&(r={verify:r}),r=r||{};var s=(t=t.slice(0)).slice(0),o=r.validityCheckDate;void 0===o&&(o=new Date);var a=!0,c=null,l=0;do{var h=t.shift(),u=null,d=!1;if(o&&(o<h.validity.notBefore||o>h.validity.notAfter)&&(c={message:"Certificate is not valid yet or has expired.",error:i.certificateError.certificate_expired,notBefore:h.validity.notBefore,notAfter:h.validity.notAfter,now:o}),null===c){if(null===(u=t[0]||e.getIssuer(h))&&h.isIssuer(h)&&(d=!0,u=h),u){var p=u;n.util.isArray(p)||(p=[p]);for(var f=!1;!f&&p.length>0;){u=p.shift();try{f=u.verify(h)}catch(e){}}f||(c={message:"Certificate signature is invalid.",error:i.certificateError.bad_certificate})}null!==c||u&&!d||e.hasCertificate(h)||(c={message:"Certificate is not trusted.",error:i.certificateError.unknown_ca})}if(null===c&&u&&!h.isIssuer(u)&&(c={message:"Certificate issuer is invalid.",error:i.certificateError.bad_certificate}),null===c)for(var y={keyUsage:!0,basicConstraints:!0},g=0;null===c&&g<h.extensions.length;++g){var m=h.extensions[g];m.critical&&!(m.name in y)&&(c={message:"Certificate has an unsupported critical extension.",error:i.certificateError.unsupported_certificate})}if(null===c&&(!a||0===t.length&&(!u||d))){var w=h.getExtension("basicConstraints"),b=h.getExtension("keyUsage");null!==b&&(b.keyCertSign&&null!==w||(c={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:i.certificateError.bad_certificate})),null!==c||null===w||w.cA||(c={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:i.certificateError.bad_certificate}),null===c&&null!==b&&"pathLenConstraint"in w&&l-1>w.pathLenConstraint&&(c={message:"Certificate basicConstraints pathLenConstraint violated.",error:i.certificateError.bad_certificate})}var v=null===c||c.error,E=r.verify?r.verify(v,l,s):v;if(!0!==E)throw!0===v&&(c={message:"The application rejected the certificate.",error:i.certificateError.bad_certificate}),(E||0===E)&&("object"!=typeof E||n.util.isArray(E)?"string"==typeof E&&(c.error=E):(E.message&&(c.message=E.message),E.error&&(c.error=E.error))),c;c=null,a=!1,++l}while(t.length>0);return!0}},5181:(e,t,r)=>{const n=r(98502),s=r(52485);e.exports=class{constructor(){this._buffer=new n,this._waitingConsumers=new n}push(e){const{promise:t,resolve:r}=s();return this._buffer.push({chunk:e,resolve:r}),this._consume(),t}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){const e=this._waitingConsumers.shift(),t=this._buffer.shift();e.resolve(t.chunk),t.resolve()}}shift(){const{promise:e,resolve:t}=s();return this._waitingConsumers.push({resolve:t}),this._consume(),e}isEmpty(){return this._buffer.isEmpty()}}},52485:e=>{"use strict";e.exports=()=>{const e={};return e.promise=new Promise(((t,r)=>{e.resolve=t,e.reject=r})),e}},99699:(e,t,r)=>{"use strict";e.exports=r(79084).default},79084:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(30349),i=n(r(47399)),o=n(r(27422)),a=r(9331),c=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map((e=>new s.Netmask(e)));function l(e){return/^::$/.test(e)||/^::1$/.test(e)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}t.default=e=>{if((0,a.isValid)(e)){const t=(0,a.parse)(e);if("ipv4"===t.kind())return function(e){for(let t of c)if(t.contains(e))return!0;return!1}(t.toNormalizedString());if("ipv6"===t.kind())return l(e)}else if((0,o.default)(e)&&i.default.v6().test(e))return l(e)}},9331:function(e){!function(t){"use strict";const r="(0?\\d+|0x[a-f0-9]+)",n={fourOctet:new RegExp(`^${r}\\.${r}\\.${r}\\.${r}$`,"i"),threeOctet:new RegExp(`^${r}\\.${r}\\.${r}$`,"i"),twoOctet:new RegExp(`^${r}\\.${r}$`,"i"),longValue:new RegExp(`^${r}$`,"i")},s=new RegExp("^0[0-7]+$","i"),i=new RegExp("^0x[a-f0-9]+$","i"),o="%[0-9a-z]{1,}",a="(?:[0-9a-f]+::?)+",c={zoneIndex:new RegExp(o,"i"),native:new RegExp(`^(::)?(${a})?([0-9a-f]+)?(::)?(${o})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${r}\\.${r}\\.${r}\\.${r}(${o})?)$`,"i"),transitional:new RegExp(`^((?:${a})|(?:::)(?:${a})?)${r}\\.${r}\\.${r}\\.${r}(${o})?$`,"i")};function l(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let r,n,s=0,i=-1,o=(e.match(c.zoneIndex)||[])[0];for(o&&(o=o.substring(1),e=e.replace(/%.+$/,""));(i=e.indexOf(":",i+1))>=0;)s++;if("::"===e.substr(0,2)&&s--,"::"===e.substr(-2,2)&&s--,s>t)return null;for(n=t-s,r=":";n--;)r+="0:";return":"===(e=e.replace("::",r))[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),{parts:t=function(){const t=e.split(":"),r=[];for(let e=0;e<t.length;e++)r.push(parseInt(t[e],16));return r}(),zoneId:o}}function h(e,t,r,n){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let s,i=0;for(;n>0;){if(s=r-n,s<0&&(s=0),e[i]>>s!=t[i]>>s)return!1;n-=r,i+=1}return!0}function u(e){if(i.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(s.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function d(e,t){for(;e.length<t;)e=`0${e}`;return e}const p={};p.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,r;for(t=0;t<e.length;t++)if(r=e[t],!(0<=r&&r<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return h(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let n,s,i;for(n=3;n>=0;n-=1){if(s=this.octets[n],!(s in r))return null;if(i=r[s],t&&0!==i)return null;8!==i&&(t=!0),e+=i}return 32-e},e.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return p.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),p.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),n=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),s=[];let i=0;for(;i<4;)s.push(parseInt(r[i],10)|255^parseInt(n[i],10)),i++;return new this(s)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.isIPv4=function(e){return null!==this.parser(e)},p.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(e){return!1}},p.IPv4.isValidFourPartDecimal=function(e){return!(!p.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},p.IPv4.networkAddressFromCIDR=function(e){let t,r,n,s,i;try{for(t=this.parseCIDR(e),n=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),s=[],r=0;r<4;)s.push(parseInt(n[r],10)&parseInt(i[r],10)),r++;return new this(s)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},p.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const r=[this.parse(t[1]),e];return Object.defineProperty(r,"toString",{value:function(){return this.join("/")}}),r}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},p.IPv4.parser=function(e){let t,r,s;if(t=e.match(n.fourOctet))return function(){const e=t.slice(1,6),n=[];for(let t=0;t<e.length;t++)r=e[t],n.push(u(r));return n}();if(t=e.match(n.longValue)){if(s=u(t[1]),s>4294967295||s<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(s>>t&255);return e}().reverse()}return(t=e.match(n.twoOctet))?function(){const e=t.slice(1,4),r=[];if(s=u(e[1]),s>16777215||s<0)throw new Error("ipaddr: address outside defined range");return r.push(u(e[0])),r.push(s>>16&255),r.push(s>>8&255),r.push(255&s),r}():(t=e.match(n.threeOctet))?function(){const e=t.slice(1,5),r=[];if(s=u(e[2]),s>65535||s<0)throw new Error("ipaddr: address outside defined range");return r.push(u(e[0])),r.push(u(e[1])),r.push(s>>8&255),r.push(255&s),r}():null},p.IPv4.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let r=0;const n=Math.floor(e/8);for(;r<n;)t[r]=255,r++;return n<4&&(t[n]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},p.IPv6=function(){function e(e,t){let r,n;if(16===e.length)for(this.parts=[],r=0;r<=14;r+=2)this.parts.push(e[r]<<8|e[r+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(r=0;r<this.parts.length;r++)if(n=this.parts[r],!(0<=n&&n<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],reserved:[[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return h(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let n,s;for(let i=7;i>=0;i-=1){if(n=this.parts[i],!(n in r))return null;if(s=r[n],t&&0!==s)return null;16!==s&&(t=!0),e+=s}return 128-e},e.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],r=this.parts;for(let n=0;n<r.length;n++)e=r[n],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(d(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],r=e[1];return new p.IPv4([t>>8,255&t,r>>8,255&r])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let r,n=0,s=-1;for(;r=e.exec(t);)r[0].length>s&&(n=r.index,s=r[0].length);return s<0?t:`${t.substring(0,n)}::${t.substring(n+s)}`},e.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},e}(),p.IPv6.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),n=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),s=[];let i=0;for(;i<16;)s.push(parseInt(r[i],10)|255^parseInt(n[i],10)),i++;return new this(s)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},p.IPv6.isIPv6=function(e){return null!==this.parser(e)},p.IPv6.isValid=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(e){return!1}},p.IPv6.networkAddressFromCIDR=function(e){let t,r,n,s,i;try{for(t=this.parseCIDR(e),n=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),s=[],r=0;r<16;)s.push(parseInt(n[r],10)&parseInt(i[r],10)),r++;return new this(s)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},p.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},p.IPv6.parseCIDR=function(e){let t,r,n;if((r=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(r[2]),t>=0&&t<=128))return n=[this.parse(r[1]),t],Object.defineProperty(n,"toString",{value:function(){return this.join("/")}}),n;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},p.IPv6.parser=function(e){let t,r,n,s,i,o;if(n=e.match(c.deprecatedTransitional))return this.parser(`::ffff:${n[1]}`);if(c.native.test(e))return l(e,8);if((n=e.match(c.transitional))&&(o=n[6]||"",t=l(n[1].slice(0,-1)+o,6),t.parts)){for(i=[parseInt(n[2]),parseInt(n[3]),parseInt(n[4]),parseInt(n[5])],r=0;r<i.length;r++)if(s=i[r],!(0<=s&&s<=255))return null;return t.parts.push(i[0]<<8|i[1]),t.parts.push(i[2]<<8|i[3]),{parts:t.parts,zoneId:t.zoneId}}return null},p.IPv6.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>128)throw new Error("ipaddr: invalid IPv6 prefix length");const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let r=0;const n=Math.floor(e/8);for(;r<n;)t[r]=255,r++;return n<16&&(t[n]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},p.fromByteArray=function(e){const t=e.length;if(4===t)return new p.IPv4(e);if(16===t)return new p.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},p.isValid=function(e){return p.IPv6.isValid(e)||p.IPv4.isValid(e)},p.parse=function(e){if(p.IPv6.isValid(e))return p.IPv6.parse(e);if(p.IPv4.isValid(e))return p.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},p.parseCIDR=function(e){try{return p.IPv6.parseCIDR(e)}catch(t){try{return p.IPv4.parseCIDR(e)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},p.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},p.subnetMatch=function(e,t,r){let n,s,i,o;for(s in null==r&&(r="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,s))for(i=t[s],!i[0]||i[0]instanceof Array||(i=[i]),n=0;n<i.length;n++)if(o=i[n],e.kind()===o[0].kind()&&e.match.apply(e,o))return s;return r},e.exports?e.exports=p:t.ipaddr=p}(this)},39026:(e,t,r)=>{"use strict";e.exports=r(43228)},43228:(e,t,r)=>{"use strict";var n=t;function s(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(74374),n.BufferWriter=r(71913),n.Reader=r(6418),n.BufferReader=r(42250),n.util=r(96259),n.rpc=r(45260),n.roots=r(11497),n.configure=s,s()},6418:(e,t,r)=>{"use strict";e.exports=c;var n,s=r(96259),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var l,h="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},u=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new n(e):h(e)})(e)}:h};function d(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new i(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}c.create=u(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return l}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){n=e,c.create=u(),n._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},42250:(e,t,r)=>{"use strict";e.exports=i;var n=r(6418);(i.prototype=Object.create(n.prototype)).constructor=i;var s=r(96259);function i(e){n.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},11497:e=>{"use strict";e.exports={}},45260:(e,t,r)=>{"use strict";t.Service=r(34245)},34245:(e,t,r)=>{"use strict";e.exports=s;var n=r(96259);function s(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(s.prototype=Object.create(n.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function e(t,r,s,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return n.asPromise(e,a,t,r,s,i);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,r){if(e)return a.emit("error",e,t),o(e);if(null!==r){if(!(r instanceof s))try{r=s[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",r,t),o(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},60185:(e,t,r)=>{"use strict";e.exports=s;var n=r(96259);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new s(r,n)},s.from=function(e){if("number"==typeof e)return s.fromNumber(e);if(n.isString(e)){if(!n.Long)return s.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},96259:function(e,t,r){"use strict";var n=t;function s(e,t,r){for(var n=Object.keys(t),s=0;s<n.length;++s)void 0!==e[n[s]]&&r||(e[n[s]]=t[n[s]]);return e}function i(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&s(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:()=>e,set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=r(12835),n.base64=r(82968),n.EventEmitter=r(25560),n.float=r(14278),n.inquire=r(33149),n.utf8=r(48301),n.pool=r(66765),n.LongBits=r(60185),n.isNode=Boolean(void 0!==r.g&&r.g&&r.g.process&&r.g.process.versions&&r.g.process.versions.node),n.global=n.isNode&&r.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=s,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}},74374:(e,t,r)=>{"use strict";e.exports=u;var n,s=r(96259),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function l(){}function h(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function u(){this.len=0,this.head=new c(l,0,0),this.tail=this.head,this.states=null}var d=function(){return s.Buffer?function(){return(u.create=function(){return new n})()}:function(){return new u}};function p(e,t,r){t[r]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function g(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}u.create=d(),u.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(u.alloc=s.pool(u.alloc,s.Array.prototype.subarray)),u.prototype._push=function(e,t,r){return this.tail=this.tail.next=new c(e,t,r),this.len+=t,this},f.prototype=Object.create(c.prototype),f.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},u.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},u.prototype.int32=function(e){return e<0?this._push(y,10,i.fromNumber(e)):this.uint32(e)},u.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},u.prototype.uint64=function(e){var t=i.from(e);return this._push(y,t.length(),t)},u.prototype.int64=u.prototype.uint64,u.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(y,t.length(),t)},u.prototype.bool=function(e){return this._push(p,1,e?1:0)},u.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},u.prototype.sfixed32=u.prototype.fixed32,u.prototype.fixed64=function(e){var t=i.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},u.prototype.sfixed64=u.prototype.fixed64,u.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},u.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var m=s.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};u.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(s.isString(e)){var r=u.alloc(t=o.length(e));o.decode(e,r,0),e=r}return this.uint32(t)._push(m,t,e)},u.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},u.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new c(l,0,0),this.len=0,this},u.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(l,0,0),this.len=0),this},u.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},u.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},u._configure=function(e){n=e,u.create=d(),n._configure()}},71913:(e,t,r)=>{"use strict";e.exports=i;var n=r(74374);(i.prototype=Object.create(n.prototype)).constructor=i;var s=r(96259);function i(){n.call(this)}function o(e,t,r){e.length<40?s.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},94715:(e,t,r)=>{let n;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:r.g):e=>(n||(n=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)))},45125:(e,t,r)=>{const{instantiate:n}=r(12200);function s(e={}){if(!s.supported)return null;var t=new Uint8Array([0,97,115,109,1,0,0,0,1,78,14,96,2,127,126,0,96,1,127,1,126,96,2,127,127,0,96,1,127,1,127,96,1,127,0,96,2,127,127,1,127,96,3,127,127,127,1,127,96,0,0,96,3,127,127,127,0,96,0,1,127,96,4,127,127,127,127,0,96,5,127,127,127,127,127,1,127,96,1,126,1,127,96,2,126,126,1,126,2,13,1,3,101,110,118,5,97,98,111,114,116,0,10,3,54,53,2,2,8,9,3,5,2,8,6,5,3,4,2,6,9,12,13,2,5,11,3,2,3,2,3,2,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,6,7,7,4,4,5,3,1,0,1,6,47,9,127,1,65,0,11,127,1,65,0,11,127,0,65,3,11,127,0,65,4,11,127,1,65,0,11,127,1,65,0,11,127,1,65,0,11,127,0,65,240,2,11,127,0,65,6,11,7,240,5,41,6,109,101,109,111,114,121,2,0,7,95,95,97,108,108,111,99,0,10,8,95,95,114,101,116,97,105,110,0,11,9,95,95,114,101,108,101,97,115,101,0,12,9,95,95,99,111,108,108,101,99,116,0,51,11,95,95,114,116,116,105,95,98,97,115,101,3,7,13,73,110,116,51,50,65,114,114,97,121,95,73,68,3,2,13,85,105,110,116,56,65,114,114,97,121,95,73,68,3,3,6,100,101,103,114,101,101,0,16,3,109,111,100,0,17,5,82,97,98,105,110,3,8,16,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,0,21,16,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,0,22,21,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,23,21,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,24,14,82,97,98,105,110,35,103,101,116,58,119,112,111,115,0,25,14,82,97,98,105,110,35,115,101,116,58,119,112,111,115,0,26,15,82,97,98,105,110,35,103,101,116,58,99,111,117,110,116,0,27,15,82,97,98,105,110,35,115,101,116,58,99,111,117,110,116,0,28,13,82,97,98,105,110,35,103,101,116,58,112,111,115,0,29,13,82,97,98,105,110,35,115,101,116,58,112,111,115,0,30,15,82,97,98,105,110,35,103,101,116,58,115,116,97,114,116,0,31,15,82,97,98,105,110,35,115,101,116,58,115,116,97,114,116,0,32,16,82,97,98,105,110,35,103,101,116,58,100,105,103,101,115,116,0,33,16,82,97,98,105,110,35,115,101,116,58,100,105,103,101,115,116,0,34,21,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,35,21,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,36,22,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,37,22,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,38,31,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,39,31,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,40,20,82,97,98,105,110,35,103,101,116,58,112,111,108,121,110,111,109,105,97,108,0,41,20,82,97,98,105,110,35,115,101,116,58,112,111,108,121,110,111,109,105,97,108,0,42,17,82,97,98,105,110,35,103,101,116,58,109,105,110,115,105,122,101,0,43,17,82,97,98,105,110,35,115,101,116,58,109,105,110,115,105,122,101,0,44,17,82,97,98,105,110,35,103,101,116,58,109,97,120,115,105,122,101,0,45,17,82,97,98,105,110,35,115,101,116,58,109,97,120,115,105,122,101,0,46,14,82,97,98,105,110,35,103,101,116,58,109,97,115,107,0,47,14,82,97,98,105,110,35,115,101,116,58,109,97,115,107,0,48,17,82,97,98,105,110,35,99,111,110,115,116,114,117,99,116,111,114,0,20,17,82,97,98,105,110,35,102,105,110,103,101,114,112,114,105,110,116,0,49,8,1,50,10,165,31,53,199,1,1,4,127,32,1,40,2,0,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,3,65,4,107,118,65,16,115,33,4,32,3,65,7,107,11,33,3,32,1,40,2,20,33,2,32,1,40,2,16,34,5,4,64,32,5,32,2,54,2,20,11,32,2,4,64,32,2,32,5,54,2,16,11,32,1,32,0,32,4,32,3,65,4,116,106,65,2,116,106,40,2,96,70,4,64,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,2,54,2,96,32,2,69,4,64,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,65,127,115,113,34,1,54,2,4,32,1,69,4,64,32,0,32,0,40,2,0,65,1,32,3,116,65,127,115,113,54,2,0,11,11,11,11,226,2,1,6,127,32,1,40,2,0,33,3,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,34,5,65,1,113,4,64,32,3,65,124,113,65,16,106,32,5,65,124,113,106,34,2,65,240,255,255,255,3,73,4,64,32,0,32,4,16,1,32,1,32,2,32,3,65,3,113,114,34,3,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,33,5,11,11,32,3,65,2,113,4,64,32,1,65,4,107,40,2,0,34,2,40,2,0,34,6,65,124,113,65,16,106,32,3,65,124,113,106,34,7,65,240,255,255,255,3,73,4,64,32,0,32,2,16,1,32,2,32,7,32,6,65,3,113,114,34,3,54,2,0,32,2,33,1,11,11,32,4,32,5,65,2,114,54,2,0,32,4,65,4,107,32,1,54,2,0,32,0,32,3,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,2,65,4,107,118,65,16,115,33,4,32,2,65,7,107,11,34,3,65,4,116,32,4,106,65,2,116,106,40,2,96,33,2,32,1,65,0,54,2,16,32,1,32,2,54,2,20,32,2,4,64,32,2,32,1,54,2,16,11,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,1,54,2,96,32,0,32,0,40,2,0,65,1,32,3,116,114,54,2,0,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,114,54,2,4,11,119,1,1,127,32,2,2,127,32,0,40,2,160,12,34,2,4,64,32,2,32,1,65,16,107,70,4,64,32,2,40,2,0,33,3,32,1,65,16,107,33,1,11,11,32,1,11,107,34,2,65,48,73,4,64,15,11,32,1,32,3,65,2,113,32,2,65,32,107,65,1,114,114,54,2,0,32,1,65,0,54,2,16,32,1,65,0,54,2,20,32,1,32,2,106,65,16,107,34,2,65,2,54,2,0,32,0,32,2,54,2,160,12,32,0,32,1,16,2,11,155,1,1,3,127,35,0,34,0,69,4,64,65,1,63,0,34,0,74,4,127,65,1,32,0,107,64,0,65,0,72,5,65,0,11,4,64,0,11,65,176,3,34,0,65,0,54,2,0,65,208,15,65,0,54,2,0,3,64,32,1,65,23,73,4,64,32,1,65,2,116,65,176,3,106,65,0,54,2,4,65,0,33,2,3,64,32,2,65,16,73,4,64,32,1,65,4,116,32,2,106,65,2,116,65,176,3,106,65,0,54,2,96,32,2,65,1,106,33,2,12,1,11,11,32,1,65,1,106,33,1,12,1,11,11,65,176,3,65,224,15,63,0,65,16,116,16,3,65,176,3,36,0,11,32,0,11,45,0,32,0,65,240,255,255,255,3,79,4,64,65,32,65,224,0,65,201,3,65,29,16,0,0,11,32,0,65,15,106,65,112,113,34,0,65,16,32,0,65,16,75,27,11,169,1,1,1,127,32,0,32,1,65,128,2,73,4,127,32,1,65,4,118,33,1,65,0,5,32,1,65,248,255,255,255,1,73,4,64,32,1,65,1,65,27,32,1,103,107,116,106,65,1,107,33,1,11,32,1,65,31,32,1,103,107,34,2,65,4,107,118,65,16,115,33,1,32,2,65,7,107,11,34,2,65,2,116,106,40,2,4,65,127,32,1,116,113,34,1,4,127,32,0,32,1,104,32,2,65,4,116,106,65,2,116,106,40,2,96,5,32,0,40,2,0,65,127,32,2,65,1,106,116,113,34,1,4,127,32,0,32,0,32,1,104,34,0,65,2,116,106,40,2,4,104,32,0,65,4,116,106,65,2,116,106,40,2,96,5,65,0,11,11,11,111,1,1,127,63,0,34,2,32,1,65,248,255,255,255,1,73,4,127,32,1,65,1,65,27,32,1,103,107,116,65,1,107,106,5,32,1,11,65,16,32,0,40,2,160,12,32,2,65,16,116,65,16,107,71,116,106,65,255,255,3,106,65,128,128,124,113,65,16,118,34,1,32,2,32,1,74,27,64,0,65,0,72,4,64,32,1,64,0,65,0,72,4,64,0,11,11,32,0,32,2,65,16,116,63,0,65,16,116,16,3,11,113,1,2,127,32,1,40,2,0,34,3,65,124,113,32,2,107,34,4,65,32,79,4,64,32,1,32,2,32,3,65,2,113,114,54,2,0,32,2,32,1,65,16,106,106,34,1,32,4,65,16,107,65,1,114,54,2,0,32,0,32,1,16,2,5,32,1,32,3,65,126,113,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,32,1,65,16,106,32,1,40,2,0,65,124,113,106,40,2,0,65,125,113,54,2,0,11,11,91,1,2,127,32,0,32,1,16,5,34,4,16,6,34,3,69,4,64,65,1,36,1,65,0,36,1,32,0,32,4,16,6,34,3,69,4,64,32,0,32,4,16,7,32,0,32,4,16,6,33,3,11,11,32,3,65,0,54,2,4,32,3,32,2,54,2,8,32,3,32,1,54,2,12,32,0,32,3,16,1,32,0,32,3,32,4,16,8,32,3,11,13,0,16,4,32,0,32,1,16,9,65,16,106,11,33,1,1,127,32,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,18,0,32,0,65,172,3,75,4,64,32,0,65,16,107,16,52,11,11,140,3,1,1,127,2,64,32,1,69,13,0,32,0,65,0,58,0,0,32,0,32,1,106,65,1,107,65,0,58,0,0,32,1,65,2,77,13,0,32,0,65,1,106,65,0,58,0,0,32,0,65,2,106,65,0,58,0,0,32,0,32,1,106,34,2,65,2,107,65,0,58,0,0,32,2,65,3,107,65,0,58,0,0,32,1,65,6,77,13,0,32,0,65,3,106,65,0,58,0,0,32,0,32,1,106,65,4,107,65,0,58,0,0,32,1,65,8,77,13,0,32,1,65,0,32,0,107,65,3,113,34,1,107,33,2,32,0,32,1,106,34,0,65,0,54,2,0,32,0,32,2,65,124,113,34,1,106,65,4,107,65,0,54,2,0,32,1,65,8,77,13,0,32,0,65,4,106,65,0,54,2,0,32,0,65,8,106,65,0,54,2,0,32,0,32,1,106,34,2,65,12,107,65,0,54,2,0,32,2,65,8,107,65,0,54,2,0,32,1,65,24,77,13,0,32,0,65,12,106,65,0,54,2,0,32,0,65,16,106,65,0,54,2,0,32,0,65,20,106,65,0,54,2,0,32,0,65,24,106,65,0,54,2,0,32,0,32,1,106,34,2,65,28,107,65,0,54,2,0,32,2,65,24,107,65,0,54,2,0,32,2,65,20,107,65,0,54,2,0,32,2,65,16,107,65,0,54,2,0,32,0,32,0,65,4,113,65,24,106,34,2,106,33,0,32,1,32,2,107,33,1,3,64,32,1,65,32,79,4,64,32,0,66,0,55,3,0,32,0,65,8,106,66,0,55,3,0,32,0,65,16,106,66,0,55,3,0,32,0,65,24,106,66,0,55,3,0,32,1,65,32,107,33,1,32,0,65,32,106,33,0,12,1,11,11,11,11,178,1,1,3,127,32,1,65,240,255,255,255,3,32,2,118,75,4,64,65,144,1,65,192,1,65,23,65,56,16,0,0,11,32,1,32,2,116,34,3,65,0,16,10,34,2,32,3,16,13,32,0,69,4,64,65,12,65,2,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,2,34,1,32,0,40,2,0,34,4,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,32,4,16,12,11,32,0,32,1,54,2,0,32,0,32,2,54,2,4,32,0,32,3,54,2,8,32,0,11,46,1,2,127,65,12,65,5,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,65,128,2,65,3,16,14,11,9,0,65,63,32,0,121,167,107,11,49,1,2,127,65,63,32,1,121,167,107,33,2,3,64,65,63,32,0,121,167,107,32,2,107,34,3,65,0,78,4,64,32,0,32,1,32,3,172,134,133,33,0,12,1,11,11,32,0,11,40,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,163,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,65,0,58,0,0,11,38,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,152,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,45,0,0,11,254,5,2,1,127,4,126,32,0,69,4,64,65,232,0,65,6,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,24,32,0,66,0,55,3,32,32,0,66,0,55,3,40,32,0,66,0,55,3,48,32,0,66,0,55,3,56,32,0,66,0,55,3,64,32,0,66,0,55,3,72,32,0,66,0,55,3,80,32,0,66,0,55,3,88,32,0,66,0,55,3,96,32,0,32,2,173,55,3,80,32,0,32,3,173,55,3,88,65,12,65,4,16,10,34,2,65,172,3,75,4,64,32,2,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,32,4,65,0,16,14,33,2,32,0,40,2,0,16,12,32,0,32,2,54,2,0,32,0,32,4,54,2,4,32,0,66,1,32,1,173,134,66,1,125,55,3,96,32,0,66,243,130,183,218,216,230,232,30,55,3,72,35,4,69,4,64,65,0,33,2,3,64,32,2,65,128,2,72,4,64,32,2,65,255,1,113,173,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,65,0,33,4,3,64,32,4,32,0,40,2,4,65,1,107,72,4,64,32,6,66,8,134,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,32,4,65,1,106,33,4,12,1,11,11,35,6,40,2,4,32,2,65,3,116,106,32,6,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,63,32,0,41,3,72,121,167,107,172,33,7,65,0,33,2,3,64,32,2,65,128,2,72,4,64,35,5,33,1,32,2,172,32,7,134,34,8,33,6,65,63,32,0,41,3,72,34,9,121,167,107,33,3,3,64,65,63,32,6,121,167,107,32,3,107,34,4,65,0,78,4,64,32,6,32,9,32,4,172,134,133,33,6,12,1,11,11,32,1,40,2,4,32,2,65,3,116,106,32,6,32,8,132,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,1,36,4,11,32,0,66,0,55,3,24,32,0,66,0,55,3,32,65,0,33,2,3,64,32,2,32,0,40,2,4,72,4,64,32,0,40,2,0,32,2,16,18,32,2,65,1,106,33,2,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,6,66,45,136,167,65,3,116,106,41,3,0,32,6,66,8,134,66,1,132,133,55,3,40,32,0,11,38,1,1,127,32,0,40,2,0,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,55,1,2,127,32,1,32,0,40,2,0,34,2,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,16,12,11,32,0,32,1,54,2,0,11,7,0,32,0,40,2,4,11,9,0,32,0,32,1,54,2,4,11,7,0,32,0,40,2,8,11,9,0,32,0,32,1,54,2,8,11,7,0,32,0,41,3,16,11,9,0,32,0,32,1,55,3,16,11,7,0,32,0,41,3,24,11,9,0,32,0,32,1,55,3,24,11,7,0,32,0,41,3,32,11,9,0,32,0,32,1,55,3,32,11,7,0,32,0,41,3,40,11,9,0,32,0,32,1,55,3,40,11,7,0,32,0,41,3,48,11,9,0,32,0,32,1,55,3,48,11,7,0,32,0,41,3,56,11,9,0,32,0,32,1,55,3,56,11,7,0,32,0,41,3,64,11,9,0,32,0,32,1,55,3,64,11,7,0,32,0,41,3,72,11,9,0,32,0,32,1,55,3,72,11,7,0,32,0,41,3,80,11,9,0,32,0,32,1,55,3,80,11,7,0,32,0,41,3,88,11,9,0,32,0,32,1,55,3,88,11,7,0,32,0,41,3,96,11,9,0,32,0,32,1,55,3,96,11,172,4,2,5,127,1,126,32,2,65,172,3,75,4,64,32,2,65,16,107,34,4,32,4,40,2,4,65,1,106,54,2,4,11,32,2,33,4,65,0,33,2,32,1,40,2,8,33,5,32,1,40,2,4,33,6,3,64,2,127,65,0,33,3,3,64,32,3,32,5,72,4,64,32,3,32,6,106,45,0,0,33,1,32,0,40,2,0,32,0,40,2,8,16,19,33,7,32,0,40,2,8,32,0,40,2,0,40,2,4,106,32,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,7,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,1,173,32,8,66,8,134,132,133,55,3,40,32,0,32,0,41,3,16,66,1,124,55,3,16,32,0,32,0,41,3,24,66,1,124,55,3,24,32,0,41,3,16,32,0,41,3,80,90,4,127,32,0,41,3,40,32,0,41,3,96,131,80,5,65,0,11,4,127,65,1,5,32,0,41,3,16,32,0,41,3,88,90,11,4,64,32,0,32,0,41,3,32,55,3,48,32,0,32,0,41,3,16,55,3,56,32,0,32,0,41,3,40,55,3,64,65,0,33,1,3,64,32,1,32,0,40,2,4,72,4,64,32,0,40,2,0,32,1,16,18,32,1,65,1,106,33,1,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,8,66,8,134,66,1,132,133,55,3,40,32,3,65,1,106,12,3,11,32,3,65,1,106,33,3,12,1,11,11,65,127,11,34,1,65,0,78,4,64,32,5,32,1,107,33,5,32,1,32,6,106,33,6,32,2,34,1,65,1,106,33,2,32,4,40,2,4,32,1,65,2,116,106,32,0,41,3,56,62,2,0,12,1,11,11,32,4,11,10,0,16,15,36,5,16,15,36,6,11,3,0,1,11,73,1,2,127,32,0,40,2,4,34,1,65,255,255,255,255,0,113,34,2,65,1,70,4,64,32,0,65,16,106,16,53,32,0,32,0,40,2,0,65,1,114,54,2,0,35,0,32,0,16,2,5,32,0,32,2,65,1,107,32,1,65,128,128,128,128,127,113,114,54,2,4,11,11,58,0,2,64,2,64,2,64,32,0,65,8,107,40,2,0,14,7,0,0,1,1,1,1,1,2,11,15,11,32,0,40,2,0,34,0,4,64,32,0,65,172,3,79,4,64,32,0,65,16,107,16,52,11,11,15,11,0,11,11,137,3,7,0,65,16,11,55,40,0,0,0,1,0,0,0,1,0,0,0,40,0,0,0,97,0,108,0,108,0,111,0,99,0,97,0,116,0,105,0,111,0,110,0,32,0,116,0,111,0,111,0,32,0,108,0,97,0,114,0,103,0,101,0,65,208,0,11,45,30,0,0,0,1,0,0,0,1,0,0,0,30,0,0,0,126,0,108,0,105,0,98,0,47,0,114,0,116,0,47,0,116,0,108,0,115,0,102,0,46,0,116,0,115,0,65,128,1,11,43,28,0,0,0,1,0,0,0,1,0,0,0,28,0,0,0,73,0,110,0,118,0,97,0,108,0,105,0,100,0,32,0,108,0,101,0,110,0,103,0,116,0,104,0,65,176,1,11,53,38,0,0,0,1,0,0,0,1,0,0,0,38,0,0,0,126,0,108,0,105,0,98,0,47,0,97,0,114,0,114,0,97,0,121,0,98,0,117,0,102,0,102,0,101,0,114,0,46,0,116,0,115,0,65,240,1,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,73,0,110,0,100,0,101,0,120,0,32,0,111,0,117,0,116,0,32,0,111,0,102,0,32,0,114,0,97,0,110,0,103,0,101,0,65,176,2,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,126,0,108,0,105,0,98,0,47,0,116,0,121,0,112,0,101,0,100,0,97,0,114,0,114,0,97,0,121,0,46,0,116,0,115,0,65,240,2,11,53,7,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,145,4,0,0,2,0,0,0,49,0,0,0,2,0,0,0,17,1,0,0,2,0,0,0,16,0,34,16,115,111,117,114,99,101,77,97,112,112,105,110,103,85,82,76,16,46,47,114,97,98,105,110,46,119,97,115,109,46,109,97,112]);return n(new Response(new Blob([t],{type:"application/wasm"})),e)}s.supported="undefined"!=typeof WebAssembly,e.exports=s},28232:(e,t,r)=>{const n=r(92673),s=r(45125);e.exports={Rabin:n,create:async(e,t,r,i,o)=>{const a=await s();return new n(a,e,t,r,i,o)}}},92673:e=>{e.exports=class{constructor(e,t=12,r=8192,n=32768,s=64,i){this.bits=t,this.min=r,this.max=n,this.asModule=e,this.rabin=new e.Rabin(t,r,n,s,i),this.polynomial=i}fingerprint(e){const{__retain:t,__release:r,__allocArray:n,__getInt32Array:s,Int32Array_ID:i,Uint8Array_ID:o}=this.asModule,a=t(n(i,new Int32Array(Math.ceil(e.length/this.min)))),c=t(n(o,e)),l=s(this.rabin.fingerprint(c,a));r(c),r(a);const h=l.indexOf(0);return h>=0?l.subarray(0,h):l}}},68239:(e,t,r)=>{"use strict";var n=r(46039),s=65536,i=r(62666).Buffer,o=r.g.crypto||r.g.msCrypto;o&&o.getRandomValues?e.exports=function(e,t){if(e>4294967295)throw new RangeError("requested too many random bytes");var r=i.allocUnsafe(e);if(e>0)if(e>s)for(var a=0;a<e;a+=s)o.getRandomValues(r.slice(a,a+s));else o.getRandomValues(r);return"function"==typeof t?n.nextTick((function(){t(null,r)})):r}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}},6633:(e,t,r)=>{const n=r(24719),s=r(914),i=r(13596),o=r(12224),{RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:l}=r(40880),h=r(49540),u=r(71368),d=r(16134),p=r(42521),f=r(97671),y=r(35047),g=r(26687);e.exports={RateLimiterRedis:n,RateLimiterMongo:s,RateLimiterMySQL:i,RateLimiterPostgres:o,RateLimiterMemory:h,RateLimiterMemcache:u,RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:l,RLWrapperBlackAndWhite:d,RateLimiterUnion:p,RateLimiterQueue:f,BurstyRateLimiter:y,RateLimiterRes:g}},35047:(e,t,r)=>{const n=r(26687);e.exports=class{constructor(e,t){this._rateLimiter=e,this._burstLimiter=t}_combineRes(e,t){return new n(e.remainingPoints,Math.min(e.msBeforeNext,t.msBeforeNext),e.consumedPoints,e.isFirstInDuration)}consume(e,t=1,r={}){return this._rateLimiter.consume(e,t,r).catch((s=>s instanceof n?this._burstLimiter.consume(e,t,r).then((e=>Promise.resolve(this._combineRes(s,e)))).catch((e=>e instanceof n?Promise.reject(this._combineRes(s,e)):Promise.reject(e))):Promise.reject(s)))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then((([e,t])=>this._combineRes(e,t)))}get points(){return this._rateLimiter.points}}},16134:(e,t,r)=>{const n=r(26687);e.exports=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if(void 0===e)throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway=void 0!==e&&e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if(void 0===e&&(e=()=>!1),"function"!=typeof e)throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if(void 0===e&&(e=()=>!1),"function"!=typeof e)throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new n(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new n(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,t=1){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.rejectBlack()),void 0===r?this.limiter.consume(e,t):(this.runActionAnyway&&this.limiter.consume(e,t).catch((()=>{})),r)}block(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.block(e,t):(this.runActionAnyway&&this.limiter.block(e,t).catch((()=>{})),r)}penalty(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.penalty(e,t):(this.runActionAnyway&&this.limiter.penalty(e,t).catch((()=>{})),r)}reward(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.reward(e,t):(this.runActionAnyway&&this.limiter.reward(e,t).catch((()=>{})),r)}get(e){let t;return this.isWhiteListedSomewhere(e)?t=this.resolveWhite():this.isBlackListedSomewhere(e)&&(t=this.resolveBlack()),void 0===t||this.runActionAnyway?this.limiter.get(e):t}delete(e){return this.limiter.delete(e)}}},97475:e=>{e.exports=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration=void 0===e?1:e}get msDuration(){return 1e3*this.duration}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration=void 0===e?0:e}get msBlockDuration(){return 1e3*this.blockDuration}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly=void 0!==e&&Boolean(e)}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs=void 0===e?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if(void 0===e&&(e="rlflx"),"string"!=typeof e)throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}}},40880:(e,t,r)=>{var n=r(46039),s=r(82784);const i=r(81265),o=r(35539),a=r(97475),c=r(49540),l=r(26687),h="rate_limiter_flexible";let u=null;const d=function(e,t,r,n){let s;s=null===n||!0===n||!1===n?n:{remainingPoints:n.remainingPoints,msBeforeNext:n.msBeforeNext,consumedPoints:n.consumedPoints,isFirstInDuration:n.isFirstInDuration},e.send({channel:h,keyPrefix:t.keyPrefix,promiseId:t.promiseId,type:r,data:s})},p=function(e){setTimeout((()=>{this._initiated?n.send(e):void 0!==this._promises[e.promiseId]&&p.call(this,e)}),30)},f=function(e,t,r,s,i){const o={channel:h,keyPrefix:this.keyPrefix,func:e,promiseId:t,data:{key:r,arg:s,opts:i}};this._initiated?n.send(o):p.call(this,o)},y=function(e,t){if(!t||t.channel!==h||void 0===this._rateLimiters[t.keyPrefix])return!1;let r;switch(t.func){case"consume":r=this._rateLimiters[t.keyPrefix].consume(t.data.key,t.data.arg,t.data.opts);break;case"penalty":r=this._rateLimiters[t.keyPrefix].penalty(t.data.key,t.data.arg,t.data.opts);break;case"reward":r=this._rateLimiters[t.keyPrefix].reward(t.data.key,t.data.arg,t.data.opts);break;case"block":r=this._rateLimiters[t.keyPrefix].block(t.data.key,t.data.arg,t.data.opts);break;case"get":r=this._rateLimiters[t.keyPrefix].get(t.data.key,t.data.opts);break;case"delete":r=this._rateLimiters[t.keyPrefix].delete(t.data.key,t.data.opts);break;default:return!1}r&&r.then((r=>{d(e,t,"resolve",r)})).catch((r=>{d(e,t,"reject",r)}))},g=function(e){if(!e||e.channel!==h||e.keyPrefix!==this.keyPrefix)return!1;if(this._promises[e.promiseId]){let t;switch(clearTimeout(this._promises[e.promiseId].timeoutId),t=null===e.data||!0===e.data||!1===e.data?e.data:new l(e.data.remainingPoints,e.data.msBeforeNext,e.data.consumedPoints,e.data.isFirstInDuration),e.type){case"resolve":this._promises[e.promiseId].resolve(t);break;case"reject":this._promises[e.promiseId].reject(t);break;default:throw new Error(`RateLimiterCluster: no such message type '${e.type}'`)}delete this._promises[e.promiseId]}},m=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},w=function(e,t){const r=n.hrtime();let s=r[0].toString()+r[1].toString();return void 0!==this._promises[s]&&(s+=o.randomBytes(12).toString("base64")),this._promises[s]={resolve:e,reject:t,timeoutId:setTimeout((()=>{delete this._promises[s],t(new Error("RateLimiterCluster timeout: no answer from master in time"))}),this.timeoutMs)},s};e.exports={RateLimiterClusterMaster:class{constructor(){if(u)return u;this._rateLimiters={},i.setMaxListeners(0),i.on("message",((e,t)=>{t&&t.channel===h&&"init"===t.type?(void 0===this._rateLimiters[t.opts.keyPrefix]&&(this._rateLimiters[t.opts.keyPrefix]=new c(t.opts)),e.send({channel:h,type:"init",keyPrefix:t.opts.keyPrefix})):y.call(this,e,t)})),u=this}},RateLimiterClusterMasterPM2:class{constructor(e){if(u)return u;this._rateLimiters={},e.launchBus(((t,r)=>{r.on("process:msg",(t=>{const r=t.raw;r&&r.channel===h&&"init"===r.type?(void 0===this._rateLimiters[r.opts.keyPrefix]&&(this._rateLimiters[r.opts.keyPrefix]=new c(r.opts)),e.sendDataToProcessId(t.process.pm_id,{data:{},topic:h,channel:h,type:"init",keyPrefix:r.opts.keyPrefix},((e,t)=>{e&&s.log(e,t)}))):y.call(this,{send:r=>{const n=r;n.topic=h,void 0===n.data&&(n.data={}),e.sendDataToProcessId(t.process.pm_id,n,((e,t)=>{e&&s.log(e,t)}))}},r)}))})),u=this}},RateLimiterCluster:class extends a{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs=void 0===e?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),n.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,n.on("message",(e=>{e&&e.channel===h&&"init"===e.type&&e.keyPrefix===this.keyPrefix?this._initiated=!0:g.call(this,e)})),n.send({channel:h,type:"init",opts:m.call(this)}),this._promises={}}consume(e,t=1,r={}){return new Promise(((n,s)=>{const i=w.call(this,n,s);f.call(this,"consume",i,e,t,r)}))}penalty(e,t=1,r={}){return new Promise(((n,s)=>{const i=w.call(this,n,s);f.call(this,"penalty",i,e,t,r)}))}reward(e,t=1,r={}){return new Promise(((n,s)=>{const i=w.call(this,n,s);f.call(this,"reward",i,e,t,r)}))}block(e,t,r={}){return new Promise(((n,s)=>{const i=w.call(this,n,s);f.call(this,"block",i,e,t,r)}))}get(e,t={}){return new Promise(((r,n)=>{const s=w.call(this,r,n);f.call(this,"get",s,e,t)}))}delete(e,t={}){return new Promise(((r,n)=>{const s=w.call(this,r,n);f.call(this,"delete",s,e,t)}))}}}},71368:(e,t,r)=>{const n=r(37492),s=r(26687);e.exports=class extends n{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,t,r){const n=new s;return n.consumedPoints=parseInt(r.consumedPoints),n.isFirstInDuration=r.consumedPoints===t,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=r.msBeforeNext,n}_upsert(e,t,r,n=!1,s={}){return new Promise(((i,o)=>{const a=Date.now(),c=Math.floor(r/1e3);n?this.client.set(e,t,c,(r=>{r?o(r):this.client.set(`${e}_expire`,c>0?a+1e3*c:-1,c,(()=>{i({consumedPoints:t,msBeforeNext:c>0?1e3*c:-1})}))})):this.client.incr(e,t,((l,h)=>{l||!1===h?this.client.add(e,t,c,((l,h)=>{if(l||!h)if(void 0===s.attemptNumber||s.attemptNumber<3){const a=Object.assign({},s);a.attemptNumber=a.attemptNumber?a.attemptNumber+1:1,this._upsert(e,t,r,n,a).then((e=>i(e))).catch((e=>o(e)))}else o(new Error("Can not add key"));else this.client.add(`${e}_expire`,c>0?a+1e3*c:-1,c,(()=>{i({consumedPoints:t,msBeforeNext:c>0?1e3*c:-1})}))})):this.client.get(`${e}_expire`,((e,t)=>{if(e)o(e);else{const e=!1===t?0:t,r={consumedPoints:h,msBeforeNext:e>=0?Math.max(e-a,0):-1};i(r)}}))}))}))}_get(e){return new Promise(((t,r)=>{const n=Date.now();this.client.get(e,((s,i)=>{i?this.client.get(`${e}_expire`,((e,s)=>{if(e)r(e);else{const e=!1===s?0:s,r={consumedPoints:i,msBeforeNext:e>=0?Math.max(e-n,0):-1};t(r)}})):t(null)}))}))}_delete(e){return new Promise(((t,r)=>{this.client.del(e,((n,s)=>{n?r(n):!1===s?t(s):this.client.del(`${e}_expire`,(e=>{e?r(e):t(s)}))}))}))}}},49540:(e,t,r)=>{const n=r(97475),s=r(69187),i=r(26687);e.exports=class extends n{constructor(e={}){super(e),this._memoryStorage=new s}consume(e,t=1,r={}){return new Promise(((n,s)=>{const i=this.getKey(e),o=this._getKeySecDuration(r);let a=this._memoryStorage.incrby(i,t,o);if(a.remainingPoints=Math.max(this.points-a.consumedPoints,0),a.consumedPoints>this.points)this.blockDuration>0&&a.consumedPoints<=this.points+t&&(a=this._memoryStorage.set(i,a.consumedPoints,this.blockDuration)),s(a);else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let e=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));e<this.execEvenlyMinDelayMs&&(e=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(n,e,a)}else n(a)}))}penalty(e,t=1,r={}){const n=this.getKey(e);return new Promise((e=>{const s=this._getKeySecDuration(r),i=this._memoryStorage.incrby(n,t,s);i.remainingPoints=Math.max(this.points-i.consumedPoints,0),e(i)}))}reward(e,t=1,r={}){const n=this.getKey(e);return new Promise((e=>{const s=this._getKeySecDuration(r),i=this._memoryStorage.incrby(n,-t,s);i.remainingPoints=Math.max(this.points-i.consumedPoints,0),e(i)}))}block(e,t){const r=1e3*t,n=this.points+1;return this._memoryStorage.set(this.getKey(e),n,t),Promise.resolve(new i(0,0===r?-1:r,n))}set(e,t,r){const n=1e3*(r>=0?r:this.duration);return this._memoryStorage.set(this.getKey(e),t,r),Promise.resolve(new i(0,0===n?-1:n,t))}get(e){const t=this._memoryStorage.get(this.getKey(e));return null!==t&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),Promise.resolve(t)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}}},914:(e,t,r)=>{const n=r(37492),s=r(26687);function i(e){try{const t=e.client?e.client:e,{version:r}=t.topology.s.options.metadata.driver,n=r.split(".").map((e=>parseInt(e)));return{major:n[0],feature:n[1],patch:n[2]}}catch(e){return{major:0,feature:0,patch:0}}}class o extends n{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,"function"==typeof this.client.then?this.client.then((e=>{this.client=e,this._initCollection(),this._driverVersion=i(this.client)})):(this._initCollection(),this._driverVersion=i(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName=void 0===e?o.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get client(){return this._client}set client(e){if(void 0===e)throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){const e=("function"==typeof this.client.db?this.client.db(this.dbName):this.client).collection(this.tableName);e.createIndex({expire:-1},{expireAfterSeconds:0}),e.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=e}_getRateLimiterRes(e,t,r){const n=new s;let i;return i=void 0===r.value?r:r.value,n.isFirstInDuration=i.points===t,n.consumedPoints=i.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=null!==i.expire?Math.max(new Date(i.expire).getTime()-Date.now(),0):-1,n}_upsert(e,t,r,n=!1,s={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const i=s.attrs||{};let o,a;n?(o={key:e},o=Object.assign(o,i),a={$set:{key:e,points:t,expire:r>0?new Date(Date.now()+r):null}},a.$set=Object.assign(a.$set,i)):(o={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},o=Object.assign(o,i),a={$setOnInsert:{key:e,expire:r>0?new Date(Date.now()+r):null},$inc:{points:t}},a.$setOnInsert=Object.assign(a.$setOnInsert,i));const c={upsert:!0};return this._driverVersion.major>=4||3===this._driverVersion.major&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?c.returnDocument="after":c.returnOriginal=!1,new Promise(((s,l)=>{this._collection.findOneAndUpdate(o,a,c).then((e=>{s(e)})).catch((o=>{if(o&&11e3===o.code){const o=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},i),a={$set:Object.assign({key:e,points:t,expire:r>0?new Date(Date.now()+r):null},i)};this._collection.findOneAndUpdate(o,a,c).then((e=>{s(e)})).catch((i=>{i&&11e3===i.code?this._upsert(e,t,r,n).then((e=>s(e))).catch((e=>l(e))):l(i)}))}else l(o)}))}))}_get(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const r=t.attrs||{},n=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},r);return this._collection.findOne(n)}_delete(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const r=t.attrs||{},n=Object.assign({key:e},r);return this._collection.deleteOne(n).then((e=>e.deletedCount>0))}}e.exports=o},13596:(e,t,r)=>{const n=r(37492),s=r(26687);e.exports=class extends n{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()):this._createDbAndTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()})).catch((e=>{if("function"!=typeof t)throw e;t(e)}))}clearExpired(e){return new Promise((t=>{this._getConnection().then((r=>{r.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],(()=>{this._releaseConnection(r),t()}))})).catch((()=>{t()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise(((e,t)=>{this.client.getConnection(((r,n)=>{if(r)return t(r);e(n)}))}));case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise(((e,t)=>{this._getConnection().then((r=>{r.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,(n=>{if(n)return this._releaseConnection(r),t(n);r.query(this._getCreateTableStmt(),(n=>{if(n)return this._releaseConnection(r),t(n);this._releaseConnection(r),e()}))}))})).catch((e=>{t(e)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if(void 0===e)if("Connection"===this.client.constructor.name)e="connection";else if("Pool"===this.client.constructor.name)e="pool";else{if("Sequelize"!==this.client.constructor.name)throw new Error("storeType is not defined");e="sequelize"}this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName=void 0===e?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=void 0!==e&&!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=void 0===e||Boolean(e)}_getRateLimiterRes(e,t,r){const n=new s,[i]=r;return n.isFirstInDuration=t===i.points,n.consumedPoints=n.isFirstInDuration?t:i.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=i.expire?Math.max(i.expire-Date.now(),0):-1,n}_upsertTransaction(e,t,r,n,s){return new Promise(((i,o)=>{e.query("BEGIN",(a=>{if(a)return e.rollback(),o(a);const c=Date.now(),l=n>0?c+n:null;let h,u;s?(h="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = ?, \n            expire = ?;",u=[this.dbName,this.tableName,t,r,l,r,l]):(h="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = IF(expire <= ?, ?, points + (?)), \n            expire = IF(expire <= ?, ?, expire);",u=[this.dbName,this.tableName,t,r,l,c,r,r,c,l]),e.query(h,u,(r=>{if(r)return e.rollback(),o(r);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,t],((t,r)=>{if(t)return e.rollback(),o(t);e.query("COMMIT",(t=>{if(t)return e.rollback(),o(t);i(r)}))}))}))}))}))}_upsert(e,t,r,n=!1){return this.tableCreated?new Promise(((s,i)=>{this._getConnection().then((o=>{this._upsertTransaction(o,e,t,r,n).then((e=>{s(e),this._releaseConnection(o)})).catch((e=>{i(e),this._releaseConnection(o)}))})).catch((e=>{i(e)}))})):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise(((t,r)=>{this._getConnection().then((n=>{n.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],((e,s)=>{e?r(e):0===s.length?t(null):t(s),this._releaseConnection(n)}))})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise(((t,r)=>{this._getConnection().then((n=>{n.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],((e,s)=>{e?r(e):t(s.affectedRows>0),this._releaseConnection(n)}))})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}}},12224:(e,t,r)=>{const n=r(37492),s=r(26687);e.exports=class extends n{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?"function"==typeof t&&t():this._createTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()})).catch((e=>{if("function"!=typeof t)throw e;t(e)}))}clearExpired(e){return new Promise((t=>{const r={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[e]};this._query(r).then((()=>{t()})).catch((()=>{t()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":default:return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master)}}_releaseConnection(e){switch(this.clientType){case"pool":case"typeorm":default:return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e)}}_createTable(){return new Promise(((e,t)=>{this._query({text:this._getCreateTableStmt()}).then((()=>{e()})).catch((r=>{"23505"===r.code?e():t(r)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( \n      key varchar(255) PRIMARY KEY,\n      points integer NOT NULL DEFAULT 0,\n      expire bigint\n    );`}get clientType(){return this._clientType}set clientType(e){const t=this.client.constructor.name;if(void 0===e)if("Client"===t)e="client";else if("Pool"===t||"BoundPool"===t)e="pool";else{if("Sequelize"!==t)throw new Error("storeType is not defined");e="sequelize"}this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=void 0!==e&&!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=void 0===e||Boolean(e)}_getRateLimiterRes(e,t,r){const n=new s,i=r.rows[0];return n.isFirstInDuration=t===i.points,n.consumedPoints=n.isFirstInDuration?t:i.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=i.expire?Math.max(i.expire-Date.now(),0):-1,n}_query(e){const t={name:`${this.tableName.toLowerCase()}:${e.name}`,text:e.text,values:e.values};return new Promise(((e,r)=>{this._getConnection().then((n=>{n.query(t).then((t=>{e(t),this._releaseConnection(n)})).catch((e=>{r(e),this._releaseConnection(n)}))})).catch((e=>{r(e)}))}))}_upsert(e,t,r,n=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));const s=r>0?Date.now()+r:null,i=n?" $3 ":` CASE\n             WHEN ${this.tableName}.expire <= $4 THEN $3\n             ELSE ${this.tableName}.expire\n            END `;return this._query({name:n?"rlflx-upsert-force":"rlflx-upsert",text:`\n            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)\n              ON CONFLICT(key) DO UPDATE SET\n                points = CASE\n                          WHEN (${this.tableName}.expire <= $4 OR 1=${n?1:0}) THEN $2\n                          ELSE ${this.tableName}.points + ($2)\n                         END,\n                expire = ${i}\n            RETURNING points, expire;`,values:[e,t,s,Date.now()]})}_get(e){return this.tableCreated?new Promise(((t,r)=>{this._query({name:"rlflx-get",text:`\n            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then((e=>{0===e.rowCount&&(e=null),t(e)})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[e]}).then((e=>e.rowCount>0)):Promise.reject(Error("Table is not created yet"))}}},97671:(e,t,r)=>{const n=r(14528),s=4294967295;e.exports=class{constructor(e,t={maxQueueSize:s}){this._queueLimiters={KEY_DEFAULT:new i(e,t)},this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(e="limiter"){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,t="limiter"){return this._queueLimiters[t]||(this._queueLimiters[t]=new i(this._limiterFlexible,{key:t,maxQueueSize:this._maxQueueSize})),this._queueLimiters[t].removeTokens(e)}};class i{constructor(e,t={maxQueueSize:s,key:"limiter"}){this._key=t.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then((e=>null!==e?e.remainingPoints:this._limiterFlexible.points))}removeTokens(e){const t=this;return new Promise(((r,s)=>{e>t._limiterFlexible.points?s(new n(`Requested tokens ${e} exceeds maximum ${t._limiterFlexible.points} tokens per interval`)):t._queue.length>0?t._queueRequest.call(t,r,s,e):t._limiterFlexible.consume(t._key,e).then((e=>{r(e.remainingPoints)})).catch((n=>{n instanceof Error?s(n):(t._queueRequest.call(t,r,s,e),null===t._waitTimeout&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),n.msBeforeNext)))}))}))}_queueRequest(e,t,r){const s=this;s._queue.length<s._maxQueueSize?s._queue.push({resolve:e,reject:t,tokens:r}):t(new n(`Number of requests reached it's maximum ${s._maxQueueSize}`))}_processFIFO(){const e=this;if(null!==e._waitTimeout&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),0===e._queue.length)return;const t=e._queue.shift();e._limiterFlexible.consume(e._key,t.tokens).then((r=>{t.resolve(r.remainingPoints),e._processFIFO.call(e)})).catch((r=>{r instanceof Error?(t.reject(r),e._processFIFO.call(e)):(e._queue.unshift(t),null===e._waitTimeout&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),r.msBeforeNext)))}))}}},24719:(e,t,r)=>{const n=r(37492),s=r(26687),i="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ";e.exports=class extends n{constructor(e){super(e),e.redis?this.client=e.redis:this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,"function"==typeof this.client.defineCommand&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:i})}_isRedisReady(){return!(this._rejectIfRedisNotReady&&(this.client.status&&"ready"!==this.client.status||"function"==typeof this.client.isReady&&!this.client.isReady()))}_getRateLimiterRes(e,t,r){let[n,i]=r;Array.isArray(n)&&([,n]=n,[,i]=i);const o=new s;return o.consumedPoints=parseInt(n),o.isFirstInDuration=o.consumedPoints===t,o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.msBeforeNext=i,o}_upsert(e,t,r,n=!1){return new Promise(((s,o)=>{if(!this._isRedisReady())return o(new Error("Redis connection is not ready"));const a=Math.floor(r/1e3),c=this.client.multi();if(n)a>0?c.set(e,t,"EX",a):c.set(e,t),c.pttl(e).exec(((e,t)=>e?o(e):s(t)));else if(a>0){const r=function(e,t){return e?o(e):s(t)};"function"==typeof this.client.rlflxIncr?this.client.rlflxIncr(e,t,a,r):this.client.eval(i,1,e,t,a,r)}else c.incrby(e,t).pttl(e).exec(((e,t)=>e?o(e):s(t)))}))}_get(e){return new Promise(((t,r)=>{if(!this._isRedisReady())return r(new Error("Redis connection is not ready"));this.client.multi().get(e).pttl(e).exec(((e,n)=>{if(e)r(e);else{const[e]=n;if(null===e)return t(null);t(n)}}))}))}_delete(e){return new Promise(((t,r)=>{this.client.del(e,((e,n)=>{e?r(e):t(n>0)}))}))}}},26687:e=>{e.exports=class{constructor(e,t,r,n){this.remainingPoints=void 0===e?0:e,this.msBeforeNext=void 0===t?0:t,this.consumedPoints=void 0===r?0:r,this.isFirstInDuration=void 0!==n&&n}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=Boolean(e)}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}},37492:(e,t,r)=>{const n=r(97475),s=r(35701),i=r(26687);e.exports=class extends n{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed||e.inmemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration||e.inmemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new s}get client(){return this._client}set client(e){if(void 0===e)throw new Error("storeClient is not set");this._client=e}_afterConsume(e,t,r,n,s,i={}){const o=this._getRateLimiterRes(r,n,s);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&o.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(r,o.msBeforeNext),o.consumedPoints>this.points?t(o):e(o);if(o.consumedPoints>this.points){let e=Promise.resolve();this.blockDuration>0&&o.consumedPoints<=this.points+n&&(o.msBeforeNext=this.msBlockDuration,e=this._block(r,o.consumedPoints,this.msBlockDuration,i)),this.inMemoryBlockOnConsumed>0&&o.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(r,this.inMemoryBlockDuration),o.msBeforeNext=this.msInMemoryBlockDuration),e.then((()=>{t(o)})).catch((e=>{t(e)}))}else if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let t=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));t<this.execEvenlyMinDelayMs&&(t=o.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,t,o)}else e(o)}_handleError(e,t,r,s,i,o=!1,a={}){this.insuranceLimiter instanceof n?this.insuranceLimiter[t](i,o,a).then((e=>{r(e)})).catch((e=>{s(e)})):s(e)}get _inmemoryBlockedKeys(){return this._inMemoryBlockedKeys}getInmemoryBlockMsBeforeExpire(e){return this.getInMemoryBlockMsBeforeExpire(e)}get inmemoryBlockOnConsumed(){return this.inMemoryBlockOnConsumed}set inmemoryBlockOnConsumed(e){this.inMemoryBlockOnConsumed=e}get inmemoryBlockDuration(){return this.inMemoryBlockDuration}set inmemoryBlockDuration(e){this.inMemoryBlockDuration=e}get msInmemoryBlockDuration(){return 1e3*this.inMemoryBlockDuration}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&0===this.inMemoryBlockOnConsumed)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return 1e3*this._inMemoryBlockDuration}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if(void 0!==e&&!(e instanceof n))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,t,r={}){const n=1e3*t;return this._block(this.getKey(e),this.points+1,n,r)}set(e,t,r,n={}){const s=1e3*(r>=0?r:this.duration);return this._block(this.getKey(e),t,s,n)}consume(e,t=1,r={}){return new Promise(((n,s)=>{const o=this.getKey(e),a=this.getInMemoryBlockMsBeforeExpire(o);if(a>0)return s(new i(0,a));this._upsert(o,t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{this._afterConsume(n,s,o,t,e)})).catch((i=>{this._handleError(i,"consume",n,s,e,t,r)}))}))}penalty(e,t=1,r={}){const n=this.getKey(e);return new Promise(((s,i)=>{this._upsert(n,t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{s(this._getRateLimiterRes(n,t,e))})).catch((n=>{this._handleError(n,"penalty",s,i,e,t,r)}))}))}reward(e,t=1,r={}){const n=this.getKey(e);return new Promise(((s,i)=>{this._upsert(n,-t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{s(this._getRateLimiterRes(n,-t,e))})).catch((n=>{this._handleError(n,"reward",s,i,e,t,r)}))}))}get(e,t={}){const r=this.getKey(e);return new Promise(((n,s)=>{this._get(r,t).then((e=>{n(null==e?null:this._getRateLimiterRes(r,0,e))})).catch((r=>{this._handleError(r,"get",n,s,e,t)}))}))}delete(e,t={}){const r=this.getKey(e);return new Promise(((n,s)=>{this._delete(r,t).then((e=>{this._inMemoryBlockedKeys.delete(r),n(e)})).catch((r=>{this._handleError(r,"delete",n,s,e,t)}))}))}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,t,r){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,t,r,n={}){return new Promise(((s,o)=>{this._upsert(e,t,r,!0,n).then((()=>{s(new i(0,r>0?r:-1,t))})).catch((t=>{this._handleError(t,"block",s,o,this.parseKey(e),r/1e3,n)}))}))}_get(e,t={}){throw new Error("You have to implement the method '_get'!")}_delete(e,t={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,t,r,n=!1,s={}){throw new Error("You have to implement the method '_upsert'!")}}},42521:(e,t,r)=>{const n=r(97475);e.exports=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach((e=>{if(!(e instanceof n))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")})),this._limiters=e}consume(e,t=1){return new Promise(((r,n)=>{const s=[];this._limiters.forEach((r=>{s.push(r.consume(e,t).catch((e=>({rejected:!0,rej:e}))))})),Promise.all(s).then((e=>{const t={};let s=!1;e.forEach((e=>{!0===e.rejected&&(s=!0)}));for(let r=0;r<e.length;r++)s&&!0===e[r].rejected?t[this._limiters[r].keyPrefix]=e[r].rej:s||(t[this._limiters[r].keyPrefix]=e[r]);s?n(t):r(t)}))}))}}},26165:e=>{e.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){const e=Date.now();Object.keys(this._keys).forEach((t=>{this._keys[t]<=e&&delete this._keys[t]})),this._addedKeysAmount=Object.keys(this._keys).length}add(e,t){this.addMs(e,1e3*t)}addMs(e,t){this._keys[e]=Date.now()+t,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){const t=this._keys[e];if(t&&t>=Date.now()){this.collectExpired();const e=Date.now();return t>=e?t-e:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach((e=>{delete this._keys[e]}))}}},35701:(e,t,r)=>{const n=r(26165);e.exports=n},69187:(e,t,r)=>{const n=r(82757),s=r(26687);e.exports=class{constructor(){this._storage={}}incrby(e,t,r){if(this._storage[e]){const n=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-(new Date).getTime():-1;return 0!==n?(this._storage[e].value=this._storage[e].value+t,new s(0,n,this._storage[e].value,!1)):this.set(e,t,r)}return this.set(e,t,r)}set(e,t,r){const i=1e3*r;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new n(t,i>0?new Date(Date.now()+i):null),i>0&&(this._storage[e].timeoutId=setTimeout((()=>{delete this._storage[e]}),i),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new s(0,0===i?-1:i,this._storage[e].value,!0)}get(e){if(this._storage[e]){const t=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-(new Date).getTime():-1;return new s(0,t,this._storage[e].value,!1)}return null}delete(e){return!!this._storage[e]&&(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0)}}},82757:e=>{e.exports=class{constructor(e,t,r=null){this.value=e,this.expiresAt=t,this.timeoutId=r}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){e instanceof Date||!Number.isInteger(e)||(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}}},14528:e=>{e.exports=class extends Error{constructor(e,t){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,t&&(this.extra=t)}}},67172:(e,t,r)=>{"use strict";e.exports=o;var n=r(8645),s=o.prototype,i=new Date%1e9;function o(e){e=e||{},this.id=e.id||(1e9*Math.random()>>>0)+i++,this.max=e.max||1/0,this.items=e.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(e.lastModified||new Date);for(var t,r,n=this.items.length;n--;)t=this.items[n],r=new Date(t.expires)-new Date,this._lookup[t.key]=t,r>0?this.expire(t.key,r):r<=0&&this.delete(t.key)}s.has=function(e){return e in this._lookup},s.get=function(e){if(!this.has(e))return null;var t=this._lookup[e];return t.refresh&&this.expire(e,t.refresh),this.items.splice(this.items.indexOf(t),1),this.items.push(t),t.value},s.meta=function(e){if(!this.has(e))return null;var t=this._lookup[e];return"meta"in t?t.meta:null},s.set=function(e,t,r){var n=this._lookup[e],s=this._lookup[e]={key:e,value:t};return this.lastModified=new Date,n?(clearTimeout(n.timeout),this.items.splice(this.items.indexOf(n),1,s)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(s),this.size++),r&&("ttl"in r&&this.expire(e,r.ttl),"meta"in r&&(s.meta=r.meta),r.refresh&&(s.refresh=r.ttl)),this},s.delete=function(e){var t=this._lookup[e];return!!t&&(this.lastModified=new Date,this.items.splice(this.items.indexOf(t),1),clearTimeout(t.timeout),delete this._lookup[e],this.size--,this)},s.expire=function(e,t){var r=t||0,s=this._lookup[e];if(!s)return this;if("string"==typeof r&&(r=n(t)),"number"!=typeof r)throw new TypeError("Expiration time must be a string or number.");return clearTimeout(s.timeout),s.timeout=setTimeout(this.delete.bind(this,s.key),r),s.expires=Number(new Date)+r,this},s.clear=function(){for(var e=this.items.length;e--;)this.delete(this.items[e].key);return this},s.toJSON=function(){for(var e,t=new Array(this.items.length),r=t.length;r--;)e=this.items[r],t[r]={key:e.key,meta:e.meta,value:e.value,expires:e.expires,refresh:e.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:t}}},21233:(e,t,r)=>{"use strict";const n=r(92730);class s{constructor(e,t,r){const s=this;this._started=n(),this._rescheduled=0,this._scheduled=t,this._args=r,this._triggered=!1,this._timerWrapper=()=>{s._rescheduled>0?(s._scheduled=s._rescheduled-(n()-s._started),s._schedule(s._scheduled)):(s._triggered=!0,e.apply(null,s._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);const t=n();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=n(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}e.exports=function(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("timeout needed");let e;if(arguments.length>0){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new s(arguments[0],arguments[1],e)}},92730:e=>{"use strict";e.exports=function(){return Date.now()}},25161:(e,t,r)=>{e.exports=function(e,t,r){if("number"!=typeof t)throw new Error("second argument must be a Number");let s,i,o,a,c,l,h=!0;function u(e){function t(){r&&r(e,s),r=null}h?n(t):t()}function d(t,r,n){if(s[t]=n,r&&(c=!0),0==--o||r)u(r);else if(!c&&l<i){let t;a?(t=a[l],l+=1,e[t]((function(e,r){d(t,e,r)}))):(t=l,l+=1,e[t]((function(e,r){d(t,e,r)})))}}Array.isArray(e)?(s=[],o=i=e.length):(a=Object.keys(e),s={},o=i=a.length),l=t,o?a?a.some((function(r,n){return e[r]((function(e,t){d(r,e,t)})),n===t-1})):e.some((function(e,r){return e((function(e,t){d(r,e,t)})),r===t-1})):u(null),h=!1};const n=r(94715)},62666:(e,t,r)=>{var n=r(83107),s=n.Buffer;function i(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return s(e,t,r)}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=n:(i(n,t),t.Buffer=o),o.prototype=Object.create(s.prototype),i(s,o),o.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return s(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=s(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return s(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},7314:(e,t,r)=>{"use strict";var n=r(65212),s=/[\/\?<>\\:\*\|"]/g,i=/[\x00-\x1f\x80-\x9f]/g,o=/^\.+$/,a=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,c=/[\. ]+$/;function l(e,t){if("string"!=typeof e)throw new Error("Input must be string");var r=e.replace(s,t).replace(i,t).replace(o,t).replace(a,t).replace(c,t);return n(r,255)}e.exports=function(e,t){var r=t&&t.replacement||"",n=l(e,r);return""===r?n:l(n,"")}},35609:e=>{"use strict";const t=new Map;e.exports={setDelayedInterval:function(e,r,n){n=n||r;const s=`${Date.now()}:${Math.floor(1e6*Math.random())}`,i=setTimeout((()=>{!async function(e,r,n){for(;t.get(n);){try{await e()}catch(e){setTimeout((()=>{throw e}),1);break}if(!t.get(n))break;await new Promise((e=>{const s=setTimeout(e,r);t.set(n,s)}))}}(e,r,s)}),n);return t.set(s,i),s},clearDelayedInterval:function(e){const r=t.get(e);r&&(clearTimeout(r),t.delete(e))}}},92891:e=>{"use strict";function t(e,t){return e+r(t)}function r(e){let t=e;return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),16843009*(t+(t>>4)&252645135)>>24}function n(e,t){return e[0]-t[0]}function s(e){return e[1]}e.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let r=this._internalPositionFor(e,!1);if(void 0===t)-1!==r&&(this._unsetInternalPos(r),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let n=!1;-1===r?(r=this._data.length,this._setBit(e),this._changedData=!0):n=!0,this._setInternalPos(r,e,t,n),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();const t=this._internalPositionFor(e,!0);if(-1!==t)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){const e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,r=new Array(this.length);for(;t<this.length;)r[t]=e(this.get(t),t,this),t++;return r}reduce(e,t){let r=0,n=t;for(;r<this.length;)n=e(n,this.get(r),r),r++;return n}find(e){let t,r,n=0;for(;n<this.length&&!t;)r=this.get(n),t=e(r),n++;return t?r:void 0}_internalPositionFor(e,n){const s=this._bytePosFor(e,n);if(s>=this._bitArrays.length)return-1;const i=this._bitArrays[s],o=e-7*s;return(i&1<<o)>0?this._bitArrays.slice(0,s).reduce(t,0)+r(i&~(4294967295<<o+1))-1:-1}_bytePosFor(e,t){const r=Math.floor(e/7),n=r+1;for(;!t&&this._bitArrays.length<n;)this._bitArrays.push(0);return r}_setBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-7*t}_unsetBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-7*t)}_setInternalPos(e,t,r,n){const s=this._data,i=[t,r];if(n)this._sortData(),s[e]=i;else{if(s.length)if(s[s.length-1][0]>=t)s.push(i);else if(s[0][0]<=t)s.unshift(i);else{const e=Math.round(s.length/2);this._data=s.slice(0,e).concat(i).concat(s.slice(e))}else this._data.push(i);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(n),this._changedData=!1}bitField(){const e=[];let t,r=8,n=0,s=0;const i=this._bitArrays.slice();for(;i.length||n;){0===n&&(t=i.shift(),n=7);const o=Math.min(n,r);s|=(t&~(255<<o))<<8-r,t>>>=o,n-=o,r-=o,r&&(n||i.length)||(e.push(s),s=0,r=8)}for(var o=e.length-1;o>0&&0===e[o];o--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(s)}}},18901:e=>{e.exports=e=>{if(e[Symbol.asyncIterator])return e;if(e.getReader)return async function*(){const t=e.getReader();try{for(;;){const{done:e,value:r}=await t.read();if(e)return;yield r}}finally{t.releaseLock()}}();throw new Error("unknown stream")}},12964:(e,t,r)=>{"use strict";const{AbortController:n}=globalThis,s=r(21233);class i extends n{constructor(e){super(),this._ms=e,this._timer=s((()=>this.abort()),e),Object.setPrototypeOf(this,i.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=s((()=>this.abort()),this._ms)}}e.exports={TimeoutController:i}},37543:e=>{!function(){e.exports=f;var t=3200,r=100982246400,n=1e3*r,s=864e13,i=4294967296,o=1e6,a=1e9,c="000000000",l=Math.trunc||function(e){var t=e-e%1;return 0===t&&(e<0||0===e&&1/e!=1/0)?-0:t},h=f.prototype;f.fromDate=function(e){return new f(+e)},f.fromInt64BE=b(0,1,2,3,0,4),f.fromInt64LE=b(3,2,1,0,4,0),f.fromString=function(e){var t,r=new f,n=(e+="").replace(/^\s*[+\-]?\d+/,(function(e){var t=+e,n=1970+(t-1970)%400;return r.year=t-n,n})).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,(function(e,r,n){return r<0&&(n*=-1),t=6e4*(60*+r+ +n),""})).replace(/\.\d+$/,(function(e){return r.nano=+(e+c).substr(1,9),""})).split(/\D+/);if(n.length>1?n[1]--:n[1]=0,r.time=t=Date.UTC.apply(Date,n)-(t||0),isNaN(t))throw new TypeError("Invalid Date");return y(r)},f.fromTimeT=function(e){return m(e,0)},h.year=0,h.time=0,h.nano=0,h.addNano=function(e){return this.nano+=+e||0,this},h.getNano=function(){var e=y(this);return(e.time%1e3*o+ +e.nano+a)%a},h.getTimeT=function(){var e=y(this),r=Math.floor(e.time/1e3),n=e.year;return n&&(r+=1168776*n*86400/t),r},h.getYear=function(){return this.toDate().getUTCFullYear()+this.year},h.toDate=function(){return g(y(this).time)},h.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},h.toString=function(e){var t=this,r=t.toDate(),n={H:function(){return E(r.getUTCHours())},L:function(){return _(r.getUTCMilliseconds(),3)},M:function(){return E(r.getUTCMinutes())},N:function(){return _(t.getNano(),9)},S:function(){return E(r.getUTCSeconds())},Y:function(){var e=t.getYear();return e>999999?"+"+e:e>9999?"+"+_(e,6):e>=0?_(e,4):e>=-999999?"-"+_(-e,6):e},a:function(){return d[r.getUTCDay()]},b:function(){return u[r.getUTCMonth()]},d:function(){return E(r.getUTCDate())},e:function(){return((e=r.getUTCDate())>9?"":" ")+(0|e);var e},m:function(){return E(r.getUTCMonth()+1)}};return function e(t){return t.replace(/%./g,(function(t){var r=t[1],s=p[r],i=n[r];return s?e(s):i?i():t}))}(e||"%Y-%m-%dT%H:%M:%S.%NZ")},h.writeInt64BE=w(0,1,2,3,0,4),h.writeInt64LE=w(3,2,1,0,4,0);var u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],p={"%":"%",F:"%Y-%m-%d",n:"\n",R:"%H:%M",T:"%H:%M:%S",t:"\t",X:"%T",Z:"GMT",z:"+0000"};return f;function f(e,t,r){var n=this;if(!(n instanceof f))return new f(e,t,r);n.time=+e||0,n.nano=+t||0,n.year=+r||0,y(n)}function y(e){var r,i,a=e.year,c=e.time,h=e.nano;if(h<0||o<=h){var u=Math.floor(h/o);h-=u*o,c+=u,r=1}var d=a%t;if(c<-s||s<c||d){(i=l(c/n))&&(a+=i*t,c-=i*n);var p=g(c);p.setUTCFullYear(d+p.getUTCFullYear());var f=(c=+p)+(i=l((a-=d)/t))*n;i&&-s<=f&&f<=s&&(a-=i*t,c=f),r=1}return r&&(e.year=a,e.time=c,e.nano=h),e}function g(e){var t=new Date(0);return t.setTime(e),t}function m(e,n){n|=0,e=+e||0;var s=l((n*=i)/r)+l(e/r),o=n%r+e%r,a=l(o/r);return a&&(s+=a,o-=a*r),new f(1e3*o,0,s*t)}function w(e,t,r,n,s,o){return function(e,t){var r=y(this);e||(e=new Array(8)),v(e,t|=0);var n=Math.floor(r.time/1e3),c=31556952*r.year,h=l(c/i)+l(n/i),u=c%i+n%i,d=Math.floor(u/i);return d&&(h+=d,u-=d*i),a(e,t+s,h),a(e,t+o,u),e};function a(s,i,o){s[i+e]=o>>24&255,s[i+t]=o>>16&255,s[i+r]=o>>8&255,s[i+n]=255&o}}function b(e,t,r,n,s,i){return function(e,t){v(e,t|=0);var r=o(e,t+s);return m(o(e,t+i),r)};function o(s,i){return 16777216*s[i+e]+(s[i+t]<<16|s[i+r]<<8|s[i+n])}}function v(e,t){var r=e&&e.length;if(null==r)throw new TypeError("Invalid Buffer");if(r<t+8)throw new RangeError("Out of range")}function E(e){return(e>9?"":"0")+(0|e)}function _(e,t){return(c+(0|e)).substr(-t)}}()},65212:(e,t,r)=>{"use strict";var n=r(26254),s=r(76515);e.exports=n.bind(null,s)},26254:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function r(e){return e>=56320&&e<=57343}e.exports=function(e,n,s){if("string"!=typeof n)throw new Error("Input must be string");for(var i,o,a=n.length,c=0,l=0;l<a;l+=1){if(i=n.charCodeAt(l),o=n[l],t(i)&&r(n.charCodeAt(l+1))&&(o+=n[l+=1]),(c+=e(o))===s)return n.slice(0,l+1);if(c>s)return n.slice(0,l-o.length+1)}return n}},76515:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function r(e){return e>=56320&&e<=57343}e.exports=function(e){if("string"!=typeof e)throw new Error("Input must be string");for(var n=e.length,s=0,i=null,o=null,a=0;a<n;a++)r(i=e.charCodeAt(a))?null!=o&&t(o)?s+=1:s+=3:i<=127?s+=1:i>=128&&i<=2047?s+=2:i>=2048&&i<=65535&&(s+=3),o=i;return s}},77877:e=>{e.exports=function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(127&n)<<i:(127&n)*Math.pow(2,i),i+=7}while(n>=128);return e.bytes=o-r,s}},96608:e=>{e.exports=function e(r,n,s){n=n||[];for(var i=s=s||0;r>=t;)n[s++]=255&r|128,r/=128;for(;-128&r;)n[s++]=255&r|128,r>>>=7;return n[s]=0|r,e.bytes=s-i+1,n};var t=Math.pow(2,31)},70393:(e,t,r)=>{e.exports={encode:r(96608),decode:r(77877),encodingLength:r(38559)}},38559:e=>{var t=Math.pow(2,7),r=Math.pow(2,14),n=Math.pow(2,21),s=Math.pow(2,28),i=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),l=Math.pow(2,63);e.exports=function(e){return e<t?1:e<r?2:e<n?3:e<s?4:e<i?5:e<o?6:e<a?7:e<c?8:e<l?9:10}},56566:(e,t,r)=>{"use strict";const n=r(70393);e.exports=e=>{if(!(e instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const t=[];for(;e.length>0;){const r=n.decode(e);t.push(r),e=e.slice(n.decode.bytes)}return t}},48231:e=>{e.exports=function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a||i>49)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(127&n)<<i:(127&n)*Math.pow(2,i),i+=7}while(n>=128);return e.bytes=o-r,s}},94836:e=>{e.exports=function e(r,n,s){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");n=n||[];for(var i=s=s||0;r>=t;)n[s++]=255&r|128,r/=128;for(;-128&r;)n[s++]=255&r|128,r>>>=7;return n[s]=0|r,e.bytes=s-i+1,n};var t=Math.pow(2,31)},44324:(e,t,r)=>{e.exports={encode:r(94836),decode:r(48231),encodingLength:r(92773)}},92773:e=>{var t=Math.pow(2,7),r=Math.pow(2,14),n=Math.pow(2,21),s=Math.pow(2,28),i=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),l=Math.pow(2,63);e.exports=function(e){return e<t?1:e<r?2:e<n?3:e<s?4:e<i?5:e<o?6:e<a?7:e<c?8:e<l?9:10}},64482:function(e,t,r){"use strict";var n,s,i;s=[r(43161)],void 0===(i="function"==typeof(n=function(e){var t=e.Reader,r=e.Writer,n=e.util,s=e.roots.default||(e.roots.default={});return s.RPC=function(){function i(e){if(this.subscriptions=[],this.messages=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.subscriptions=n.emptyArray,i.prototype.messages=n.emptyArray,i.prototype.control=null,Object.defineProperty(i.prototype,"_control",{get:n.oneOfGetter(o=["control"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){if(t||(t=r.create()),null!=e.subscriptions&&e.subscriptions.length)for(var n=0;n<e.subscriptions.length;++n)s.RPC.SubOpts.encode(e.subscriptions[n],t.uint32(10).fork()).ldelim();if(null!=e.messages&&e.messages.length)for(n=0;n<e.messages.length;++n)s.RPC.Message.encode(e.messages[n],t.uint32(18).fork()).ldelim();return null!=e.control&&Object.hasOwnProperty.call(e,"control")&&s.RPC.ControlMessage.encode(e.control,t.uint32(26).fork()).ldelim(),t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.subscriptions&&i.subscriptions.length||(i.subscriptions=[]),i.subscriptions.push(s.RPC.SubOpts.decode(e,e.uint32()));break;case 2:i.messages&&i.messages.length||(i.messages=[]),i.messages.push(s.RPC.Message.decode(e,e.uint32()));break;case 3:i.control=s.RPC.ControlMessage.decode(e,e.uint32());break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC)return e;var t=new s.RPC;if(e.subscriptions){if(!Array.isArray(e.subscriptions))throw TypeError(".RPC.subscriptions: array expected");t.subscriptions=[];for(var r=0;r<e.subscriptions.length;++r){if("object"!=typeof e.subscriptions[r])throw TypeError(".RPC.subscriptions: object expected");t.subscriptions[r]=s.RPC.SubOpts.fromObject(e.subscriptions[r])}}if(e.messages){if(!Array.isArray(e.messages))throw TypeError(".RPC.messages: array expected");for(t.messages=[],r=0;r<e.messages.length;++r){if("object"!=typeof e.messages[r])throw TypeError(".RPC.messages: object expected");t.messages[r]=s.RPC.Message.fromObject(e.messages[r])}}if(null!=e.control){if("object"!=typeof e.control)throw TypeError(".RPC.control: object expected");t.control=s.RPC.ControlMessage.fromObject(e.control)}return t},i.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.subscriptions=[],r.messages=[]),e.subscriptions&&e.subscriptions.length){r.subscriptions=[];for(var n=0;n<e.subscriptions.length;++n)r.subscriptions[n]=s.RPC.SubOpts.toObject(e.subscriptions[n],t)}if(e.messages&&e.messages.length)for(r.messages=[],n=0;n<e.messages.length;++n)r.messages[n]=s.RPC.Message.toObject(e.messages[n],t);return null!=e.control&&e.hasOwnProperty("control")&&(r.control=s.RPC.ControlMessage.toObject(e.control,t),t.oneofs&&(r._control="control")),r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i.SubOpts=function(){function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.subscribe=null,i.prototype.topic=null,Object.defineProperty(i.prototype,"_subscribe",{get:n.oneOfGetter(o=["subscribe"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_topic",{get:n.oneOfGetter(o=["topic"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=r.create()),null!=e.subscribe&&Object.hasOwnProperty.call(e,"subscribe")&&t.uint32(8).bool(e.subscribe),null!=e.topic&&Object.hasOwnProperty.call(e,"topic")&&t.uint32(18).string(e.topic),t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.SubOpts;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.subscribe=e.bool();break;case 2:i.topic=e.string();break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.SubOpts)return e;var t=new s.RPC.SubOpts;return null!=e.subscribe&&(t.subscribe=Boolean(e.subscribe)),null!=e.topic&&(t.topic=String(e.topic)),t},i.toObject=function(e,t){t||(t={});var r={};return null!=e.subscribe&&e.hasOwnProperty("subscribe")&&(r.subscribe=e.subscribe,t.oneofs&&(r._subscribe="subscribe")),null!=e.topic&&e.hasOwnProperty("topic")&&(r.topic=e.topic,t.oneofs&&(r._topic="topic")),r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.Message=function(){function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.from=null,i.prototype.data=null,i.prototype.seqno=null,i.prototype.topic="",i.prototype.signature=null,i.prototype.key=null,Object.defineProperty(i.prototype,"_from",{get:n.oneOfGetter(o=["from"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_data",{get:n.oneOfGetter(o=["data"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_seqno",{get:n.oneOfGetter(o=["seqno"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_signature",{get:n.oneOfGetter(o=["signature"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_key",{get:n.oneOfGetter(o=["key"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=r.create()),null!=e.from&&Object.hasOwnProperty.call(e,"from")&&t.uint32(10).bytes(e.from),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),null!=e.seqno&&Object.hasOwnProperty.call(e,"seqno")&&t.uint32(26).bytes(e.seqno),t.uint32(34).string(e.topic),null!=e.signature&&Object.hasOwnProperty.call(e,"signature")&&t.uint32(42).bytes(e.signature),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(50).bytes(e.key),t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var i=void 0===r?e.len:e.pos+r,o=new s.RPC.Message;e.pos<i;){var a=e.uint32();switch(a>>>3){case 1:o.from=e.bytes();break;case 2:o.data=e.bytes();break;case 3:o.seqno=e.bytes();break;case 4:o.topic=e.string();break;case 5:o.signature=e.bytes();break;case 6:o.key=e.bytes();break;default:e.skipType(7&a)}}if(!o.hasOwnProperty("topic"))throw n.ProtocolError("missing required 'topic'",{instance:o});return o},i.fromObject=function(e){if(e instanceof s.RPC.Message)return e;var t=new s.RPC.Message;return null!=e.from&&("string"==typeof e.from?n.base64.decode(e.from,t.from=n.newBuffer(n.base64.length(e.from)),0):e.from.length&&(t.from=e.from)),null!=e.data&&("string"==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),null!=e.seqno&&("string"==typeof e.seqno?n.base64.decode(e.seqno,t.seqno=n.newBuffer(n.base64.length(e.seqno)),0):e.seqno.length&&(t.seqno=e.seqno)),null!=e.topic&&(t.topic=String(e.topic)),null!=e.signature&&("string"==typeof e.signature?n.base64.decode(e.signature,t.signature=n.newBuffer(n.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),null!=e.key&&("string"==typeof e.key?n.base64.decode(e.key,t.key=n.newBuffer(n.base64.length(e.key)),0):e.key.length&&(t.key=e.key)),t},i.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.topic=""),null!=e.from&&e.hasOwnProperty("from")&&(r.from=t.bytes===String?n.base64.encode(e.from,0,e.from.length):t.bytes===Array?Array.prototype.slice.call(e.from):e.from,t.oneofs&&(r._from="from")),null!=e.data&&e.hasOwnProperty("data")&&(r.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data,t.oneofs&&(r._data="data")),null!=e.seqno&&e.hasOwnProperty("seqno")&&(r.seqno=t.bytes===String?n.base64.encode(e.seqno,0,e.seqno.length):t.bytes===Array?Array.prototype.slice.call(e.seqno):e.seqno,t.oneofs&&(r._seqno="seqno")),null!=e.topic&&e.hasOwnProperty("topic")&&(r.topic=e.topic),null!=e.signature&&e.hasOwnProperty("signature")&&(r.signature=t.bytes===String?n.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature,t.oneofs&&(r._signature="signature")),null!=e.key&&e.hasOwnProperty("key")&&(r.key=t.bytes===String?n.base64.encode(e.key,0,e.key.length):t.bytes===Array?Array.prototype.slice.call(e.key):e.key,t.oneofs&&(r._key="key")),r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlMessage=function(){function i(e){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return i.prototype.ihave=n.emptyArray,i.prototype.iwant=n.emptyArray,i.prototype.graft=n.emptyArray,i.prototype.prune=n.emptyArray,i.encode=function(e,t){if(t||(t=r.create()),null!=e.ihave&&e.ihave.length)for(var n=0;n<e.ihave.length;++n)s.RPC.ControlIHave.encode(e.ihave[n],t.uint32(10).fork()).ldelim();if(null!=e.iwant&&e.iwant.length)for(n=0;n<e.iwant.length;++n)s.RPC.ControlIWant.encode(e.iwant[n],t.uint32(18).fork()).ldelim();if(null!=e.graft&&e.graft.length)for(n=0;n<e.graft.length;++n)s.RPC.ControlGraft.encode(e.graft[n],t.uint32(26).fork()).ldelim();if(null!=e.prune&&e.prune.length)for(n=0;n<e.prune.length;++n)s.RPC.ControlPrune.encode(e.prune[n],t.uint32(34).fork()).ldelim();return t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.ControlMessage;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.ihave&&i.ihave.length||(i.ihave=[]),i.ihave.push(s.RPC.ControlIHave.decode(e,e.uint32()));break;case 2:i.iwant&&i.iwant.length||(i.iwant=[]),i.iwant.push(s.RPC.ControlIWant.decode(e,e.uint32()));break;case 3:i.graft&&i.graft.length||(i.graft=[]),i.graft.push(s.RPC.ControlGraft.decode(e,e.uint32()));break;case 4:i.prune&&i.prune.length||(i.prune=[]),i.prune.push(s.RPC.ControlPrune.decode(e,e.uint32()));break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlMessage)return e;var t=new s.RPC.ControlMessage;if(e.ihave){if(!Array.isArray(e.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");t.ihave=[];for(var r=0;r<e.ihave.length;++r){if("object"!=typeof e.ihave[r])throw TypeError(".RPC.ControlMessage.ihave: object expected");t.ihave[r]=s.RPC.ControlIHave.fromObject(e.ihave[r])}}if(e.iwant){if(!Array.isArray(e.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");for(t.iwant=[],r=0;r<e.iwant.length;++r){if("object"!=typeof e.iwant[r])throw TypeError(".RPC.ControlMessage.iwant: object expected");t.iwant[r]=s.RPC.ControlIWant.fromObject(e.iwant[r])}}if(e.graft){if(!Array.isArray(e.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");for(t.graft=[],r=0;r<e.graft.length;++r){if("object"!=typeof e.graft[r])throw TypeError(".RPC.ControlMessage.graft: object expected");t.graft[r]=s.RPC.ControlGraft.fromObject(e.graft[r])}}if(e.prune){if(!Array.isArray(e.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");for(t.prune=[],r=0;r<e.prune.length;++r){if("object"!=typeof e.prune[r])throw TypeError(".RPC.ControlMessage.prune: object expected");t.prune[r]=s.RPC.ControlPrune.fromObject(e.prune[r])}}return t},i.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.ihave=[],r.iwant=[],r.graft=[],r.prune=[]),e.ihave&&e.ihave.length){r.ihave=[];for(var n=0;n<e.ihave.length;++n)r.ihave[n]=s.RPC.ControlIHave.toObject(e.ihave[n],t)}if(e.iwant&&e.iwant.length)for(r.iwant=[],n=0;n<e.iwant.length;++n)r.iwant[n]=s.RPC.ControlIWant.toObject(e.iwant[n],t);if(e.graft&&e.graft.length)for(r.graft=[],n=0;n<e.graft.length;++n)r.graft[n]=s.RPC.ControlGraft.toObject(e.graft[n],t);if(e.prune&&e.prune.length)for(r.prune=[],n=0;n<e.prune.length;++n)r.prune[n]=s.RPC.ControlPrune.toObject(e.prune[n],t);return r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlIHave=function(){function i(e){if(this.messageIDs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.topicID=null,i.prototype.messageIDs=n.emptyArray,Object.defineProperty(i.prototype,"_topicID",{get:n.oneOfGetter(o=["topicID"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){if(t||(t=r.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),null!=e.messageIDs&&e.messageIDs.length)for(var n=0;n<e.messageIDs.length;++n)t.uint32(18).bytes(e.messageIDs[n]);return t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.ControlIHave;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.topicID=e.string();break;case 2:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),i.messageIDs.push(e.bytes());break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlIHave)return e;var t=new s.RPC.ControlIHave;if(null!=e.topicID&&(t.topicID=String(e.topicID)),e.messageIDs){if(!Array.isArray(e.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");t.messageIDs=[];for(var r=0;r<e.messageIDs.length;++r)"string"==typeof e.messageIDs[r]?n.base64.decode(e.messageIDs[r],t.messageIDs[r]=n.newBuffer(n.base64.length(e.messageIDs[r])),0):e.messageIDs[r].length&&(t.messageIDs[r]=e.messageIDs[r])}return t},i.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.messageIDs=[]),null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),e.messageIDs&&e.messageIDs.length){r.messageIDs=[];for(var s=0;s<e.messageIDs.length;++s)r.messageIDs[s]=t.bytes===String?n.base64.encode(e.messageIDs[s],0,e.messageIDs[s].length):t.bytes===Array?Array.prototype.slice.call(e.messageIDs[s]):e.messageIDs[s]}return r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlIWant=function(){function i(e){if(this.messageIDs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return i.prototype.messageIDs=n.emptyArray,i.encode=function(e,t){if(t||(t=r.create()),null!=e.messageIDs&&e.messageIDs.length)for(var n=0;n<e.messageIDs.length;++n)t.uint32(10).bytes(e.messageIDs[n]);return t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.ControlIWant;e.pos<n;){var o=e.uint32();o>>>3==1?(i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),i.messageIDs.push(e.bytes())):e.skipType(7&o)}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlIWant)return e;var t=new s.RPC.ControlIWant;if(e.messageIDs){if(!Array.isArray(e.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");t.messageIDs=[];for(var r=0;r<e.messageIDs.length;++r)"string"==typeof e.messageIDs[r]?n.base64.decode(e.messageIDs[r],t.messageIDs[r]=n.newBuffer(n.base64.length(e.messageIDs[r])),0):e.messageIDs[r].length&&(t.messageIDs[r]=e.messageIDs[r])}return t},i.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.messageIDs=[]),e.messageIDs&&e.messageIDs.length){r.messageIDs=[];for(var s=0;s<e.messageIDs.length;++s)r.messageIDs[s]=t.bytes===String?n.base64.encode(e.messageIDs[s],0,e.messageIDs[s].length):t.bytes===Array?Array.prototype.slice.call(e.messageIDs[s]):e.messageIDs[s]}return r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlGraft=function(){function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.topicID=null,Object.defineProperty(i.prototype,"_topicID",{get:n.oneOfGetter(o=["topicID"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=r.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.ControlGraft;e.pos<n;){var o=e.uint32();o>>>3==1?i.topicID=e.string():e.skipType(7&o)}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlGraft)return e;var t=new s.RPC.ControlGraft;return null!=e.topicID&&(t.topicID=String(e.topicID)),t},i.toObject=function(e,t){t||(t={});var r={};return null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlPrune=function(){function i(e){if(this.peers=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.topicID=null,i.prototype.peers=n.emptyArray,i.prototype.backoff=null,Object.defineProperty(i.prototype,"_topicID",{get:n.oneOfGetter(o=["topicID"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_backoff",{get:n.oneOfGetter(o=["backoff"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){if(t||(t=r.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),null!=e.peers&&e.peers.length)for(var n=0;n<e.peers.length;++n)s.RPC.PeerInfo.encode(e.peers[n],t.uint32(18).fork()).ldelim();return null!=e.backoff&&Object.hasOwnProperty.call(e,"backoff")&&t.uint32(24).uint64(e.backoff),t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.ControlPrune;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.topicID=e.string();break;case 2:i.peers&&i.peers.length||(i.peers=[]),i.peers.push(s.RPC.PeerInfo.decode(e,e.uint32()));break;case 3:i.backoff=e.uint64();break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlPrune)return e;var t=new s.RPC.ControlPrune;if(null!=e.topicID&&(t.topicID=String(e.topicID)),e.peers){if(!Array.isArray(e.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");t.peers=[];for(var r=0;r<e.peers.length;++r){if("object"!=typeof e.peers[r])throw TypeError(".RPC.ControlPrune.peers: object expected");t.peers[r]=s.RPC.PeerInfo.fromObject(e.peers[r])}}return null!=e.backoff&&(n.Long?(t.backoff=n.Long.fromValue(e.backoff)).unsigned=!0:"string"==typeof e.backoff?t.backoff=parseInt(e.backoff,10):"number"==typeof e.backoff?t.backoff=e.backoff:"object"==typeof e.backoff&&(t.backoff=new n.LongBits(e.backoff.low>>>0,e.backoff.high>>>0).toNumber(!0))),t},i.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.peers=[]),null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),e.peers&&e.peers.length){r.peers=[];for(var i=0;i<e.peers.length;++i)r.peers[i]=s.RPC.PeerInfo.toObject(e.peers[i],t)}return null!=e.backoff&&e.hasOwnProperty("backoff")&&("number"==typeof e.backoff?r.backoff=t.longs===String?String(e.backoff):e.backoff:r.backoff=t.longs===String?n.Long.prototype.toString.call(e.backoff):t.longs===Number?new n.LongBits(e.backoff.low>>>0,e.backoff.high>>>0).toNumber(!0):e.backoff,t.oneofs&&(r._backoff="backoff")),r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.PeerInfo=function(){function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.peerID=null,i.prototype.signedPeerRecord=null,Object.defineProperty(i.prototype,"_peerID",{get:n.oneOfGetter(o=["peerID"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_signedPeerRecord",{get:n.oneOfGetter(o=["signedPeerRecord"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=r.create()),null!=e.peerID&&Object.hasOwnProperty.call(e,"peerID")&&t.uint32(10).bytes(e.peerID),null!=e.signedPeerRecord&&Object.hasOwnProperty.call(e,"signedPeerRecord")&&t.uint32(18).bytes(e.signedPeerRecord),t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.PeerInfo;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.peerID=e.bytes();break;case 2:i.signedPeerRecord=e.bytes();break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.PeerInfo)return e;var t=new s.RPC.PeerInfo;return null!=e.peerID&&("string"==typeof e.peerID?n.base64.decode(e.peerID,t.peerID=n.newBuffer(n.base64.length(e.peerID)),0):e.peerID.length&&(t.peerID=e.peerID)),null!=e.signedPeerRecord&&("string"==typeof e.signedPeerRecord?n.base64.decode(e.signedPeerRecord,t.signedPeerRecord=n.newBuffer(n.base64.length(e.signedPeerRecord)),0):e.signedPeerRecord.length&&(t.signedPeerRecord=e.signedPeerRecord)),t},i.toObject=function(e,t){t||(t={});var r={};return null!=e.peerID&&e.hasOwnProperty("peerID")&&(r.peerID=t.bytes===String?n.base64.encode(e.peerID,0,e.peerID.length):t.bytes===Array?Array.prototype.slice.call(e.peerID):e.peerID,t.oneofs&&(r._peerID="peerID")),null!=e.signedPeerRecord&&e.hasOwnProperty("signedPeerRecord")&&(r.signedPeerRecord=t.bytes===String?n.base64.encode(e.signedPeerRecord,0,e.signedPeerRecord.length):t.bytes===Array?Array.prototype.slice.call(e.signedPeerRecord):e.signedPeerRecord,t.oneofs&&(r._signedPeerRecord="signedPeerRecord")),r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i}(),s})?n.apply(t,s):n)||(e.exports=i)},84242:(e,t,r)=>{"use strict";r.d(t,{Ue:()=>Ej});var n={};r.r(n),r.d(n,{base58btc:()=>Pe,base58flickr:()=>Ne});var s={};r.r(s),r.d(s,{base32:()=>De,base32hex:()=>Be,base32hexpad:()=>Ue,base32hexpadupper:()=>ze,base32hexupper:()=>Me,base32pad:()=>xe,base32padupper:()=>Le,base32upper:()=>Oe,base32z:()=>Ve});var i={};r.r(i),r.d(i,{base64:()=>Fe,base64pad:()=>je,base64url:()=>Ke,base64urlpad:()=>$e});var o={};r.r(o),r.d(o,{code:()=>sr,createLink:()=>rr,createNode:()=>tr,decode:()=>or,encode:()=>ir,name:()=>nr,prepare:()=>Xt,validate:()=>er});var a={};r.r(a),r.d(a,{code:()=>xn,decode:()=>Bn,encode:()=>Ln,name:()=>On});var c={};r.r(c),r.d(c,{code:()=>Gn,decode:()=>Yn,encode:()=>Wn,name:()=>qn});var l={};r.r(l),r.d(l,{code:()=>ns,decode:()=>cs,encode:()=>as,name:()=>rs,toGeneral:()=>os});var h={};r.r(h),r.d(h,{identity:()=>hs});var u={};r.r(u),r.d(u,{identity:()=>us});var d={};r.r(d),r.d(d,{base2:()=>ds});var p={};r.r(p),r.d(p,{base8:()=>ps});var f={};r.r(f),r.d(f,{base10:()=>fs});var y={};r.r(y),r.d(y,{base16:()=>ys,base16upper:()=>gs});var g={};r.r(g),r.d(g,{base36:()=>ms,base36upper:()=>ws});var m={};r.r(m),r.d(m,{base256emoji:()=>_s});var w={};r.r(w),r.d(w,{sha256:()=>As,sha512:()=>Is});var b={};r.r(b),r.d(b,{code:()=>ks,decode:()=>Cs,encode:()=>Ts,name:()=>Rs});var v={};r.r(v),r.d(v,{code:()=>Os,decode:()=>Ls,encode:()=>xs,name:()=>Ds});var E={};r.r(E),r.d(E,{RsaPrivateKey:()=>Ml,RsaPublicKey:()=>Bl,fromJwk:()=>Vl,generateKeyPair:()=>Fl,unmarshalRsaPrivateKey:()=>Ul,unmarshalRsaPublicKey:()=>zl});var _={};r.r(_),r.d(_,{Ed25519PrivateKey:()=>Bh,Ed25519PublicKey:()=>Lh,generateKeyPair:()=>zh,generateKeyPairFromSeed:()=>Vh,unmarshalEd25519PrivateKey:()=>Mh,unmarshalEd25519PublicKey:()=>Uh});var S={};r.r(S),r.d(S,{Secp256k1PrivateKey:()=>qh,Secp256k1PublicKey:()=>Hh,generateKeyPair:()=>Yh,unmarshalSecp256k1PrivateKey:()=>Gh,unmarshalSecp256k1PublicKey:()=>Wh});var A={};r.r(A),r.d(A,{InvalidValueError:()=>T_,MissingRepoOptionsError:()=>C_,NonReversibleMigrationError:()=>I_,NotInitializedRepoError:()=>R_,RequiredParameterError:()=>k_});var I={};r.r(I),r.d(I,{identity:()=>kA});var R={};r.r(R),r.d(R,{base2:()=>TA});var k={};r.r(k),r.d(k,{base8:()=>CA});var T={};r.r(T),r.d(T,{base10:()=>PA});var C={};r.r(C),r.d(C,{base16:()=>NA,base16upper:()=>DA});var P={};r.r(P),r.d(P,{base32:()=>OA,base32hex:()=>MA,base32hexpad:()=>zA,base32hexpadupper:()=>VA,base32hexupper:()=>UA,base32pad:()=>LA,base32padupper:()=>BA,base32upper:()=>xA,base32z:()=>FA});var N={};r.r(N),r.d(N,{base36:()=>jA,base36upper:()=>KA});var D={};r.r(D),r.d(D,{base58btc:()=>$A,base58flickr:()=>HA});var O={};r.r(O),r.d(O,{base64:()=>qA,base64pad:()=>GA,base64url:()=>WA,base64urlpad:()=>YA});var x={};r.r(x),r.d(x,{base256emoji:()=>XA});var L={};r.r(L),r.d(L,{sha256:()=>bI,sha512:()=>vI});var B={};r.r(B),r.d(B,{identity:()=>_I});var M={};r.r(M),r.d(M,{code:()=>AI,decode:()=>RI,encode:()=>II,name:()=>SI});var U={};r.r(U),r.d(U,{code:()=>PI,decode:()=>DI,encode:()=>NI,name:()=>CI});var z={};r.r(z),r.d(z,{identity:()=>MR});var V={};r.r(V),r.d(V,{base2:()=>UR});var F={};r.r(F),r.d(F,{base8:()=>zR});var j={};r.r(j),r.d(j,{base10:()=>VR});var K={};r.r(K),r.d(K,{base16:()=>FR,base16upper:()=>jR});var $={};r.r($),r.d($,{base32:()=>KR,base32hex:()=>GR,base32hexpad:()=>YR,base32hexpadupper:()=>ZR,base32hexupper:()=>WR,base32pad:()=>HR,base32padupper:()=>qR,base32upper:()=>$R,base32z:()=>QR});var H={};r.r(H),r.d(H,{base36:()=>JR,base36upper:()=>XR});var q={};r.r(q),r.d(q,{base58btc:()=>ek,base58flickr:()=>tk});var G={};r.r(G),r.d(G,{base64:()=>rk,base64pad:()=>nk,base64url:()=>sk,base64urlpad:()=>ik});var W={};r.r(W),r.d(W,{base256emoji:()=>lk});var Y={};r.r(Y),r.d(Y,{sha256:()=>Ck,sha512:()=>Pk});var Z={};r.r(Z),r.d(Z,{identity:()=>Dk});var Q={};r.r(Q),r.d(Q,{code:()=>xk,decode:()=>Bk,encode:()=>Lk,name:()=>Ok});var J={};r.r(J),r.d(J,{code:()=>Vk,decode:()=>jk,encode:()=>Fk,name:()=>zk});var X={};r.r(X),r.d(X,{Decoder:()=>JD,Encoder:()=>QD,PacketType:()=>ZD,protocol:()=>YD});var ee={};r.r(ee),r.d(ee,{identity:()=>UU});var te={};r.r(te),r.d(te,{base2:()=>zU});var re={};r.r(re),r.d(re,{base8:()=>VU});var ne={};r.r(ne),r.d(ne,{base10:()=>FU});var se={};r.r(se),r.d(se,{base16:()=>jU,base16upper:()=>KU});var ie={};r.r(ie),r.d(ie,{base32:()=>$U,base32hex:()=>WU,base32hexpad:()=>ZU,base32hexpadupper:()=>QU,base32hexupper:()=>YU,base32pad:()=>qU,base32padupper:()=>GU,base32upper:()=>HU,base32z:()=>JU});var oe={};r.r(oe),r.d(oe,{base36:()=>XU,base36upper:()=>ez});var ae={};r.r(ae),r.d(ae,{base58btc:()=>tz,base58flickr:()=>rz});var ce={};r.r(ce),r.d(ce,{base64:()=>nz,base64pad:()=>sz,base64url:()=>iz,base64urlpad:()=>oz});var le={};r.r(le),r.d(le,{base256emoji:()=>hz});var he={};r.r(he),r.d(he,{sha256:()=>Pz,sha512:()=>Nz});var ue={};r.r(ue),r.d(ue,{identity:()=>Oz});var de={};r.r(de),r.d(de,{code:()=>Lz,decode:()=>Mz,encode:()=>Bz,name:()=>xz});var pe={};r.r(pe),r.d(pe,{code:()=>Fz,decode:()=>Kz,encode:()=>jz,name:()=>Vz});var fe={};r.r(fe),r.d(fe,{abortedError:()=>oj,notFoundError:()=>ij});const ye=r(76768);var ge=r(27697),me=r(2402);const we=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==r[o])throw new TypeError(i+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,s=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*l+1>>>0,o=new Uint8Array(i);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var u=0,d=i-1;(0!==h||u<s)&&-1!==d;d--,u++)h+=a*o[d]>>>0,o[d]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");s=u,t++}if(" "!==e[t]){for(var p=i-s;p!==i&&0===o[p];)p++;for(var f=new Uint8Array(n+(i-p)),y=n;p!==i;)f[y++]=o[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var o=(i-s)*h+1>>>0,l=new Uint8Array(o);s!==i;){for(var u=t[s],d=0,p=o-1;(0!==u||d<n)&&-1!==p;p--,d++)u+=256*l[p]>>>0,l[p]=u%a>>>0,u=u/a>>>0;if(0!==u)throw new Error("Non-zero carry");n=d,s++}for(var f=o-n;f!==o&&0===l[f];)f++;for(var y=c.repeat(r);f<o;++f)y+=e.charAt(l[f]);return y},decodeUnsafe:u,decode:function(e){var r=u(e);if(r)return r;throw new Error(`Non-${t} character`)}}},be=new Uint8Array(0),ve=e=>{const t=e.match(/../g);return t?new Uint8Array(t.map((e=>parseInt(e,16)))):be},Ee=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class _e{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Se{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Ie(this,e)}}class Ae{constructor(e){this.decoders=e}or(e){return Ie(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ie=(e,t)=>new Ae({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Re{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new _e(e,t,r),this.decoder=new Se(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ke=({name:e,prefix:t,encode:r,decode:n})=>new Re(e,t,r,n),Te=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:s}=we(r,t);return ke({prefix:e,name:t,encode:n,decode:e=>Ee(s(e))})},Ce=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>ke({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],s=(1<<r)-1;let i="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,i+=t[s&a>>o];if(o&&(i+=t[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i})(e,n,r),decode:t=>((e,t,r,n)=>{const s={};for(let e=0;e<t.length;++e)s[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,l=0;for(let t=0;t<i;++t){const i=s[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),Pe=Te({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ne=Te({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),De=Ce({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Oe=Ce({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),xe=Ce({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Le=Ce({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Be=Ce({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Me=Ce({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ue=Ce({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ze=Ce({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ve=Ce({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Fe=Ce({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),je=Ce({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ke=Ce({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$e=Ce({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function He(e){return Object.assign(me(e),{error:me(`${e}:error`),trace:me(`${e}:trace`)})}me.formatters.b=e=>null==e?"undefined":Pe.baseEncode(e),me.formatters.t=e=>null==e?"undefined":De.baseEncode(e),me.formatters.m=e=>null==e?"undefined":Fe.baseEncode(e),me.formatters.p=e=>null==e?"undefined":e.toString(),me.formatters.c=e=>null==e?"undefined":e.toString(),me.formatters.k=e=>null==e?"undefined":e.toString();var qe=r(77514),Ge=r(39026);const We=Ge.Reader,Ye=Ge.Writer,Ze=Ge.util,Qe=Ge.roots["ipfs-unixfs"]||(Ge.roots["ipfs-unixfs"]={}),Je=Qe.Data=(()=>{function e(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=Ze.newBuffer([]),e.prototype.filesize=Ze.Long?Ze.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=Ze.emptyArray,e.prototype.hashType=Ze.Long?Ze.Long.fromBits(0,0,!0):0,e.prototype.fanout=Ze.Long?Ze.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(e,t){if(t||(t=Ye.create()),t.uint32(8).int32(e.Type),null!=e.Data&&Object.hasOwnProperty.call(e,"Data")&&t.uint32(18).bytes(e.Data),null!=e.filesize&&Object.hasOwnProperty.call(e,"filesize")&&t.uint32(24).uint64(e.filesize),null!=e.blocksizes&&e.blocksizes.length)for(var r=0;r<e.blocksizes.length;++r)t.uint32(32).uint64(e.blocksizes[r]);return null!=e.hashType&&Object.hasOwnProperty.call(e,"hashType")&&t.uint32(40).uint64(e.hashType),null!=e.fanout&&Object.hasOwnProperty.call(e,"fanout")&&t.uint32(48).uint64(e.fanout),null!=e.mode&&Object.hasOwnProperty.call(e,"mode")&&t.uint32(56).uint32(e.mode),null!=e.mtime&&Object.hasOwnProperty.call(e,"mtime")&&Qe.UnixTime.encode(e.mtime,t.uint32(66).fork()).ldelim(),t},e.decode=function(e,t){e instanceof We||(e=We.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Qe.Data;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;case 3:n.filesize=e.uint64();break;case 4:if(n.blocksizes&&n.blocksizes.length||(n.blocksizes=[]),2==(7&s))for(var i=e.uint32()+e.pos;e.pos<i;)n.blocksizes.push(e.uint64());else n.blocksizes.push(e.uint64());break;case 5:n.hashType=e.uint64();break;case 6:n.fanout=e.uint64();break;case 7:n.mode=e.uint32();break;case 8:n.mtime=Qe.UnixTime.decode(e,e.uint32());break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("Type"))throw Ze.ProtocolError("missing required 'Type'",{instance:n});return n},e.fromObject=function(e){if(e instanceof Qe.Data)return e;var t=new Qe.Data;switch(e.Type){case"Raw":case 0:t.Type=0;break;case"Directory":case 1:t.Type=1;break;case"File":case 2:t.Type=2;break;case"Metadata":case 3:t.Type=3;break;case"Symlink":case 4:t.Type=4;break;case"HAMTShard":case 5:t.Type=5}if(null!=e.Data&&("string"==typeof e.Data?Ze.base64.decode(e.Data,t.Data=Ze.newBuffer(Ze.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),null!=e.filesize&&(Ze.Long?(t.filesize=Ze.Long.fromValue(e.filesize)).unsigned=!0:"string"==typeof e.filesize?t.filesize=parseInt(e.filesize,10):"number"==typeof e.filesize?t.filesize=e.filesize:"object"==typeof e.filesize&&(t.filesize=new Ze.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0))),e.blocksizes){if(!Array.isArray(e.blocksizes))throw TypeError(".Data.blocksizes: array expected");t.blocksizes=[];for(var r=0;r<e.blocksizes.length;++r)Ze.Long?(t.blocksizes[r]=Ze.Long.fromValue(e.blocksizes[r])).unsigned=!0:"string"==typeof e.blocksizes[r]?t.blocksizes[r]=parseInt(e.blocksizes[r],10):"number"==typeof e.blocksizes[r]?t.blocksizes[r]=e.blocksizes[r]:"object"==typeof e.blocksizes[r]&&(t.blocksizes[r]=new Ze.LongBits(e.blocksizes[r].low>>>0,e.blocksizes[r].high>>>0).toNumber(!0))}if(null!=e.hashType&&(Ze.Long?(t.hashType=Ze.Long.fromValue(e.hashType)).unsigned=!0:"string"==typeof e.hashType?t.hashType=parseInt(e.hashType,10):"number"==typeof e.hashType?t.hashType=e.hashType:"object"==typeof e.hashType&&(t.hashType=new Ze.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0))),null!=e.fanout&&(Ze.Long?(t.fanout=Ze.Long.fromValue(e.fanout)).unsigned=!0:"string"==typeof e.fanout?t.fanout=parseInt(e.fanout,10):"number"==typeof e.fanout?t.fanout=e.fanout:"object"==typeof e.fanout&&(t.fanout=new Ze.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0))),null!=e.mode&&(t.mode=e.mode>>>0),null!=e.mtime){if("object"!=typeof e.mtime)throw TypeError(".Data.mtime: object expected");t.mtime=Qe.UnixTime.fromObject(e.mtime)}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.blocksizes=[]),t.defaults){if(r.Type=t.enums===String?"Raw":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=Ze.newBuffer(r.Data))),Ze.Long){var n=new Ze.Long(0,0,!0);r.filesize=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.filesize=t.longs===String?"0":0;Ze.Long?(n=new Ze.Long(0,0,!0),r.hashType=t.longs===String?n.toString():t.longs===Number?n.toNumber():n):r.hashType=t.longs===String?"0":0,Ze.Long?(n=new Ze.Long(0,0,!0),r.fanout=t.longs===String?n.toString():t.longs===Number?n.toNumber():n):r.fanout=t.longs===String?"0":0,r.mode=0,r.mtime=null}if(null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?Qe.Data.DataType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?Ze.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),null!=e.filesize&&e.hasOwnProperty("filesize")&&("number"==typeof e.filesize?r.filesize=t.longs===String?String(e.filesize):e.filesize:r.filesize=t.longs===String?Ze.Long.prototype.toString.call(e.filesize):t.longs===Number?new Ze.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0):e.filesize),e.blocksizes&&e.blocksizes.length){r.blocksizes=[];for(var s=0;s<e.blocksizes.length;++s)"number"==typeof e.blocksizes[s]?r.blocksizes[s]=t.longs===String?String(e.blocksizes[s]):e.blocksizes[s]:r.blocksizes[s]=t.longs===String?Ze.Long.prototype.toString.call(e.blocksizes[s]):t.longs===Number?new Ze.LongBits(e.blocksizes[s].low>>>0,e.blocksizes[s].high>>>0).toNumber(!0):e.blocksizes[s]}return null!=e.hashType&&e.hasOwnProperty("hashType")&&("number"==typeof e.hashType?r.hashType=t.longs===String?String(e.hashType):e.hashType:r.hashType=t.longs===String?Ze.Long.prototype.toString.call(e.hashType):t.longs===Number?new Ze.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0):e.hashType),null!=e.fanout&&e.hasOwnProperty("fanout")&&("number"==typeof e.fanout?r.fanout=t.longs===String?String(e.fanout):e.fanout:r.fanout=t.longs===String?Ze.Long.prototype.toString.call(e.fanout):t.longs===Number?new Ze.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0):e.fanout),null!=e.mode&&e.hasOwnProperty("mode")&&(r.mode=e.mode),null!=e.mtime&&e.hasOwnProperty("mtime")&&(r.mtime=Qe.UnixTime.toObject(e.mtime,t)),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e.DataType=function(){const e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),e})(),Xe=(Qe.UnixTime=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Seconds=Ze.Long?Ze.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(e,t){return t||(t=Ye.create()),t.uint32(8).int64(e.Seconds),null!=e.FractionalNanoseconds&&Object.hasOwnProperty.call(e,"FractionalNanoseconds")&&t.uint32(21).fixed32(e.FractionalNanoseconds),t},e.decode=function(e,t){e instanceof We||(e=We.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Qe.UnixTime;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.Seconds=e.int64();break;case 2:n.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("Seconds"))throw Ze.ProtocolError("missing required 'Seconds'",{instance:n});return n},e.fromObject=function(e){if(e instanceof Qe.UnixTime)return e;var t=new Qe.UnixTime;return null!=e.Seconds&&(Ze.Long?(t.Seconds=Ze.Long.fromValue(e.Seconds)).unsigned=!1:"string"==typeof e.Seconds?t.Seconds=parseInt(e.Seconds,10):"number"==typeof e.Seconds?t.Seconds=e.Seconds:"object"==typeof e.Seconds&&(t.Seconds=new Ze.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber())),null!=e.FractionalNanoseconds&&(t.FractionalNanoseconds=e.FractionalNanoseconds>>>0),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if(Ze.Long){var n=new Ze.Long(0,0,!1);r.Seconds=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.Seconds=t.longs===String?"0":0;r.FractionalNanoseconds=0}return null!=e.Seconds&&e.hasOwnProperty("Seconds")&&("number"==typeof e.Seconds?r.Seconds=t.longs===String?String(e.Seconds):e.Seconds:r.Seconds=t.longs===String?Ze.Long.prototype.toString.call(e.Seconds):t.longs===Number?new Ze.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber():e.Seconds),null!=e.FractionalNanoseconds&&e.hasOwnProperty("FractionalNanoseconds")&&(r.FractionalNanoseconds=e.FractionalNanoseconds),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e})(),Qe.Metadata=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.MimeType="",e.encode=function(e,t){return t||(t=Ye.create()),null!=e.MimeType&&Object.hasOwnProperty.call(e,"MimeType")&&t.uint32(10).string(e.MimeType),t},e.decode=function(e,t){e instanceof We||(e=We.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Qe.Metadata;e.pos<r;){var s=e.uint32();s>>>3==1?n.MimeType=e.string():e.skipType(7&s)}return n},e.fromObject=function(e){if(e instanceof Qe.Metadata)return e;var t=new Qe.Metadata;return null!=e.MimeType&&(t.MimeType=String(e.MimeType)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.MimeType=""),null!=e.MimeType&&e.hasOwnProperty("MimeType")&&(r.MimeType=e.MimeType),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e})(),Je),et=["raw","directory","file","metadata","symlink","hamt-sharded-directory"],tt=["directory","hamt-sharded-directory"],rt=parseInt("0644",8),nt=parseInt("0755",8);function st(e){if(null!=e)return"number"==typeof e?4095&e:"0"===(e=e.toString()).substring(0,1)?4095&parseInt(e,8):4095&parseInt(e,10)}function it(e){if(null==e)return;let t;if(null!=e.secs&&(t={secs:e.secs,nsecs:e.nsecs}),null!=e.Seconds&&(t={secs:e.Seconds,nsecs:e.FractionalNanoseconds}),Array.isArray(e)&&(t={secs:e[0],nsecs:e[1]}),e instanceof Date){const r=e.getTime(),n=Math.floor(r/1e3);t={secs:n,nsecs:1e3*(r-1e3*n)}}if(Object.prototype.hasOwnProperty.call(t,"secs")){if(null!=t&&null!=t.nsecs&&(t.nsecs<0||t.nsecs>999999999))throw qe(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return t}}class ot{static unmarshal(e){const t=Xe.decode(e),r=Xe.toObject(t,{defaults:!1,arrays:!0,longs:Number,objects:!1}),n=new ot({type:et[r.Type],data:r.Data,blockSizes:r.blocksizes,mode:r.mode,mtime:r.mtime?{secs:r.mtime.Seconds,nsecs:r.mtime.FractionalNanoseconds}:void 0});return n._originalMode=r.mode||0,n}constructor(e={type:"file"}){const{type:t,data:r,blockSizes:n,hashType:s,fanout:i,mtime:o,mode:a}=e;if(t&&!et.includes(t))throw qe(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t||"file",this.data=r,this.hashType=s,this.fanout=i,this.blockSizes=n||[],this._originalMode=0,this.mode=st(a),o&&(this.mtime=it(o),this.mtime&&!this.mtime.nsecs&&(this.mtime.nsecs=0))}set mode(e){this._mode=this.isDirectory()?nt:rt;const t=st(e);void 0!==t&&(this._mode=t)}get mode(){return this._mode}isDirectory(){return Boolean(this.type&&tt.includes(this.type))}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0;let e=0;return this.blockSizes.forEach((t=>{e+=t})),this.data&&(e+=this.data.length),e}marshal(){let e;switch(this.type){case"raw":e=Xe.DataType.Raw;break;case"directory":e=Xe.DataType.Directory;break;case"file":e=Xe.DataType.File;break;case"metadata":e=Xe.DataType.Metadata;break;case"symlink":e=Xe.DataType.Symlink;break;case"hamt-sharded-directory":e=Xe.DataType.HAMTShard;break;default:throw qe(new Error("Type: "+e+" is not valid"),"ERR_INVALID_TYPE")}let t,r,n=this.data;if(this.data&&this.data.length||(n=void 0),null!=this.mode&&(t=4294963200&this._originalMode|(st(this.mode)||0),t!==rt||this.isDirectory()||(t=void 0),t===nt&&this.isDirectory()&&(t=void 0)),null!=this.mtime){const e=it(this.mtime);e&&(r={Seconds:e.secs,FractionalNanoseconds:e.nsecs},0===r.FractionalNanoseconds&&delete r.FractionalNanoseconds)}const s={Type:e,Data:n,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:r};return Xe.encode(s).finish()}}var at=Math.pow(2,31),ct=Math.pow(2,7),lt=Math.pow(2,14),ht=Math.pow(2,21),ut=Math.pow(2,28),dt=Math.pow(2,35),pt=Math.pow(2,42),ft=Math.pow(2,49),yt=Math.pow(2,56),gt=Math.pow(2,63),mt={encode:function e(t,r,n){r=r||[];for(var s=n=n||0;t>=at;)r[n++]=255&t|128,t/=128;for(;-128&t;)r[n++]=255&t|128,t>>>=7;return r[n]=0|t,e.bytes=n-s+1,r},decode:function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(127&n)<<i:(127&n)*Math.pow(2,i),i+=7}while(n>=128);return e.bytes=o-r,s},encodingLength:function(e){return e<ct?1:e<lt?2:e<ht?3:e<ut?4:e<dt?5:e<pt?6:e<ft?7:e<yt?8:e<gt?9:10}};const wt=mt,bt=(e,t=0)=>[wt.decode(e,t),wt.decode.bytes],vt=(e,t,r=0)=>(wt.encode(e,t,r),t),Et=e=>wt.encodingLength(e),_t=(e,t)=>{const r=t.byteLength,n=Et(e),s=n+Et(r),i=new Uint8Array(s+r);return vt(e,i,0),vt(r,i,n),i.set(t,s),new At(e,r,t,i)},St=e=>{const t=Ee(e),[r,n]=bt(t),[s,i]=bt(t.subarray(n)),o=t.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new At(r,s,o,t)};class At{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const It=new WeakMap,Rt=e=>{const t=It.get(e);if(null==t){const t=new Map;return It.set(e,t),t}return t};class kt{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Nt)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Dt)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return kt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=_t(e,t);return kt.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return kt.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return((e,t)=>{const{bytes:r,version:n}=e;return 0===n?Ct(r,Rt(e),t||Pe.encoder):Pt(r,Rt(e),t||De.encoder)})(this,e)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof kt)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:s}=t;return new kt(e,r,n,s||Ot(e,r,n.bytes))}if(!0===t[xt]){const{version:e,multihash:r,code:n}=t,s=St(r);return kt.create(e,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Nt)throw new Error(`Version 0 CID must use dag-pb (code: ${Nt}) block encoding`);return new kt(e,t,r,r.bytes);case 1:{const n=Ot(e,t,r.bytes);return new kt(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return kt.create(0,Nt,e)}static createV1(e,t){return kt.create(1,e,t)}static decode(e){const[t,r]=kt.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=kt.inspectBytes(e),r=t.size-t.multihashSize,n=Ee(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),i=new At(t.multihashCode,t.digestSize,s,n);return[0===t.version?kt.createV0(i):kt.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=bt(e.subarray(t));return t+=n,r};let n=r(),s=Nt;if(18===n?(n=0,t=0):s=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,o=r(),a=r(),c=t+a;return{version:n,codec:s,multihashCode:o,digestSize:a,multihashSize:c-i,size:c}}static parse(e,t){const[r,n]=Tt(e,t),s=kt.decode(n);return Rt(s).set(r,e),s}}const Tt=(e,t)=>{switch(e[0]){case"Q":{const r=t||Pe;return[Pe.prefix,r.decode(`${Pe.prefix}${e}`)]}case Pe.prefix:{const r=t||Pe;return[Pe.prefix,r.decode(e)]}case De.prefix:{const r=t||De;return[De.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Ct=(e,t,r)=>{const{prefix:n}=r;if(n!==Pe.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const s=t.get(n);if(null==s){const s=r.encode(e).slice(1);return t.set(n,s),s}return s},Pt=(e,t,r)=>{const{prefix:n}=r,s=t.get(n);if(null==s){const s=r.encode(e);return t.set(n,s),s}return s},Nt=112,Dt=18,Ot=(e,t,r)=>{const n=Et(e),s=n+Et(t),i=new Uint8Array(s+r.byteLength);return vt(e,i,0),vt(t,i,n),i.set(r,s),i},xt=Symbol.for("@ipld/js-cid/CID"),Lt=new TextDecoder;function Bt(e,t){let r=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");const s=e[t++];if(r+=n<28?(127&s)<<n:(127&s)*2**n,s<128)break}return[r,t]}function Mt(e,t){let r;[r,t]=Bt(e,t);const n=t+r;if(r<0||n<0)throw new Error("protobuf: invalid length");if(n>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,n),n]}function Ut(e,t){let r;return[r,t]=Bt(e,t),[7&r,r>>3,t]}function zt(e){const t={},r=e.length;let n=0;for(;n<r;){let r,s;if([r,s,n]=Ut(e,n),1===s){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(2!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Hash`);if(void 0!==t.Name)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=Mt(e,n)}else if(2===s){if(void 0!==t.Name)throw new Error("protobuf: (PBLink) duplicate Name section");if(2!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Name`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let s;[s,n]=Mt(e,n),t.Name=Lt.decode(s)}else{if(3!==s)throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(0!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Tsize`);[t.Tsize,n]=Bt(e,n)}}if(n>r)throw new Error("protobuf: (PBLink) unexpected end of data");return t}const Vt=new TextEncoder,Ft=2**32;function jt(e,t){let r=t.length;if("number"==typeof e.Tsize){if(e.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw new Error("Tsize too large for encoding");r=$t(t,r,e.Tsize)-1,t[r]=24}if("string"==typeof e.Name){const n=Vt.encode(e.Name);r-=n.length,t.set(n,r),r=$t(t,r,n.length)-1,t[r]=18}return e.Hash&&(r-=e.Hash.length,t.set(e.Hash,r),r=$t(t,r,e.Hash.length)-1,t[r]=10),t.length-r}function Kt(e){let t=0;if(e.Hash){const r=e.Hash.length;t+=1+r+Ht(r)}if("string"==typeof e.Name){const r=Vt.encode(e.Name).length;t+=1+r+Ht(r)}return"number"==typeof e.Tsize&&(t+=1+Ht(e.Tsize)),t}function $t(e,t,r){const n=t-=Ht(r);for(;r>=2147483648;)e[t++]=127&r|128,r/=128;for(;r>=128;)e[t++]=127&r|128,r>>>=7;return e[t]=r,n}function Ht(e){return e%2==0&&e++,Math.floor((function(e){let t=0;return e>=Ft&&(e=Math.floor(e/Ft),t=32),e>=65536&&(e>>>=16,t+=16),e>=256&&(e>>>=8,t+=8),t+qt[e]}(e)+6)/7)}const qt=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],Gt=["Data","Links"],Wt=["Hash","Name","Tsize"],Yt=new TextEncoder;function Zt(e,t){if(e===t)return 0;const r=e.Name?Yt.encode(e.Name):[],n=t.Name?Yt.encode(t.Name):[];let s=r.length,i=n.length;for(let e=0,t=Math.min(s,i);e<t;++e)if(r[e]!==n[e]){s=r[e],i=n[e];break}return s<i?-1:i<s?1:0}function Qt(e,t){return!Object.keys(e).some((e=>!t.includes(e)))}function Jt(e){if("object"==typeof e.asCID){const t=kt.asCID(e);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if("object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(e.Hash){let r=kt.asCID(e.Hash);try{r||("string"==typeof e.Hash?r=kt.parse(e.Hash):e.Hash instanceof Uint8Array&&(r=kt.decode(e.Hash)))}catch(e){throw new TypeError(`Invalid DAG-PB form: ${e.message}`)}r&&(t.Hash=r)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return"string"==typeof e.Name&&(t.Name=e.Name),"number"==typeof e.Tsize&&(t.Tsize=e.Tsize),t}function Xt(e){if((e instanceof Uint8Array||"string"==typeof e)&&(e={Data:e}),"object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(void 0!==e.Data)if("string"==typeof e.Data)t.Data=Yt.encode(e.Data);else{if(!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form");t.Data=e.Data}if(void 0!==e.Links){if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form");t.Links=e.Links.map(Jt),t.Links.sort(Zt)}else t.Links=[];return t}function er(e){if(!e||"object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");if(!Qt(e,Gt))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==e.Data&&!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be a Uint8Array)");if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form (Links must be an array)");for(let t=0;t<e.Links.length;t++){const r=e.Links[t];if(!r||"object"!=typeof r||Array.isArray(r))throw new TypeError("Invalid DAG-PB form (bad link object)");if(!Qt(r,Wt))throw new TypeError("Invalid DAG-PB form (extraneous properties on link object)");if(!r.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(r.Hash.asCID!==r.Hash)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==r.Name&&"string"!=typeof r.Name)throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==r.Tsize&&("number"!=typeof r.Tsize||r.Tsize%1!=0))throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t>0&&-1===Zt(r,e.Links[t-1]))throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function tr(e,t=[]){return Xt({Data:e,Links:t})}function rr(e,t,r){return Jt({Hash:r,Name:e,Tsize:t})}const nr="dag-pb",sr=112;function ir(e){er(e);const t={};return e.Links&&(t.Links=e.Links.map((e=>{const t={};return e.Hash&&(t.Hash=e.Hash.bytes),void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),e.Data&&(t.Data=e.Data),function(e){const t=function(e){let t=0;if(e.Data){const r=e.Data.length;t+=1+r+Ht(r)}if(e.Links)for(const r of e.Links){const e=Kt(r);t+=1+e+Ht(e)}return t}(e),r=new Uint8Array(t);let n=t;if(e.Data&&(n-=e.Data.length,r.set(e.Data,n),n=$t(r,n,e.Data.length)-1,r[n]=10),e.Links)for(let t=e.Links.length-1;t>=0;t--){const s=jt(e.Links[t],r.subarray(0,n));n-=s,n=$t(r,n,s)-1,r[n]=18}return r}(t)}function or(e){const t=function(e){const t=e.length;let r,n,s=0,i=!1;for(;s<t;){let t,o;if([t,o,s]=Ut(e,s),2!==t)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${t}`);if(1===o){if(n)throw new Error("protobuf: (PBNode) duplicate Data section");[n,s]=Mt(e,s),r&&(i=!0)}else{if(2!==o)throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${o}`);{if(i)throw new Error("protobuf: (PBNode) duplicate Links section");let t;r||(r=[]),[t,s]=Mt(e,s),r.push(zt(t))}}}if(s>t)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return n&&(o.Data=n),o.Links=r||[],o}(e),r={};return t.Data&&(r.Data=t.Data),t.Links&&(r.Links=t.Links.map((e=>{const t={};try{t.Hash=kt.decode(e.Hash)}catch(e){}if(!t.Hash)throw new Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),r}const ar=["string","number","bigint","symbol"],cr=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];class lr{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}lr.uint=new lr(0,"uint",!0),lr.negint=new lr(1,"negint",!0),lr.bytes=new lr(2,"bytes",!0),lr.string=new lr(3,"string",!0),lr.array=new lr(4,"array",!1),lr.map=new lr(5,"map",!1),lr.tag=new lr(6,"tag",!1),lr.float=new lr(7,"float",!0),lr.false=new lr(7,"false",!0),lr.true=new lr(7,"true",!0),lr.null=new lr(7,"null",!0),lr.undefined=new lr(7,"undefined",!0),lr.break=new lr(7,"break",!0);class hr{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const ur=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,dr=new TextDecoder,pr=new TextEncoder;function fr(e){return ur&&globalThis.Buffer.isBuffer(e)}function yr(e){return e instanceof Uint8Array?fr(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const gr=ur?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):Sr(e,t,r):(e,t,r)=>r-t>64?dr.decode(e.subarray(t,r)):Sr(e,t,r),mr=ur?e=>e.length>64?globalThis.Buffer.from(e):_r(e):e=>e.length>64?pr.encode(e):_r(e),wr=e=>Uint8Array.from(e),br=ur?(e,t,r)=>fr(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),vr=ur?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),yr(globalThis.Buffer.concat(e,t))):(e,t)=>{const r=new Uint8Array(t);let n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},Er=ur?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function _r(e,t=1/0){let r;const n=e.length;let s=null;const i=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!s){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&i.push(239,191,189);continue}s=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),s=r;continue}r=65536+(s-55296<<10|r-56320)}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function Sr(e,t,r){const n=[];for(;t<r;){const s=e[t];let i=null,o=s>239?4:s>223?3:s>191?2:1;if(t+o<=r){let r,n,a,c;switch(o){case 1:s<128&&(i=s);break;case 2:r=e[t+1],128==(192&r)&&(c=(31&s)<<6|63&r,c>127&&(i=c));break;case 3:r=e[t+1],n=e[t+2],128==(192&r)&&128==(192&n)&&(c=(15&s)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&s)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),t+=o}return Ar(n)}function Ar(e){const t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}class Ir{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=Er(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=br(r,0,this.cursor)}else t=vr(this.chunks,this.cursor);return e&&this.reset(),t}}const Rr=[];function kr(e,t,r){if(e.length-t<r)throw new Error("CBOR decode error: not enough data for type")}Rr[23]=1,Rr[24]=2,Rr[25]=3,Rr[26]=5,Rr[27]=9;const Tr=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Cr(e,t,r){kr(e,t,1);const n=e[t];if(!0===r.strict&&n<Tr[0])throw new Error("CBOR decode error: integer encoded in more bytes than necessary (strict decode)");return n}function Pr(e,t,r){kr(e,t,2);const n=e[t]<<8|e[t+1];if(!0===r.strict&&n<Tr[1])throw new Error("CBOR decode error: integer encoded in more bytes than necessary (strict decode)");return n}function Nr(e,t,r){kr(e,t,4);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<Tr[2])throw new Error("CBOR decode error: integer encoded in more bytes than necessary (strict decode)");return n}function Dr(e,t,r){kr(e,t,8);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],s=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],i=(BigInt(n)<<BigInt(32))+BigInt(s);if(!0===r.strict&&i<Tr[3])throw new Error("CBOR decode error: integer encoded in more bytes than necessary (strict decode)");if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(!0===r.allowBigInt)return i;throw new Error("CBOR decode error: integers outside of the safe integer range are not supported")}function Or(e,t){return xr(e,0,t.value)}function xr(e,t,r){if(r<Tr[0]){const n=Number(r);e.push([t|n])}else if(r<Tr[1]){const n=Number(r);e.push([24|t,n])}else if(r<Tr[2]){const n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<Tr[3]){const n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{const n=BigInt(r);if(!(n<Tr[4]))throw new Error("CBOR decode error: encountered BigInt larger than allowable range");{const r=[27|t,0,0,0,0,0,0,0];let s=Number(n&BigInt(4294967295)),i=Number(n>>BigInt(32)&BigInt(4294967295));r[8]=255&s,s>>=8,r[7]=255&s,s>>=8,r[6]=255&s,s>>=8,r[5]=255&s,r[4]=255&i,i>>=8,r[3]=255&i,i>>=8,r[2]=255&i,i>>=8,r[1]=255&i,e.push(r)}}}Or.encodedSize=function(e){return xr.encodedSize(e.value)},xr.encodedSize=function(e){return e<Tr[0]?1:e<Tr[1]?2:e<Tr[2]?3:e<Tr[3]?5:9},Or.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};const Lr=BigInt(-1),Br=BigInt(1);function Mr(e,t){const r=t.value,n="bigint"==typeof r?r*Lr-Br:-1*r-1;xr(e,t.type.majorEncoded,n)}function Ur(e,t,r,n){kr(e,t,r+n);const s=br(e,t+r,t+r+n);return new hr(lr.bytes,s,r+n)}function zr(e,t,r,n){return Ur(e,t,1,r)}function Vr(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===lr.string?mr(e.value):e.value),e.encodedBytes}function Fr(e,t){const r=Vr(t);xr(e,t.type.majorEncoded,r.length),e.push(r)}function jr(e,t,r,n,s){const i=r+n;kr(e,t,i);const o=new hr(lr.string,gr(e,t+r,t+i),i);return!0===s.retainStringBytes&&(o.byteValue=br(e,t+r,t+i)),o}function Kr(e,t,r,n){return jr(e,t,1,r,n)}Mr.encodedSize=function(e){const t=e.value,r="bigint"==typeof t?t*Lr-Br:-1*t-1;return r<Tr[0]?1:r<Tr[1]?2:r<Tr[2]?3:r<Tr[3]?5:9},Mr.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},Fr.encodedSize=function(e){const t=Vr(e);return xr.encodedSize(t.length)+t.length},Fr.compareTokens=function(e,t){return r=Vr(e),n=Vr(t),r.length<n.length?-1:r.length>n.length?1:function(e,t){if(fr(e)&&fr(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}(r,n);var r,n};const $r=Fr;function Hr(e,t,r,n){return new hr(lr.array,n,r)}function qr(e,t,r,n){return Hr(0,0,1,r)}function Gr(e,t){xr(e,lr.array.majorEncoded,t.value)}function Wr(e,t,r,n){return new hr(lr.map,n,r)}function Yr(e,t,r,n){return Wr(0,0,1,r)}function Zr(e,t){xr(e,lr.map.majorEncoded,t.value)}function Qr(e,t,r,n){return new hr(lr.tag,r,1)}function Jr(e,t){xr(e,lr.tag.majorEncoded,t.value)}function Xr(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw new Error("CBOR decode error: NaN values are not supported");if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw new Error("CBOR decode error: Infinity values are not supported")}return new hr(lr.float,e,t)}function en(e,t,r){const n=t.value;if(!1===n)e.push([20|lr.float.majorEncoded]);else if(!0===n)e.push([21|lr.float.majorEncoded]);else if(null===n)e.push([22|lr.float.majorEncoded]);else if(void 0===n)e.push([23|lr.float.majorEncoded]);else{let t,i=!1;r&&!0===r.float64||(sn(n),t=on(nn,1),n===t||Number.isNaN(n)?(nn[0]=249,e.push(nn.slice(0,3)),i=!0):(an(n),t=cn(nn,1),n===t&&(nn[0]=250,e.push(nn.slice(0,5)),i=!0))),i||(s=n,rn.setFloat64(0,s,!1),t=ln(nn,1),nn[0]=251,e.push(nn.slice(0,9)))}var s}Gr.compareTokens=Or.compareTokens,Gr.encodedSize=function(e){return xr.encodedSize(e.value)},Zr.compareTokens=Or.compareTokens,Zr.encodedSize=function(e){return xr.encodedSize(e.value)},Jr.compareTokens=Or.compareTokens,Jr.encodedSize=function(e){return xr.encodedSize(e.value)},en.encodedSize=function(e,t){const r=e.value;if(!1===r||!0===r||null==r)return 1;if(!t||!0!==t.float64){sn(r);let e=on(nn,1);if(r===e||Number.isNaN(r))return 3;if(an(r),e=cn(nn,1),r===e)return 5}return 9};const tn=new ArrayBuffer(9),rn=new DataView(tn,1),nn=new Uint8Array(tn,0);function sn(e){if(e===1/0)rn.setUint16(0,31744,!1);else if(e===-1/0)rn.setUint16(0,64512,!1);else if(Number.isNaN(e))rn.setUint16(0,32256,!1);else{rn.setFloat32(0,e);const t=rn.getUint32(0),r=(2139095040&t)>>23,n=8388607&t;if(255===r)rn.setUint16(0,31744,!1);else if(0===r)rn.setUint16(0,(2147483648&e)>>16|n>>13,!1);else{const e=r-127;e<-24?rn.setUint16(0,0):e<-14?rn.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):rn.setUint16(0,(2147483648&t)>>16|e+15<<10|n>>13,!1)}}}function on(e,t){if(e.length-t<2)throw new Error("CBOR decode error: not enough data for float16");const r=(e[t]<<8)+e[t+1];if(31744===r)return 1/0;if(64512===r)return-1/0;if(32256===r)return NaN;const n=r>>10&31,s=1023&r;let i;return i=0===n?s*2**-24:31!==n?(s+1024)*2**(n-25):0===s?1/0:NaN,32768&r?-i:i}function an(e){rn.setFloat32(0,e,!1)}function cn(e,t){if(e.length-t<4)throw new Error("CBOR decode error: not enough data for float32");const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function ln(e,t){if(e.length-t<8)throw new Error("CBOR decode error: not enough data for float64");const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}function hn(e,t,r){throw new Error(`CBOR decode error: encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function un(e){return()=>{throw new Error(`CBOR decode error: ${e}`)}}en.compareTokens=Or.compareTokens;const dn=[];for(let e=0;e<=23;e++)dn[e]=hn;dn[24]=function(e,t,r,n){return new hr(lr.uint,Cr(e,t+1,n),2)},dn[25]=function(e,t,r,n){return new hr(lr.uint,Pr(e,t+1,n),3)},dn[26]=function(e,t,r,n){return new hr(lr.uint,Nr(e,t+1,n),5)},dn[27]=function(e,t,r,n){return new hr(lr.uint,Dr(e,t+1,n),9)},dn[28]=hn,dn[29]=hn,dn[30]=hn,dn[31]=hn;for(let e=32;e<=55;e++)dn[e]=hn;dn[56]=function(e,t,r,n){return new hr(lr.negint,-1-Cr(e,t+1,n),2)},dn[57]=function(e,t,r,n){return new hr(lr.negint,-1-Pr(e,t+1,n),3)},dn[58]=function(e,t,r,n){return new hr(lr.negint,-1-Nr(e,t+1,n),5)},dn[59]=function(e,t,r,n){const s=Dr(e,t+1,n);if("bigint"!=typeof s){const e=-1-s;if(e>=Number.MIN_SAFE_INTEGER)return new hr(lr.negint,e,9)}if(!0!==n.allowBigInt)throw new Error("CBOR decode error: integers outside of the safe integer range are not supported");return new hr(lr.negint,Lr-BigInt(s),9)},dn[60]=hn,dn[61]=hn,dn[62]=hn,dn[63]=hn;for(let e=64;e<=87;e++)dn[e]=zr;dn[88]=function(e,t,r,n){return Ur(e,t,2,Cr(e,t+1,n))},dn[89]=function(e,t,r,n){return Ur(e,t,3,Pr(e,t+1,n))},dn[90]=function(e,t,r,n){return Ur(e,t,5,Nr(e,t+1,n))},dn[91]=function(e,t,r,n){const s=Dr(e,t+1,n);if("bigint"==typeof s)throw new Error("CBOR decode error: 64-bit integer bytes lengths not supported");return Ur(e,t,9,s)},dn[92]=hn,dn[93]=hn,dn[94]=hn,dn[95]=un("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)dn[e]=Kr;dn[120]=function(e,t,r,n){return jr(e,t,2,Cr(e,t+1,n),n)},dn[121]=function(e,t,r,n){return jr(e,t,3,Pr(e,t+1,n),n)},dn[122]=function(e,t,r,n){return jr(e,t,5,Nr(e,t+1,n),n)},dn[123]=function(e,t,r,n){const s=Dr(e,t+1,n);if("bigint"==typeof s)throw new Error("CBOR decode error: 64-bit integer string lengths not supported");return jr(e,t,9,s,n)},dn[124]=hn,dn[125]=hn,dn[126]=hn,dn[127]=un("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)dn[e]=qr;dn[152]=function(e,t,r,n){return Hr(0,0,2,Cr(e,t+1,n))},dn[153]=function(e,t,r,n){return Hr(0,0,3,Pr(e,t+1,n))},dn[154]=function(e,t,r,n){return Hr(0,0,5,Nr(e,t+1,n))},dn[155]=function(e,t,r,n){const s=Dr(e,t+1,n);if("bigint"==typeof s)throw new Error("CBOR decode error: 64-bit integer array lengths not supported");return Hr(0,0,9,s)},dn[156]=hn,dn[157]=hn,dn[158]=hn,dn[159]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error("CBOR decode error: indefinite length items not allowed");return Hr(0,0,1,1/0)};for(let e=160;e<=183;e++)dn[e]=Yr;dn[184]=function(e,t,r,n){return Wr(0,0,2,Cr(e,t+1,n))},dn[185]=function(e,t,r,n){return Wr(0,0,3,Pr(e,t+1,n))},dn[186]=function(e,t,r,n){return Wr(0,0,5,Nr(e,t+1,n))},dn[187]=function(e,t,r,n){const s=Dr(e,t+1,n);if("bigint"==typeof s)throw new Error("CBOR decode error: 64-bit integer map lengths not supported");return Wr(0,0,9,s)},dn[188]=hn,dn[189]=hn,dn[190]=hn,dn[191]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error("CBOR decode error: indefinite length items not allowed");return Wr(0,0,1,1/0)};for(let e=192;e<=215;e++)dn[e]=Qr;dn[216]=function(e,t,r,n){return new hr(lr.tag,Cr(e,t+1,n),2)},dn[217]=function(e,t,r,n){return new hr(lr.tag,Pr(e,t+1,n),3)},dn[218]=function(e,t,r,n){return new hr(lr.tag,Nr(e,t+1,n),5)},dn[219]=function(e,t,r,n){return new hr(lr.tag,Dr(e,t+1,n),9)},dn[220]=hn,dn[221]=hn,dn[222]=hn,dn[223]=hn;for(let e=224;e<=243;e++)dn[e]=un("simple values are not supported");dn[244]=hn,dn[245]=hn,dn[246]=hn,dn[247]=function(e,t,r,n){if(!1===n.allowUndefined)throw new Error("CBOR decode error: undefined values are not supported");return!0===n.coerceUndefinedToNull?new hr(lr.null,null,1):new hr(lr.undefined,void 0,1)},dn[248]=un("simple values are not supported"),dn[249]=function(e,t,r,n){return Xr(on(e,t+1),3,n)},dn[250]=function(e,t,r,n){return Xr(cn(e,t+1),5,n)},dn[251]=function(e,t,r,n){return Xr(ln(e,t+1),9,n)},dn[252]=hn,dn[253]=hn,dn[254]=hn,dn[255]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error("CBOR decode error: indefinite length items not allowed");return new hr(lr.break,void 0,1)};const pn=[];for(let e=0;e<24;e++)pn[e]=new hr(lr.uint,e,1);for(let e=-1;e>=-24;e--)pn[31-e]=new hr(lr.negint,e,1);pn[64]=new hr(lr.bytes,new Uint8Array(0),1),pn[96]=new hr(lr.string,"",1),pn[128]=new hr(lr.array,0,1),pn[160]=new hr(lr.map,0,1),pn[244]=new hr(lr.false,!1,1),pn[245]=new hr(lr.true,!0,1),pn[246]=new hr(lr.null,null,1);var fn=r(82784);const yn={float64:!1,mapSorter:function(e,t){const r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);const s=r.type.major,i=gn[s].compareTokens(r,n);return 0===i&&fn.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i},quickEncodeToken:function(e){switch(e.type){case lr.false:return wr([244]);case lr.true:return wr([245]);case lr.null:return wr([246]);case lr.bytes:return e.value.length?void 0:wr([64]);case lr.string:return""===e.value?wr([96]):void 0;case lr.array:return 0===e.value?wr([128]):void 0;case lr.map:return 0===e.value?wr([160]):void 0;case lr.uint:return e.value<24?wr([Number(e.value)]):void 0;case lr.negint:if(e.value>=-24)return wr([31-Number(e.value)])}}},gn=function(){const e=[];return e[lr.uint.major]=Or,e[lr.negint.major]=Mr,e[lr.bytes.major]=Fr,e[lr.string.major]=$r,e[lr.array.major]=Gr,e[lr.map.major]=Zr,e[lr.tag.major]=Jr,e[lr.float.major]=en,e}(),mn=new Ir;class wn{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error("CBOR encode error: object contains circular references");return new wn(t,e)}}const bn={null:new hr(lr.null,null),undefined:new hr(lr.undefined,void 0),true:new hr(lr.true,!0),false:new hr(lr.false,!1),emptyArray:new hr(lr.array,0),emptyMap:new hr(lr.map,0)},vn={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new hr(e>=0?lr.uint:lr.negint,e):new hr(lr.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new hr(lr.uint,e):new hr(lr.negint,e),Uint8Array:(e,t,r,n)=>new hr(lr.bytes,e),string:(e,t,r,n)=>new hr(lr.string,e),boolean:(e,t,r,n)=>e?bn.true:bn.false,null:(e,t,r,n)=>bn.null,undefined:(e,t,r,n)=>bn.undefined,ArrayBuffer:(e,t,r,n)=>new hr(lr.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new hr(lr.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[bn.emptyArray,new hr(lr.break)]:bn.emptyArray;n=wn.createCheck(n,e);const s=[];let i=0;for(const t of e)s[i++]=En(t,r,n);return r.addBreakTokens?[new hr(lr.array,e.length),s,new hr(lr.break)]:[new hr(lr.array,e.length),s]},Object(e,t,r,n){const s="Object"!==t,i=s?e.keys():Object.keys(e),o=s?e.size:i.length;if(!o)return!0===r.addBreakTokens?[bn.emptyMap,new hr(lr.break)]:bn.emptyMap;n=wn.createCheck(n,e);const a=[];let c=0;for(const t of i)a[c++]=[En(t,r,n),En(s?e.get(t):e[t],r,n)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(a,r),r.addBreakTokens?[new hr(lr.map,o),a,new hr(lr.break)]:[new hr(lr.map,o),a]}};vn.Map=vn.Object,vn.Buffer=vn.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))vn[`${e}Array`]=vn.DataView;function En(e,t={},r){const n=function(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(ar.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";const r=function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(cr.includes(t))return t}(e);return r||"Object"}(e),s=t&&t.typeEncoders&&t.typeEncoders[n]||vn[n];if("function"==typeof s){const i=s(e,n,t,r);if(null!=i)return i}const i=vn[n];if(!i)throw new Error(`CBOR encode error: unsupported type: ${n}`);return i(e,n,t,r)}function _n(e,t,r,n){if(Array.isArray(t))for(const s of t)_n(e,s,r,n);else r[t.type.major](e,t,n)}function Sn(e,t,r){const n=En(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){const e=r.quickEncodeToken(n);if(e)return e;const s=t[n.type.major];if(s.encodedSize){const e=s.encodedSize(n,r),t=new Ir(e);if(s(t,n,r),1!==t.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return yr(t.chunks[0])}}return mn.reset(),_n(mn,n,t,r),mn.toBytes(!0)}function An(e,t){return t=Object.assign({},yn,t),Sn(e,gn,t)}const In={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Rn{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=pn[e];if(void 0===t){const r=dn[e];if(!r)throw new Error(`CBOR decode error: no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const n=31&e;t=r(this.data,this.pos,n,this.options)}return this.pos+=t.encodedLength,t}}const kn=Symbol.for("DONE"),Tn=Symbol.for("BREAK");function Cn(e,t){if(e.done())return kn;const r=e.next();if(r.type===lr.break)return Tn;if(r.type.terminal)return r.value;if(r.type===lr.array)return function(e,t,r){const n=[];for(let s=0;s<e.value;s++){const i=Cn(t,r);if(i===Tn){if(e.value===1/0)break;throw new Error("CBOR decode error: got unexpected break to lengthed array")}if(i===kn)throw new Error(`CBOR decode error: found array but not enough entries (got ${s}, expected ${e.value})`);n[s]=i}return n}(r,e,t);if(r.type===lr.map)return function(e,t,r){const n=!0===r.useMaps,s=n?void 0:{},i=n?new Map:void 0;for(let o=0;o<e.value;o++){const a=Cn(t,r);if(a===Tn){if(e.value===1/0)break;throw new Error("CBOR decode error: got unexpected break to lengthed map")}if(a===kn)throw new Error(`CBOR decode error: found map but not enough entries (got ${o} [no key], expected ${e.value})`);if(!0!==n&&"string"!=typeof a)throw new Error(`CBOR decode error: non-string keys not supported (got ${typeof a})`);const c=Cn(t,r);if(c===kn)throw new Error(`CBOR decode error: found map but not enough entries (got ${o} [no value], expected ${e.value})`);n?i.set(a,c):s[a]=c}return n?i:s}(r,e,t);if(r.type===lr.tag){if(t.tags&&"function"==typeof t.tags[r.value]){const n=Cn(e,t);return t.tags[r.value](n)}throw new Error(`CBOR decode error: tag not supported (${r.value})`)}throw new Error("unsupported")}function Pn(e,t){if(!(e instanceof Uint8Array))throw new Error("CBOR decode error: data to decode must be a Uint8Array");const r=(t=Object.assign({},In,t)).tokenizer||new Rn(e,t),n=Cn(r,t);if(n===kn)throw new Error("CBOR decode error: did not find any content to decode");if(n===Tn)throw new Error("CBOR decode error: got unexpected break");if(!r.done())throw new Error("CBOR decode error: too many terminals, data makes no sense");return n}const Nn={float64:!0,typeEncoders:{Object:function(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const t=kt.asCID(e);if(!t)return null;const r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new hr(lr.tag,42),new hr(lr.bytes,r)]},undefined:function(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}},Dn={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};Dn.tags[42]=function(e){if(0!==e[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return kt.decode(e.subarray(1))};const On="dag-cbor",xn=113,Ln=e=>An(e,Nn),Bn=e=>Pn(e,Dn),Mn=({name:e,code:t,encode:r})=>new Un(e,t,r);class Un{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?_t(this.code,t):t.then((e=>_t(this.code,e)))}throw Error("Unknown type, must be binary type")}}class zn extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===lr.array&&(t.elements++,1!==t.elements&&e.push([44])),t.type===lr.map&&(t.elements++,1!==t.elements&&(t.elements%2==1?e.push([44]):e.push([58]))))}[lr.uint.major](e,t){this.prefix(e);const r=String(t.value),n=[];for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);e.push(n)}[lr.negint.major](e,t){this[lr.uint.major](e,t)}[lr.bytes.major](e,t){throw new Error("CBOR encode error: unsupported type: Uint8Array")}[lr.string.major](e,t){this.prefix(e);const r=mr(JSON.stringify(t.value));e.push(r.length>32?yr(r):r)}[lr.array.major](e,t){this.prefix(e),this.inRecursive.push({type:lr.array,elements:0}),e.push([91])}[lr.map.major](e,t){this.prefix(e),this.inRecursive.push({type:lr.map,elements:0}),e.push([123])}[lr.tag.major](e,t){}[lr.float.major](e,t){if("break"===t.type.name){const t=this.inRecursive.pop();if(t){if(t.type===lr.array)e.push([93]);else{if(t.type!==lr.map)throw new Error("Unexpected recursive type; this should not happen!");e.push([125])}return}throw new Error("Unexpected break; this should not happen!")}if(void 0===t.value)throw new Error("CBOR encode error: unsupported type: undefined");if(this.prefix(e),"true"===t.type.name)return void e.push([116,114,117,101]);if("false"===t.type.name)return void e.push([102,97,108,115,101]);if("null"===t.type.name)return void e.push([110,117,108,108]);const r=String(t.value),n=[];let s=!1;for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e),s||46!==n[e]&&101!==n[e]&&69!==n[e]||(s=!0);s||(n.push(46),n.push(48)),e.push(n)}}const Vn={addBreakTokens:!0,mapSorter:function(e,t){if(Array.isArray(e[0])||Array.isArray(t[0]))throw new Error("CBOR encode error: complex map keys are not supported");const r=e[0],n=t[0];if(r.type!==lr.string||n.type!==lr.string)throw new Error("CBOR encode error: non-string map keys are not supported");if(r<n)return-1;if(r>n)return 1;throw new Error("CBOR encode error: unexpected duplicate map keys, this is not supported")}};class Fn{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`CBOR decode error: unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`CBOR decode error: unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this.pos;let t=!1,r=!1;const n=e=>{for(;!this.done();){const t=this.ch();if(!e.includes(t))break;this.pos++}};if(45===this.ch()&&(t=!0,this.pos++),48===this.ch()){if(this.pos++,46!==this.ch())return new hr(lr.uint,0,this.pos-e);this.pos++,r=!0}if(n([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`CBOR decode error: unexpected token at position ${this.pos}`);if(!this.done()&&46===this.ch()){if(r)throw new Error(`CBOR decode error: unexpected token at position ${this.pos}`);r=!0,this.pos++,n([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(r=!0,this.pos++,this.done()||43!==this.ch()&&45!==this.ch()||this.pos++,n([48,49,50,51,52,53,54,55,56,57]));const s=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),i=parseFloat(s);return r?new hr(lr.float,i,this.pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(i)?new hr(i>=0?lr.uint:lr.negint,i,this.pos-e):new hr(i>=0?lr.uint:lr.negint,BigInt(s),this.pos-e)}parseString(){if(34!==this.ch())throw new Error(`CBOR decode error: unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let e=this.pos,t=0;e<this.data.length&&t<65536;e++,t++){const r=this.data[e];if(92===r||r<32||r>=128)break;if(34===r){const r=String.fromCharCode.apply(null,this.data.subarray(this.pos,e));return this.pos=e+1,new hr(lr.string,r,t)}}const e=this.pos,t=[],r=()=>{if(this.pos+4>=this.data.length)throw new Error(`CBOR decode error: unexpected end of unicode escape sequence at position ${this.pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else{if(!(t>=65&&t<=70))throw new Error(`CBOR decode error: unexpected unicode escape character at position ${this.pos}`);t=t-65+10}e=16*e+t,this.pos++}return e},n=()=>{const e=this.ch();let r,n,s,i,o=null,a=e>239?4:e>223?3:e>191?2:1;if(this.pos+a>this.data.length)throw new Error(`CBOR decode error: unexpected unicode sequence at position ${this.pos}`);switch(a){case 1:e<128&&(o=e);break;case 2:r=this.data[this.pos+1],128==(192&r)&&(i=(31&e)<<6|63&r,i>127&&(o=i));break;case 3:r=this.data[this.pos+1],n=this.data[this.pos+2],128==(192&r)&&128==(192&n)&&(i=(15&e)<<12|(63&r)<<6|63&n,i>2047&&(i<55296||i>57343)&&(o=i));break;case 4:r=this.data[this.pos+1],n=this.data[this.pos+2],s=this.data[this.pos+3],128==(192&r)&&128==(192&n)&&128==(192&s)&&(i=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&s,i>65535&&i<1114112&&(o=i))}null===o?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|1023&o),t.push(o),this.pos+=a};for(;!this.done();){const s=this.ch();let i;switch(s){case 92:if(this.pos++,this.done())throw new Error(`CBOR decode error: unexpected string termination at position ${this.pos}`);switch(i=this.ch(),this.pos++,i){case 34:case 39:case 92:case 47:t.push(i);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw new Error(`CBOR decode error: unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new hr(lr.string,Ar(t),this.pos-e);default:if(s<32)throw new Error(`CBOR decode error: invalid control character at position ${this.pos}`);s<128?(t.push(s),this.pos++):n()}}throw new Error(`CBOR decode error: unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new hr(lr.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new hr(lr.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new hr(lr.null,null,4);case 102:return this.expect([102,97,108,115,101]),new hr(lr.false,!1,5);case 116:return this.expect([116,114,117,101]),new hr(lr.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`CBOR decode error: unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this.pos++,this.skipWhitespace(),new hr(lr.break,void 0,1);if(44!==this.ch())throw new Error(`CBOR decode error: unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":return this.modeStack.pop(),93===this.ch()?(this.pos++,this.skipWhitespace(),new hr(lr.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(125===this.ch())return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new hr(lr.break,void 0,1);if(44!==this.ch())throw new Error(`CBOR decode error: unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this.pos++,this.skipWhitespace(),new hr(lr.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw new Error(`CBOR decode error: unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`CBOR decode error: unexpected parse state at position ${this.pos}; this shouldn't happen`)}}}function jn(e){const t=Fe.encode(e).slice(1);return[new hr(lr.map,1/0,1),new hr(lr.string,"/",1),new hr(lr.map,1/0,1),new hr(lr.string,"bytes",5),new hr(lr.string,t,t.length),new hr(lr.break,void 0,1),new hr(lr.break,void 0,1)]}const Kn={typeEncoders:{Object:function(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const t=kt.asCID(e);if(!t)return null;const r=t.toString();return[new hr(lr.map,1/0,1),new hr(lr.string,"/",1),new hr(lr.string,r,r.length),new hr(lr.break,void 0,1)]},Uint8Array:jn,Buffer:jn,undefined:function(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}};class $n extends Fn{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===lr.map){const e=this._next();if(e.type===lr.string&&"/"===e.value){const e=this._next();if(e.type===lr.string){if(this._next().type!==lr.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(e),new hr(lr.tag,42,0)}if(e.type===lr.map){const e=this._next();if(e.type===lr.string&&"bytes"===e.value){const e=this._next();if(e.type===lr.string){for(let e=0;e<2;e++)if(this._next().type!==lr.break)throw new Error("Invalid encoded Bytes form");const t=Fe.decode(`m${e.value}`);return new hr(lr.bytes,t,e.value.length)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}return e}}const Hn={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};Hn.tags[42]=kt.parse;const qn="dag-json",Gn=297,Wn=e=>{return t=e,r=Kn,r=Object.assign({},Vn,r),Sn(t,new zn,r);var t,r},Yn=e=>function(e,t){return Pn(e,t=Object.assign({tokenizer:new Fn(e,t)},t))}(e,Object.assign(Hn,{tokenizer:new $n(e,Hn)}));function Zn(e){return Ke.encode(e).slice(1)}function Qn(e){return Ke.decode(`u${e}`)}function Jn(e){const t={signature:Qn(e.signature)};return e.header&&(t.header=e.header),e.protected&&(t.protected=Qn(e.protected)),t}function Xn(e){const t={signature:Zn(e.signature)};return e.header&&(t.header=e.header),e.protected&&(t.protected=Zn(e.protected)),t}function es(e){const t={};return e.encrypted_key&&(t.encrypted_key=Qn(e.encrypted_key)),e.header&&(t.header=e.header),t}function ts(e){const t={};return e.encrypted_key&&(t.encrypted_key=Zn(e.encrypted_key)),e.header&&(t.header=e.header),t}const rs="dag-jose",ns=133;function ss(e){return"payload"in e&&"string"==typeof e.payload&&"signatures"in e&&Array.isArray(e.signatures)}function is(e){return"ciphertext"in e&&"string"==typeof e.ciphertext&&"iv"in e&&"string"==typeof e.iv&&"protected"in e&&"string"==typeof e.protected&&"tag"in e&&"string"==typeof e.tag}function os(e){if("string"==typeof e){const t=e.split(".");if(3===t.length)return function(e){const[t,r,n]=e;return{payload:r,signatures:[{protected:t,signature:n}],link:kt.decode(Qn(r))}}(t);if(5===t.length)return function(e){const[t,r,n,s,i]=e,o={ciphertext:s,iv:n,protected:t,tag:i};return r&&(o.recipients=[{encrypted_key:r}]),o}(t);throw new Error("Not a valid JOSE string")}if(ss(e)||is(e))return e;throw new Error("Not a valid unencoded JOSE object")}function as(e){let t;if("string"==typeof e&&(e=os(e)),ss(e))t=function(e){const t=Qn(e.payload);try{kt.decode(t)}catch(e){throw new Error("Not a valid DagJWS")}return{payload:t,signatures:e.signatures.map(Jn)}}(e);else{if(!is(e))throw new Error("Not a valid JOSE object");t=function(e){const t={ciphertext:Qn(e.ciphertext),protected:Qn(e.protected),iv:Qn(e.iv),tag:Qn(e.tag)};return e.aad&&(t.aad=Qn(e.aad)),e.recipients&&(t.recipients=e.recipients.map(es)),e.unprotected&&(t.unprotected=e.unprotected),t}(e)}return new Uint8Array(Ln(t))}function cs(e){let t;try{t=Bn(e)}catch(e){throw new Error("Not a valid DAG-JOSE object")}if("payload"in(r=t)&&r.payload instanceof Uint8Array&&"signatures"in r&&Array.isArray(r.signatures))return function(e){const t={payload:Zn(e.payload),signatures:e.signatures.map(Xn)};return t.link=kt.decode(new Uint8Array(e.payload)),t}(t);if(function(e){return"ciphertext"in e&&e.ciphertext instanceof Uint8Array&&"iv"in e&&e.iv instanceof Uint8Array&&"protected"in e&&e.protected instanceof Uint8Array&&"tag"in e&&e.tag instanceof Uint8Array}(t))return function(e){const t={ciphertext:Zn(e.ciphertext),protected:Zn(e.protected),iv:Zn(e.iv),tag:Zn(e.tag)};return e.aad&&(t.aad=Zn(e.aad)),e.recipients&&(t.recipients=e.recipients.map(ts)),e.unprotected&&(t.unprotected=e.unprotected),t}(t);throw new Error("Not a valid DAG-JOSE object");var r}const ls=Ee,hs={code:0,name:"identity",encode:ls,digest:e=>_t(0,ls(e))},us=ke({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),ds=Ce({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ps=Ce({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),fs=Te({prefix:"9",name:"base10",alphabet:"0123456789"}),ys=Ce({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),gs=Ce({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),ms=Te({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ws=Te({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),bs=Array.from(""),vs=bs.reduce(((e,t,r)=>(e[r]=t,e)),[]),Es=bs.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]),_s=ke({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+vs[t]),"")},decode:function(e){const t=[];for(const r of e){const e=Es[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),Ss=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),As=Mn({name:"sha2-256",code:18,encode:Ss("SHA-256")}),Is=Mn({name:"sha2-512",code:19,encode:Ss("SHA-512")}),Rs="raw",ks=85,Ts=e=>Ee(e),Cs=e=>Ee(e),Ps=new TextEncoder,Ns=new TextDecoder,Ds="json",Os=512,xs=e=>Ps.encode(JSON.stringify(e)),Ls=e=>JSON.parse(Ns.decode(e)),Bs={...u,...d,...p,...f,...y,...s,...g,...n,...i,...m},Ms={...w,...h},Us={raw:b,json:v};class zs extends Error{constructor(e="not initialized"){super(e),this.name="NotInitializedError",this.code=zs.code}}zs.code="ERR_NOT_INITIALIZED";class Vs extends Error{constructor(e="cannot initialize an initializing node"){super(e),this.name="AlreadyInitializingError",this.code=Fs.code}}Vs.code="ERR_ALREADY_INITIALIZING";class Fs extends Error{constructor(e="cannot re-initialize an initialized node"){super(e),this.name="AlreadyInitializedError",this.code=Fs.code}}Fs.code="ERR_ALREADY_INITIALIZED";class js extends Error{constructor(e="not started"){super(e),this.name="NotStartedError",this.code=js.code}}js.code="ERR_NOT_STARTED";class Ks extends Error{constructor(e="cannot start, already startin"){super(e),this.name="AlreadyStartingError",this.code=Ks.code}}Ks.code="ERR_ALREADY_STARTING";class $s extends Error{constructor(e="cannot start, already started"){super(e),this.name="AlreadyStartedError",this.code=$s.code}}$s.code="ERR_ALREADY_STARTED";class Hs extends Error{constructor(e="not enabled"){super(e),this.name="NotEnabledError",this.code=Hs.code}}function qs(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Gs(e=0){return null!=globalThis.Buffer?.alloc?qs(globalThis.Buffer.alloc(e)):new Uint8Array(e)}function Ws(e=0){return null!=globalThis.Buffer?.allocUnsafe?qs(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Ys(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}Hs.code="ERR_NOT_ENABLED";const Zs=Ys("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Qs=Ys("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=Ws((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),Js={utf8:Zs,"utf-8":Zs,hex:Bs.base16,latin1:Qs,ascii:Qs,binary:Qs,...Bs};function Xs(e,t="utf8"){const r=Js[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):qs(globalThis.Buffer.from(e,"utf-8"))}var ei=r(12964);const ti=new class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,r=e();return void 0===r&&(this.index=t),r}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically((()=>{const t=this.readChar();if(t===e)return t}))}readSeparator(e,t,r){return this.readAtomically((()=>{if(!(t>0&&void 0===this.readGivenChar(e)))return r()}))}readNumber(e,t,r,n){return this.readAtomically((()=>{let s=0,i=0;const o=this.peekChar();if(void 0===o)return;const a="0"===o,c=2**(8*n)-1;for(;;){const r=this.readAtomically((()=>{const t=this.readChar();if(void 0===t)return;const r=Number.parseInt(t,e);return Number.isNaN(r)?void 0:r}));if(void 0===r)break;if(s*=e,s+=r,s>c)return;if(i+=1,void 0!==t&&i>t)return}return 0===i||!r&&a&&i>1?void 0:s}))}readIPv4Addr(){return this.readAtomically((()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const r=this.readSeparator(".",t,(()=>this.readNumber(10,3,!1,1)));if(void 0===r)return;e[t]=r}return e}))}readIPv6Addr(){const e=e=>{for(let t=0;t<e.length/2;t++){const r=2*t;if(t<e.length-3){const n=this.readSeparator(":",t,(()=>this.readIPv4Addr()));if(void 0!==n)return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],[r+4,!0]}const n=this.readSeparator(":",t,(()=>this.readNumber(16,4,!0,2)));if(void 0===n)return[r,!1];e[r]=n>>8,e[r+1]=255&n}return[e.length,!1]};return this.readAtomically((()=>{const t=new Uint8Array(16),[r,n]=e(t);if(16===r)return t;if(n)return;if(void 0===this.readGivenChar(":"))return;if(void 0===this.readGivenChar(":"))return;const s=new Uint8Array(14),i=16-(r+2),[o]=e(s.subarray(0,i));return t.set(s.subarray(0,o),16-o),t}))}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};function ri(e){return Boolean(function(e){if(!(e.length>45))return ti.new(e).parseWith((()=>ti.readIPAddr()))}(e))}function ni(e,t="utf8"){const r=Js[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}const si=function(e){return Boolean(function(e){if(!(e.length>15))return ti.new(e).parseWith((()=>ti.readIPv4Addr()))}(e))},ii=function(e){return Boolean(function(e){if(!(e.length>45))return ti.new(e).parseWith((()=>ti.readIPv6Addr()))}(e))},oi=function(e){let t=0;if(e=e.toString().trim(),si(e)){const r=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{r[t++]=255&parseInt(e,10)})),r}if(ii(e)){const r=e.split(":",8);let n;for(n=0;n<r.length;n++){let e;si(r[n])&&(e=oi(r[n]),r[n]=ni(e.slice(0,2),"base16")),null!=e&&++n<8&&r.splice(n,0,ni(e.slice(2,4),"base16"))}if(""===r[0])for(;r.length<8;)r.unshift("0");else if(""===r[r.length-1])for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&""!==r[n];n++);const e=[n,1];for(n=9-r.length;n>0;n--)e.push("0");r.splice.apply(r,e)}const s=new Uint8Array(t+16);for(n=0;n<r.length;n++){const e=parseInt(r[n],16);s[t++]=e>>8&255,s[t++]=255&e}return s}throw new Error("invalid ip address")},ai=-1,ci={},li={};function hi(e){if("number"==typeof e){if(null!=li[e])return li[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=ci[e])return ci[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,ai,"ip6zone"],[53,ai,"dns",!0],[54,ai,"dns4",!0],[55,ai,"dns6",!0],[56,ai,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,ai,"unix",!1,!0],[421,ai,"ipfs"],[421,ai,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,ai,"garlic64"],[460,0,"quic"],[465,0,"webtransport"],[466,ai,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,ai,"memory"]].forEach((e=>{const t=function(e,t,r,n,s){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(s)}}(...e);li[t.code]=t,ci[t.name]=t}));var ui=r(44324);function di(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=Ws(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return qs(r)}function pi(e,t){switch(hi(e).code){case 4:case 41:return function(e){const t=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let s=0;s<r;s++)n.push(e[t+s]);return n.join(".")}if(16===r){const e=[];for(let s=0;s<r;s+=2)e.push(n.getUint16(t+s).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""}(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!ri(t))throw new Error("invalid ip address");return t}(t);case 6:case 273:case 33:case 132:return wi(t).toString();case 53:case 54:case 55:case 56:case 400:case 777:return function(e){const t=ui.decode(e);if((e=e.slice(ui.decode.bytes)).length!==t)throw new Error("inconsistent lengths");return ni(e)}(t);case 421:return function(e){const t=ui.decode(e),r=e.slice(ui.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return ni(r,"base58btc")}(t);case 444:case 445:return function(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${ni(t,"base32")}:${wi(r)}`}(t);case 466:return function(e){const t=ui.decode(e),r=e.slice(ui.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return"u"+ni(r,"base64url")}(t);default:return ni(t,"base16")}}function fi(e,t){switch(hi(e).code){case 4:case 41:return function(e){if(!ri(e))throw new Error("invalid ip address");return oi(e)}(t);case 6:case 273:case 33:case 132:return mi(parseInt(t,10));case 53:case 54:case 55:case 56:case 400:case 777:return function(e){const t=Xs(e),r=Uint8Array.from(ui.encode(t.length));return di([r,t],r.length+t.length)}(t);case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?St(Pe.decode(`z${e}`)).bytes:kt.parse(e).multihash.bytes;const r=Uint8Array.from(ui.encode(t.length));return di([r,t],r.length+t.length)}(t);case 444:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const r=De.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=mi(n);return di([r,s],r.length+s.length)}(t);case 445:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const r=De.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=mi(n);return di([r,s],r.length+s.length)}(t);case 466:return function(e){const t=gi.decode(e),r=Uint8Array.from(ui.encode(t.length));return di([r,t],r.length+t.length)}(t);default:return Xs(t,"base16")}}const yi=Object.values(Bs).map((e=>e.decoder)),gi=function(){let e=yi[0].or(yi[1]);return yi.slice(2).forEach((t=>e=e.or(t))),e}();function mi(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function wi(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function bi(e){return e.map((e=>{const t=ki(e);return null!=e[1]?[t.code,pi(t.code,e[1])]:[t.code]}))}function vi(e){return Ai(di(e.map((e=>{const t=ki(e);let r=Uint8Array.from(ui.encode(t.code));return e.length>1&&null!=e[1]&&(r=di([r,e[1]])),r}))))}function Ei(e,t){return e.size>0?e.size/8:0===e.size?0:ui.decode(t)+ui.decode.bytes}function _i(e){const t=[];let r=0;for(;r<e.length;){const n=ui.decode(e,r),s=ui.decode.bytes,i=Ei(hi(n),e.slice(r+s));if(0===i){t.push([n]),r+=s;continue}const o=e.slice(r+s,r+s+i);if(r+=i+s,r>e.length)throw Ri("Invalid address Uint8Array: "+ni(e,"base16"));t.push([n,o])}return t}function Si(e){return function(e){const t=[];return e.map((e=>{const r=ki(e);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),Ii(t.join("/"))}(bi(_i(e)))}function Ai(e){const t=function(e){try{_i(e)}catch(e){return e}}(e);if(null!=t)throw t;return Uint8Array.from(e)}function Ii(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function Ri(e){return new Error("Error parsing address: "+e)}function ki(e){return hi(e[0])}function Ti(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}var Ci,Pi,Ni,Di,Oi=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},xi=function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r};const Li=Symbol.for("nodejs.util.inspect.custom"),Bi=[hi("dns").code,hi("dns4").code,hi("dns6").code,hi("dnsaddr").code],Mi=[hi("p2p").code,hi("ipfs").code],Ui=new Map,zi=Symbol.for("@multiformats/js-multiaddr/multiaddr");function Vi(e,t){if(null==e)throw new Error("requires node address object");if(null==t)throw new Error("requires transport protocol");let r;switch(e.family){case 4:r="ip4";break;case 6:r="ip6";break;default:throw Error("Invalid addr family, should be 4 or 6.")}return new ji("/"+[r,e.address,t,e.port].join("/"))}function Fi(e){return Boolean(e?.[zi])}class ji{constructor(e){if(Ci.set(this,void 0),Pi.set(this,void 0),Ni.set(this,void 0),this[Di]=!0,null==e&&(e=""),e instanceof Uint8Array)this.bytes=Ai(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=function(e){const t=function(e){const t=[],r=e.split("/").slice(1);if(1===r.length&&""===r[0])return[];for(let n=0;n<r.length;n++){const s=r[n],i=hi(s);if(0!==i.size){if(n++,n>=r.length)throw Ri("invalid address: "+e);if(!0===i.path){t.push([s,Ii(r.slice(n).join("/"))]);break}t.push([s,r[n]])}else t.push([s])}return t}(e=Ii(e));return vi(t.map((e=>{Array.isArray(e)||(e=[e]);const t=ki(e);return e.length>1?[t.code,fi(t.code,e[1])]:[t.code]})))}(e)}else{if(!Fi(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=Ai(e.bytes)}}toString(){return null==Oi(this,Ci,"f")&&xi(this,Ci,Si(this.bytes),"f"),Oi(this,Ci,"f")}toJSON(){return this.toString()}toOptions(){const e=this.protoCodes(),t=this.toString().split("/").slice(1);let r,n;if(t.length>2)Bi.includes(e[0])&&Mi.includes(e[1])?(r=hi("tcp").name,n=443):(r=hi(t[2]).name,n=parseInt(t[3]));else{if(!Bi.includes(e[0]))throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');r=hi("tcp").name,n=443}return{family:41===e[0]||55===e[0]?6:4,host:t[1],transport:r,port:n}}protos(){return this.protoCodes().map((e=>Object.assign({},hi(e))))}protoCodes(){const e=[],t=this.bytes;let r=0;for(;r<t.length;){const n=ui.decode(t,r),s=ui.decode.bytes;r+=Ei(hi(n),t.slice(r+s))+s,e.push(n)}return e}protoNames(){return this.protos().map((e=>e.name))}tuples(){return null==Oi(this,Pi,"f")&&xi(this,Pi,_i(this.bytes),"f"),Oi(this,Pi,"f")}stringTuples(){return null==Oi(this,Ni,"f")&&xi(this,Ni,bi(this.tuples()),"f"),Oi(this,Ni,"f")}encapsulate(e){return e=new ji(e),new ji(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new ji(r.slice(0,n))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new ji(vi(t.slice(0,r)));return this}getPeerId(){try{const e=this.stringTuples().filter((e=>e[0]===ci.ipfs.code)),t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?ni(Pe.decode(`z${e}`),"base58btc"):ni(kt.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){let e=null;try{e=this.stringTuples().filter((e=>!0===hi(e[0]).path))[0][1],null==e&&(e=null)}catch{e=null}return e}equals(e){return Ti(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const r=Ui.get(t.name);if(null==r)throw qe(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await r(this,e)).map((e=>new ji(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(2!==t.length||4!==t[0].code&&41!==t[0].code||6!==t[1].code&&273!==t[1].code)}[(Ci=new WeakMap,Pi=new WeakMap,Ni=new WeakMap,Di=zi,Li)](){return this.inspect()}inspect(){return"<Multiaddr "+ni(this.bytes,"base16")+" - "+Si(this.bytes)+">"}}function Ki(e){return new ji(e)}const $i=go("dns4"),Hi=go("dns6"),qi=go("dnsaddr"),Gi=yo(go("dns"),qi,$i,Hi),Wi=yo(go("ip4"),go("ip6")),Yi=yo(fo(Wi,go("tcp")),fo(Gi,go("tcp"))),Zi=fo(Wi,go("udp")),Qi=fo(Zi,go("utp")),Ji=fo(Zi,go("quic")),Xi=yo(fo(Yi,go("ws")),fo(Gi,go("ws"))),eo=yo(fo(Yi,go("wss")),fo(Gi,go("wss"))),to=yo(fo(Yi,go("http")),fo(Wi,go("http")),fo(Gi,go("http"))),ro=yo(fo(Yi,go("https")),fo(Wi,go("https")),fo(Gi,go("https"))),no=yo(fo(Xi,go("p2p-webrtc-star"),go("p2p")),fo(eo,go("p2p-webrtc-star"),go("p2p")),fo(Xi,go("p2p-webrtc-star")),fo(eo,go("p2p-webrtc-star"))),so=(yo(fo(Xi,go("p2p-websocket-star"),go("p2p")),fo(eo,go("p2p-websocket-star"),go("p2p")),fo(Xi,go("p2p-websocket-star")),fo(eo,go("p2p-websocket-star"))),yo(fo(to,go("p2p-webrtc-direct"),go("p2p")),fo(ro,go("p2p-webrtc-direct"),go("p2p")),fo(to,go("p2p-webrtc-direct")),fo(ro,go("p2p-webrtc-direct")))),io=yo(Xi,eo,to,ro,no,so,Yi,Qi,Ji,Gi),oo=(yo(fo(io,go("p2p-stardust"),go("p2p")),fo(io,go("p2p-stardust"))),yo(fo(io,go("p2p")),no,so,go("p2p"))),ao=yo(fo(oo,go("p2p-circuit"),oo),fo(oo,go("p2p-circuit")),fo(go("p2p-circuit"),oo),fo(io,go("p2p-circuit")),fo(go("p2p-circuit"),io),go("p2p-circuit")),co=()=>yo(fo(ao,co),ao),lo=co(),ho=yo(fo(lo,oo,lo),fo(oo,lo),fo(lo,oo),lo,oo),uo=ho;function po(e){return function(t){let r;try{r=Ki(t)}catch(e){return!1}const n=e(r.protoNames());return null!==n&&(!0===n||!1===n?n:0===n.length)}}function fo(...e){function t(t){if(t.length<e.length)return null;let r=t;return e.some((e=>(r="function"==typeof e?e().partialMatch(t):e.partialMatch(t),Array.isArray(r)&&(t=r),null===r))),r}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:po(t),partialMatch:t}}function yo(...e){function t(t){let r=null;return e.some((e=>{const n="function"==typeof e?e().partialMatch(t):e.partialMatch(t);return null!=n&&(r=n,!0)})),r}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:po(t),partialMatch:t}}function go(e){const t=e;return{toString:function(){return t},matches:function(e){let r;try{r=Ki(e)}catch(e){return!1}const n=r.protoNames();return 1===n.length&&n[0]===t},partialMatch:function(e){return 0===e.length?null:e[0]===t?e.slice(1):null}}}var mo=r(21963);const wo=/^\/(ip[fn]s)\/([^/?#]+)/,bo=/^https?:\/\/([^/]+)\.(ip[fn]s)\.[^/?]+/,vo=/^(([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])\.)+([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])$/;function Eo(e){try{return Ao(e)?Boolean(kt.parse(e)):e instanceof Uint8Array?Boolean(kt.decode(e)):Boolean(kt.asCID(e))}catch{return!1}}function _o(e,t,r=1,n=2){const s=Io(e);if(!1===s)return!1;const i=s.match(t);if(null==i)return!1;if("ipfs"!==i[r])return!1;let o=i[n];return null!=o&&t===bo&&(o=o.toLowerCase()),Eo(o)}function So(e,t,r=1,n=2){const s=Io(e);if(!1===s)return!1;const i=s.match(t);if(null==i)return!1;if("ipns"!==i[r])return!1;let o=i[n];if(null!=o&&t===bo){if(o=o.toLowerCase(),Eo(o))return!0;try{!o.includes(".")&&o.includes("-")&&(o=o.replace(/--/g,"@").replace(/-/g,".").replace(/@/g,"-"));const{hostname:e}=new mo.URL(`http://${o}`);return vo.test(e)}catch(e){return!1}}return!0}function Ao(e){return"string"==typeof e}function Io(e){return e instanceof Uint8Array?ni(e,"base58btc"):!!Ao(e)&&e}const Ro=e=>_o(e,wo)||So(e,wo),ko=e=>So(e,wo);let To=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")),"");const Co="/",Po=(new TextEncoder).encode(Co),No=Po[0];class Do{constructor(e,t){if("string"==typeof e)this._buf=Xs(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==No)throw new Error("Invalid key")}toString(e="utf8"){return ni(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Do(e.join(Co))}static random(){return new Do(To().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new Do(e):"function"==typeof e.uint8Array?new Do(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=Po),this._buf[0]!==No){const e=new Uint8Array(this._buf.byteLength+1);e.fill(No,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===No;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],s=r[e];if(n<s)return!0;if(n>s)return!1}return t.length<r.length}reverse(){return Do.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Co).slice(1)}type(){return function(e){const t=e.split(":");return t.length<2?"":t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new Do(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Co)||(e+=Co),e+=this.type(),new Do(e)}parent(){const e=this.list();return 1===e.length?new Do(Co):new Do(e.slice(0,-1).join(Co))}child(e){return this.toString()===Co?e:e.toString()===Co?this:new Do(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return Do.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}var Oo=r(92360);let xo=/(-?(?:\d+\.?\d*|\d*\.?\d+)(?:e[-+]?\d+)?)\s*([\p{L}]*)/giu;function Lo(e="",t="ms"){var r=null;return(e=(e+"").replace(/(\d)[,_](\d)/g,"$1$2")).replace(xo,(function(e,t,n){(n=Bo(n))&&(r=(r||0)+parseFloat(t,10)*n)})),r&&r/(Bo(t)||1)}function Bo(e){return Lo[e]||Lo[e.toLowerCase().replace(/s$/,"")]}Lo.nanosecond=Lo.ns=1e-6,Lo["s"]=Lo["s"]=Lo.us=Lo.microsecond=.001,Lo.millisecond=Lo.ms=Lo[""]=1,Lo.second=Lo.sec=Lo.s=1e3*Lo.ms,Lo.minute=Lo.min=Lo.m=60*Lo.s,Lo.hour=Lo.hr=Lo.h=60*Lo.m,Lo.day=Lo.d=24*Lo.h,Lo.week=Lo.wk=Lo.w=7*Lo.d,Lo.month=Lo.b=30.4375*Lo.d,Lo.year=Lo.yr=Lo.y=365.25*Lo.d;const Mo=Lo;class Uo extends Error{constructor(e="request timed out"){super(e),this.name="TimeoutError",this.code=Uo.code}}function zo(e,t){return(...r)=>{const n=r[null==t?r.length-1:t];if(!n||!n.timeout)return e(...r);const s="string"==typeof n.timeout?Mo(n.timeout):n.timeout,i=new ei.TimeoutController(s);n.signal=(0,Oo.anySignal)([n.signal,i.signal]);const o=e(...r),a=new Promise(((e,t)=>{i.signal.addEventListener("abort",(()=>{t(new Uo)}))})),c=Date.now(),l=()=>{if(i.signal.aborted)throw new Uo;if(Date.now()-c>s)throw i.abort(),new Uo};return o[Symbol.asyncIterator]?async function*(){const e=o[Symbol.asyncIterator]();try{for(;;){const{value:t,done:r}=await Promise.race([e.next(),a]);if(r)break;l(),yield t}}catch(e){throw l(),e}finally{i.clear(),e.return&&e.return()}}():(async()=>{try{const e=await Promise.race([o,a]);return l(),e}catch(e){throw l(),e}finally{i.clear()}})()}}Uo.code="ERR_TIMEOUT";const Vo="/ipfs/";function Fo(e){if(e instanceof Uint8Array)try{e=kt.decode(e)}catch(e){throw qe(e,"ERR_INVALID_CID")}let t=kt.asCID(e);if(t)return{cid:t,path:void 0};(e=e.toString()).startsWith(Vo)&&(e=e.substring(Vo.length));const r=e.split("/");let n;try{t=kt.parse(r.shift()||"")}catch(e){throw qe(e,"ERR_INVALID_CID")}return r.length&&(n=`/${r.join("/")}`),{cid:t,path:n}}const jo="This command must be run in online mode. Try running 'ipfs daemon' first.",Ko=new Do("/local/filesroot"),$o=262144,Ho=e=>e instanceof Uint8Array?kt.decode(e).toString():(0===(e=e.toString()).indexOf("/ipfs/")&&(e=e.substring("/ipfs/".length)),"/"===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),e),qo=async function(e,t,r,n={}){const{cid:s,path:i}=Fo(r);i&&(n.path=i);let o=s,a=n.path||"";if(a.startsWith("/")&&(a=a.substring(1)),n.path)try{for await(const{value:r,remainderPath:i}of Yo(s,n.path,t,e,{signal:n.signal})){if(!kt.asCID(r))break;a=i,o=r}}catch(e){throw e.message.startsWith("Object has no property")&&(e.message=`no link named "${a.split("/")[0]}" under ${o}`,e.code="ERR_NO_LINK"),e}return{cid:o,remainderPath:a||""}},Go=e=>{if("file"!==e.type&&"directory"!==e.type&&"raw"!==e.type)throw new Error(`Unknown node type '${e.type}'`);const t={cid:e.cid,path:e.path,name:e.name,size:e.size,type:"file"};return"directory"===e.type&&(t.type="dir"),"file"===e.type&&(t.size=e.unixfs.fileSize()),"file"!==e.type&&"directory"!==e.type||(t.mode=e.unixfs.mode,void 0!==e.unixfs.mtime&&(t.mtime=e.unixfs.mtime)),t},Wo=zo((async(e,t)=>await e)),Yo=async function*(e,t,r,n,s){const i=async e=>{const t=await r.getCodec(e.code),i=await n.blocks.get(e,s);return t.decode(i)},o=t.split("/").filter(Boolean);let a=await i(e),c=e;for(;o.length;){const r=o.shift();if(!r)throw qe(new Error(`Could not resolve path "${t}"`),"ERR_INVALID_PATH");if(e.code===sr&&Array.isArray(a.Links)){const e=a.Links.find((e=>e.Name===r));if(e){yield{value:e.Hash,remainderPath:o.join("/")},a=await i(e.Hash),c=e.Hash;continue}}if(!Object.prototype.hasOwnProperty.call(a,r))throw qe(new Error(`no link named "${r}" under ${c}`),"ERR_NO_LINK");a=a[r],yield{value:a,remainderPath:o.join("/")},kt.asCID(a)&&(c=a,a=await i(a))}yield{value:a,remainderPath:""}};class Zo{static create({start:e,stop:t}){return new Zo(e,t)}static async start(e,t){const{state:r,activate:n}=e;switch(r.status){case"stopped":try{const r=n(t);e.state={status:"starting",ready:r};const s=await r;return e.state={status:"started",value:s},s}catch(t){throw e.state={status:"stopped"},t}case"starting":throw new Ks;case"started":throw new $s;case"stopping":return await r.ready,await Zo.start(e,t);default:return Zo.panic(e)}}static async stop(e){const{state:t,deactivate:r}=e;switch(t.status){case"stopped":break;case"starting":try{await t.ready}catch(e){}return await Zo.stop(e);case"stopping":return await t.ready;case"started":r&&await r(t.value),e.state={status:"stopped"};break;default:Zo.panic(t)}}static try({state:e}){return"started"===e.status?e.value:null}static async use({state:e},t){switch(e.status){case"started":return e.value;case"starting":return await Wo(e.ready,t);default:throw new js}}static panic({state:e}){const t=JSON.stringify({status:e.status});throw RangeError(`Service in invalid state ${t}, should never happen if you see this please report a bug`)}constructor(e,t){this.activate=e,this.deactivate=t,this.state={status:"stopped"}}async use(e){return await Zo.use(this,e)}try(){return Zo.try(this)}}var Qo=r(26205),Jo=r(33579);class Xo extends Error{constructor(e){super(e),this.name="TimeoutError"}}class ea extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const ta=e=>void 0===globalThis.DOMException?new ea(e):new DOMException(e),ra=e=>{const t=void 0===e.reason?ta("This operation was aborted."):e.reason;return t instanceof Error?t:ta(t)};function na(e,t,r,n){let s;const i=new Promise(((i,o)=>{if("number"!=typeof t||1!==Math.sign(t))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t!==Number.POSITIVE_INFINITY){if((n={customTimers:{setTimeout,clearTimeout},...n}).signal){const{signal:e}=n;e.aborted&&o(ra(e)),e.addEventListener("abort",(()=>{o(ra(e))}))}s=n.customTimers.setTimeout.call(void 0,(()=>{if("function"==typeof r){try{i(r())}catch(e){o(e)}return}const n=r instanceof Error?r:new Xo("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),o(n)}),t),(async()=>{try{i(await e)}catch(e){o(e)}finally{n.customTimers.clearTimeout.call(void 0,s)}})()}else i(e)}));return i.clear=()=>{clearTimeout(s),s=void 0},i}var sa,ia=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class oa{constructor(){sa.set(this,[])}enqueue(e,t){const r={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&ia(this,sa,"f")[this.size-1].priority>=t.priority)return void ia(this,sa,"f").push(r);const n=function(e,t,r){let n=0,s=e.length;for(;s>0;){const r=Math.trunc(s/2);let o=n+r;i=e[o],t.priority-i.priority<=0?(n=++o,s-=r+1):s=r}var i;return n}(ia(this,sa,"f"),r);ia(this,sa,"f").splice(n,0,r)}dequeue(){const e=ia(this,sa,"f").shift();return null==e?void 0:e.run}filter(e){return ia(this,sa,"f").filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return ia(this,sa,"f").length}}sa=new WeakMap;var aa,ca,la,ha,ua,da,pa,fa,ya,ga,ma,wa,ba,va,Ea,_a,Sa,Aa,Ia,Ra,ka,Ta,Ca,Pa,Na,Da,Oa=function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},xa=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};const La=new Xo;class Ba extends Error{}class Ma extends Jo{constructor(e){var t,r,n,s;if(super(),aa.add(this),ca.set(this,void 0),la.set(this,void 0),ha.set(this,0),ua.set(this,void 0),da.set(this,void 0),pa.set(this,0),fa.set(this,void 0),ya.set(this,void 0),ga.set(this,void 0),ma.set(this,void 0),wa.set(this,0),ba.set(this,void 0),va.set(this,void 0),Ea.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:oa,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(s=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==s?s:""}\` (${typeof e.interval})`);Oa(this,ca,e.carryoverConcurrencyCount,"f"),Oa(this,la,e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,"f"),Oa(this,ua,e.intervalCap,"f"),Oa(this,da,e.interval,"f"),Oa(this,ga,new e.queueClass,"f"),Oa(this,ma,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,Oa(this,Ea,!0===e.throwOnTimeout,"f"),Oa(this,va,!1===e.autoStart,"f")}get concurrency(){return xa(this,ba,"f")}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);Oa(this,ba,e,"f"),xa(this,aa,"m",Na).call(this)}async add(e,t={}){return new Promise(((r,n)=>{xa(this,ga,"f").enqueue((async()=>{var s,i,o;Oa(this,wa,(i=xa(this,wa,"f"),++i),"f"),Oa(this,ha,(o=xa(this,ha,"f"),++o),"f");try{if(null===(s=t.signal)||void 0===s?void 0:s.aborted)return void n(new Ba("The task was aborted."));const i=void 0===this.timeout&&void 0===t.timeout?e({signal:t.signal}):na(Promise.resolve(e({signal:t.signal})),void 0===t.timeout?this.timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?xa(this,Ea,"f"):t.throwOnTimeout)&&n(La)})),o=await i;r(o),this.emit("completed",o)}catch(e){n(e),this.emit("error",e)}xa(this,aa,"m",Aa).call(this)}),t),xa(this,aa,"m",Ta).call(this),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return xa(this,va,"f")?(Oa(this,va,!1,"f"),xa(this,aa,"m",Na).call(this),this):this}pause(){Oa(this,va,!0,"f")}clear(){Oa(this,ga,new(xa(this,ma,"f")),"f")}async onEmpty(){0!==xa(this,ga,"f").size&&await xa(this,aa,"m",Da).call(this,"empty")}async onSizeLessThan(e){xa(this,ga,"f").size<e||await xa(this,aa,"m",Da).call(this,"next",(()=>xa(this,ga,"f").size<e))}async onIdle(){0===xa(this,wa,"f")&&0===xa(this,ga,"f").size||await xa(this,aa,"m",Da).call(this,"idle")}get size(){return xa(this,ga,"f").size}sizeBy(e){return xa(this,ga,"f").filter(e).length}get pending(){return xa(this,wa,"f")}get isPaused(){return xa(this,va,"f")}}ca=new WeakMap,la=new WeakMap,ha=new WeakMap,ua=new WeakMap,da=new WeakMap,pa=new WeakMap,fa=new WeakMap,ya=new WeakMap,ga=new WeakMap,ma=new WeakMap,wa=new WeakMap,ba=new WeakMap,va=new WeakMap,Ea=new WeakMap,aa=new WeakSet,_a=function(){return xa(this,la,"f")||xa(this,ha,"f")<xa(this,ua,"f")},Sa=function(){return xa(this,wa,"f")<xa(this,ba,"f")},Aa=function(){var e;Oa(this,wa,(e=xa(this,wa,"f"),--e),"f"),xa(this,aa,"m",Ta).call(this),this.emit("next")},Ia=function(){this.emit("empty"),0===xa(this,wa,"f")&&this.emit("idle")},Ra=function(){xa(this,aa,"m",Pa).call(this),xa(this,aa,"m",Ca).call(this),Oa(this,ya,void 0,"f")},ka=function(){const e=Date.now();if(void 0===xa(this,fa,"f")){const t=xa(this,pa,"f")-e;if(!(t<0))return void 0===xa(this,ya,"f")&&Oa(this,ya,setTimeout((()=>{xa(this,aa,"m",Ra).call(this)}),t),"f"),!0;Oa(this,ha,xa(this,ca,"f")?xa(this,wa,"f"):0,"f")}return!1},Ta=function(){if(0===xa(this,ga,"f").size)return xa(this,fa,"f")&&clearInterval(xa(this,fa,"f")),Oa(this,fa,void 0,"f"),xa(this,aa,"m",Ia).call(this),!1;if(!xa(this,va,"f")){const e=!xa(this,aa,"a",ka);if(xa(this,aa,"a",_a)&&xa(this,aa,"a",Sa)){const t=xa(this,ga,"f").dequeue();return!!t&&(this.emit("active"),t(),e&&xa(this,aa,"m",Ca).call(this),!0)}}return!1},Ca=function(){xa(this,la,"f")||void 0!==xa(this,fa,"f")||(Oa(this,fa,setInterval((()=>{xa(this,aa,"m",Pa).call(this)}),xa(this,da,"f")),"f"),Oa(this,pa,Date.now()+xa(this,da,"f"),"f"))},Pa=function(){0===xa(this,ha,"f")&&0===xa(this,wa,"f")&&xa(this,fa,"f")&&(clearInterval(xa(this,fa,"f")),Oa(this,fa,void 0,"f")),Oa(this,ha,xa(this,ca,"f")?xa(this,wa,"f"):0,"f"),xa(this,aa,"m",Na).call(this)},Na=function(){for(;xa(this,aa,"m",Ta).call(this););},Da=async function(e,t){return new Promise((r=>{const n=()=>{t&&!t()||(this.off(e,n),r())};this.on(e,n)}))};var Ua=r(6963);const za=new class{constructor(e){this.lru=Qo(e)}get(e){const t=this.lru.get(e);if(t)return t.expire&&t.expire<Date.now()?void this.lru.remove(e):t.value}set(e,t,r){this.lru.set(e,{value:t,expire:Date.now()+r})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}}(1e3),Va=new(Ma.default?Ma.default:Ma)({concurrency:4}),Fa=e=>{if(e.Path)return e.Path;throw new Error(e.Message)};const ja=Symbol.for("@libp2p/peer-id");function Ka(e){return null!=e&&Boolean(e[ja])}const $a=Object.values(Bs).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),Bs.identity.decoder);class Ha{constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[ja](){return!0}toString(){return null==this.string&&(this.string=Pe.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return kt.createV1(114,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Ti(this.multihash.bytes,e);if("string"==typeof e)return Za(e).equals(this);if(null!=e?.multihash?.bytes)return Ti(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}}class qa extends Ha{constructor(e){super({...e,type:"RSA"}),this.type="RSA",this.publicKey=e.publicKey}}class Ga extends Ha{constructor(e){super({...e,type:"Ed25519"}),this.type="Ed25519",this.publicKey=e.multihash.digest}}class Wa extends Ha{constructor(e){super({...e,type:"secp256k1"}),this.type="secp256k1",this.publicKey=e.multihash.digest}}function Ya(e){if("RSA"===e.type)return new qa(e);if("Ed25519"===e.type)return new Ga(e);if("secp256k1"===e.type)return new Wa(e);throw qe(new Error("Not a PeerId"),"ERR_INVALID_PARAMETERS")}function Za(e,t){if(t=t??$a,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=St(Pe.decode(`z${e}`));return e.startsWith("12D")?new Ga({multihash:t}):e.startsWith("16U")?new Wa({multihash:t}):new qa({multihash:t})}return Qa($a.decode(e))}function Qa(e){try{const t=St(e);if(t.code===hs.code){if(36===t.digest.length)return new Ga({multihash:t});if(37===t.digest.length)return new Wa({multihash:t})}if(t.code===As.code)return new qa({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&114!==e.code)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===As.code)return new qa({multihash:e.multihash});if(t.code===hs.code){if(36===t.digest.length)return new Ga({multihash:e.multihash});if(37===t.digest.length)return new Wa({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(kt.decode(e))}throw new Error("Supplied PeerID CID is invalid")}async function Ja(e,t){return 36===e.length?new Ga({multihash:_t(hs.code,e),privateKey:t}):37===e.length?new Wa({multihash:_t(hs.code,e),privateKey:t}):new qa({multihash:await As.digest(e),publicKey:e,privateKey:t})}async function Xa(e){let t;for await(const r of e)t=r;return t}async function*ec(e){if(null==e)throw qe(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT");const t=kt.asCID(e);if(t)yield tc({cid:t});else{if(!(e instanceof String||"string"==typeof e)){if(null!=e.cid||null!=e.path)return yield tc(e);if(Symbol.iterator in e){const t=e[Symbol.iterator](),r=t.next();if(r.done)return t;if(kt.asCID(r.value)||r.value instanceof String||"string"==typeof r.value){yield tc({cid:r.value});for(const e of t)yield tc({cid:e});return}if(null!=r.value.cid||null!=r.value.path){yield tc(r.value);for(const e of t)yield tc(e);return}throw qe(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}if(Symbol.asyncIterator in e){const t=e[Symbol.asyncIterator](),r=await t.next();if(r.done)return t;if(kt.asCID(r.value)||r.value instanceof String||"string"==typeof r.value){yield tc({cid:r.value});for await(const e of t)yield tc({cid:e});return}if(null!=r.value.cid||null!=r.value.path){yield tc(r.value);for await(const e of t)yield tc(e);return}throw qe(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}throw qe(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}yield tc({path:e})}}function tc(e){const t=e.cid||`${e.path}`;if(!t)throw qe(new Error("Unexpected input: Please path either a CID or an IPFS path"),"ERR_UNEXPECTED_INPUT");const r={path:t,recursive:!1!==e.recursive};return null!=e.metadata&&(r.metadata=e.metadata),r}const rc={direct:"direct",recursive:"recursive",indirect:"indirect",all:"all"};function nc(e,t,r){const n={type:e,cid:t};return r&&(n.metadata=r),n}class sc{constructor({codecs:e,repo:t}){const r=function({repo:e,codecs:t}){return zo((async function*(r,n={}){const s=async function*(){for await(const{path:n,recursive:s,metadata:i}of ec(r)){const{cid:r}=await qo(e,t,n),{reason:o}=await e.pins.isPinnedWithType(r,[rc.recursive,rc.direct]);if("recursive"===o&&!s)throw new Error(`${r} already pinned recursively`);s?await e.pins.pinRecursively(r,{metadata:i}):await e.pins.pinDirectly(r,{metadata:i}),yield r}};if(!Boolean(n.lock))return void(yield*s());const i=await e.gcLock.readLock();try{yield*s()}finally{i()}}))}({codecs:e,repo:t});this.addAll=r,this.add=function({addAll:e}){return(t,r={})=>{let n;const s=kt.asCID(t);return n=e(s?[{cid:s,...r}]:[{path:t.toString(),...r}],r),Xa(n)}}({addAll:r});const n=function({repo:e,codecs:t}){return zo((async function*(r,n={}){const s=await e.gcLock.readLock();try{for await(const{path:n,recursive:s}of ec(r)){const{cid:r}=await qo(e,t,n),{pinned:i,reason:o}=await e.pins.isPinnedWithType(r,rc.all);if(!i)throw new Error(`${r} is not pinned`);switch(o){case rc.recursive:if(!s)throw new Error(`${r} is pinned recursively`);await e.pins.unpin(r),yield r;break;case rc.direct:await e.pins.unpin(r),yield r;break;default:throw new Error(`${r} is pinned indirectly under ${o}`)}}}finally{s()}}))}({codecs:e,repo:t});this.rmAll=n,this.rm=function({rmAll:e}){return async function(t,r={}){const n=await Xa(e([{path:t,...r}],r));if(!n)throw new Error("CID expected");return n}}({rmAll:n}),this.ls=function({repo:e,codecs:t}){return zo((async function*(r={}){let n=rc.all;if(r.type&&(n=r.type,!Object.keys(rc).includes(n)))throw qe(new Error("Invalid pin type"),"ERR_INVALID_PIN_TYPE");if(r.paths){let s=!1;for await(const{path:i}of ec(r.paths)){const{cid:r}=await qo(e,t,i),{reason:o,pinned:a,parent:c,metadata:l}=await e.pins.isPinnedWithType(r,n);if(!a)throw qe(new Error(`path '${i}' is not pinned`),"ERR_NOT_PINNED");switch(o){case rc.direct:case rc.recursive:s=!0,yield nc(o,r,l);break;default:s=!0,yield nc(`${rc.indirect} through ${c}`,r,l)}}if(!s)throw new Error("No match found")}else{if(n===rc.recursive||n===rc.all)for await(const{cid:t,metadata:r}of e.pins.recursiveKeys())yield nc(rc.recursive,t,r);if(n===rc.indirect||n===rc.all)for await(const t of e.pins.indirectKeys(r))yield nc(rc.indirect,t);if(n===rc.direct||n===rc.all)for await(const{cid:t,metadata:r}of e.pins.directKeys())yield nc(rc.direct,t,r)}}))}({codecs:e,repo:t}),this.remote={add:(e,t={})=>Promise.reject(new Error("Not implemented")),ls:async function*(e,t={}){return Promise.reject(new Error("Not implemented"))},rm:(e,t={})=>Promise.reject(new Error("Not implemented")),rmAll:(e,t={})=>Promise.reject(new Error("Not implemented")),service:{add:(e,t)=>Promise.reject(new Error("Not implemented")),rm:(e,t={})=>Promise.reject(new Error("Not implemented")),ls:(e={})=>Promise.reject(new Error("Not implemented"))}}}}function ic(e){return e=e||new Error("Cannot open database"),qe(e,"ERR_DB_OPEN_FAILED")}function oc(e){return e=e||new Error("Delete failed"),qe(e,"ERR_DB_DELETE_FAILED")}function ac(e){return e=e||new Error("Write failed"),qe(e,"ERR_DB_WRITE_FAILED")}function cc(e){return e=e||new Error("Not Found"),qe(e,"ERR_NOT_FOUND")}var lc=r(37543),hc=r(6418),uc=r(42250),dc=r(74374),pc=r(71913);r(96259)._configure(),hc._configure(uc),dc._configure(pc);const fc=["uint64","int64","sint64","fixed64","sfixed64"];function yc(e,t){const r=function(e){return function(e){for(const t of fc){if(null==e[t])continue;const r=e[t];e[t]=function(){return BigInt(r.call(this).toString())}}return e}(new hc(e))}(e instanceof Uint8Array?e:e.subarray());return t.decode(r)}function gc(e,t){const r=function(e){for(const t of fc){if(null==e[t])continue;const r=e[t];e[t]=function(e){return r.call(this,e.toString())}}return e}(dc.create());return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var mc,wc,bc,vc,Ec;function _c(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function Sc(e){function t(t){if(null==e[t.toString()])throw new Error("Invalid enum value");return e[t]}return _c("enum",mc.VARINT,(function(e,r){const n=t(e);r.int32(n)}),(function(e){return t(e.int32())}))}function Ac(e,t){return _c("message",mc.LENGTH_DELIMITED,e,t)}!function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"}(mc||(mc={})),function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(wc||(wc={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(bc||(bc={})),function(e){e.codec=()=>Sc(bc)}(wc||(wc={})),function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),wc.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=wc.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(vc||(vc={})),function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),wc.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=wc.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(Ec||(Ec={})),r(69522),r(4676);var Ic=r(72900);const Rc={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};var kc=r(33229);function Tc(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.slice(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=di([new Uint8Array(t-r.length),r])}return ni(r,"base64url")}function Cc(e){const t=function(e,t){let r=Xs(e,"base64urlpad");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=di([new Uint8Array(t-r.length),r])}return r}(e);return new Ic.jsbn.BigInteger(ni(t,"base16"),16)}r(67161);function Pc(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,s=e?.digest??"SHA-256",i=e?.saltLength??16,o=e?.iterations??32767,a=Rc.get();return r*=8,{encrypt:async function(e,c){const l=a.getRandomValues(new Uint8Array(i)),h=a.getRandomValues(new Uint8Array(n)),u={name:t,iv:h};"string"==typeof c&&(c=Xs(c));const d={name:"PBKDF2",salt:l,iterations:o,hash:{name:s}},p=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),f=await a.subtle.deriveKey(d,p,{name:t,length:r},!0,["encrypt"]),y=await a.subtle.encrypt(u,f,e);return di([l,u.iv,new Uint8Array(y)])},decrypt:async function(e,c){const l=e.slice(0,i),h=e.slice(i,i+n),u=e.slice(i+n),d={name:t,iv:h};"string"==typeof c&&(c=Xs(c));const p={name:"PBKDF2",salt:l,iterations:o,hash:{name:s}},f=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),y=await a.subtle.deriveKey(p,f,{name:t,length:r},!0,["decrypt"]),g=await a.subtle.decrypt(d,y,u);return new Uint8Array(g)}}}Object.keys({"P-256":256,"P-384":384,"P-521":521}).join(" / "),r(63099);var Nc=r(95856),Dc=r.t(Nc,2);const Oc=BigInt(0),xc=BigInt(1),Lc=BigInt(2),Bc=BigInt(3),Mc=BigInt(8),Uc=Object.freeze({a:Oc,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:xc,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")});function zc(e){const{a:t,b:r}=Uc,n=ol(e*e),s=ol(n*e);return ol(s+t*e+r)}const Vc=Uc.a===Oc;class Fc extends Error{constructor(e){super(e)}}class jc{constructor(e,t,r){this.x=e,this.y=t,this.z=r}static fromAffine(e){if(!(e instanceof $c))throw new TypeError("JacobianPoint#fromAffine: expected Point");return new jc(e.x,e.y,xc)}static toAffineBatch(e){const t=function(e,t=Uc.P){const r=new Array(e.length),n=e.reduce(((e,n,s)=>n===Oc?e:(r[s]=e,ol(e*n,t))),xc),s=cl(n,t);return e.reduceRight(((e,n,s)=>n===Oc?e:(r[s]=ol(e*r[s],t),ol(e*n,t))),s),r}(e.map((e=>e.z)));return e.map(((e,r)=>e.toAffine(t[r])))}static normalizeZ(e){return jc.toAffineBatch(e).map(jc.fromAffine)}equals(e){if(!(e instanceof jc))throw new TypeError("JacobianPoint expected");const{x:t,y:r,z:n}=this,{x:s,y:i,z:o}=e,a=ol(n*n),c=ol(o*o),l=ol(t*c),h=ol(s*a),u=ol(ol(r*o)*c),d=ol(ol(i*n)*a);return l===h&&u===d}negate(){return new jc(this.x,ol(-this.y),this.z)}double(){const{x:e,y:t,z:r}=this,n=ol(e*e),s=ol(t*t),i=ol(s*s),o=e+s,a=ol(Lc*(ol(o*o)-n-i)),c=ol(Bc*n),l=ol(c*c),h=ol(l-Lc*a),u=ol(c*(a-h)-Mc*i),d=ol(Lc*t*r);return new jc(h,u,d)}add(e){if(!(e instanceof jc))throw new TypeError("JacobianPoint expected");const{x:t,y:r,z:n}=this,{x:s,y:i,z:o}=e;if(s===Oc||i===Oc)return this;if(t===Oc||r===Oc)return e;const a=ol(n*n),c=ol(o*o),l=ol(t*c),h=ol(s*a),u=ol(ol(r*o)*c),d=ol(ol(i*n)*a),p=ol(h-l),f=ol(d-u);if(p===Oc)return f===Oc?this.double():jc.ZERO;const y=ol(p*p),g=ol(p*y),m=ol(l*y),w=ol(f*f-g-Lc*m),b=ol(f*(m-w)-u*g),v=ol(n*o*p);return new jc(w,b,v)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){const t=jc.ZERO;if("bigint"==typeof e&&e===Oc)return t;let r=il(e);if(r===xc)return this;if(!Vc){let e=t,n=this;for(;r>Oc;)r&xc&&(e=e.add(n)),n=n.double(),r>>=xc;return e}let{k1neg:n,k1:s,k2neg:i,k2:o}=ul(r),a=t,c=t,l=this;for(;s>Oc||o>Oc;)s&xc&&(a=a.add(l)),o&xc&&(c=c.add(l)),l=l.double(),s>>=xc,o>>=xc;return n&&(a=a.negate()),i&&(c=c.negate()),c=new jc(ol(c.x*Uc.beta),c.y,c.z),a.add(c)}precomputeWindow(e){const t=Vc?128/e+1:256/e+1,r=[];let n=this,s=n;for(let i=0;i<t;i++){s=n,r.push(s);for(let t=1;t<2**(e-1);t++)s=s.add(n),r.push(s);n=s.double()}return r}wNAF(e,t){!t&&this.equals(jc.BASE)&&(t=$c.BASE);const r=t&&t._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let n=t&&Kc.get(t);n||(n=this.precomputeWindow(r),t&&1!==r&&(n=jc.normalizeZ(n),Kc.set(t,n)));let s=jc.ZERO,i=jc.ZERO;const o=1+(Vc?128/r:256/r),a=2**(r-1),c=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let t=0;t<o;t++){const r=t*a;let o=Number(e&c);if(e>>=h,o>a&&(o-=l,e+=xc),0===o){let e=n[r];t%2&&(e=e.negate()),i=i.add(e)}else{let e=n[r+Math.abs(o)-1];o<0&&(e=e.negate()),s=s.add(e)}}return{p:s,f:i}}multiply(e,t){let r,n,s=il(e);if(Vc){const{k1neg:e,k1:i,k2neg:o,k2:a}=ul(s);let{p:c,f:l}=this.wNAF(i,t),{p:h,f:u}=this.wNAF(a,t);e&&(c=c.negate()),o&&(h=h.negate()),h=new jc(ol(h.x*Uc.beta),h.y,h.z),r=c.add(h),n=l.add(u)}else{const{p:e,f:i}=this.wNAF(s,t);r=e,n=i}return jc.normalizeZ([r,n])[0]}toAffine(e=cl(this.z)){const{x:t,y:r,z:n}=this,s=e,i=ol(s*s),o=ol(i*s),a=ol(t*i),c=ol(r*o);if(ol(n*s)!==xc)throw new Error("invZ was invalid");return new $c(a,c)}}jc.BASE=new jc(Uc.Gx,Uc.Gy,xc),jc.ZERO=new jc(Oc,xc,Oc);const Kc=new WeakMap;class $c{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,Kc.delete(this)}hasEvenY(){return this.y%Lc===Oc}static fromCompressedHex(e){const t=32===e.length,r=nl(t?e:e.subarray(1));if(!ml(r))throw new Error("Point is not on curve");let n=function(e){const{P:t}=Uc,r=BigInt(6),n=BigInt(11),s=BigInt(22),i=BigInt(23),o=BigInt(44),a=BigInt(88),c=e*e*e%t,l=c*c*e%t,h=al(l,Bc)*l%t,u=al(h,Bc)*l%t,d=al(u,Lc)*c%t,p=al(d,n)*d%t,f=al(p,s)*p%t,y=al(f,o)*f%t,g=al(y,a)*y%t,m=al(g,o)*f%t,w=al(m,Bc)*l%t,b=al(w,i)*p%t,v=al(b,r)*c%t;return al(v,Lc)}(zc(r));const s=(n&xc)===xc;t?s&&(n=ol(-n)):1==(1&e[0])!==s&&(n=ol(-n));const i=new $c(r,n);return i.assertValidity(),i}static fromUncompressedHex(e){const t=nl(e.subarray(1,33)),r=nl(e.subarray(33,65)),n=new $c(t,r);return n.assertValidity(),n}static fromHex(e){const t=sl(e),r=t.length,n=t[0];if(32===r||33===r&&(2===n||3===n))return this.fromCompressedHex(t);if(65===r&&4===n)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${r}`)}static fromPrivateKey(e){return $c.BASE.multiply(bl(e))}static fromSignature(e,t,r){const n=dl(e=sl(e)),{r:s,s:i}=vl(t);if(0!==r&&1!==r)throw new Error("Cannot recover signature: invalid recovery bit");const o=1&r?"03":"02",a=$c.fromHex(o+Jc(s)),{n:c}=Uc,l=cl(s,c),h=ol(-n*l,c),u=ol(i*l,c),d=$c.BASE.multiplyAndAddUnsafe(a,h,u);if(!d)throw new Error("Cannot recover signature: point at infinify");return d.assertValidity(),d}toRawBytes(e=!1){return rl(this.toHex(e))}toHex(e=!1){const t=Jc(this.x);return e?`${this.hasEvenY()?"02":"03"}${t}`:`04${t}${Jc(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const e="Point is not on elliptic curve",{x:t,y:r}=this;if(!ml(t)||!ml(r))throw new Error(e);const n=ol(r*r);if(ol(n-zc(t))!==Oc)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new $c(this.x,ol(-this.y))}double(){return jc.fromAffine(this).double().toAffine()}add(e){return jc.fromAffine(this).add(jc.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return jc.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,r){const n=jc.fromAffine(this),s=t===Oc||t===xc||this!==$c.BASE?n.multiplyUnsafe(t):n.multiply(t),i=jc.fromAffine(e).multiplyUnsafe(r),o=s.add(i);return o.equals(jc.ZERO)?void 0:o.toAffine()}}function Hc(e){return Number.parseInt(e[0],16)>=8?"00"+e:e}function qc(e){if(e.length<2||2!==e[0])throw new Error(`Invalid signature integer tag: ${Zc(e)}`);const t=e[1],r=e.subarray(2,t+2);if(!t||r.length!==t)throw new Error("Invalid signature integer: wrong length");if(0===r[0]&&r[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:nl(r),left:e.subarray(t+2)}}$c.BASE=new $c(Uc.Gx,Uc.Gy),$c.ZERO=new $c(Oc,Oc);class Gc{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){const t=e instanceof Uint8Array,r="Signature.fromCompact";if("string"!=typeof e&&!t)throw new TypeError(`${r}: Expected string or Uint8Array`);const n=t?Zc(e):e;if(128!==n.length)throw new Error(`${r}: Expected 64-byte hex`);return new Gc(tl(n.slice(0,64)),tl(n.slice(64,128)))}static fromDER(e){const t=e instanceof Uint8Array;if("string"!=typeof e&&!t)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r,s:n}=function(e){if(e.length<2||48!=e[0])throw new Error(`Invalid signature tag: ${Zc(e)}`);if(e[1]!==e.length-2)throw new Error("Invalid signature: incorrect length");const{data:t,left:r}=qc(e.subarray(2)),{data:n,left:s}=qc(r);if(s.length)throw new Error(`Invalid signature: left bytes after parsing: ${Zc(s)}`);return{r:t,s:n}}(t?e:rl(e));return new Gc(r,n)}static fromHex(e){return this.fromDER(e)}assertValidity(){const{r:e,s:t}=this;if(!gl(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!gl(t))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const e=Uc.n>>xc;return this.s>e}normalizeS(){return this.hasHighS()?new Gc(this.r,Uc.n-this.s):this}toDERRawBytes(e=!1){return rl(this.toDERHex(e))}toDERHex(e=!1){const t=Hc(el(this.s));if(e)return t;const r=Hc(el(this.r)),n=el(r.length/2),s=el(t.length/2);return`30${el(r.length/2+t.length/2+4)}02${n}${r}02${s}${t}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return rl(this.toCompactHex())}toCompactHex(){return Jc(this.r)+Jc(this.s)}}function Wc(...e){if(!e.every((e=>e instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const s=e[t];r.set(s,n),n+=s.length}return r}const Yc=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Zc(e){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");let t="";for(let r=0;r<e.length;r++)t+=Yc[e[r]];return t}const Qc=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function Jc(e){if("bigint"!=typeof e)throw new Error("Expected bigint");if(!(Oc<=e&&e<Qc))throw new Error("Expected number < 2^256");return e.toString(16).padStart(64,"0")}function Xc(e){const t=rl(Jc(e));if(32!==t.length)throw new Error("Error: expected 32 bytes");return t}function el(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function tl(e){if("string"!=typeof e)throw new TypeError("hexToNumber: expected string, got "+typeof e);return BigInt(`0x${e}`)}function rl(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+e.length);const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){const n=2*r,s=e.slice(n,n+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");t[r]=i}return t}function nl(e){return tl(Zc(e))}function sl(e){return e instanceof Uint8Array?Uint8Array.from(e):rl(e)}function il(e){if("number"==typeof e&&Number.isSafeInteger(e)&&e>0)return BigInt(e);if("bigint"==typeof e&&gl(e))return e;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function ol(e,t=Uc.P){const r=e%t;return r>=Oc?r:t+r}function al(e,t){const{P:r}=Uc;let n=e;for(;t-- >Oc;)n*=n,n%=r;return n}function cl(e,t=Uc.P){if(e===Oc||t<=Oc)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=ol(e,t),n=t,s=Oc,i=xc,o=xc,a=Oc;for(;r!==Oc;){const e=n/r,t=n%r,c=s-o*e,l=i-a*e;n=r,r=t,s=o,i=a,o=c,a=l}if(n!==xc)throw new Error("invert: does not exist");return ol(s,t)}const ll=(e,t)=>(e+t/Lc)/t,hl={a1:BigInt("0x3086d221a7d46bcde86c90e49284eb15"),b1:-xc*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),a2:BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),b2:BigInt("0x3086d221a7d46bcde86c90e49284eb15"),POW_2_128:BigInt("0x100000000000000000000000000000000")};function ul(e){const{n:t}=Uc,{a1:r,b1:n,a2:s,b2:i,POW_2_128:o}=hl,a=ll(i*e,t),c=ll(-n*e,t);let l=ol(e-a*r-c*s,t),h=ol(-a*n-c*i,t);const u=l>o,d=h>o;if(u&&(l=t-l),d&&(h=t-h),l>o||h>o)throw new Error("splitScalarEndo: Endomorphism failed, k="+e);return{k1neg:u,k1:l,k2neg:d,k2:h}}function dl(e){const{n:t}=Uc,r=8*e.length-256;let n=nl(e);return r>0&&(n>>=BigInt(r)),n>=t&&(n-=t),n}let pl,fl;class yl{constructor(){this.v=new Uint8Array(32).fill(1),this.k=new Uint8Array(32).fill(0),this.counter=0}hmac(...e){return Tl.hmacSha256(this.k,...e)}hmacSync(...e){return fl(this.k,...e)}checkSync(){if("function"!=typeof fl)throw new Fc("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),0!==e.length&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),0!==e.length&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){return this.incr(),this.v=await this.hmac(this.v),this.v}generateSync(){return this.checkSync(),this.incr(),this.v=this.hmacSync(this.v),this.v}}function gl(e){return Oc<e&&e<Uc.n}function ml(e){return Oc<e&&e<Uc.P}function wl(e,t,r){const n=nl(e);if(!gl(n))return;const{n:s}=Uc,i=$c.BASE.multiply(n),o=ol(i.x,s);if(o===Oc)return;const a=ol(cl(n,s)*ol(t+r*o,s),s);if(a===Oc)return;const c=new Gc(o,a);return{sig:c,recovery:(i.x===c.r?0:2)|Number(i.y&xc)}}function bl(e){let t;if("bigint"==typeof e)t=e;else if("number"==typeof e&&Number.isSafeInteger(e)&&e>0)t=BigInt(e);else if("string"==typeof e){if(64!==e.length)throw new Error("Expected 32 bytes of private key");t=tl(e)}else{if(!(e instanceof Uint8Array))throw new TypeError("Expected valid private key");if(32!==e.length)throw new Error("Expected 32 bytes of private key");t=nl(e)}if(!gl(t))throw new Error("Expected private key: 0 < key < n");return t}function vl(e){if(e instanceof Gc)return e.assertValidity(),e;try{return Gc.fromDER(e)}catch(t){return Gc.fromCompact(e)}}function El(e,t=!1){return $c.fromPrivateKey(e).toRawBytes(t)}function _l(e){return nl(e.length>32?e.slice(0,32):e)}function Sl(e){const t=_l(e),r=ol(t,Uc.n);return Al(r<Oc?t:r)}function Al(e){return Xc(e)}const Il={strict:!0};$c.BASE._setWindowSize(8);const Rl={node:Dc,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},kl={},Tl={bytesToHex:Zc,hexToBytes:rl,concatBytes:Wc,mod:ol,invert:cl,isValidPrivateKey(e){try{return bl(e),!0}catch(e){return!1}},_bigintTo32Bytes:Xc,_normalizePrivateKey:bl,hashToPrivateKey:e=>{if((e=sl(e)).length<40||e.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return Xc(ol(nl(e),Uc.n-xc)+xc)},randomBytes:(e=32)=>{if(Rl.web)return Rl.web.getRandomValues(new Uint8Array(e));if(Rl.node){const{randomBytes:t}=Rl.node;return Uint8Array.from(t(e))}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Tl.hashToPrivateKey(Tl.randomBytes(40)),sha256:async(...e)=>{if(Rl.web){const t=await Rl.web.subtle.digest("SHA-256",Wc(...e));return new Uint8Array(t)}if(Rl.node){const{createHash:t}=Rl.node,r=t("sha256");return e.forEach((e=>r.update(e))),Uint8Array.from(r.digest())}throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(e,...t)=>{if(Rl.web){const r=await Rl.web.subtle.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=Wc(...t),s=await Rl.web.subtle.sign("HMAC",r,n);return new Uint8Array(s)}if(Rl.node){const{createHmac:r}=Rl.node,n=r("sha256",e);return t.forEach((e=>n.update(e))),Uint8Array.from(n.digest())}throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(e,...t)=>{let r=kl[e];if(void 0===r){const t=await Tl.sha256(Uint8Array.from(e,(e=>e.charCodeAt(0))));r=Wc(t,t),kl[e]=r}return Tl.sha256(r,...t)},taggedHashSync:(e,...t)=>{if("function"!=typeof pl)throw new Fc("sha256Sync is undefined, you need to set it");let r=kl[e];if(void 0===r){const t=pl(Uint8Array.from(e,(e=>e.charCodeAt(0))));r=Wc(t,t),kl[e]=r}return pl(r,...t)},precompute(e=8,t=$c.BASE){const r=t===$c.BASE?t:new $c(t.x,t.y);return r._setWindowSize(e),r.multiply(Bc),r}};function Cl(e){if(isNaN(e)||e<=0)throw qe(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return Tl.randomBytes(e)}function Pl(e,t){return t.map((t=>Cc(e[t])))}async function Nl(e){const t=[await Rc.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await Ol(e)],r=await Dl({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function Dl(e){if(null==e.privateKey||null==e.publicKey)throw qe(new Error("Private and public key are required"),"ERR_INVALID_PARAMETERS");return await Promise.all([Rc.get().subtle.exportKey("jwk",e.privateKey),Rc.get().subtle.exportKey("jwk",e.publicKey)])}async function Ol(e){return await Rc.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function xl(e,t,r,n){const s=t?function(e){return Ic.pki.setRsaPublicKey(...Pl(e,["n","e"]))}(e):function(e){return Ic.pki.setRsaPrivateKey(...Pl(e,["n","e","d","p","q","dp","dq","qi"]))}(e);return Xs(n(ni(Uint8Array.from(r),"ascii"),s),"ascii")}async function Ll(e,t){const r=Pc(),n=await r.encrypt(e,t);return Fe.encode(n)}Object.defineProperties(Tl,{sha256Sync:{configurable:!1,get:()=>pl,set(e){pl||(pl=e)}},hmacSha256Sync:{configurable:!1,get:()=>fl,set(e){fl||(fl=e)}}}),r(83635);class Bl{constructor(e){this._key=e}async verify(e,t){return await async function(e,t,r){const n=await Rc.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return await Rc.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw qe(new Error("JWK was missing components"),"ERR_INVALID_PARAMETERS");const t=Ic.pki.publicKeyToAsn1({n:Cc(e.n),e:Cc(e.e)});return Xs(Ic.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return vc.encode({Type:wc.RSA,Data:this.marshal()}).subarray()}encrypt(e){return xl(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return Ti(this.bytes,e.bytes)}async hash(){const{bytes:e}=await As.digest(this.bytes);return e}}class Ml{constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return Cl(16)}async sign(e){return await async function(e,t){const r=await Rc.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Rc.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw qe(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new Bl(this._publicKey)}decrypt(e){return xl(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw qe(new Error("JWK was missing components"),"ERR_INVALID_PARAMETERS");const t=Ic.pki.privateKeyToAsn1({n:Cc(e.n),e:Cc(e.e),d:Cc(e.d),p:Cc(e.p),q:Cc(e.q),dP:Cc(e.dp),dQ:Cc(e.dq),qInv:Cc(e.qi)});return Xs(Ic.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Ec.encode({Type:wc.RSA,Data:this.marshal()}).subarray()}equals(e){return Ti(this.bytes,e.bytes)}async hash(){const{bytes:e}=await As.digest(this.bytes);return e}async id(){return ni(await this.public.hash(),"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new Ic.util.ByteBuffer(this.marshal()),r=Ic.asn1.fromDer(t),n=Ic.pki.privateKeyFromAsn1(r),s={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return Ic.pki.encryptRsaPrivateKey(n,e,s)}if("libp2p-key"===t)return await Ll(this.bytes,e);throw qe(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}async function Ul(e){const t=function(e){const t=Ic.asn1.fromDer(ni(e,"ascii")),r=Ic.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:Tc(r.n),e:Tc(r.e),d:Tc(r.d),p:Tc(r.p),q:Tc(r.q),dp:Tc(r.dP),dq:Tc(r.dQ),qi:Tc(r.qInv),alg:"RS256"}}(e),r=await Nl(t);return new Ml(r.privateKey,r.publicKey)}function zl(e){const t=function(e){const t=Ic.asn1.fromDer(ni(e,"ascii")),r=Ic.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:Tc(r.n),e:Tc(r.e)}}(e);return new Bl(t)}async function Vl(e){const t=await Nl(e);return new Ml(t.privateKey,t.publicKey)}async function Fl(e){const t=await async function(e){const t=await Rc.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await Dl(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new Ml(t.privateKey,t.publicKey)}var jl=r(7420),Kl=r.t(jl,2);const $l=BigInt(0),Hl=BigInt(1),ql=BigInt(2),Gl=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),Wl=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:Gl,n:Gl,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")}),Yl=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),Zl=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),Ql=(BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235")),Jl=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Xl=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),eh=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class th{constructor(e,t,r,n){this.x=e,this.y=t,this.z=r,this.t=n}static fromAffine(e){if(!(e instanceof ah))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(ah.ZERO)?th.ZERO:new th(e.x,e.y,Hl,bh(e.x*e.y))}static toAffineBatch(e){const t=function(e,t=Wl.P){const r=new Array(e.length),n=e.reduce(((e,n,s)=>n===$l?e:(r[s]=e,bh(e*n,t))),Hl),s=vh(n,t);return e.reduceRight(((e,n,s)=>n===$l?e:(r[s]=bh(e*r[s],t),bh(e*n,t))),s),r}(e.map((e=>e.z)));return e.map(((e,r)=>e.toAffine(t[r])))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){rh(e);const{x:t,y:r,z:n}=this,{x:s,y:i,z:o}=e,a=bh(t*o),c=bh(s*n),l=bh(r*o),h=bh(i*n);return a===c&&l===h}negate(){return new th(bh(-this.x),this.y,this.z,bh(-this.t))}double(){const{x:e,y:t,z:r}=this,{a:n}=Wl,s=bh(e*e),i=bh(t*t),o=bh(ql*bh(r*r)),a=bh(n*s),c=e+t,l=bh(bh(c*c)-s-i),h=a+i,u=h-o,d=a-i,p=bh(l*u),f=bh(h*d),y=bh(l*d),g=bh(u*h);return new th(p,f,g,y)}add(e){rh(e);const{x:t,y:r,z:n,t:s}=this,{x:i,y:o,z:a,t:c}=e,l=bh((r-t)*(o+i)),h=bh((r+t)*(o-i)),u=bh(h-l);if(u===$l)return this.double();const d=bh(n*ql*c),p=bh(s*ql*a),f=p+d,y=h+l,g=p-d,m=bh(f*u),w=bh(y*g),b=bh(f*g),v=bh(u*y);return new th(m,w,v,b)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const t=1+256/e,r=[];let n=this,s=n;for(let i=0;i<t;i++){s=n,r.push(s);for(let t=1;t<2**(e-1);t++)s=s.add(n),r.push(s);n=s.double()}return r}wNAF(e,t){!t&&this.equals(th.BASE)&&(t=ah.BASE);const r=t&&t._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let n=t&&oh.get(t);n||(n=this.precomputeWindow(r),t&&1!==r&&(n=th.normalizeZ(n),oh.set(t,n)));let s=th.ZERO,i=th.ZERO;const o=1+256/r,a=2**(r-1),c=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let t=0;t<o;t++){const r=t*a;let o=Number(e&c);if(e>>=h,o>a&&(o-=l,e+=Hl),0===o){let e=n[r];t%2&&(e=e.negate()),i=i.add(e)}else{let e=n[r+Math.abs(o)-1];o<0&&(e=e.negate()),s=s.add(e)}}return th.normalizeZ([s,i])[0]}multiply(e,t){return this.wNAF(Rh(e,Wl.l),t)}multiplyUnsafe(e){let t=Rh(e,Wl.l,!1);const r=th.BASE,n=th.ZERO;if(t===$l)return n;if(this.equals(n)||t===Hl)return this;if(this.equals(r))return this.wNAF(t);let s=n,i=this;for(;t>$l;)t&Hl&&(s=s.add(i)),i=i.double(),t>>=Hl;return s}isSmallOrder(){return this.multiplyUnsafe(Wl.h).equals(th.ZERO)}isTorsionFree(){return this.multiplyUnsafe(Wl.l).equals(th.ZERO)}toAffine(e=vh(this.z)){const{x:t,y:r,z:n}=this,s=bh(t*e),i=bh(r*e);if(bh(n*e)!==Hl)throw new Error("invZ was invalid");return new ah(s,i)}fromRistrettoBytes(){sh()}toRistrettoBytes(){sh()}fromRistrettoHash(){sh()}}function rh(e){if(!(e instanceof th))throw new TypeError("ExtendedPoint expected")}function nh(e){if(!(e instanceof ih))throw new TypeError("RistrettoPoint expected")}function sh(){throw new Error("Legacy method: switch to RistrettoPoint")}th.BASE=new th(Wl.Gx,Wl.Gy,Hl,bh(Wl.Gx*Wl.Gy)),th.ZERO=new th($l,Hl,Hl,$l);class ih{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:t}=Wl,r=bh(Zl*e*e),n=bh((r+Hl)*Xl);let s=BigInt(-1);const i=bh((s-t*r)*bh(r+t));let{isValid:o,value:a}=_h(n,i),c=bh(a*e);yh(c)||(c=bh(-c)),o||(a=c),o||(s=r);const l=bh(s*(r-Hl)*eh-i),h=a*a,u=bh((a+a)*i),d=bh(l*Ql),p=bh(Hl-h),f=bh(Hl+h);return new th(bh(u*f),bh(p*d),bh(d*f),bh(u*p))}static hashToCurve(e){const t=wh((e=Ih(e,64)).slice(0,32)),r=this.calcElligatorRistrettoMap(t),n=wh(e.slice(32,64)),s=this.calcElligatorRistrettoMap(n);return new ih(r.add(s))}static fromHex(e){e=Ih(e,32);const{a:t,d:r}=Wl,n="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",s=wh(e);if(!function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(fh(s),e)||yh(s))throw new Error(n);const i=bh(s*s),o=bh(Hl+t*i),a=bh(Hl-t*i),c=bh(o*o),l=bh(a*a),h=bh(t*r*c-l),{isValid:u,value:d}=Sh(bh(h*l)),p=bh(d*a),f=bh(d*p*h);let y=bh((s+s)*p);yh(y)&&(y=bh(-y));const g=bh(o*f),m=bh(y*g);if(!u||yh(m)||g===$l)throw new Error(n);return new ih(new th(y,g,Hl,m))}toRawBytes(){let{x:e,y:t,z:r,t:n}=this.ep;const s=bh(bh(r+t)*bh(r-t)),i=bh(e*t),o=bh(i*i),{value:a}=Sh(bh(s*o)),c=bh(a*s),l=bh(a*i),h=bh(c*l*n);let u;if(yh(n*h)){let r=bh(t*Zl),n=bh(e*Zl);e=r,t=n,u=bh(c*Jl)}else u=l;yh(e*h)&&(t=bh(-t));let d=bh((r-t)*u);return yh(d)&&(d=bh(-d)),fh(d)}toHex(){return uh(this.toRawBytes())}toString(){return this.toHex()}equals(e){nh(e);const t=this.ep,r=e.ep,n=bh(t.x*r.y)===bh(t.y*r.x),s=bh(t.y*r.y)===bh(t.x*r.x);return n||s}add(e){return nh(e),new ih(this.ep.add(e.ep))}subtract(e){return nh(e),new ih(this.ep.subtract(e.ep))}multiply(e){return new ih(this.ep.multiply(e))}multiplyUnsafe(e){return new ih(this.ep.multiplyUnsafe(e))}}ih.BASE=new ih(th.BASE),ih.ZERO=new ih(th.ZERO);const oh=new WeakMap;class ah{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,oh.delete(this)}static fromHex(e,t=!0){const{d:r,P:n}=Wl,s=(e=Ih(e,32)).slice();s[31]=-129&e[31];const i=gh(s);if(t&&i>=n)throw new Error("Expected 0 < hex < P");if(!t&&i>=Yl)throw new Error("Expected 0 < hex < 2**256");const o=bh(i*i),a=bh(o-Hl),c=bh(r*o+Hl);let{isValid:l,value:h}=_h(a,c);if(!l)throw new Error("Point.fromHex: invalid y coordinate");const u=(h&Hl)===Hl;return 0!=(128&e[31])!==u&&(h=bh(-h)),new ah(h,i)}static async fromPrivateKey(e){return(await Th(e)).point}toRawBytes(){const e=fh(this.y);return e[31]|=this.x&Hl?128:0,e}toHex(){return uh(this.toRawBytes())}toX25519(){const{y:e}=this;return fh(bh((Hl+e)*vh(Hl-e)))}isTorsionFree(){return th.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new ah(bh(-this.x),this.y)}add(e){return th.fromAffine(this).add(th.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return th.fromAffine(this).multiply(e,this).toAffine()}}ah.BASE=new ah(Wl.Gx,Wl.Gy),ah.ZERO=new ah($l,Hl);class ch{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){const t=Ih(e,64),r=ah.fromHex(t.slice(0,32),!1),n=gh(t.slice(32,64));return new ch(r,n)}assertValidity(){const{r:e,s:t}=this;if(!(e instanceof ah))throw new Error("Expected Point instance");return Rh(t,Wl.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(fh(this.s),32),e}toHex(){return uh(this.toRawBytes())}}function lh(...e){if(!e.every((e=>e instanceof Uint8Array)))throw new Error("Expected Uint8Array list");if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const s=e[t];r.set(s,n),n+=s.length}return r}const hh=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function uh(e){if(!(e instanceof Uint8Array))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=hh[e[r]];return t}function dh(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){const n=2*r,s=e.slice(n,n+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");t[r]=i}return t}function ph(e){return dh(e.toString(16).padStart(64,"0"))}function fh(e){return ph(e).reverse()}function yh(e){return(bh(e)&Hl)===Hl}function gh(e){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+uh(Uint8Array.from(e).reverse()))}const mh=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function wh(e){return bh(gh(e)&mh)}function bh(e,t=Wl.P){const r=e%t;return r>=$l?r:t+r}function vh(e,t=Wl.P){if(e===$l||t<=$l)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=bh(e,t),n=t,s=$l,i=Hl,o=Hl,a=$l;for(;r!==$l;){const e=n/r,t=n%r,c=s-o*e,l=i-a*e;n=r,r=t,s=o,i=a,o=c,a=l}if(n!==Hl)throw new Error("invert: does not exist");return bh(s,t)}function Eh(e,t){const{P:r}=Wl;let n=e;for(;t-- >$l;)n*=n,n%=r;return n}function _h(e,t){const r=bh(t*t*t),n=bh(r*r*t);let s=bh(e*r*function(e){const{P:t}=Wl,r=BigInt(5),n=BigInt(10),s=BigInt(20),i=BigInt(40),o=BigInt(80),a=e*e%t*e%t,c=Eh(a,ql)*a%t,l=Eh(c,Hl)*e%t,h=Eh(l,r)*l%t,u=Eh(h,n)*h%t,d=Eh(u,s)*u%t,p=Eh(d,i)*d%t,f=Eh(p,o)*p%t,y=Eh(f,o)*p%t,g=Eh(y,n)*h%t;return{pow_p_5_8:Eh(g,ql)*e%t,b2:a}}(e*n).pow_p_5_8);const i=bh(t*s*s),o=s,a=bh(s*Zl),c=i===e,l=i===bh(-e),h=i===bh(-e*Zl);return c&&(s=o),(l||h)&&(s=a),yh(s)&&(s=bh(-s)),{isValid:c||l,value:s}}function Sh(e){return _h(Hl,e)}function Ah(e){return bh(gh(e),Wl.l)}function Ih(e,t){const r=e instanceof Uint8Array?Uint8Array.from(e):dh(e);if("number"==typeof t&&r.length!==t)throw new Error(`Expected ${t} bytes`);return r}function Rh(e,t,r=!0){if(!t)throw new TypeError("Specify max value");if("number"==typeof e&&Number.isSafeInteger(e)&&(e=BigInt(e)),"bigint"==typeof e&&e<t)if(r){if($l<e)return e}else if($l<=e)return e;throw new TypeError("Expected valid scalar: 0 < scalar < max")}let kh;async function Th(e){return function(e){const t=function(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}(e.slice(0,32)),r=e.slice(32,64),n=Ah(t),s=ah.BASE.multiply(n),i=s.toRawBytes();return{head:t,prefix:r,scalar:n,point:s,pointBytes:i}}(await Nh.sha512(function(e){if(32!==(e="bigint"==typeof e||"number"==typeof e?ph(Rh(e,Yl)):Ih(e)).length)throw new Error("Expected 32 bytes");return e}(e)))}async function Ch(e){return(await Th(e)).pointBytes}ah.BASE._setWindowSize(8);const Ph={node:Kl,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},Nh={bytesToHex:uh,hexToBytes:dh,concatBytes:lh,getExtendedPublicKey:Th,mod:bh,invert:vh,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:e=>{if((e=Ih(e)).length<40||e.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return bh(gh(e),Wl.l-Hl)+Hl},randomBytes:(e=32)=>{if(Ph.web)return Ph.web.getRandomValues(new Uint8Array(e));if(Ph.node){const{randomBytes:t}=Ph.node;return new Uint8Array(t(e).buffer)}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Nh.randomBytes(32),sha512:async(...e)=>{const t=lh(...e);if(Ph.web){const e=await Ph.web.subtle.digest("SHA-512",t.buffer);return new Uint8Array(e)}if(Ph.node)return Uint8Array.from(Ph.node.createHash("sha512").update(t).digest());throw new Error("The environment doesn't have sha512 function")},precompute(e=8,t=ah.BASE){const r=t.equals(ah.BASE)?t:new ah(t.x,t.y);return r._setWindowSize(e),r.multiply(ql),r},sha512Sync:void 0};Object.defineProperties(Nh,{sha512Sync:{configurable:!1,get:()=>kh,set(e){kh||(kh=e)}}});const Dh=64;async function Oh(e,t,r){return await async function(e,t,r){const{r:n,SB:s,msg:i,pub:o}=function(e,t,r){t=Ih(t),r instanceof ah||(r=ah.fromHex(r,!1));const{r:n,s}=e instanceof ch?e.assertValidity():ch.fromHex(e);return{r:n,s,SB:th.BASE.multiplyUnsafe(s),pub:r,msg:t}}(e,t,r),a=await Nh.sha512(n.toRawBytes(),o.toRawBytes(),i);return function(e,t,r,n){const s=Ah(n),i=th.fromAffine(e).multiplyUnsafe(s);return th.fromAffine(t).add(i).subtract(r).multiplyUnsafe(Wl.h).equals(th.ZERO)}(o,n,s,a)}(t,r,e)}function xh(e,t){const r=new Uint8Array(Dh);for(let n=0;n<32;n++)r[n]=e[n],r[32+n]=t[n];return r}class Lh{constructor(e){this._key=Fh(e,32)}async verify(e,t){return await Oh(this._key,t,e)}marshal(){return this._key}get bytes(){return vc.encode({Type:wc.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Ti(this.bytes,e.bytes)}async hash(){const{bytes:e}=await As.digest(this.bytes);return e}}class Bh{constructor(e,t){this._key=Fh(e,Dh),this._publicKey=Fh(t,32)}async sign(e){return await async function(e,t){const r=e.slice(0,32);return await async function(e,t){e=Ih(e);const{prefix:r,scalar:n,pointBytes:s}=await Th(t),i=Ah(await Nh.sha512(r,e)),o=ah.BASE.multiply(i),a=bh(i+Ah(await Nh.sha512(o.toRawBytes(),s,e))*n,Wl.l);return new ch(o,a).toRawBytes()}(t,r)}(this._key,e)}get public(){return new Lh(this._publicKey)}marshal(){return this._key}get bytes(){return Ec.encode({Type:wc.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Ti(this.bytes,e.bytes)}async hash(){const{bytes:e}=await As.digest(this.bytes);return e}async id(){const e=await hs.digest(this.public.bytes);return Pe.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return await Ll(this.bytes,e);throw qe(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}function Mh(e){if(e.length>Dh){const t=(e=Fh(e,96)).slice(0,Dh),r=e.slice(Dh,e.length);return new Bh(t,r)}const t=(e=Fh(e,Dh)).slice(0,Dh),r=e.slice(32);return new Bh(t,r)}function Uh(e){return e=Fh(e,32),new Lh(e)}async function zh(){const{privateKey:e,publicKey:t}=await async function(){const e=Nh.randomPrivateKey(),t=await Ch(e);return{privateKey:xh(e,t),publicKey:t}}();return new Bh(e,t)}async function Vh(e){const{privateKey:t,publicKey:r}=await async function(e){if(32!==e.length)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=await Ch(t);return{privateKey:xh(t,r),publicKey:r}}(e);return new Bh(t,r)}function Fh(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw qe(new Error(`Key must be a Uint8Array of length ${t}, got ${e.length}`),"ERR_INVALID_KEY_TYPE");return e}async function jh(e,t){const{digest:r}=await As.digest(t);try{return await async function(e,t,r={}){const{seed:n,m:s,d:i}=function(e,t,r){if(null==e)throw new Error(`sign: expected valid message hash, not "${e}"`);const n=sl(e),s=bl(t),i=[Al(s),Sl(n)];if(null!=r){!0===r&&(r=Tl.randomBytes(32));const e=sl(r);if(32!==e.length)throw new Error("sign: Expected 32 bytes of extra data");i.push(e)}return{seed:Wc(...i),m:_l(n),d:s}}(e,t,r.extraEntropy);let o;const a=new yl;for(await a.reseed(n);!(o=wl(await a.generate(),s,i));)await a.reseed();return function(e,t){let{sig:r,recovery:n}=e;const{canonical:s,der:i,recovered:o}=Object.assign({canonical:!0,der:!0},t);s&&r.hasHighS()&&(r=r.normalizeS(),n^=1);const a=i?r.toDERRawBytes():r.toCompactRawBytes();return o?[a,n]:a}(o,r)}(r,e)}catch(e){throw qe(e,"ERR_INVALID_INPUT")}}async function Kh(e,t,r){try{const{digest:n}=await As.digest(r);return function(e,t,r,n=Il){let s;try{s=vl(e),t=sl(t)}catch(e){return!1}const{r:i,s:o}=s;if(n.strict&&s.hasHighS())return!1;const a=dl(t);let c;try{c=function(e){return e instanceof $c?(e.assertValidity(),e):$c.fromHex(e)}(r)}catch(e){return!1}const{n:l}=Uc,h=cl(o,l),u=ol(a*h,l),d=ol(i*h,l),p=$c.BASE.multiplyAndAddUnsafe(c,u,d);return!!p&&ol(p.x,l)===i}(t,n,e)}catch(e){throw qe(e,"ERR_INVALID_INPUT")}}function $h(e){try{$c.fromHex(e)}catch(e){throw qe(e,"ERR_INVALID_PUBLIC_KEY")}}class Hh{constructor(e){$h(e),this._key=e}async verify(e,t){return await Kh(this._key,t,e)}marshal(){return e=this._key,$c.fromHex(e).toRawBytes(!0);var e}get bytes(){return vc.encode({Type:wc.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Ti(this.bytes,e.bytes)}async hash(){const{bytes:e}=await As.digest(this.bytes);return e}}class qh{constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return El(e,!0)}catch(e){throw qe(e,"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{El(e,!0)}catch(e){throw qe(e,"ERR_INVALID_PRIVATE_KEY")}}(this._key),$h(this._publicKey)}async sign(e){return await jh(this._key,e)}get public(){return new Hh(this._publicKey)}marshal(){return this._key}get bytes(){return Ec.encode({Type:wc.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Ti(this.bytes,e.bytes)}async hash(){const{bytes:e}=await As.digest(this.bytes);return e}async id(){return ni(await this.public.hash(),"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return await Ll(this.bytes,e);throw qe(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}function Gh(e){return new qh(e)}function Wh(e){return new Hh(e)}async function Yh(){const e=await Tl.randomPrivateKey();return new qh(e)}const Zh={rsa:E,ed25519:_,secp256k1:S};function Qh(e){const t=Object.keys(Zh).join(" / ");return qe(new Error(`invalid or unsupported key type ${e}. Must be ${t}`),"ERR_UNSUPPORTED_KEY_TYPE")}function Jh(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return Zh[e];throw Qh(e)}async function Xh(e,t){return await Jh(e).generateKeyPair(t??2048)}function eu(e){const t=vc.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case wc.RSA:return Zh.rsa.unmarshalRsaPublicKey(r);case wc.Ed25519:return Zh.ed25519.unmarshalEd25519PublicKey(r);case wc.Secp256k1:return Zh.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw Qh(t.Type??"RSA")}}function tu(e,t){return Jh(t=(t??"rsa").toLowerCase()),e.bytes}async function ru(e){const t=Ec.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case wc.RSA:return await Zh.rsa.unmarshalRsaPrivateKey(r);case wc.Ed25519:return Zh.ed25519.unmarshalEd25519PrivateKey(r);case wc.Secp256k1:return Zh.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw Qh(t.Type??"RSA")}}async function nu(e,t){try{const r=await async function(e,t){const r=Fe.decode(e),n=Pc();return await n.decrypt(r,t)}(e,t);return await ru(r)}catch(e){}const r=Ic.pki.decryptRsaPrivateKey(e,t);if(null===r)throw qe(new Error("Cannot read the key, most likely the password is wrong or not a RSA key"),"ERR_CANNOT_DECRYPT_PEM");let n=Ic.asn1.toDer(Ic.pki.privateKeyToAsn1(r));return n=Xs(n.getBytes(),"ascii"),await Zh.rsa.unmarshalRsaPrivateKey(n)}const su="ERR_UNRECOGNIZED_VALIDITY",iu="ERR_SIGNATURE_VERIFICATION",ou="ERR_UNDEFINED_PARAMETER";var au;!function(e){let t,r,n;!function(e){e.EOL="EOL"}(t=e.ValidityType||(e.ValidityType={})),function(e){e[e.EOL=0]="EOL"}(r||(r={})),function(e){e.codec=()=>Sc(r)}(t=e.ValidityType||(e.ValidityType={})),e.codec=()=>(null==n&&(n=Ac(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.value&&(r.uint32(10),r.bytes(t.value)),null!=t.signature&&(r.uint32(18),r.bytes(t.signature)),null!=t.validityType&&(r.uint32(24),e.ValidityType.codec().encode(t.validityType,r)),null!=t.validity&&(r.uint32(34),r.bytes(t.validity)),null!=t.sequence&&(r.uint32(40),r.uint64(t.sequence)),null!=t.ttl&&(r.uint32(48),r.uint64(t.ttl)),null!=t.pubKey&&(r.uint32(58),r.bytes(t.pubKey)),null!=t.signatureV2&&(r.uint32(66),r.bytes(t.signatureV2)),null!=t.data&&(r.uint32(74),r.bytes(t.data)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){const r=t.uint32();switch(r>>>3){case 1:n.value=t.bytes();break;case 2:n.signature=t.bytes();break;case 3:n.validityType=e.ValidityType.codec().decode(t);break;case 4:n.validity=t.bytes();break;case 5:n.sequence=t.uint64();break;case 6:n.ttl=t.uint64();break;case 7:n.pubKey=t.bytes();break;case 8:n.signatureV2=t.bytes();break;case 9:n.data=t.bytes();break;default:t.skipType(7&r)}}return n}))),n),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(au||(au={}));const cu=He("ipns:utils"),lu=Xs("/ipns/");function hu(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),r=String(e).trim().match(t);if(null==r)throw new Error("Invalid format");const n=parseInt(r[1],10),s=parseInt(r[2],10)-1,i=parseInt(r[3],10),o=parseInt(r[4],10),a=parseInt(r[5],10),c=parseInt(r[6],10),l=parseInt(r[7].slice(0,-6),10);return new Date(Date.UTC(n,s,i,o,a,c,l))}const uu=e=>di([Xs("ipns-signature:"),e]),du=e=>{const t=au.decode(e);return null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),{value:t.value??new Uint8Array(0),signature:t.signature??new Uint8Array(0),validityType:t.validityType??au.ValidityType.EOL,validity:t.validity??new Uint8Array(0),sequence:t.sequence??0n,pubKey:t.pubKey,ttl:t.ttl??void 0,signatureV2:t.signatureV2,data:t.data}},pu=e=>di([lu,e.toBytes()]),fu=He("ipns"),yu=hs.code,gu="/ipns/",mu=gu.length,wu=e=>new Do(`/ipns/${(e=>Oe.encode(e).slice(1))(e)}`),bu=async(e,t,r,n)=>{try{const s=((e,t,r)=>di([e,r,Xs(t)]))(t,r,n);return await e.sign(s)}catch(e){throw fu.error("record signature creation failed",e),qe(new Error("record signature creation failed"),"ERR_SIGNATURE_CREATION")}},vu=He("ipfs:ipns:publisher"),Eu=cc().code,_u=36e5;class Su{constructor(e,t){this._routing=e,this._datastore=t}async publishWithEOL(e,t,r,n){const s=await this._updateOrCreateRecord(e,t,r,n);return this._putRecordToRouting(s,e,n)}publish(e,t,r){return this.publishWithEOL(e,t,_u,r)}async _putRecordToRouting(e,t,r){if(!Ka(t)){const e="peerId received is not valid";throw vu.error(e),qe(new Error(e),"ERR_INVALID_PEER_ID")}if(null==t.publicKey)throw qe(new Error("Public key was missing"),"ERR_MISSING_PUBLIC_KEY");const n=pu(t);return await this._publishEntry(n,e,r),e}async _publishEntry(e,t,r){try{const n=await this._routing.put(e,t,r);return vu(`ipns record for ${ni(e,"base32")} was stored in the routing`),n}catch(t){const r=`ipns record for ${ni(e,"base32")} could not be stored in the routing - ${t.stack}`;throw vu.error(r),vu.error(t),qe(new Error(r),"ERR_PUTTING_TO_ROUTING")}}async _getPublished(e,t={}){if(!Ka(e)){const e="peerId received is not valid";throw vu.error(e),qe(new Error(e),"ERR_INVALID_PEER_ID")}const r=!1!==t.checkRouting;try{const t=await this._datastore.get(wu(e.toBytes()));return this._unmarshalData(t)}catch(t){if(t.code!==Eu){const t=`unexpected error getting the ipns record ${e.toString()} from datastore`;throw vu.error(t),qe(new Error(t),"ERR_UNEXPECTED_DATASTORE_RESPONSE")}if(!r)throw qe(t,"ERR_NOT_FOUND_AND_CHECK_ROUTING_NOT_ENABLED");try{const t=pu(e),r=await this._routing.get(t);return this._unmarshalData(r)}catch(e){throw vu.error(e),e}}}_unmarshalData(e){try{return du(e)}catch(e){throw qe(e,"ERR_INVALID_RECORD_DATA")}}async _updateOrCreateRecord(e,t,r,n){if(!Ka(e)){const e="peerId received is not valid";throw vu.error(e),qe(new Error(e),"ERR_INVALID_PEER_ID")}const s={checkRouting:!0};let i;try{i=await this._getPublished(e,s)}catch(t){if(t.code!==Eu){const r=`unexpected error when determining the last published IPNS record for ${e.toString()} ${t.stack}`;throw vu.error(r),qe(new Error(r),"ERR_DETERMINING_PUBLISHED_RECORD")}}let o,a=0n;i&&void 0!==i.sequence&&(a=Ti(i.value,t)?i.sequence:i.sequence+BigInt(1));try{o=await(async(e,t,r,n)=>{const s=new lc(Date.now()+Number(n)),i=au.ValidityType.EOL,[o,a]=n.toString().split("."),c=BigInt(o)*BigInt(1e5)+BigInt(a??"0");return await(async(e,t,r,n,s,i)=>{r=BigInt(r);const o=Xs(s.toString());if(null==e.privateKey)throw qe(new Error("Missing private key"),"ERR_MISSING_PRIVATE_KEY");const a=await ru(e.privateKey),c=await bu(a,t,n,o),l=((e,t,r,n,s)=>{let i;if(r!==au.ValidityType.EOL)throw qe(new Error("Unknown validity type"),su);return i=0,An({Value:e,Validity:t,ValidityType:0,Sequence:n,TTL:s})})(t,o,n,r,i),h=uu(l),u={value:t,signature:c,validityType:n,validity:o,sequence:r,ttl:i,signatureV2:await a.sign(h),data:l};if(null!=e.publicKey){const t=St(e.toBytes());t.code===yu&&Ti(e.publicKey,t.digest)||(u.pubKey=e.publicKey)}return fu("ipns entry for %b created",t),u})(e,t,r,i,s,c)})(e,t,a,r)}catch(e){const r=`ipns record for ${t} could not be created`;throw vu.error(e),qe(new Error(r),"ERR_CREATING_IPNS_RECORD")}try{const r=(c=o,au.encode(c));return await this._datastore.put(wu(e.toBytes()),r,n),vu(`ipns record for ${ni(t,"base32")} was stored in the datastore`),r}catch(e){const r=`ipns record for ${t} could not be stored in the datastore`;throw vu.error(r),qe(new Error(r),"ERR_STORING_IN_DATASTORE")}var c}}Su.defaultRecordLifetime=_u;const Au=He("ipfs:ipns:republisher");class Iu{constructor(e,t,r,n,s={pass:""}){this._publisher=e,this._datastore=t,this._peerId=r,this._keychain=n,this._options=s,this._republishHandle=null}async start(){if(this._republishHandle)throw qe(new Error("republisher is already running"),"ERR_REPUBLISH_ALREADY_RUNNING");const e={_task:null,_inflightTask:null,_timeoutId:null,runPeriodically:t=>{e._timeoutId=setTimeout((async()=>{e._timeoutId=null;try{e._inflightTask=e._task(),await e._inflightTask,e._task&&e.runPeriodically(t)}catch(e){Au.error(e)}}),t())},cancel:async()=>{null!=e._timeoutId&&clearTimeout(e._timeoutId),e._task=null,await e._inflightTask}},{pass:t}=this._options;let r=!0;e._task=async()=>{const e=new ei.TimeoutController(3e4);try{await this._republishEntries(this._peerId,t,{signal:e.signal})}finally{e.clear()}},e.runPeriodically((()=>r?(r=!1,this._options.initialBroadcastInterval||6e4):this._options.broadcastInterval||144e5)),this._republishHandle=e}async stop(){const e=this._republishHandle;if(!e)throw qe(new Error("republisher is not running"),"ERR_REPUBLISH_NOT_RUNNING");this._republishHandle=null,await e.cancel()}async _republishEntries(e,t,r){try{await this._republishEntry(e,r)}catch(e){const t="cannot republish entry for the node's private key";return void Au.error(t)}if(t)try{const e=await this._keychain.listKeys();for(const n of e){if("self"===n.name)continue;const e=await this._keychain.exportKey(n.name,t),s=await nu(e,t),i=await Ja(s.public.bytes,s.bytes);await this._republishEntry(i,r)}}catch(e){Au.error(e)}}async _republishEntry(e,t){try{const r=await this._getPreviousValue(e);await this._publisher.publishWithEOL(e,r,864e5,t)}catch(e){if("ERR_NO_ENTRY_FOUND"===e.code)return;throw e}}async _getPreviousValue(e){if(!Ka(e))throw qe(new Error("invalid peer ID"),"ERR_INVALID_PEER_ID");try{const t=await this._datastore.get(wu(e.toBytes()));if(!(t instanceof Uint8Array))throw qe(new Error("found ipns record that we couldn't process"),"ERR_INVALID_IPNS_RECORD");try{return du(t).value}catch(e){throw Au.error(e),qe(new Error("found ipns record that we couldn't convert to a value"),"ERR_INVALID_IPNS_RECORD")}}catch(t){if(t&&t.notFound)throw qe(new Error(`no previous entry for record with id: ${e.toString()}`),"ERR_NO_ENTRY_FOUND");throw t}}}const Ru=He("ipns:validator"),ku=async(e,t)=>{const r=(e=>Qa(e.slice(lu.length)))(e),n=du(t),s=await(async(e,t)=>{if(null==t||null==e){const e=new Error("one or more of the provided parameters are not defined");throw cu.error(e),qe(e,ou)}let r;if(null!=t.pubKey){try{r=eu(t.pubKey)}catch(e){throw cu.error(e),e}if(!(await Ja(t.pubKey)).equals(e))throw qe(new Error("Embedded public key did not match PeerID"),"ERR_INVALID_EMBEDDED_KEY")}else null!=e.publicKey&&(r=eu(e.publicKey));if(null!=r)return r;throw qe(new Error("no public key is available"),ou)})(r,n);await(async(e,t)=>{const{value:r,validityType:n,validity:s}=t;let i,o,a;if(null==t.signatureV2||null==t.data)throw qe(new Error("missing data or signatureV2"),iu);o=t.signatureV2,i=uu(t.data),(e=>{if(null==e.data)throw qe(new Error("Record data is missing"),"ERR_INVALID_RECORD_DATA");const t=(e=>{const t=Pn(e);if(0!==t.ValidityType)throw qe(new Error("Unknown validity type"),su);return t.ValidityType=au.ValidityType.EOL,Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t})(e.data);if(!Ti(t.Value,e.value))throw qe(new Error('Field "value" did not match between protobuf and CBOR'),iu);if(!Ti(t.Validity,e.validity))throw qe(new Error('Field "validity" did not match between protobuf and CBOR'),iu);if(t.ValidityType!==e.validityType)throw qe(new Error('Field "validityType" did not match between protobuf and CBOR'),iu);if(t.Sequence!==e.sequence)throw qe(new Error('Field "sequence" did not match between protobuf and CBOR'),iu);if(t.TTL!==e.ttl)throw qe(new Error('Field "ttl" did not match between protobuf and CBOR'),iu)})(t);try{a=await e.verify(i,o)}catch(e){a=!1}if(!a)throw Ru.error("record signature verification failed"),qe(new Error("record signature verification failed"),iu);if(null!=s&&n===au.ValidityType.EOL){let e;try{e=hu(ni(s))}catch(e){throw Ru.error("unrecognized validity format (not an rfc3339 format)"),qe(new Error("unrecognized validity format (not an rfc3339 format)"),"ERR_UNRECOGNIZED_FORMAT")}if(e.getTime()<Date.now())throw Ru.error("record has expired"),qe(new Error("record has expired"),"ERR_IPNS_EXPIRED_RECORD")}else if(null!=n)throw Ru.error("unrecognized validity type"),qe(new Error("unrecognized validity type"),su);Ru("ipns entry for %b is valid",r)})(s,n)},Tu=He("ipfs:ipns:resolver"),Cu=cc().code;class Pu{constructor(e){this._routing=e}async resolve(e,t={}){if("string"!=typeof e)throw qe(new Error("invalid name"),"ERR_INVALID_NAME");const r=t.recursive&&"true"===t.recursive.toString(),n=e.split("/");if(3!==n.length||""!==n[0])throw qe(new Error("invalid name"),"ERR_INVALID_NAME");const s=n[2];let i=1/0;r&&(i=32);const o=await this.resolver(s,i,t);return Tu(`${e} was locally resolved correctly`),o}async resolver(e,t,r){if(0===t){const e="could not resolve name (recursion limit of 32 exceeded)";throw Tu.error(e),qe(new Error(e),"ERR_RESOLVE_RECURSION_LIMIT")}const n=await this._resolveName(e,r),s=n.split("/");return"ipfs"!==s[1]&&t?this.resolver(s[2],t-1,r):n}async _resolveName(e,t){const r=Za(e),n=pu(r);let s;try{s=await this._routing.get(n,t)}catch(t){if(Tu.error("could not get record from routing",t),t.code===Cu)throw qe(new Error(`record requested for ${e} was not found in the network`),"ERR_NO_RECORD_FOUND");throw qe(new Error(`unexpected error getting the ipns record ${r.toString()}`),"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}return this._validateRecord(r,s)}async _validateRecord(e,t){return await ku(di([Xs("/ipns/"),e.toBytes()]),t),ni(du(t).value)}}class Nu{constructor(e){this.lru=Qo(e)}get(e){const t=this.lru.get(e);if(t)return t.expire&&t.expire<Date.now()?void this.lru.remove(e):t.value}set(e,t,r){this.lru.set(e,{value:t,expire:Date.now()+r})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}}const Du=He("ipfs:ipns");class Ou{constructor(e,t,r,n,s){this.publisher=new Su(e,t),this.republisher=new Iu(this.publisher,t,r,n,s),this.resolver=new Pu(e),this.cache=new Nu(1e3),this.routing=e}async publish(e,t,r=Su.defaultRecordLifetime,n){try{await this.publisher.publishWithEOL(e,t,r,n),Du(`IPNS value ${ni(t,"base32")} was published correctly`);const s=e.toString(),i=parseFloat(r),o=i<6e4?i:6e4;return this.cache.set(s,t,o),Du(`IPNS value ${ni(t,"base32")} was cached correctly`),{name:s,value:t}}catch(e){throw Du.error(e),e}}async resolve(e,t={}){if("string"!=typeof e)throw qe(new Error("name received is not valid"),"ERR_INVALID_NAME");if(!t.nocache&&!t.recursive){const t=e.split("/")[2],r=this.cache.get(t);if(r)return r}try{const r=await this.resolver.resolve(e,t);return Du(`IPNS record from ${e} was resolved correctly`),r}catch(e){throw Du.error(e),e}}async initializeKeyspace(e,t,r){return this.publish(e,t,Su.defaultRecordLifetime,r)}}var xu=r(68071);const Lu=(e,t)=>async function*(){const r=await xu(e);yield*r.sort(t)}();var Bu=r(5075),Mu=r(8293),Uu=r(6043);class zu{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await Bu(this.putMany(e,r)),e=[],await Bu(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix&&(r=Mu(r,(t=>t.key.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>Mu(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>Lu(e,t)),r)),null!=e.offset){let t=0;r=Mu(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=Uu(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix&&(r=Mu(r,(t=>t.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>Mu(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>Lu(e,t)),r)),null!=e.offset){let t=0;r=Mu(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=Uu(r,e.limit)),r}}class Vu{constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class Fu{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Vu(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new Vu(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}function ju(e={}){return Ku((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}function Ku(e,t){let r,n,s,i=(t=t??{}).onEnd,o=new Fu;const a=e=>null!=n?n(e):(o.push(e),r),c=e=>{if(s)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return a({done:!1,value:e})},l=e=>s?r:(s=!0,null!=e?(e=>(o=new Fu,null!=n?n({error:e}):(o.push({error:e}),r)))(e):a({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>o.isEmpty()?s?{done:!0}:await new Promise(((t,s)=>{n=i=>{n=null,o.push(i);try{t(e(o))}catch(e){s(e)}return r}})):e(o),return:()=>(o=new Fu,l(),{done:!0}),throw:e=>(l(e),{done:!0}),push:c,end:l,get readableLength(){return o.size}},null==i)return r;const h=r;return r={[Symbol.asyncIterator](){return this},next:()=>h.next(),throw:e=>(h.throw(e),null!=i&&(i(e),i=void 0),{done:!0}),return:()=>(h.return(),null!=i&&(i(),i=void 0),{done:!0}),push:c,end:e=>(h.end(e),null!=i&&(i(e),i=void 0),r),get readableLength(){return h.readableLength}},r}const $u=He("datastore:core:tiered");class Hu extends zu{constructor(e){super(),this.stores=e.slice()}async open(){try{await Promise.all(this.stores.map((e=>e.open())))}catch(e){throw ic()}}async put(e,t,r){try{await Promise.all(this.stores.map((n=>n.put(e,t,r))))}catch(e){throw ac()}}async get(e,t){for(const r of this.stores)try{const n=await r.get(e,t);if(n)return n}catch(e){$u.error(e)}throw cc()}async has(e,t){for(const r of this.stores)if(await r.has(e,t))return!0;return!1}async delete(e,t){try{await Promise.all(this.stores.map((r=>r.delete(e,t))))}catch(e){throw oc()}}async*putMany(e,t={}){let r;const n=this.stores.map((e=>{const n=ju({objectMode:!0});return Bu(e.putMany(n,t)).catch((e=>{r=e})),n}));try{for await(const t of e){if(r)throw r;n.forEach((e=>e.push(t))),yield t}}finally{n.forEach((e=>e.end()))}}async*deleteMany(e,t={}){let r;const n=this.stores.map((e=>{const n=ju({objectMode:!0});return Bu(e.deleteMany(n,t)).catch((e=>{r=e})),n}));try{for await(const t of e){if(r)throw r;n.forEach((e=>e.push(t))),yield t}}finally{n.forEach((e=>e.end()))}}async close(){await Promise.all(this.stores.map((e=>e.close())))}batch(){const e=this.stores.map((e=>e.batch()));return{put:(t,r)=>{e.forEach((e=>e.put(t,r)))},delete:t=>{e.forEach((e=>e.delete(t)))},commit:async t=>{for(const r of e)await r.commit(t)}}}query(e,t){return this.stores[this.stores.length-1].query(e,t)}queryKeys(e,t){return this.stores[this.stores.length-1].queryKeys(e,t)}}var qu=r(93765);const Gu=(e,t)=>{const r=t.map(((e,t)=>({entry:au.decode(e),index:t})));return r.sort(((e,t)=>{if(null!=e.entry.signatureV2&&null==t.entry.signatureV2)return-1;if(null==e.entry.signatureV2&&null!=t.entry.signatureV2)return 1;const r=e.entry.sequence??0n,n=t.entry.sequence??0n;if(r>n)return-1;if(r<n)return 1;const s=e.entry.validity??new Uint8Array(0),i=t.entry.validity??new Uint8Array(0),o=hu(ni(s)),a=hu(ni(i));return o.getTime()>a.getTime()?-1:o.getTime()<a.getTime()?1:0})),r[0].index};class Wu extends zu{constructor(){super(),this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(e,t){this.data[e.toString()]=t}async get(e){if(!await this.has(e))throw cc();return this.data[e.toString()]}async has(e){return void 0!==this.data[e.toString()]}async delete(e){delete this.data[e.toString()]}async*_all(){yield*Object.entries(this.data).map((([e,t])=>({key:new Do(e),value:t})))}async*_allKeys(){yield*Object.entries(this.data).map((([e])=>new Do(e)))}}r(63246);var Yu=r(59274);const Zu=e=>null!=e&&("function"==typeof e[Symbol.asyncIterator]||"function"==typeof e[Symbol.iterator]||"function"==typeof e.next),Qu=e=>null!=e&&"function"==typeof e.sink&&Zu(e.source),Ju=e=>t=>{const r=e.sink(t);if(null!=r.then){const t=ju({objectMode:!0});r.then((()=>{t.end()}),(e=>{t.end(e)}));const n=async function*(){yield*e.source,t.end()};return Yu(t,n())}return e.source};function Xu(e,...t){if(Qu(e)){const t=e;e=()=>t.source}else if(Zu(e)){const t=e;e=()=>t}const r=[e,...t];if(r.length>1&&Qu(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let e=1;e<r.length-1;e++)Qu(r[e])&&(r[e]=Ju(r[e]));return((...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t})(...r)}new Do("SHARDING"),new Do("_README"),r(86119);const ed="/record/";function td(e){return ni(e,"base32")}function rd(e){return("string"==typeof e||e instanceof String)&&(e=Xs(e.toString())),`/record/${ni(e,"base64url")}`}const nd=He("datastore-pubsub:publisher");class sd extends zu{constructor(e,t,r,n,s,i){if(super(),!n)throw qe(new TypeError("missing validator"),"ERR_INVALID_PARAMETERS");if("function"!=typeof n)throw qe(new TypeError("missing validate function"),"ERR_INVALID_PARAMETERS");if("function"!=typeof s)throw qe(new TypeError("missing select function"),"ERR_INVALID_PARAMETERS");if(i&&"function"!=typeof i)throw qe(new TypeError("invalid subscriptionKeyFn received"),"ERR_INVALID_PARAMETERS");this._pubsub=e,this._datastore=t,this._peerId=r,this._validator=n,this._selector=s,this._handleSubscriptionKeyFn=i,this._onMessage=this._onMessage.bind(this),this._pubsub.addEventListener("message",this._onMessage)}async put(e,t,r){if(!(e instanceof Uint8Array)){const e="datastore key does not have a valid format";throw nd.error(e),qe(new Error(e),"ERR_INVALID_DATASTORE_KEY")}if(!(t instanceof Uint8Array)){const e="received value is not a Uint8Array";throw nd.error(e),qe(new Error(e),"ERR_INVALID_VALUE_RECEIVED")}const n=rd(e);nd(`publish value for topic ${n}`),await this._pubsub.publish(n,t)}async get(e,t){if(!(e instanceof Uint8Array)){const e="datastore key does not have a valid format";throw nd.error(e),qe(new Error(e),"ERR_INVALID_DATASTORE_KEY")}const r=rd(e),n=await this._pubsub.getTopics();if(n&&Array.isArray(n)&&n.indexOf(r)>-1)return this._getLocal(e,t);try{await this._pubsub.subscribe(r)}catch(e){const t=`cannot subscribe topic ${r}`;throw nd.error(t),qe(new Error(t),"ERR_SUBSCRIBING_TOPIC")}return nd(`subscribed values for key ${r}`),this._getLocal(e)}unsubscribe(e){const t=rd(e);return this._pubsub.unsubscribe(t)}async _getLocal(e,t){const r=new Do("/"+td(e),!1);let n;try{n=await this._datastore.get(r,t)}catch(e){if("ERR_NOT_FOUND"!==e.code){const e=`unexpected error getting the ipns record for ${r.toString()}`;throw nd.error(e),qe(new Error(e),"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}const t=`local record requested was not found for ${r.toString()}`;throw nd.error(t),qe(new Error(t),"ERR_NOT_FOUND")}if(!(n instanceof Uint8Array)){const e="found record that we couldn't convert to a value";throw nd.error(e),qe(new Error(e),"ERR_INVALID_RECORD_RECEIVED")}return n}async _onMessage(e){const t=e.detail;if("signed"!==t.type)return void nd.error("unsigned message received, this module can only work with signed messages");const{data:r,from:n,topic:s}=t;let i;try{i=function(e){if(e.substring(0,ed.length)!==ed)throw qe(new Error("topic received is not from a record"),"ERR_TOPIC_IS_NOT_FROM_RECORD_NAMESPACE");return Xs(e.substring(ed.length),"base64url")}(s)}catch(e){return void nd.error(e)}if(nd(`message received for topic ${s}`),this._peerId.equals(n))nd("message discarded as it is from the same peer");else{if(this._handleSubscriptionKeyFn){let e;try{e=await this._handleSubscriptionKeyFn(i)}catch(e){return void nd.error("message discarded by the subscriptionKeyFn")}i=e}try{await this._storeIfSubscriptionIsBetter(i,r)}catch(e){nd.error(e)}}}async _storeIfSubscriptionIsBetter(e,t,r){let n=!1;try{n=await this._isBetter(e,t)}catch(e){if("ERR_NOT_VALID_RECORD"!==e.code)throw e}n&&await this._storeRecord(e,t,r)}async _validateRecord(e,t){return this._validator(e,t)}async _selectRecord(e,t){return 0===await this._selector(e,t)}async _isBetter(e,t){try{await this._validateRecord(e,t)}catch(e){const t="record received through pubsub is not valid";throw nd.error(t),qe(new Error(t),"ERR_NOT_VALID_RECORD")}const r=new Do(e);let n;try{n=await this._getLocal(r.uint8Array())}catch(e){return!0}return!Ti(n,t)&&this._selectRecord(e,[n,t])}async _storeRecord(e,t,r){const n=new Do("/"+td(e),!1);await this._datastore.put(n,t,r),nd(`record for ${rd(e)} was stored in the datastore`)}}const id=He("ipfs:ipns:pubsub");class od{constructor(e,t,r){this._subscriptions={},this._handleSubscriptionKey=this._handleSubscriptionKey.bind(this),this._pubsubDs=new sd(e,t,r,ku,Gu,this._handleSubscriptionKey)}async put(e,t,r){try{await this._pubsubDs.put(e,t,r)}catch(e){throw id.error(e),e}}async get(e,t){let r,n;try{r=await this._pubsubDs.get(e,t)}catch(e){n=e}if(ni(e.slice(0,mu))===gu){const t=Pe.encode(e).substring(1),r=Pe.encode(e.slice(mu)).substring(1);this._subscriptions[t]=r,id(`subscribed to pubsub topic ${t}, id ${r}`)}if(n)throw n;return r}_handleSubscriptionKey(e){e instanceof Uint8Array&&(e=ni(e,"base58btc"));const t=this._subscriptions[e];if(!t)throw qe(new Error(`key ${e} does not correspond to a subscription`),"ERR_INVALID_KEY");try{return pu(Za(t))}catch(e){throw id.error(e),e}}getSubscriptions(){return Object.values(this._subscriptions).filter(Boolean).map((e=>`/ipns/${e}`))}async cancel(e){if("string"!=typeof e)throw qe(new Error("invalid subscription name"),"ERR_INVALID_SUBSCRIPTION_NAME");e.startsWith(gu)&&(e=e.substring(mu));const t=Object.keys(this._subscriptions).find((t=>this._subscriptions[t]===e));if(!t)return{canceled:!1};const r=Xs(t);return this._pubsubDs.unsubscribe(r),delete this._subscriptions[t],id(`unsubscribed pubsub ${t}: ${e}`),{canceled:!0}}}var ad;function cd(e){const t=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0"),n=String(e.getUTCDate()).padStart(2,"0"),s=String(e.getUTCHours()).padStart(2,"0"),i=String(e.getUTCMinutes()).padStart(2,"0"),o=String(e.getUTCSeconds()).padStart(2,"0"),a=e.getUTCMilliseconds();return`${t}-${r}-${n}T${s}:${i}:${o}.${String(1e3*a*1e3).padStart(9,"0")}Z`}!function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.key&&e.key.byteLength>0)&&(t.uint32(10),t.bytes(e.key)),(!0===r.writeDefaults||null!=e.value&&e.value.byteLength>0)&&(t.uint32(18),t.bytes(e.value)),!0!==r.writeDefaults&&""===e.timeReceived||(t.uint32(42),t.string(e.timeReceived)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={key:new Uint8Array(0),value:new Uint8Array(0),timeReceived:""},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.key=e.bytes();break;case 2:r.value=e.bytes();break;case 5:r.timeReceived=e.string();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(ad||(ad={}));class ld{constructor(e,t,r){if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=r}serialize(){return ad.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:cd(this.timeReceived)}}static deserialize(e){const t=ad.decode(e);return new ld(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=function(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),r=String(e).trim().match(t);if(null==r)throw new Error("Invalid format");const n=parseInt(r[1],10),s=parseInt(r[2],10)-1,i=parseInt(r[3],10),o=parseInt(r[4],10),a=parseInt(r[5],10),c=parseInt(r[6],10),l=parseInt(r[7].slice(0,-6),10);return new Date(Date.UTC(n,s,i,o,a,c,l))}(e.timeReceived);if(null==e.key)throw new Error("key missing from deserialized object");if(null==e.value)throw new Error("value missing from deserialized object");return new ld(e.key,e.value,t)}}const hd=He("ipfs:ipns:offline-datastore");class ud{constructor(e){this._datastore=e,this.stores=[]}async put(e,t,r){if(!(e instanceof Uint8Array))throw qe(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");if(!(t instanceof Uint8Array))throw qe(new Error("Offline datastore value must be a Uint8Array"),"ERR_INVALID_VALUE");let n;try{n=this._routingKey(e)}catch(e){throw hd.error(e),qe(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}const s=new ld(e,t,new Date);await this._datastore.put(n,s.serialize(),r)}async get(e,t){if(!(e instanceof Uint8Array))throw qe(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");let r;try{r=this._routingKey(e)}catch(e){throw hd.error(e),qe(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}const n=await this._datastore.get(r,t);let s;try{s=ld.deserialize(n)}catch(e){throw hd.error(e),e}return s.value}_routingKey(e){return new Do("/dht/record/"+ni(e,"base32"),!1)}}async function dd(e){for await(const t of e);}const pd=He("ipfs:ipns:dht-datastore");class fd{constructor(e){this._dht=e}async put(e,t,r){try{await dd(this._dht.put(e,t,r))}catch(e){throw pd.error(e),e}}async get(e,t){for await(const r of this._dht.get(e,t))if("VALUE"===r.name)return r.value;throw cc()}}const yd=He("ipfs:components:ipns");class gd{constructor(e={pass:""}){this.options=e,this.offline=null,this.online=null}getIPNS(){const e=this.online||this.offline;if(e)return e;throw new zs}get routing(){return this.getIPNS().routing}startOffline({repo:e,peerId:t,keychain:r}){if(null!=this.offline)throw new Fs;yd("initializing IPNS keyspace (offline)");const n=new ud(e.datastore),s=new Ou(n,e.datastore,t,r,this.options);this.offline=s}async startOnline({libp2p:e,repo:t,peerId:r,keychain:n}){if(null!=this.online)throw new Fs;const s=function({libp2p:e,repo:t,peerId:r,options:n}){const s=[];let i;if(qu(n,"EXPERIMENTAL.ipnsPubsub",!1)&&(i=new od(e.pubsub,t.datastore,r),s.push(i)),!0!==qu(n,"offline",!1)&&["dht","dhtclient","dhtserver"].includes(qu(n,"config.Routing.Type","none"))&&s.push(new fd(e.dht)),qu(n,"offline",!1)||0===s.length){const e=new ud(t.datastore);s.push(e)}return new Hu(s)}({libp2p:e,repo:t,peerId:r,options:this.options}),i=new Ou(s,t.datastore,r,n,this.options);await i.republisher.start(),this.online=i}async stop(){const e=this.online;e&&(await e.republisher.stop(),this.online=null)}publish(e,t,r,n){return this.getIPNS().publish(e,t,r,n)}resolve(e,t){return this.getIPNS().resolve(e,t)}initializeKeyspace(e,t,r){return this.getIPNS().initializeKeyspace(e,t,r)}}async function md({ipns:e,repo:t,codecs:r},n,s){if(ko(n))return e.resolve(n);const{cid:i,path:o}=Fo(n);await dd(Yo(i,o||"",r,t,s))}const wd=He("ipfs:name:publish");var bd=r(20757);const vd=ye.bind({ignoreUndefined:!0}),Ed=He("ipfs:name:resolve"),_d=(e,t)=>t.length>0?e+"/"+t.join("/"):e;function Sd(e,t){if(!e||!t||!t.ipnsPubsub)throw qe(new Error("IPNS pubsub subsystem is not enabled"),"ERR_IPNS_PUBSUB_NOT_ENABLED");if(e.routing instanceof od)return e.routing;const r=(e.routing.stores||[]).find((e=>e instanceof od));if(!r)throw qe(new Error("IPNS pubsub datastore not found"),"ERR_PUBSUB_DATASTORE_NOT_FOUND");return r}class Ad{constructor({ipns:e,options:t}){this.cancel=function({ipns:e,options:t}){const r=t.EXPERIMENTAL;return zo((async function(t,n={}){return Sd(e,r).cancel(t,n)}))}({ipns:e,options:t}),this.state=function({ipns:e,options:t}){const r=t.EXPERIMENTAL;return zo((async function(t={}){try{return{enabled:Boolean(Sd(e,r))}}catch(e){return{enabled:!1}}}))}({ipns:e,options:t}),this.subs=function({ipns:e,options:t}){const r=t.EXPERIMENTAL;return zo((async function(t={}){return Sd(e,r).getSubscriptions(t)}))}({ipns:e,options:t})}}class Id{constructor({dns:e,ipns:t,repo:r,codecs:n,peerId:s,isOnline:i,keychain:o,options:a}){this.publish=function({ipns:e,repo:t,codecs:r,peerId:n,isOnline:s,keychain:i}){const o=async e=>{let t;if("self"===e&&null!=n.privateKey)t=await ru(n.privateKey);else try{const r=await i.exportKey(e,"temp");t=await nu(r,"temp")}catch(e){throw wd.error(e),qe(e,"ERR_CANNOT_GET_KEY")}return Ja(t.public.bytes,t.bytes)};return zo((async function(n,i={}){const a=!(!1===i.resolve),c=i.lifetime||"24h",l=i.key||"self";if(!s())throw qe(new Error(jo),"OFFLINE_ERROR");try{n=(e=>{if(kt.asCID(e))return`/ipfs/${e}`;const t=e.toString();try{return`/ipfs/${kt.parse(t)}`}catch{}if(Ro(t))return t;throw qe(new Error(`invalid path: ${e}`),"ERR_BAD_PATH")})(n)}catch(e){throw wd.error(e),e}let h=0;try{h=Mo(c)||0,h=parseFloat(h.toFixed(6))}catch(e){throw wd.error(e),e}const u=await Promise.all([o(l),a?md({ipns:e,repo:t,codecs:r},n):Promise.resolve()]),d=Xs(n),p=await e.publish(u[0],d,h,i);return{name:p.name,value:ni(p.value)}}))}({ipns:t,repo:r,codecs:n,peerId:s,isOnline:i,keychain:o}),this.resolve=function({dns:e,ipns:t,isOnline:r,options:{offline:n}}){return zo((async function*(s,i={}){if(i=vd({nocache:!1,recursive:!0},i),n&&i&&i.nocache)throw qe(new Error("cannot specify both offline and nocache"),"ERR_NOCACHE_AND_OFFLINE");if(!r()&&!n)throw qe(new Error(jo),"OFFLINE_ERROR");let o=s.toString();o.startsWith("/ipns/")||(o=`/ipns/${o}`);let[a,c,...l]=o.slice(1).split("/");try{if("1"===c.substring(0,1)){const e=Za(c),t=St(e.toBytes());c=kt.createV1(114,t).toString(ms)}else{const e=kt.parse(c);1===e.version&&(c=e.toString(ms))}}catch(t){if(bd(c))return void(yield _d(await e(c,i),l));throw Ed.error(t),qe(new Error("Invalid IPNS name"),"ERR_IPNS_INVALID_NAME")}const h=await t.resolve(`/${a}/${c}`,i);yield _d(h instanceof Uint8Array?ni(h):h,l)}))}({dns:e,ipns:t,isOnline:i,options:a}),this.pubsub=new Ad({ipns:t,options:a})}}const Rd=cc().code,kd="<dst>";async function*Td(e,t,r,n,s){const i=await e(n,s),{cid:o}=Fo(i),a=null!=s.maxDepth?s.maxDepth:1/0,c=s.unique||!1;for await(const e of async function*(e,t,r,n,s,i){const o=new Set;yield*async function*r(a,c){const l=c+1;if(!(l>n))try{for await(const n of async function*(e,t,r,n){const s=await e.blocks.get(r,n),i=(await t.getCodec(r.code)).decode(s),o=r.code===sr,a=[];for(const[e,t]of Pd(i,a)){if(o){const r=e.match(/^Links\/(\d+)\/Hash$/);if(r){const e=Number(r[1]);if(e<i.Links.length){yield{name:i.Links[e].Name,cid:t};continue}}}yield{name:e,cid:t}}}(e,t,a.cid,i))yield{parent:a,node:n,isDuplicate:s&&o.has(n.cid.toString())},s&&o.add(n.cid.toString()),yield*r(n,l)}catch(e){throw e.code===Rd&&(e.message=`Could not find object with CID: ${a.cid}`),e}}({cid:r},0)}(t,r,o,a,c,s))e.parent&&(e.isDuplicate||(yield{ref:Cd(e.parent.cid,e.node.cid,e.node.name,s.format)}))}function Cd(e,t,r="",n="<dst>"){let s=n.replace(/<src>/g,e.toString());return s=s.replace(/<dst>/g,t.toString()),s=s.replace(/<linkname>/g,r),s}const Pd=function*(e,t){if(null!=e&&!(e instanceof Uint8Array)){for(const[r,n]of Object.entries(e)){const e=[...t,r];if(null!=n&&"object"==typeof n)if(Array.isArray(n))for(const[t,r]of n.entries()){const n=[...e,t],s=kt.asCID(r);s?yield[n.join("/"),s]:"object"==typeof r&&(yield*Pd(r,n))}else{const t=kt.asCID(n);t?yield[e.join("/"),t]:yield*Pd(n,e)}}return[]}};function Nd({repo:e}){return zo((async function*(t={}){for await(const r of e.blocks.queryKeys({},{signal:t.signal}))yield{ref:r.toString()}}))}function Dd({network:e}){return zo((async function(t={}){const r=(await e.use(t)).bitswap,n=r.stat().snapshot;return{provideBufLen:parseInt(n.providesBufferLength.toString()),blocksReceived:BigInt(n.blocksReceived.toString()),wantlist:Array.from(r.getWantlist()).map((e=>e[1].cid)),peers:r.peers(),dupBlksReceived:BigInt(n.dupBlksReceived.toString()),dupDataReceived:BigInt(n.dupDataReceived.toString()),dataReceived:BigInt(n.dataReceived.toString()),blocksSent:BigInt(n.blocksSent.toString()),dataSent:BigInt(n.dataSent.toString())}}))}class Od{constructor({network:e}){this.wantlist=function({network:e}){return zo((async function(t={}){const{bitswap:r}=await e.use(t),n=r.getWantlist();return Array.from(n).map((e=>e[1].cid))}))}({network:e}),this.wantlistForPeer=function({network:e}){return zo((async function(t,r={}){const{bitswap:n}=await e.use(r),s=n.wantlistForPeer(t);return Array.from(s).map((e=>e[1].cid))}))}({network:e}),this.unwant=function({network:e}){return zo((async function(t,r={}){const{bitswap:n}=await e.use(r);return Array.isArray(t)||(t=[t]),n.unwant(t)}))}({network:e}),this.stat=Dd({network:e})}}function xd(e){try{return uo.matches(e)}catch(e){return!1}}class Ld{constructor({repo:e}){this.add=function({repo:e}){return zo((async function(t,r={}){if(!xd(t))throw new Error(`${t} is not a valid Multiaddr`);const n=await e.config.getAll(r),s=n.Bootstrap||[];return s.push(t.toString()),n.Bootstrap=Array.from(new Set(s)).sort(((e,t)=>e.localeCompare(t))),await e.config.replace(n),{Peers:[t]}}))}({repo:e}),this.list=function({repo:e}){return zo((async function(t={}){return{Peers:(await e.config.get("Bootstrap",t)||[]).map((e=>Ki(e)))}}))}({repo:e}),this.rm=function({repo:e}){return zo((async function(t,r={}){if(!xd(t))throw new Error(`${t} is not a valid Multiaddr`);const n=await e.config.getAll(r);return n.Bootstrap=(n.Bootstrap||[]).filter((e=>e.toString()!==t.toString())),await e.config.replace(n),{Peers:[t]}}))}({repo:e}),this.clear=function({repo:e}){return zo((async function(t={}){const r=await e.config.getAll(t),n=r.Bootstrap||[];return r.Bootstrap=[],await e.config.replace(r),{Peers:n.map((e=>Ki(e)))}}))}({repo:e}),this.reset=function({repo:e}){return zo((async function(t={}){const r=await e.config.getAll(t);return r.Bootstrap=["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"],await e.config.replace(r),{Peers:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"].map((e=>Ki(e)))}}))}({repo:e})}}function Bd(){const e={};return e.promise=new Promise(((t,r)=>{e.resolve=t,e.reject=r})),e}const Md=globalThis.CustomEvent??Event;async function*Ud(e,t={}){let r=t.concurrency??1/0;r<1&&(r=1/0);const n=null!=t.ordered&&t.ordered,s=new EventTarget,i=[];let o,a=Bd(),c=Bd(),l=!1,h=!1;function u(){return n?i[0]?.done:Boolean(i.find((e=>e.done)))}function*d(){for(;i.length>0&&i[0].done;){const e=i[0];if(i.shift(),!e.ok)throw h=!0,a.resolve(),e.err;yield e.value,a.resolve()}}function*p(){for(;u();)for(let e=0;e<i.length;e++)if(i[e].done){const t=i[e];if(i.splice(e,1),e--,!t.ok)throw h=!0,a.resolve(),t.err;yield t.value,a.resolve()}}for(s.addEventListener("task-complete",(()=>{c.resolve()})),Promise.resolve().then((async()=>{try{for await(const t of e){if(i.length===r&&(a=Bd(),await a.promise),h)break;const e={done:!1};i.push(e),t().then((t=>{e.done=!0,e.ok=!0,e.value=t,s.dispatchEvent(new Md("task-complete"))}),(t=>{e.done=!0,e.err=t,s.dispatchEvent(new Md("task-complete"))}))}l=!0,s.dispatchEvent(new Md("task-complete"))}catch(e){o=e,s.dispatchEvent(new Md("task-complete"))}}));;){if(u()||(c=Bd(),await c.promise),null!=o)throw o;if(n?yield*d():yield*p(),l&&0===i.length)break}}async function*zd(e,t){for await(const r of e)yield t(r)}async function*Vd(e,t){for await(const r of e)await t(r)&&(yield r)}function Fd(e){return e instanceof Uint8Array?kt.decode(e):kt.parse(e.toString())}class jd{constructor({codecs:e,hashers:t,preload:r,repo:n}){this.get=function({preload:e,repo:t}){return zo((async function(r,n={}){return!1!==n.preload&&e(r),t.blocks.get(r,n)}))}({preload:r,repo:n}),this.put=function({codecs:e,hashers:t,repo:r,preload:n}){return zo((async function(s,i={}){const o=i.pin?await r.gcLock.readLock():null;try{const a=null!=i.version?i.version:0,c=i.format||(0===a?"dag-pb":"raw"),l=await t.getHasher(i.mhtype||"sha2-256"),h=await l.digest(s),u=await e.getCodec(c),d=kt.create(a,u.code,h);return await r.blocks.put(d,s,{signal:i.signal}),!1!==i.preload&&n(d),!0===i.pin&&await r.pins.pinRecursively(d,{signal:i.signal}),d}finally{o&&o()}}))}({codecs:e,hashers:t,preload:r,repo:n}),this.rm=function({repo:e}){return zo((async function*(t,r={}){Array.isArray(t)||(t=[t]);const n=await e.gcLock.writeLock();try{yield*Xu(t,(t=>zd(t,(t=>async()=>{const n={cid:t=Fd(t)};try{if(!await e.blocks.has(t))throw qe(new Error("block not found"),"ERR_BLOCK_NOT_FOUND");await e.blocks.delete(t)}catch(e){r.force||(e.message=`cannot remove ${t}: ${e.message}`,n.error=e)}return n}))),(e=>Ud(e,{concurrency:8})),(e=>Vd(e,(()=>!r.quiet))))}finally{n()}}))}({repo:n}),this.stat=function({repo:e,preload:t}){return zo((async function(r,n={}){return r=Fd(r),!1!==n.preload&&t(r),{cid:r,size:(await e.blocks.get(r)).length}}))}({preload:r,repo:n})}}async function*Kd(e,t={}){const r=e.getReader();try{for(;;){const e=await r.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&await r.cancel(),r.releaseLock()}}function $d(e){const[t,r]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>t.next(),push:e=>{n.push(e)},next:()=>n.length>0?{done:!1,value:n.shift()}:t.next(),[r](){return this}}}async function Hd(e){const t=[];for await(const r of e)t.push(r);return t}function qd(e){return ArrayBuffer.isView(e)||e instanceof ArrayBuffer}function Gd(e){return e.constructor&&("Blob"===e.constructor.name||"File"===e.constructor.name)&&"function"==typeof e.stream}function Wd(e){return"object"==typeof e&&(e.path||e.content)}const Yd=e=>e&&"function"==typeof e.getReader;async function*Zd(e){yield e}async function Qd(e){if(qd(e))return Zd(Jd(e));if("string"==typeof e||e instanceof String)return Zd(Jd(e.toString()));if(Gd(e))return"function"==typeof(t=e).stream?Kd(t.stream()):Kd(new Response(t).body);var t;if(Yd(e)&&(e=Kd(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const t=$d(e),{value:r,done:n}=await t.peek();if(n)return Zd(new Uint8Array(0));if(t.push(r),Number.isInteger(r))return Zd(Uint8Array.from(await Hd(t)));if(qd(r)||"string"==typeof r||r instanceof String)return zd(t,Jd)}throw qe(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT")}function Jd(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Array.isArray(e)?Uint8Array.from(e):Xs(e.toString())}async function Xd(e,t){const{path:r,mode:n,mtime:s,content:i}=e,o={path:r||"",mode:st(n),mtime:it(s)};return i?o.content=await t(i):r||(o.content=await t(e)),o}function ep(e){return async function*(e,t){if(null==e)throw qe(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT");if("string"==typeof e||e instanceof String)yield Xd(e.toString(),t);else if(qd(e)||Gd(e))yield Xd(e,t);else{if(Yd(e)&&(e=Kd(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const r=$d(e),{value:n,done:s}=await r.peek();if(s)return void(yield{content:[]});if(r.push(n),Number.isInteger(n)||qd(n)||"string"==typeof n||n instanceof String)return void(yield Xd(r,t));throw qe(new Error("Unexpected input: multiple items passed - if you are using ipfs.add, please use ipfs.addAll instead"),"ERR_UNEXPECTED_INPUT")}if(!Wd(e))throw qe(new Error('Unexpected input: cannot convert "'+typeof e+'" into ImportCandidate'),"ERR_UNEXPECTED_INPUT");yield Xd(e,t)}}(e,Qd)}async function*tp(e,t=1){let r=[];t<1&&(t=1);for await(const n of e)for(r.push(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length>0;)yield r.slice(0,t),r=r.slice(t)}async function*rp(e,t=1){for await(const r of tp(e,t)){const e=r.map((async e=>await e().then((e=>({ok:!0,value:e})),(e=>({ok:!1,err:e})))));for(let t=0;t<e.length;t++){const r=await e[t];if(!r.ok)throw r.err;yield r.value}}}var np=r(11042);Mn({name:"murmur3-32",code:35,encode:e=>function(e){const t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}(np.x86.hash32(e))});const sp=Mn({name:"murmur3-128",code:34,encode:e=>ve(np.x64.hash128(e))});Mn({name:"murmur3-x64-64",code:34,encode:e=>ve(np.x64.hash128(e)).subarray(0,8)});const ip={chunker:"fixed",strategy:"balanced",rawLeaves:!1,onlyHash:!1,reduceSingleLeafToSelf:!0,hasher:As,leafType:"file",cidVersion:0,progress:()=>()=>{},shardSplitThreshold:1e3,fileImportConcurrency:50,blockWriteConcurrency:10,minChunkSize:262144,maxChunkSize:262144,avgChunkSize:262144,window:16,polynomial:0x3df305dfb2a804,maxChildrenPerNode:174,layerRepeat:4,wrapWithDirectory:!1,recursive:!1,hidden:!1,timeout:void 0,hamtHashFn:async function(e){return(await sp.encode(e)).slice(0,8).reverse()},hamtHashCode:34,hamtBucketBits:8},op=async(e,t,r)=>{r.codec||(r.codec=o),r.hasher||(r.hasher=As),void 0===r.cidVersion&&(r.cidVersion=1),r.codec===o&&r.hasher!==As&&(r.cidVersion=1);const n=await r.hasher.digest(e),s=kt.create(r.cidVersion,r.codec.code,n);return r.onlyHash||await t.put(s,e,{signal:r.signal}),s},ap=async(e,t,r)=>{const n=new ot({type:"directory",mtime:e.mtime,mode:e.mode}),s=ir(Xt({Data:n.marshal()}));return{cid:await op(s,t,r),path:e.path,unixfs:n,size:s.length}};async function cp(e,t,r){const n=[];for await(const s of tp(e,r.maxChildrenPerNode))n.push(await t(s));return n.length>1?cp(n,t,r):n[0]}class lp{constructor(e,t,r=0){this.maxDepth=e,this.layerRepeat=t,this.currentDepth=1,this.iteration=r,this.root=this.node=this.parent={children:[],depth:this.currentDepth,maxDepth:e,maxChildren:(this.maxDepth-this.currentDepth)*this.layerRepeat}}isFull(){if(!this.root.data)return!1;if(this.currentDepth<this.maxDepth&&this.node.maxChildren)return this._addNextNodeToParent(this.node),!1;const e=this._findParent(this.node,this.currentDepth);return!e||(this._addNextNodeToParent(e),!1)}_addNextNodeToParent(e){this.parent=e;const t={children:[],depth:e.depth+1,parent:e,maxDepth:this.maxDepth,maxChildren:Math.floor(e.children.length/this.layerRepeat)*this.layerRepeat};e.children.push(t),this.currentDepth=t.depth,this.node=t}append(e){this.node.data=e}reduce(e){return this._reduce(this.root,e)}async _reduce(e,t){let r=[];return e.children.length&&(r=await Promise.all(e.children.filter((e=>e.data)).map((e=>this._reduce(e,t))))),t((e.data||[]).concat(r))}_findParent(e,t){const r=e.parent;if(r&&0!==r.depth)return r.children.length!==r.maxChildren&&r.maxChildren?r:this._findParent(r,t)}}class hp extends lp{constructor(e){super(0,e),this.root.depth=0,this.currentDepth=1}addChild(e){this.root.children.push(e)}reduce(e){return e((this.root.data||[]).concat(this.root.children))}}const up=async function*(e,t,r){for await(let n of e.content)yield async()=>{let s;r.progress(n.length,e.path);const i={codec:o,cidVersion:r.cidVersion,hasher:r.hasher,onlyHash:r.onlyHash};return r.rawLeaves?(i.codec=b,i.cidVersion=1):(s=new ot({type:r.leafType,data:n}),n=ir({Data:s.marshal(),Links:[]})),{cid:await op(n,t,i),unixfs:s,size:n.length}}},dp={flat:async function(e,t){return t(await Hd(e))},balanced:function(e,t,r){return cp(e,t,r)},trickle:async function(e,t,r){const n=new hp(r.layerRepeat);let s=0,i=1,o=n;for await(const a of tp(e,r.maxChildrenPerNode))o.isFull()&&(o!==n&&n.addChild(await o.reduce(t)),s&&s%r.layerRepeat==0&&i++,o=new lp(i,r.layerRepeat,s),s++),o.append(a);return o&&o!==n&&n.addChild(await o.reduce(t)),n.reduce(t)}},pp=function(e,t,r){const n=dp[r.strategy];if(!n)throw qe(new Error(`Unknown importer build strategy name: ${r.strategy}`),"ERR_BAD_STRATEGY");return n(async function*(e,t,r){let n,s,i=-1;s="function"==typeof r.bufferImporter?r.bufferImporter:up;for await(const o of rp(s(e,t,r),r.blockWriteConcurrency))i++,0!==i?(1===i&&n&&(yield n,n=null),yield o):n=o;n&&(n.single=!0,yield n)}(e,t,r),((e,t,r)=>async function(n){if(1===n.length&&n[0].single&&r.reduceSingleLeafToSelf){const s=n[0];if(void 0!==e.mtime||void 0!==e.mode){let n=await t.get(s.cid);s.unixfs=new ot({type:"file",mtime:e.mtime,mode:e.mode,data:n}),n=ir(Xt({Data:s.unixfs.marshal()})),s.cid=await op(n,t,{...r,codec:o,hasher:r.hasher,cidVersion:r.cidVersion}),s.size=n.length}return{cid:s.cid,path:e.path,unixfs:s.unixfs,size:s.size}}const s=new ot({type:"file",mtime:e.mtime,mode:e.mode}),i=n.filter((e=>!(e.cid.code!==ks||!e.size)||!(!e.unixfs||e.unixfs.data||!e.unixfs.fileSize())||Boolean(e.unixfs&&e.unixfs.data&&e.unixfs.data.length))).map((e=>e.cid.code===ks?(s.addBlockSize(e.size),{Name:"",Tsize:e.size,Hash:e.cid}):(e.unixfs&&e.unixfs.data?s.addBlockSize(e.unixfs.data.length):s.addBlockSize(e.unixfs&&e.unixfs.fileSize()||0),{Name:"",Tsize:e.size,Hash:e.cid}))),a={Data:s.marshal(),Links:i},c=ir(Xt(a));return{cid:await op(c,t,r),path:e.path,unixfs:s,size:c.length+a.Links.reduce(((e,t)=>e+t.Tsize),0)}})(e,t,r),r)},fp=Symbol.for("@achingbrain/uint8arraylist");function yp(e,t){if(null==t||t<0)throw new RangeError("index is out of bounds");let r=0;for(const n of e){const e=r+n.byteLength;if(t<e)return{buf:n,index:t-r};r=e}throw new RangeError("index is out of bounds")}function gp(e){return Boolean(e?.[fp])}class mp{constructor(...e){Object.defineProperty(this,fp,{value:!0}),this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const r of e)if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.push(r);else{if(!gp(r))throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");t+=r.byteLength,this.bufs.push(...r.bufs)}this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const r of e.reverse())if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.unshift(r);else{if(!gp(r))throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");t+=r.byteLength,this.bufs.unshift(...r.bufs)}this.length+=t}get(e){const t=yp(this.bufs,e);return t.buf[t.index]}set(e,t){const r=yp(this.bufs,e);r.buf[r.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let r=0;r<e.length;r++)this.set(t+r,e[r]);else{if(!gp(e))throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList");for(let r=0;r<e.length;r++)this.set(t+r,e.get(r))}}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0))for(;this.bufs.length>0;){if(!(e>=this.bufs[0].byteLength)){this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift()}}slice(e,t){const{bufs:r,length:n}=this._subList(e,t);return di(r,n)}subarray(e,t){const{bufs:r,length:n}=this._subList(e,t);return 1===r.length?r[0]:di(r,n)}sublist(e,t){const{bufs:r,length:n}=this._subList(e,t),s=new mp;return s.length=n,s.bufs=r,s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(0===e&&t===this.length)return{bufs:[...this.bufs],length:this.length};const r=[];let n=0;for(let s=0;s<this.bufs.length;s++){const i=this.bufs[s],o=n,a=o+i.byteLength;if(n=a,e>=a)continue;const c=e>=o&&e<a,l=t>o&&t<=a;if(c&&l){if(e===o&&t===a){r.push(i);break}const n=e-o;r.push(i.subarray(n,n+(t-e)));break}if(c){if(0===e){r.push(i);continue}r.push(i.subarray(e-o))}else{if(l){if(t===a){r.push(i);break}r.push(i.subarray(0,t-o));break}r.push(i)}}return{bufs:r,length:t-e}}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const r=Ws(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt8(0,t),this.write(r,e)}getInt16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt16(0,t)}setInt16(e,t,r){const n=Gs(2);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt16(0,t,r),this.write(n,e)}getInt32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt32(0,t)}setInt32(e,t,r){const n=Gs(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt32(0,t,r),this.write(n,e)}getBigInt64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigInt64(0,t)}setBigInt64(e,t,r){const n=Gs(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setBigInt64(0,t,r),this.write(n,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const r=Ws(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint8(0,t),this.write(r,e)}getUint16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,t)}setUint16(e,t,r){const n=Gs(2);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint16(0,t,r),this.write(n,e)}getUint32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint32(0,t)}setUint32(e,t,r){const n=Gs(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,t,r),this.write(n,e)}getBigUint64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigUint64(0,t)}setBigUint64(e,t,r){const n=Gs(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setBigUint64(0,t,r),this.write(n,e)}getFloat32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat32(0,t)}setFloat32(e,t,r){const n=Gs(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setFloat32(0,t,r),this.write(n,e)}getFloat64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat64(0,t)}setFloat64(e,t,r){const n=Gs(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setFloat64(0,t,r),this.write(n,e)}equals(e){if(null==e)return!1;if(!(e instanceof mp))return!1;if(e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Ti(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const r=new mp;return r.bufs=e,null==t&&(t=e.reduce(((e,t)=>e+t.byteLength),0)),r.length=t,r}}var wp=r(28232);const bp=async function*(e,t){let r,n,s;if(t.minChunkSize&&t.maxChunkSize&&t.avgChunkSize)s=t.avgChunkSize,r=t.minChunkSize,n=t.maxChunkSize;else{if(!t.avgChunkSize)throw qe(new Error("please specify an average chunk size"),"ERR_INVALID_AVG_CHUNK_SIZE");s=t.avgChunkSize,r=s/3,n=s+s/2}if(r<16)throw qe(new Error("rabin min must be greater than 16"),"ERR_INVALID_MIN_CHUNK_SIZE");n<r&&(n=r),s<r&&(s=r);const i=Math.floor(Math.log2(s));for await(const s of async function*(e,t){const r=await(0,wp.create)(t.bits,t.min,t.max,t.window),n=new mp;for await(const t of e){n.append(t);const e=r.fingerprint(t);for(let t=0;t<e.length;t++){const r=e[t],s=n.slice(0,r);n.consume(r),yield s}}n.length&&(yield n.subarray(0))}(e,{min:r,max:n,bits:i,window:t.window,polynomial:t.polynomial}))yield s},vp=async function*(e,t){let r=new mp,n=0,s=!1;const i=t.maxChunkSize;for await(const t of e)for(r.append(t),n+=t.length;n>=i;)if(yield r.slice(0,i),s=!0,i===r.length)r=new mp,n=0;else{const e=new mp;e.append(r.sublist(i)),r=e,n-=i}s&&!n||(yield r.subarray(0,n))},Ep=async function*(e){for await(const t of e){if(void 0===t.length)throw qe(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if("string"==typeof t||t instanceof String)yield Xs(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else{if(!(t instanceof Uint8Array))throw qe(new Error("Content was invalid"),"ERR_INVALID_CONTENT");yield t}}};function _p(e){try{if(e instanceof Uint8Array)return async function*(){yield e}();if(t=e,Symbol.iterator in t)return async function*(){yield*e}();if(function(e){return Symbol.asyncIterator in e}(e))return e}catch{throw qe(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}var t;throw qe(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}const Sp=async function*(e,t,r){for await(const n of e)if(n.path&&("./"===n.path.substring(0,2)&&(r.wrapWithDirectory=!0),n.path=n.path.split("/").filter((e=>e&&"."!==e)).join("/")),n.content){let e,s;e="function"==typeof r.chunker?r.chunker:"rabin"===r.chunker?bp:vp,s="function"==typeof r.chunkValidator?r.chunkValidator:Ep;const i={path:n.path,mtime:n.mtime,mode:n.mode,content:e(s(_p(n.content),r),r)};yield()=>pp(i,t,r)}else{if(!n.path)throw new Error("Import candidate must have content or path or both");{const e={path:n.path,mtime:n.mtime,mode:n.mode};yield()=>ap(e,t,r)}}},Ap=class{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}},Ip=class extends Ap{constructor(e,t){super(e,t),this._children={}}async put(e,t){this.cid=void 0,this.size=void 0,this._children[e]=t}get(e){return Promise.resolve(this._children[e])}childCount(){return Object.keys(this._children).length}directChildrenCount(){return this.childCount()}onlyChild(){return this._children[Object.keys(this._children)[0]]}async*eachChildSeries(){const e=Object.keys(this._children);for(let t=0;t<e.length;t++){const r=e[t];yield{key:r,child:this._children[r]}}}async*flush(e){const t=Object.keys(this._children),r=[];for(let n=0;n<t.length;n++){let s=this._children[t[n]];if(s instanceof Ap)for await(const t of s.flush(e))s=t,yield s;null!=s.size&&s.cid&&r.push({Name:t[n],Tsize:s.size,Hash:s.cid})}const n=new ot({type:"directory",mtime:this.mtime,mode:this.mode}),s={Data:n.marshal(),Links:r},i=ir(Xt(s)),o=await op(i,e,this.options),a=i.length+s.Links.reduce(((e,t)=>e+(null==t.Tsize?0:t.Tsize)),0);this.cid=o,this.size=a,yield{cid:o,unixfs:n,path:this.path,size:a}}};var Rp=r(92891);class kp{constructor(e,t,r=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=r,this._children=new Rp,this.key=null}async put(e,t){const r=await this._findNewBucketAndPos(e);await r.bucket._putAt(r,e,t)}async get(e){const t=await this._findChild(e);if(null!=t)return t.value}async del(e){const t=await this._findPlace(e),r=t.bucket._at(t.pos);null!=r&&r.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce(((e,t)=>t instanceof kp?e+t.leafCount():e+1),0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const t of e)t instanceof kp?yield*t.eachLeafSeries():yield t}serialize(e,t){return t(this._children.reduce(((r,n,s)=>(null!=n&&(n instanceof kp?r.push(n.serialize(e,t)):r.push(e(n,s))),r)),[]))}async asyncTransform(e,t){return await Np(this,e,t)}toJSON(){return this.serialize(Cp,Pp)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const t=await this._findPlace(e),r=t.bucket._at(t.pos);if(!(r instanceof kp))return null!=r&&r.key===e?r:void 0}async _findPlace(e){const t=this._options.hash("string"==typeof e?Xs(e):e),r=await t.take(this._options.bits),n=this._children.get(r);return n instanceof kp?await n._findPlace(t):{bucket:this,pos:r,hash:t,existingChild:n}}async _findNewBucketAndPos(e){const t=await this._findPlace(e);if(null!=t.existingChild&&t.existingChild.key!==e){const e=new kp(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,e);const r=await e._findPlace(t.existingChild.hash);return r.bucket._putAt(r,t.existingChild.key,t.existingChild.value),await e._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,r){this._putObjectAt(e.pos,{key:t,value:r,hash:e.hash})}_putObjectAt(e,t){null==this._children.get(e)&&this._popCount++,this._children.set(e,t)}_delAt(e){if(-1===e)throw new Error("Invalid position");null!=this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(null!=this._parent&&this._popCount<=1)if(1===this._popCount){const e=this._children.find(Tp);if(null!=e&&!(e instanceof kp)){const t=e.hash;t.untake(this._options.bits);const r={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(r,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function Tp(e){return Boolean(e)}function Cp(e,t){return e.key}function Pp(e){return e}async function Np(e,t,r){const n=[];for(const s of e._children.compactArray())if(s instanceof kp)await Np(s,t,r);else{const r=await t(s);n.push({bitField:e._children.bitField(),children:r})}return await r(n)}const Dp=[255,254,252,248,240,224,192,128],Op=[1,3,7,15,31,63,127,255];class xp{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){const e=this._value[this._currentBytePos],n=this._currentBitPos+1,s=Math.min(n,t);r=(r<<s)+Lp(e,n-s,s),t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function Lp(e,t,r){const n=function(e,t){return Dp[e]&Op[Math.min(t+e-1,7)]}(t,r);return(e&n)>>>t}function Bp(e){return function(t){return t instanceof Mp?t:new Mp(t,e)}}class Mp{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t);r=(r<<n)+e.take(n),t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?di([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),r=new xp(t);this._buffers.push(r),this._availableBits+=r.availableBits()}}function Up(e){if(null==e||null==e.hashFn)throw new Error("please define an options.hashFn");const t={bits:e.bits??8,hash:Bp(e.hashFn)};return new kp(t)}const zp=class extends Ap{constructor(e,t){super(e,t),this._bucket=Up({hashFn:t.hamtHashFn,bits:t.hamtBucketBits})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){for await(const t of Vp(this._bucket,e,this,this.options))yield{...t,path:this.path}}};async function*Vp(e,t,r,n){const s=e._children,i=[];let o=0;for(let e=0;e<s.length;e++){const r=s.get(e);if(!r)continue;const a=e.toString(16).toUpperCase().padStart(2,"0");if(r instanceof kp){let e;for await(const s of await Vp(r,t,null,n))e=s;if(!e)throw new Error("Could not flush sharded directory, no subshard found");i.push({Name:a,Tsize:e.size,Hash:e.cid}),o+=e.size}else if("function"==typeof r.value.flush){const e=r.value;let n;for await(const r of e.flush(t))n=r,yield n;const s=a+r.key;i.push({Name:s,Tsize:n.size,Hash:n.cid}),o+=n.size}else{const e=r.value;if(!e.cid)continue;const t=a+r.key,n=e.size;i.push({Name:t,Tsize:n,Hash:e.cid}),o+=n}}const a=Uint8Array.from(s.bitField().reverse()),c=new ot({type:"hamt-sharded-directory",data:a,fanout:e.tableSize(),hashType:n.hamtHashCode,mtime:r&&r.mtime,mode:r&&r.mode}),l=ir(Xt({Data:c.marshal(),Links:i})),h=await op(l,t,n),u=l.length+o;yield{cid:h,unixfs:c,size:u}}const Fp=async function e(t,r,n,s){let i=r;r instanceof Ip&&r.directChildrenCount()>=n&&(i=await async function(e,t){const r=new zp({root:e.root,dir:!0,parent:e.parent,parentKey:e.parentKey,path:e.path,dirty:e.dirty,flat:!1,mtime:e.mtime,mode:e.mode},t);for await(const{key:t,child:n}of e.eachChildSeries())await r.put(t,n);return r}(r,s));const o=i.parent;if(o){if(i!==r){if(t&&(t.parent=i),!i.parentKey)throw new Error("No parent key found");await o.put(i.parentKey,i)}return e(i,o,n,s)}return i};async function jp(e,t,r){const n=((e="")=>(e.trim().match(/([^\\/]|\\\/)+/g)||[]).filter(Boolean))(e.path||""),s=n.length-1;let i=t,o="";for(let a=0;a<n.length;a++){const c=n[a];o+=`${o?"/":""}${c}`;const l=a===s;if(i.dirty=!0,i.cid=void 0,i.size=void 0,l)await i.put(c,e),t=await Fp(null,i,r.shardSplitThreshold,r);else{let e=await i.get(c);e&&e instanceof Ap||(e=new Ip({root:!1,dir:!0,parent:i,parentKey:c,path:o,dirty:!0,flat:!0,mtime:e&&e.unixfs&&e.unixfs.mtime,mode:e&&e.unixfs&&e.unixfs.mode},r)),await i.put(c,e),i=e}}return t}async function*Kp(e,t){e instanceof Ap?yield*e.flush(t):e&&e.unixfs&&e.unixfs.isDirectory()&&(yield e)}const $p=async function*(e,t,r){let n=new Ip({root:!0,dir:!0,path:"",dirty:!0,flat:!0},r);for await(const t of e)t&&(n=await jp(t,n,r),t.unixfs&&t.unixfs.isDirectory()||(yield t));if(r.wrapWithDirectory)yield*Kp(n,t);else for await(const e of n.eachChildSeries())e&&(yield*Kp(e.child,t))};async function*Hp(e,t,r={}){const n=((e={})=>ye.bind({ignoreUndefined:!0})(ip,e))(r);let s,i,o;s="function"==typeof r.dagBuilder?r.dagBuilder:Sp,i="function"==typeof r.treeBuilder?r.treeBuilder:$p,o=Symbol.asyncIterator in e||Symbol.iterator in e?e:[e];for await(const e of i(rp(s(o,t,n),n.fileImportConcurrency),t,n))yield{cid:e.cid,path:e.path,unixfs:e.unixfs,size:e.size}}async function*qp(e,t){if("string"==typeof e||e instanceof String||qd(e)||Gd(e)||e._readableState)throw qe(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(Yd(e)&&(e=Kd(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const r=$d(e),{value:n,done:s}=await r.peek();if(s)return void(yield*[]);if(r.push(n),Number.isInteger(n))throw qe(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(n._readableState)return void(yield*zd(r,(e=>Gp({content:e},t))));if(qd(n))return void(yield Gp({content:r},t));if(Wd(n)||n[Symbol.iterator]||n[Symbol.asyncIterator]||Yd(n)||Gd(n))return void(yield*zd(r,(e=>Gp(e,t))))}if(Wd(e))throw qe(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");throw qe(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}async function Gp(e,t){const{path:r,mode:n,mtime:s,content:i}=e,o={path:r||"",mode:st(n),mtime:it(s)};return i?o.content=await t(i):r||(o.content=await t(e)),o}const Wp=e=>{if(e){if(e.startsWith("size-")){const t=e.split("-")[1],r=parseInt(t);if(isNaN(r))throw new Error("Chunker parameter size must be an integer");return{chunker:"fixed",maxChunkSize:r}}if(e.startsWith("rabin"))return{chunker:"rabin",...Yp(e)};throw new Error(`Unrecognized chunker option: ${e}`)}return{chunker:"fixed"}},Yp=e=>{const t={},r=e.split("-");switch(r.length){case 1:t.avgChunkSize=262144;break;case 2:t.avgChunkSize=Zp(r[1],"avg");break;case 4:t.minChunkSize=Zp(r[1],"min"),t.avgChunkSize=Zp(r[2],"avg"),t.maxChunkSize=Zp(r[3],"max");break;default:throw new Error('Incorrect chunker format (expected "rabin" "rabin-[avg]" or "rabin-[min]-[avg]-[max]"')}return t},Zp=(e,t)=>{const r=parseInt(e);if(isNaN(r))throw new Error(`Chunker parameter ${t} must be an integer`);return r},Qp=ye.bind({ignoreUndefined:!0});const Jp=async function(e){return(await sp.encode(e)).slice(0,8).reverse()},Xp=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),ef=async(e,t,r,n,s)=>{if(!n){const e=Up({hashFn:Jp});n={rootBucket:e,hamtDepth:1,lastBucket:e}}await((e,t,r)=>Promise.all(e.map((e=>{if(null==e.Name)throw new Error("Unexpected Link without a Name");if(2===e.Name.length){const n=parseInt(e.Name,16);return t._putObjectAt(n,new kp({hash:r._options.hash,bits:r._options.bits},t,n))}return r.put(e.Name.substring(2),!0)}))))(e.Links,n.lastBucket,n.rootBucket);const i=await n.rootBucket._findNewBucketAndPos(t);let o=Xp(i.pos);const a=(e=>{let t=e.bucket;const r=[];for(;t._parent;)r.push(t),t=t._parent;return r.push(t),r.reverse()})(i);a.length>n.hamtDepth&&(n.lastBucket=a[n.hamtDepth],o=Xp(n.lastBucket._posAtParent));const c=e.Links.find((e=>{if(null==e.Name)return!1;const r=e.Name.substring(0,2),n=e.Name.substring(2);return r===o&&(!n||n===t)}));return c?null!=c.Name&&c.Name.substring(2)===t?c.Hash:(n.hamtDepth++,e=or(await r.get(c.Hash,s)),ef(e,t,r,n,s)):null},tf=ef,rf=function(e,t,r,n){const s=t+e.length;return r>=s||n<t?new Uint8Array(0):(n>=t&&n<s&&(e=e.subarray(0,n-t)),r>=t&&r<s&&(e=e.subarray(r-t)),e)},nf=(e,t,r)=>{if(t||(t=0),t<0)throw qe(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(t>e)throw qe(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(r||0===r||(r=e-t),r<0)throw qe(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");return t+r>e&&(r=e-t),{offset:t,length:r}};async function sf(e,t,r,n,s,i,o,a){if(t instanceof Uint8Array)return void r.push(rf(t,n,s,i));if(null==t.Data)throw qe(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=ot.unmarshal(t.Data)}catch(e){throw qe(e,"ERR_NOT_UNIXFS")}if(null!=c.data){const e=c.data,t=rf(e,n,s,i);r.push(t),n+=t.byteLength}const l=[];for(let e=0;e<t.Links.length;e++){const r=t.Links[e],o=n,a=o+c.blockSizes[e];if((s>=o&&s<a||i>=o&&i<=a||s<o&&i>a)&&l.push({link:r,blockStart:n}),(n=a)>i)break}await Xu(l,(t=>zd(t,(t=>async()=>{const r=await e.get(t.link.Hash,{signal:a.signal});return{...t,block:r}}))),(e=>Ud(e,{ordered:!0})),(async t=>{for await(const{link:n,block:c,blockStart:l}of t){let t;switch(n.Hash.code){case sr:t=or(c);break;case ks:t=c;break;default:return void r.end(qe(new Error(`Unsupported codec: ${n.Hash.code}`),"ERR_NOT_UNIXFS"))}o.add((async()=>{await sf(e,t,r,l,s,i,o,a)}))}}))}const of=(e,t,r,n,s,i,o)=>async function*(e={}){const n=r.fileSize();if(void 0===n)throw new Error("File was a directory");const{offset:s,length:i}=nf(n,e.offset,e.length);if(0===i)return;const a=new Ma({concurrency:1}),c=ju();a.add((async()=>{await sf(o,t,c,0,s,s+i,a,e)})),a.on("error",(e=>{c.end(e)}));let l=0;for await(const e of c)null!=e&&(l+=e.byteLength,l===i&&c.end(),yield e)};async function*af(e,t,r,n,s,i){const o=e.Links;for(const a of o){const o=null!=a.Name?a.Name.substring(2):null;if(o){const e=await r(a.Hash,o,`${t}/${o}`,[],n+1,s,i);yield e.entry}else{e=or(await s.get(a.Hash));for await(const o of af(e,t,r,n,s,i))yield o}}}const cf={raw:of,file:of,directory:(e,t,r,n,s,i,o)=>async function*(e={}){const r=e.offset||0,a=e.length||t.Links.length,c=t.Links.slice(r,a);for(const t of c){const r=await s(t.Hash,t.Name||"",`${n}/${t.Name||""}`,[],i+1,o,e);r.entry&&(yield r.entry)}},"hamt-sharded-directory":(e,t,r,n,s,i,o)=>function(e={}){return af(t,n,s,i,o,e)},metadata:(e,t,r,n,s,i,o)=>()=>[],symlink:(e,t,r,n,s,i,o)=>()=>[]},lf={[sr]:async(e,t,r,n,s,i,o,a)=>{const c=or(await o.get(e,a));let l,h;if(t||(t=e.toString()),null==c.Data)throw qe(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{l=ot.unmarshal(c.Data)}catch(e){throw qe(e,"ERR_NOT_UNIXFS")}if(r||(r=t),n.length){let e;if(e=l&&"hamt-sharded-directory"===l.type?await tf(c,n[0],o):((e,t)=>{const r=e.Links.find((e=>e.Name===t));return r&&r.Hash})(c,n[0]),!e)throw qe(new Error("file does not exist"),"ERR_NOT_FOUND");const t=n.shift();h={cid:e,toResolve:n,name:t||"",path:`${r}/${t}`}}return{entry:{type:l.isDirectory()?"directory":"file",name:t,path:r,cid:e,content:cf[l.type](e,c,l,r,s,i,o),unixfs:l,depth:i,node:c,size:l.fileSize()},next:h}},[ks]:async(e,t,r,n,s,i,o,a)=>{if(n.length)throw qe(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");const c=await o.get(e,a);return{entry:{type:"raw",name:t,path:r,cid:e,content:(l=c,async function*(e={}){const{offset:t,length:r}=nf(l.length,e.offset,e.length);yield rf(l,0,t,t+r)}),depth:i,size:c.length,node:c}};var l},[xn]:async(e,t,r,n,s,i,o,a)=>{const c=await o.get(e),l=Bn(c);let h=l,u=r;for(;n.length;){const s=n[0];if(!(s in h))throw qe(new Error(`No property named ${s} found in cbor node ${e}`),"ERR_NO_PROP");{n.shift(),u=`${u}/${s}`;const o=kt.asCID(h[s]);if(o)return{entry:{type:"object",name:t,path:r,cid:e,node:c,depth:i,size:c.length,content:async function*(){yield l}},next:{cid:o,name:s,path:u,toResolve:n}};h=h[s]}}return{entry:{type:"object",name:t,path:r,cid:e,node:c,depth:i,size:c.length,content:async function*(){yield l}}}},[hs.code]:async(e,t,r,n,s,i,o,a)=>{if(n.length)throw qe(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");const c=await St(e.multihash.bytes);return{entry:{type:"identity",name:t,path:r,cid:e,content:(l=c.digest,async function*(e={}){const{offset:t,length:r}=nf(l.length,e.offset,e.length);yield rf(l,0,t,t+r)}),depth:i,size:c.digest.length,node:c.digest}};var l}},hf=function e(t,r,n,s,i,o,a){const c=lf[t.code];if(!c)throw qe(new Error(`No resolver for code ${t.code}`),"ERR_NO_RESOLVER");return c(t,r,n,s,e,i,o,a)};async function*uf(e,t,r={}){let{cid:n,toResolve:s}=(e=>{if(e instanceof Uint8Array)return{cid:kt.decode(e),toResolve:[]};const t=kt.asCID(e);if(t)return{cid:t,toResolve:[]};if("string"==typeof e){0===e.indexOf("/ipfs/")&&(e=e.substring(6));const t=((e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean))(e);return{cid:kt.parse(t[0]),toResolve:t.slice(1)}}throw qe(new Error(`Unknown path type ${e}`),"ERR_BAD_PATH")})(e),i=n.toString(),o=i;const a=s.length;for(;;){const c=await hf(n,i,o,s,a,t,r);if(!c.entry&&!c.next)throw qe(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");if(c.entry&&(yield c.entry),!c.next)return;s=c.next.toResolve,n=c.next.cid,i=c.next.name,o=c.next.path}}async function df(e,t,r={}){const n=await Xa(uf(e,t,r));if(!n)throw qe(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");return n}async function*pf(e,t,r={}){const n=await df(e,t,r);if(n&&(yield n,"directory"===n.type))for await(const e of async function*e(t,r){for await(const n of t.content(r))yield n,n instanceof Uint8Array||"directory"===n.type&&(yield*e(n,r))}(n,r))yield e}"0".charCodeAt(0),Xs("ustar\0","binary"),Xs("ustar ","binary"),Xs(" \0","binary");var ff=r(78814);async function yf(e){let t=new Uint8Array(0);for await(const r of e)t=di([t,r],t.length+r.length);return t}const gf="0".charCodeAt(0),mf=Xs("ustar\0","binary"),wf=Xs("00","binary"),bf=parseInt("7777",8),vf=function(e,t){const r=e.toString(8);return r.length>t?Xs("7777777777777777777".slice(0,t)+" "):Xs("0000000000000000000".slice(0,t-r.length)+r+" ")},Ef=function(e){const t=Xs(e).byteLength;let r=Math.floor(Math.log(t)/Math.log(10))+1;return t+r>=Math.pow(10,r)&&r++,`${t+r}${e}`};function _f(e){const t=new Uint8Array(512);let r=e.name,n="";if(5===e.typeflag&&"/"!==r[r.length-1]&&(r+="/"),Xs(r).byteLength!==r.length)return null;for(;Xs(r).byteLength>100;){const e=r.indexOf("/");if(-1===e)return null;n+=""!==n?"/"+r.slice(0,e):r.slice(0,e),r=r.slice(e+1)}return Xs(r).byteLength>100||Xs(n).byteLength>155||null!=e.linkname&&Xs(e.linkname).byteLength>100?null:(t.set(Xs(r),0),t.set(vf(e.mode&bf,6),100),t.set(vf(e.uid,6),108),t.set(vf(e.gid,6),116),t.set(vf(e.size,11),124),t.set(vf(e.mtime.getTime()/1e3|0,11),136),t[156]=gf+function(e){switch(e){case"file":default:return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72}}(e.type),null!=e.linkname&&t.set(Xs(e.linkname),157),t.set(mf,257),t.set(wf,263),null!=e.uname&&t.set(Xs(e.uname),265),null!=e.gname&&t.set(Xs(e.gname),297),t.set(vf(e.devmajor??0,6),329),t.set(vf(e.devminor??0,6),337),null!=n&&t.set(Xs(n),345),t.set(vf(function(e){let t=256;for(let r=0;r<148;r++)t+=e[r];for(let r=156;r<512;r++)t+=e[r];return t}(t),6),148),t)}const{S_IFMT:Sf,S_IFBLK:Af,S_IFCHR:If,S_IFDIR:Rf,S_IFIFO:kf,S_IFLNK:Tf}=ff,Cf=parseInt("755",8),Pf=parseInt("644",8),Nf=new Uint8Array(1024);function Df(e=0){switch(e&Sf){case Af:return"block-device";case If:return"character-device";case Rf:return"directory";case kf:return"fifo";case Tf:return"symlink";default:return"file"}}function Of(e){return 0!=(e&=511)?Nf.subarray(0,512-e):new Uint8Array(0)}function xf(e){if(null==e.pax){const t=_f(e);if(null!=t)return t}return function(e){const t=function(e){let t="";null!=e.name&&(t+=Ef(" path="+e.name+"\n")),null!=e.linkname&&(t+=Ef(" linkpath="+e.linkname+"\n"));const r=e.pax;if(null!=r)for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t+=Ef(" "+e+"="+r[e]+"\n"));return Xs(t)}(e),r={name:"PaxHeader",mode:e.mode,uid:e.uid,gid:e.gid,size:t.length,mtime:e.mtime,type:"pax-header",linkname:e.linkname,uname:e.uname,gname:e.gname,devmajor:e.devmajor,devminor:e.devminor};return new mp(_f(r)??new Uint8Array(0),t,Of(t.length),_f({...r,size:e.size,type:e.type})??new Uint8Array(0)).subarray()}(e)}function Lf(){return async function*(e){for await(let{header:t,body:r}of e){const e={...t,size:"symlink"===t.type?0:t.size??0,type:t.type??Df(t.mode),mode:t.mode??("directory"===t.type?Cf:Pf),uid:t.uid??0,gid:t.gid??0,mtime:t.mtime??new Date};if("string"==typeof r&&(r=Xs(r)),r instanceof Uint8Array||gp(r)){e.size=r.length,yield xf(e),yield gp(r)?r.subarray():r,yield Of(e.size);continue}if("symlink"===e.type&&null==e.linkname){if(null==r)throw new Error("type was symlink but no linkname or body specified");e.linkname=ni(await yf(r)),yield xf(e);continue}if(yield xf(e),"file"!==e.type&&"contiguous-file"!==e.type)continue;let n=0;for await(const e of r??[])n+=e.length,yield gp(e)?e.subarray():e;if(n!==e.size)throw new Error(`size mismatch, wrote ${n} of ${e.size} bytes`);yield Of(e.size)}yield Nf}}function Bf(e){let t=e.length;for(;--t>=0;)e[t]=0}const Mf=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Uf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),zf=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Vf=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ff=new Array(576);Bf(Ff);const jf=new Array(60);Bf(jf);const Kf=new Array(512);Bf(Kf);const $f=new Array(256);Bf($f);const Hf=new Array(29);Bf(Hf);const qf=new Array(30);function Gf(e,t,r,n,s){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=s,this.has_stree=e&&e.length}let Wf,Yf,Zf;function Qf(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Bf(qf);const Jf=e=>e<256?Kf[e]:Kf[256+(e>>>7)],Xf=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ey=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,Xf(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},ty=(e,t,r)=>{ey(e,r[2*t],r[2*t+1])},ry=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},ny=(e,t,r)=>{const n=new Array(16);let s,i,o=0;for(s=1;s<=15;s++)o=o+r[s-1]<<1,n[s]=o;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=ry(n[t]++,t))}},sy=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},iy=e=>{e.bi_valid>8?Xf(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},oy=(e,t,r,n)=>{const s=2*t,i=2*r;return e[s]<e[i]||e[s]===e[i]&&n[t]<=n[r]},ay=(e,t,r)=>{const n=e.heap[r];let s=r<<1;for(;s<=e.heap_len&&(s<e.heap_len&&oy(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!oy(t,n,e.heap[s],e.depth));)e.heap[r]=e.heap[s],r=s,s<<=1;e.heap[r]=n},cy=(e,t,r)=>{let n,s,i,o,a=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+a++],n+=(255&e.pending_buf[e.sym_buf+a++])<<8,s=e.pending_buf[e.sym_buf+a++],0===n?ty(e,s,t):(i=$f[s],ty(e,i+256+1,t),o=Mf[i],0!==o&&(s-=Hf[i],ey(e,s,o)),n--,i=Jf(n),ty(e,i,r),o=Uf[i],0!==o&&(n-=qf[i],ey(e,n,o)))}while(a<e.sym_next);ty(e,256,t)},ly=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,s=t.stat_desc.has_stree,i=t.stat_desc.elems;let o,a,c,l=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<i;o++)0!==r[2*o]?(e.heap[++e.heap_len]=l=o,e.depth[o]=0):r[2*o+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,r[2*c]=1,e.depth[c]=0,e.opt_len--,s&&(e.static_len-=n[2*c+1]);for(t.max_code=l,o=e.heap_len>>1;o>=1;o--)ay(e,r,o);c=i;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ay(e,r,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,r[2*c]=r[2*o]+r[2*a],e.depth[c]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,r[2*o+1]=r[2*a+1]=c,e.heap[1]=c++,ay(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,n=t.max_code,s=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,h,u,d,p,f,y=0;for(d=0;d<=15;d++)e.bl_count[d]=0;for(r[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)h=e.heap[l],d=r[2*r[2*h+1]+1]+1,d>c&&(d=c,y++),r[2*h+1]=d,h>n||(e.bl_count[d]++,p=0,h>=a&&(p=o[h-a]),f=r[2*h],e.opt_len+=f*(d+p),i&&(e.static_len+=f*(s[2*h+1]+p)));if(0!==y){do{for(d=c-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[c]--,y-=2}while(y>0);for(d=c;0!==d;d--)for(h=e.bl_count[d];0!==h;)u=e.heap[--l],u>n||(r[2*u+1]!==d&&(e.opt_len+=(d-r[2*u+1])*r[2*u],r[2*u+1]=d),h--)}})(e,t),ny(r,l,e.bl_count)},hy=(e,t,r)=>{let n,s,i=-1,o=t[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)s=o,o=t[2*(n+1)+1],++a<c&&s===o||(a<l?e.bl_tree[2*s]+=a:0!==s?(s!==i&&e.bl_tree[2*s]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,i=s,0===o?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4))},uy=(e,t,r)=>{let n,s,i=-1,o=t[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),n=0;n<=r;n++)if(s=o,o=t[2*(n+1)+1],!(++a<c&&s===o)){if(a<l)do{ty(e,s,e.bl_tree)}while(0!=--a);else 0!==s?(s!==i&&(ty(e,s,e.bl_tree),a--),ty(e,16,e.bl_tree),ey(e,a-3,2)):a<=10?(ty(e,17,e.bl_tree),ey(e,a-3,3)):(ty(e,18,e.bl_tree),ey(e,a-11,7));a=0,i=s,0===o?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4)}};let dy=!1;const py=(e,t,r,n)=>{ey(e,0+(n?1:0),3),iy(e),Xf(e,r),Xf(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var fy={_tr_init:e=>{dy||((()=>{let e,t,r,n,s;const i=new Array(16);for(r=0,n=0;n<28;n++)for(Hf[n]=r,e=0;e<1<<Mf[n];e++)$f[r++]=n;for($f[r-1]=n,s=0,n=0;n<16;n++)for(qf[n]=s,e=0;e<1<<Uf[n];e++)Kf[s++]=n;for(s>>=7;n<30;n++)for(qf[n]=s<<7,e=0;e<1<<Uf[n]-7;e++)Kf[256+s++]=n;for(t=0;t<=15;t++)i[t]=0;for(e=0;e<=143;)Ff[2*e+1]=8,e++,i[8]++;for(;e<=255;)Ff[2*e+1]=9,e++,i[9]++;for(;e<=279;)Ff[2*e+1]=7,e++,i[7]++;for(;e<=287;)Ff[2*e+1]=8,e++,i[8]++;for(ny(Ff,287,i),e=0;e<30;e++)jf[2*e+1]=5,jf[2*e]=ry(e,5);Wf=new Gf(Ff,Mf,257,286,15),Yf=new Gf(jf,Uf,0,30,15),Zf=new Gf(new Array(0),zf,0,19,7)})(),dy=!0),e.l_desc=new Qf(e.dyn_ltree,Wf),e.d_desc=new Qf(e.dyn_dtree,Yf),e.bl_desc=new Qf(e.bl_tree,Zf),e.bi_buf=0,e.bi_valid=0,sy(e)},_tr_stored_block:py,_tr_flush_block:(e,t,r,n)=>{let s,i,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),ly(e,e.l_desc),ly(e,e.d_desc),o=(e=>{let t;for(hy(e,e.dyn_ltree,e.l_desc.max_code),hy(e,e.dyn_dtree,e.d_desc.max_code),ly(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Vf[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=s&&(s=i)):s=i=r+5,r+4<=s&&-1!==t?py(e,t,r,n):4===e.strategy||i===s?(ey(e,2+(n?1:0),3),cy(e,Ff,jf)):(ey(e,4+(n?1:0),3),((e,t,r,n)=>{let s;for(ey(e,t-257,5),ey(e,r-1,5),ey(e,n-4,4),s=0;s<n;s++)ey(e,e.bl_tree[2*Vf[s]+1],3);uy(e,e.dyn_ltree,t-1),uy(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),cy(e,e.dyn_ltree,e.dyn_dtree)),sy(e),n&&iy(e)},_tr_tally:(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*($f[r]+256+1)]++,e.dyn_dtree[2*Jf(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{ey(e,2,3),ty(e,256,Ff),(e=>{16===e.bi_valid?(Xf(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},yy=(e,t,r,n)=>{let s=65535&e|0,i=e>>>16&65535|0,o=0;for(;0!==r;){o=r>2e3?2e3:r,r-=o;do{s=s+t[n++]|0,i=i+s|0}while(--o);s%=65521,i%=65521}return s|i<<16|0};const gy=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var my=(e,t,r,n)=>{const s=gy,i=n+r;e^=-1;for(let r=n;r<i;r++)e=e>>>8^s[255&(e^t[r])];return-1^e},wy={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},by={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:vy,_tr_stored_block:Ey,_tr_flush_block:_y,_tr_tally:Sy,_tr_align:Ay}=fy,{Z_NO_FLUSH:Iy,Z_PARTIAL_FLUSH:Ry,Z_FULL_FLUSH:ky,Z_FINISH:Ty,Z_BLOCK:Cy,Z_OK:Py,Z_STREAM_END:Ny,Z_STREAM_ERROR:Dy,Z_DATA_ERROR:Oy,Z_BUF_ERROR:xy,Z_DEFAULT_COMPRESSION:Ly,Z_FILTERED:By,Z_HUFFMAN_ONLY:My,Z_RLE:Uy,Z_FIXED:zy,Z_DEFAULT_STRATEGY:Vy,Z_UNKNOWN:Fy,Z_DEFLATED:jy}=by,Ky=258,$y=262,Hy=42,qy=113,Gy=666,Wy=(e,t)=>(e.msg=wy[t],t),Yy=e=>2*e-(e>4?9:0),Zy=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Qy=e=>{let t,r,n,s=e.w_size;t=e.hash_size,n=t;do{r=e.head[--n],e.head[n]=r>=s?r-s:0}while(--t);t=s,n=t;do{r=e.prev[--n],e.prev[n]=r>=s?r-s:0}while(--t)};let Jy=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const Xy=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},eg=(e,t)=>{_y(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Xy(e.strm)},tg=(e,t)=>{e.pending_buf[e.pending++]=t},rg=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},ng=(e,t,r,n)=>{let s=e.avail_in;return s>n&&(s=n),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),r),1===e.state.wrap?e.adler=yy(e.adler,t,s,r):2===e.state.wrap&&(e.adler=my(e.adler,t,s,r)),e.next_in+=s,e.total_in+=s,s)},sg=(e,t)=>{let r,n,s=e.max_chain_length,i=e.strstart,o=e.prev_length,a=e.nice_match;const c=e.strstart>e.w_size-$y?e.strstart-(e.w_size-$y):0,l=e.window,h=e.w_mask,u=e.prev,d=e.strstart+Ky;let p=l[i+o-1],f=l[i+o];e.prev_length>=e.good_match&&(s>>=2),a>e.lookahead&&(a=e.lookahead);do{if(r=t,l[r+o]===f&&l[r+o-1]===p&&l[r]===l[i]&&l[++r]===l[i+1]){i+=2,r++;do{}while(l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&i<d);if(n=Ky-(d-i),i=d-Ky,n>o){if(e.match_start=t,o=n,n>=a)break;p=l[i+o-1],f=l[i+o]}}}while((t=u[t&h])>c&&0!=--s);return o<=e.lookahead?o:e.lookahead},ig=e=>{const t=e.w_size;let r,n,s;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-$y)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Qy(e),n+=t),0===e.strm.avail_in)break;if(r=ng(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=Jy(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=Jy(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<$y&&0!==e.strm.avail_in)},og=(e,t)=>{let r,n,s,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,a=e.strm.avail_in;do{if(r=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,n=e.strstart-e.block_start,r>n+e.strm.avail_in&&(r=n+e.strm.avail_in),r>s&&(r=s),r<i&&(0===r&&t!==Ty||t===Iy||r!==n+e.strm.avail_in))break;o=t===Ty&&r===n+e.strm.avail_in?1:0,Ey(e,0,0,o),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,Xy(e.strm),n&&(n>r&&(n=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,r-=n),r&&(ng(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===o);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Iy&&t!==Ty&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(ng(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,i=s>e.w_size?e.w_size:s,n=e.strstart-e.block_start,(n>=i||(n||t===Ty)&&t!==Iy&&0===e.strm.avail_in&&n<=s)&&(r=n>s?s:n,o=t===Ty&&0===e.strm.avail_in&&r===n?1:0,Ey(e,e.block_start,r,o),e.block_start+=r,Xy(e.strm)),o?3:1)},ag=(e,t)=>{let r,n;for(;;){if(e.lookahead<$y){if(ig(e),e.lookahead<$y&&t===Iy)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=Jy(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-$y&&(e.match_length=sg(e,r)),e.match_length>=3)if(n=Sy(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Jy(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Jy(e,e.ins_h,e.window[e.strstart+1]);else n=Sy(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(eg(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Ty?(eg(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(eg(e,!1),0===e.strm.avail_out)?1:2},cg=(e,t)=>{let r,n,s;for(;;){if(e.lookahead<$y){if(ig(e),e.lookahead<$y&&t===Iy)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=Jy(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-$y&&(e.match_length=sg(e,r),e.match_length<=5&&(e.strategy===By||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,n=Sy(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=Jy(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(eg(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=Sy(e,0,e.window[e.strstart-1]),n&&eg(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Sy(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Ty?(eg(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(eg(e,!1),0===e.strm.avail_out)?1:2};function lg(e,t,r,n,s){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=s}const hg=[new lg(0,0,0,0,og),new lg(4,4,8,4,ag),new lg(4,5,16,8,ag),new lg(4,6,32,32,ag),new lg(4,4,16,16,cg),new lg(8,16,32,32,cg),new lg(8,16,128,128,cg),new lg(8,32,128,256,cg),new lg(32,128,258,1024,cg),new lg(32,258,258,4096,cg)];function ug(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=jy,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Zy(this.dyn_ltree),Zy(this.dyn_dtree),Zy(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Zy(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Zy(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const dg=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Hy&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==qy&&t.status!==Gy?1:0},pg=e=>{if(dg(e))return Wy(e,Dy);e.total_in=e.total_out=0,e.data_type=Fy;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Hy:qy,e.adler=2===t.wrap?0:1,t.last_flush=-2,vy(t),Py},fg=e=>{const t=pg(e);var r;return t===Py&&((r=e.state).window_size=2*r.w_size,Zy(r.head),r.max_lazy_match=hg[r.level].max_lazy,r.good_match=hg[r.level].good_length,r.nice_match=hg[r.level].nice_length,r.max_chain_length=hg[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),t},yg=(e,t,r,n,s,i)=>{if(!e)return Dy;let o=1;if(t===Ly&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),s<1||s>9||r!==jy||n<8||n>15||t<0||t>9||i<0||i>zy||8===n&&1!==o)return Wy(e,Dy);8===n&&(n=9);const a=new ug;return e.state=a,a.strm=e,a.status=Hy,a.wrap=o,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=i,a.method=r,fg(e)};var gg=yg,mg=(e,t)=>dg(e)||2!==e.state.wrap?Dy:(e.state.gzhead=t,Py),wg=(e,t)=>{if(dg(e)||t>Cy||t<0)return e?Wy(e,Dy):Dy;const r=e.state;if(!e.output||0!==e.avail_in&&!e.input||r.status===Gy&&t!==Ty)return Wy(e,0===e.avail_out?xy:Dy);const n=r.last_flush;if(r.last_flush=t,0!==r.pending){if(Xy(e),0===e.avail_out)return r.last_flush=-1,Py}else if(0===e.avail_in&&Yy(t)<=Yy(n)&&t!==Ty)return Wy(e,xy);if(r.status===Gy&&0!==e.avail_in)return Wy(e,xy);if(r.status===Hy&&0===r.wrap&&(r.status=qy),r.status===Hy){let t=jy+(r.w_bits-8<<4)<<8,n=-1;if(n=r.strategy>=My||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=n<<6,0!==r.strstart&&(t|=32),t+=31-t%31,rg(r,t),0!==r.strstart&&(rg(r,e.adler>>>16),rg(r,65535&e.adler)),e.adler=1,r.status=qy,Xy(e),0!==r.pending)return r.last_flush=-1,Py}if(57===r.status)if(e.adler=0,tg(r,31),tg(r,139),tg(r,8),r.gzhead)tg(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),tg(r,255&r.gzhead.time),tg(r,r.gzhead.time>>8&255),tg(r,r.gzhead.time>>16&255),tg(r,r.gzhead.time>>24&255),tg(r,9===r.level?2:r.strategy>=My||r.level<2?4:0),tg(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(tg(r,255&r.gzhead.extra.length),tg(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=my(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(tg(r,0),tg(r,0),tg(r,0),tg(r,0),tg(r,0),tg(r,9===r.level?2:r.strategy>=My||r.level<2?4:0),tg(r,3),r.status=qy,Xy(e),0!==r.pending)return r.last_flush=-1,Py;if(69===r.status){if(r.gzhead.extra){let t=r.pending,n=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+n>r.pending_buf_size;){let s=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=my(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=s,Xy(e),0!==r.pending)return r.last_flush=-1,Py;t=0,n-=s}let s=new Uint8Array(r.gzhead.extra);r.pending_buf.set(s.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending+=n,r.gzhead.hcrc&&r.pending>t&&(e.adler=my(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let t,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(e.adler=my(e.adler,r.pending_buf,r.pending-n,n)),Xy(e),0!==r.pending)return r.last_flush=-1,Py;n=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,tg(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>n&&(e.adler=my(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let t,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(e.adler=my(e.adler,r.pending_buf,r.pending-n,n)),Xy(e),0!==r.pending)return r.last_flush=-1,Py;n=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,tg(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>n&&(e.adler=my(e.adler,r.pending_buf,r.pending-n,n))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Xy(e),0!==r.pending))return r.last_flush=-1,Py;tg(r,255&e.adler),tg(r,e.adler>>8&255),e.adler=0}if(r.status=qy,Xy(e),0!==r.pending)return r.last_flush=-1,Py}if(0!==e.avail_in||0!==r.lookahead||t!==Iy&&r.status!==Gy){let n=0===r.level?og(r,t):r.strategy===My?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(ig(e),0===e.lookahead)){if(t===Iy)return 1;break}if(e.match_length=0,r=Sy(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(eg(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ty?(eg(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(eg(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===Uy?((e,t)=>{let r,n,s,i;const o=e.window;for(;;){if(e.lookahead<=Ky){if(ig(e),e.lookahead<=Ky&&t===Iy)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,n=o[s],n===o[++s]&&n===o[++s]&&n===o[++s])){i=e.strstart+Ky;do{}while(n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&s<i);e.match_length=Ky-(i-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=Sy(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Sy(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(eg(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ty?(eg(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(eg(e,!1),0===e.strm.avail_out)?1:2})(r,t):hg[r.level].func(r,t);if(3!==n&&4!==n||(r.status=Gy),1===n||3===n)return 0===e.avail_out&&(r.last_flush=-1),Py;if(2===n&&(t===Ry?Ay(r):t!==Cy&&(Ey(r,0,0,!1),t===ky&&(Zy(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Xy(e),0===e.avail_out))return r.last_flush=-1,Py}return t!==Ty?Py:r.wrap<=0?Ny:(2===r.wrap?(tg(r,255&e.adler),tg(r,e.adler>>8&255),tg(r,e.adler>>16&255),tg(r,e.adler>>24&255),tg(r,255&e.total_in),tg(r,e.total_in>>8&255),tg(r,e.total_in>>16&255),tg(r,e.total_in>>24&255)):(rg(r,e.adler>>>16),rg(r,65535&e.adler)),Xy(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Py:Ny)},bg=e=>{if(dg(e))return Dy;const t=e.state.status;return e.state=null,t===qy?Wy(e,Oy):Py},vg=(e,t)=>{let r=t.length;if(dg(e))return Dy;const n=e.state,s=n.wrap;if(2===s||1===s&&n.status!==Hy||n.lookahead)return Dy;if(1===s&&(e.adler=yy(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){0===s&&(Zy(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(r-n.w_size,r),0),t=e,r=n.w_size}const i=e.avail_in,o=e.next_in,a=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,ig(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=Jy(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,ig(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=o,e.input=a,e.avail_in=i,n.wrap=s,Py};const Eg=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var _g=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)Eg(r,t)&&(e[t]=r[t])}}return e},Sg=e=>{let t=0;for(let r=0,n=e.length;r<n;r++)t+=e[r].length;const r=new Uint8Array(t);for(let t=0,n=0,s=e.length;t<s;t++){let s=e[t];r.set(s,n),n+=s.length}return r};let Ag=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Ag=!1}const Ig=new Uint8Array(256);for(let e=0;e<256;e++)Ig[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Ig[254]=Ig[254]=1;var Rg=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,n,s,i,o=e.length,a=0;for(s=0;s<o;s++)r=e.charCodeAt(s),55296==(64512&r)&&s+1<o&&(n=e.charCodeAt(s+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),s++)),a+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(a),i=0,s=0;i<a;s++)r=e.charCodeAt(s),55296==(64512&r)&&s+1<o&&(n=e.charCodeAt(s+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),s++)),r<128?t[i++]=r:r<2048?(t[i++]=192|r>>>6,t[i++]=128|63&r):r<65536?(t[i++]=224|r>>>12,t[i++]=128|r>>>6&63,t[i++]=128|63&r):(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63,t[i++]=128|r>>>6&63,t[i++]=128|63&r);return t},kg=(e,t)=>{const r=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,s;const i=new Array(2*r);for(s=0,n=0;n<r;){let t=e[n++];if(t<128){i[s++]=t;continue}let o=Ig[t];if(o>4)i[s++]=65533,n+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&n<r;)t=t<<6|63&e[n++],o--;o>1?i[s++]=65533:t<65536?i[s++]=t:(t-=65536,i[s++]=55296|t>>10&1023,i[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Ag)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r})(i,s)},Tg=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+Ig[e[r]]>t?r:t},Cg=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Pg=Object.prototype.toString,{Z_NO_FLUSH:Ng,Z_SYNC_FLUSH:Dg,Z_FULL_FLUSH:Og,Z_FINISH:xg,Z_OK:Lg,Z_STREAM_END:Bg,Z_DEFAULT_COMPRESSION:Mg,Z_DEFAULT_STRATEGY:Ug,Z_DEFLATED:zg}=by;function Vg(e){this.options=_g({level:Mg,method:zg,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ug},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Cg,this.strm.avail_out=0;let r=gg(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Lg)throw new Error(wy[r]);if(t.header&&mg(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Rg(t.dictionary):"[object ArrayBuffer]"===Pg.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=vg(this.strm,e),r!==Lg)throw new Error(wy[r]);this._dict_set=!0}}function Fg(e,t){const r=new Vg(t);if(r.push(e,!0),r.err)throw r.msg||wy[r.err];return r.result}Vg.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let s,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?xg:Ng,"string"==typeof e?r.input=Rg(e):"[object ArrayBuffer]"===Pg.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(i===Dg||i===Og)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(s=wg(r,i),s===Bg)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),s=bg(this.strm),this.onEnd(s),this.ended=!0,s===Lg;if(0!==r.avail_out){if(i>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Vg.prototype.onData=function(e){this.chunks.push(e)},Vg.prototype.onEnd=function(e){e===Lg&&(this.result=Sg(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var jg={Deflate:Vg,deflate:Fg,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Fg(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Fg(e,t)},constants:by};const Kg=16209;var $g=function(e,t){let r,n,s,i,o,a,c,l,h,u,d,p,f,y,g,m,w,b,v,E,_,S,A,I;const R=e.state;r=e.next_in,A=e.input,n=r+(e.avail_in-5),s=e.next_out,I=e.output,i=s-(t-e.avail_out),o=s+(e.avail_out-257),a=R.dmax,c=R.wsize,l=R.whave,h=R.wnext,u=R.window,d=R.hold,p=R.bits,f=R.lencode,y=R.distcode,g=(1<<R.lenbits)-1,m=(1<<R.distbits)-1;e:do{p<15&&(d+=A[r++]<<p,p+=8,d+=A[r++]<<p,p+=8),w=f[d&g];t:for(;;){if(b=w>>>24,d>>>=b,p-=b,b=w>>>16&255,0===b)I[s++]=65535&w;else{if(!(16&b)){if(0==(64&b)){w=f[(65535&w)+(d&(1<<b)-1)];continue t}if(32&b){R.mode=16191;break e}e.msg="invalid literal/length code",R.mode=Kg;break e}v=65535&w,b&=15,b&&(p<b&&(d+=A[r++]<<p,p+=8),v+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=A[r++]<<p,p+=8,d+=A[r++]<<p,p+=8),w=y[d&m];r:for(;;){if(b=w>>>24,d>>>=b,p-=b,b=w>>>16&255,!(16&b)){if(0==(64&b)){w=y[(65535&w)+(d&(1<<b)-1)];continue r}e.msg="invalid distance code",R.mode=Kg;break e}if(E=65535&w,b&=15,p<b&&(d+=A[r++]<<p,p+=8,p<b&&(d+=A[r++]<<p,p+=8)),E+=d&(1<<b)-1,E>a){e.msg="invalid distance too far back",R.mode=Kg;break e}if(d>>>=b,p-=b,b=s-i,E>b){if(b=E-b,b>l&&R.sane){e.msg="invalid distance too far back",R.mode=Kg;break e}if(_=0,S=u,0===h){if(_+=c-b,b<v){v-=b;do{I[s++]=u[_++]}while(--b);_=s-E,S=I}}else if(h<b){if(_+=c+h-b,b-=h,b<v){v-=b;do{I[s++]=u[_++]}while(--b);if(_=0,h<v){b=h,v-=b;do{I[s++]=u[_++]}while(--b);_=s-E,S=I}}}else if(_+=h-b,b<v){v-=b;do{I[s++]=u[_++]}while(--b);_=s-E,S=I}for(;v>2;)I[s++]=S[_++],I[s++]=S[_++],I[s++]=S[_++],v-=3;v&&(I[s++]=S[_++],v>1&&(I[s++]=S[_++]))}else{_=s-E;do{I[s++]=I[_++],I[s++]=I[_++],I[s++]=I[_++],v-=3}while(v>2);v&&(I[s++]=I[_++],v>1&&(I[s++]=I[_++]))}break}}break}}while(r<n&&s<o);v=p>>3,r-=v,p-=v<<3,d&=(1<<p)-1,e.next_in=r,e.next_out=s,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=s<o?o-s+257:257-(s-o),R.hold=d,R.bits=p};const Hg=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),qg=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Gg=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Wg=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Yg=(e,t,r,n,s,i,o,a)=>{const c=a.bits;let l,h,u,d,p,f,y=0,g=0,m=0,w=0,b=0,v=0,E=0,_=0,S=0,A=0,I=null;const R=new Uint16Array(16),k=new Uint16Array(16);let T,C,P,N=null;for(y=0;y<=15;y++)R[y]=0;for(g=0;g<n;g++)R[t[r+g]]++;for(b=c,w=15;w>=1&&0===R[w];w--);if(b>w&&(b=w),0===w)return s[i++]=20971520,s[i++]=20971520,a.bits=1,0;for(m=1;m<w&&0===R[m];m++);for(b<m&&(b=m),_=1,y=1;y<=15;y++)if(_<<=1,_-=R[y],_<0)return-1;if(_>0&&(0===e||1!==w))return-1;for(k[1]=0,y=1;y<15;y++)k[y+1]=k[y]+R[y];for(g=0;g<n;g++)0!==t[r+g]&&(o[k[t[r+g]]++]=g);if(0===e?(I=N=o,f=20):1===e?(I=Hg,N=qg,f=257):(I=Gg,N=Wg,f=0),A=0,g=0,y=m,p=i,v=b,E=0,u=-1,S=1<<b,d=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){T=y-E,o[g]+1<f?(C=0,P=o[g]):o[g]>=f?(C=N[o[g]-f],P=I[o[g]-f]):(C=96,P=0),l=1<<y-E,h=1<<v,m=h;do{h-=l,s[p+(A>>E)+h]=T<<24|C<<16|P|0}while(0!==h);for(l=1<<y-1;A&l;)l>>=1;if(0!==l?(A&=l-1,A+=l):A=0,g++,0==--R[y]){if(y===w)break;y=t[r+o[g]]}if(y>b&&(A&d)!==u){for(0===E&&(E=b),p+=m,v=y-E,_=1<<v;v+E<w&&(_-=R[v+E],!(_<=0));)v++,_<<=1;if(S+=1<<v,1===e&&S>852||2===e&&S>592)return 1;u=A&d,s[u]=b<<24|v<<16|p-i|0}}return 0!==A&&(s[p+A]=y-E<<24|64<<16|0),a.bits=b,0};const{Z_FINISH:Zg,Z_BLOCK:Qg,Z_TREES:Jg,Z_OK:Xg,Z_STREAM_END:em,Z_NEED_DICT:tm,Z_STREAM_ERROR:rm,Z_DATA_ERROR:nm,Z_MEM_ERROR:sm,Z_BUF_ERROR:im,Z_DEFLATED:om}=by,am=16180,cm=16190,lm=16191,hm=16192,um=16194,dm=16199,pm=16200,fm=16206,ym=16209,gm=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function mm(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const wm=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<am||t.mode>16211?1:0},bm=e=>{if(wm(e))return rm;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=am,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Xg},vm=e=>{if(wm(e))return rm;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,bm(e)},Em=(e,t)=>{let r;if(wm(e))return rm;const n=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?rm:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,vm(e))},_m=(e,t)=>{if(!e)return rm;const r=new mm;e.state=r,r.strm=e,r.window=null,r.mode=am;const n=Em(e,t);return n!==Xg&&(e.state=null),n};let Sm,Am,Im=!0;const Rm=e=>{if(Im){Sm=new Int32Array(512),Am=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Yg(1,e.lens,0,288,Sm,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Yg(2,e.lens,0,32,Am,0,e.work,{bits:5}),Im=!1}e.lencode=Sm,e.lenbits=9,e.distcode=Am,e.distbits=5},km=(e,t,r,n)=>{let s;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(t.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):(s=i.wsize-i.wnext,s>n&&(s=n),i.window.set(t.subarray(r-n,r-n+s),i.wnext),(n-=s)?(i.window.set(t.subarray(r-n,r),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=s,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=s))),0};var Tm=vm,Cm=_m,Pm=(e,t)=>{let r,n,s,i,o,a,c,l,h,u,d,p,f,y,g,m,w,b,v,E,_,S,A=0;const I=new Uint8Array(4);let R,k;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(wm(e)||!e.output||!e.input&&0!==e.avail_in)return rm;r=e.state,r.mode===lm&&(r.mode=hm),o=e.next_out,s=e.output,c=e.avail_out,i=e.next_in,n=e.input,a=e.avail_in,l=r.hold,h=r.bits,u=a,d=c,S=Xg;e:for(;;)switch(r.mode){case am:if(0===r.wrap){r.mode=hm;break}for(;h<16;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}if(2&r.wrap&&35615===l){0===r.wbits&&(r.wbits=15),r.check=0,I[0]=255&l,I[1]=l>>>8&255,r.check=my(r.check,I,2,0),l=0,h=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",r.mode=ym;break}if((15&l)!==om){e.msg="unknown compression method",r.mode=ym;break}if(l>>>=4,h-=4,_=8+(15&l),0===r.wbits&&(r.wbits=_),_>15||_>r.wbits){e.msg="invalid window size",r.mode=ym;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&l?16189:lm,l=0,h=0;break;case 16181:for(;h<16;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}if(r.flags=l,(255&r.flags)!==om){e.msg="unknown compression method",r.mode=ym;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=ym;break}r.head&&(r.head.text=l>>8&1),512&r.flags&&4&r.wrap&&(I[0]=255&l,I[1]=l>>>8&255,r.check=my(r.check,I,2,0)),l=0,h=0,r.mode=16182;case 16182:for(;h<32;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}r.head&&(r.head.time=l),512&r.flags&&4&r.wrap&&(I[0]=255&l,I[1]=l>>>8&255,I[2]=l>>>16&255,I[3]=l>>>24&255,r.check=my(r.check,I,4,0)),l=0,h=0,r.mode=16183;case 16183:for(;h<16;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}r.head&&(r.head.xflags=255&l,r.head.os=l>>8),512&r.flags&&4&r.wrap&&(I[0]=255&l,I[1]=l>>>8&255,r.check=my(r.check,I,2,0)),l=0,h=0,r.mode=16184;case 16184:if(1024&r.flags){for(;h<16;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}r.length=l,r.head&&(r.head.extra_len=l),512&r.flags&&4&r.wrap&&(I[0]=255&l,I[1]=l>>>8&255,r.check=my(r.check,I,2,0)),l=0,h=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(p=r.length,p>a&&(p=a),p&&(r.head&&(_=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(i,i+p),_)),512&r.flags&&4&r.wrap&&(r.check=my(r.check,n,p,i)),a-=p,i+=p,r.length-=p),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===a)break e;p=0;do{_=n[i+p++],r.head&&_&&r.length<65536&&(r.head.name+=String.fromCharCode(_))}while(_&&p<a);if(512&r.flags&&4&r.wrap&&(r.check=my(r.check,n,p,i)),a-=p,i+=p,_)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===a)break e;p=0;do{_=n[i+p++],r.head&&_&&r.length<65536&&(r.head.comment+=String.fromCharCode(_))}while(_&&p<a);if(512&r.flags&&4&r.wrap&&(r.check=my(r.check,n,p,i)),a-=p,i+=p,_)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;h<16;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}if(4&r.wrap&&l!==(65535&r.check)){e.msg="header crc mismatch",r.mode=ym;break}l=0,h=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=lm;break;case 16189:for(;h<32;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}e.adler=r.check=gm(l),l=0,h=0,r.mode=cm;case cm:if(0===r.havedict)return e.next_out=o,e.avail_out=c,e.next_in=i,e.avail_in=a,r.hold=l,r.bits=h,tm;e.adler=r.check=1,r.mode=lm;case lm:if(t===Qg||t===Jg)break e;case hm:if(r.last){l>>>=7&h,h-=7&h,r.mode=fm;break}for(;h<3;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}switch(r.last=1&l,l>>>=1,h-=1,3&l){case 0:r.mode=16193;break;case 1:if(Rm(r),r.mode=dm,t===Jg){l>>>=2,h-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=ym}l>>>=2,h-=2;break;case 16193:for(l>>>=7&h,h-=7&h;h<32;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",r.mode=ym;break}if(r.length=65535&l,l=0,h=0,r.mode=um,t===Jg)break e;case um:r.mode=16195;case 16195:if(p=r.length,p){if(p>a&&(p=a),p>c&&(p=c),0===p)break e;s.set(n.subarray(i,i+p),o),a-=p,i+=p,c-=p,o+=p,r.length-=p;break}r.mode=lm;break;case 16196:for(;h<14;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}if(r.nlen=257+(31&l),l>>>=5,h-=5,r.ndist=1+(31&l),l>>>=5,h-=5,r.ncode=4+(15&l),l>>>=4,h-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=ym;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;h<3;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}r.lens[T[r.have++]]=7&l,l>>>=3,h-=3}for(;r.have<19;)r.lens[T[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,R={bits:r.lenbits},S=Yg(0,r.lens,0,19,r.lencode,0,r.work,R),r.lenbits=R.bits,S){e.msg="invalid code lengths set",r.mode=ym;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;A=r.lencode[l&(1<<r.lenbits)-1],g=A>>>24,m=A>>>16&255,w=65535&A,!(g<=h);){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}if(w<16)l>>>=g,h-=g,r.lens[r.have++]=w;else{if(16===w){for(k=g+2;h<k;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}if(l>>>=g,h-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=ym;break}_=r.lens[r.have-1],p=3+(3&l),l>>>=2,h-=2}else if(17===w){for(k=g+3;h<k;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}l>>>=g,h-=g,_=0,p=3+(7&l),l>>>=3,h-=3}else{for(k=g+7;h<k;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}l>>>=g,h-=g,_=0,p=11+(127&l),l>>>=7,h-=7}if(r.have+p>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=ym;break}for(;p--;)r.lens[r.have++]=_}}if(r.mode===ym)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=ym;break}if(r.lenbits=9,R={bits:r.lenbits},S=Yg(1,r.lens,0,r.nlen,r.lencode,0,r.work,R),r.lenbits=R.bits,S){e.msg="invalid literal/lengths set",r.mode=ym;break}if(r.distbits=6,r.distcode=r.distdyn,R={bits:r.distbits},S=Yg(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,R),r.distbits=R.bits,S){e.msg="invalid distances set",r.mode=ym;break}if(r.mode=dm,t===Jg)break e;case dm:r.mode=pm;case pm:if(a>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=i,e.avail_in=a,r.hold=l,r.bits=h,$g(e,d),o=e.next_out,s=e.output,c=e.avail_out,i=e.next_in,n=e.input,a=e.avail_in,l=r.hold,h=r.bits,r.mode===lm&&(r.back=-1);break}for(r.back=0;A=r.lencode[l&(1<<r.lenbits)-1],g=A>>>24,m=A>>>16&255,w=65535&A,!(g<=h);){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}if(m&&0==(240&m)){for(b=g,v=m,E=w;A=r.lencode[E+((l&(1<<b+v)-1)>>b)],g=A>>>24,m=A>>>16&255,w=65535&A,!(b+g<=h);){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}l>>>=b,h-=b,r.back+=b}if(l>>>=g,h-=g,r.back+=g,r.length=w,0===m){r.mode=16205;break}if(32&m){r.back=-1,r.mode=lm;break}if(64&m){e.msg="invalid literal/length code",r.mode=ym;break}r.extra=15&m,r.mode=16201;case 16201:if(r.extra){for(k=r.extra;h<k;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,h-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;A=r.distcode[l&(1<<r.distbits)-1],g=A>>>24,m=A>>>16&255,w=65535&A,!(g<=h);){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}if(0==(240&m)){for(b=g,v=m,E=w;A=r.distcode[E+((l&(1<<b+v)-1)>>b)],g=A>>>24,m=A>>>16&255,w=65535&A,!(b+g<=h);){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}l>>>=b,h-=b,r.back+=b}if(l>>>=g,h-=g,r.back+=g,64&m){e.msg="invalid distance code",r.mode=ym;break}r.offset=w,r.extra=15&m,r.mode=16203;case 16203:if(r.extra){for(k=r.extra;h<k;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,h-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=ym;break}r.mode=16204;case 16204:if(0===c)break e;if(p=d-c,r.offset>p){if(p=r.offset-p,p>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=ym;break}p>r.wnext?(p-=r.wnext,f=r.wsize-p):f=r.wnext-p,p>r.length&&(p=r.length),y=r.window}else y=s,f=o-r.offset,p=r.length;p>c&&(p=c),c-=p,r.length-=p;do{s[o++]=y[f++]}while(--p);0===r.length&&(r.mode=pm);break;case 16205:if(0===c)break e;s[o++]=r.length,c--,r.mode=pm;break;case fm:if(r.wrap){for(;h<32;){if(0===a)break e;a--,l|=n[i++]<<h,h+=8}if(d-=c,e.total_out+=d,r.total+=d,4&r.wrap&&d&&(e.adler=r.check=r.flags?my(r.check,s,d,o-d):yy(r.check,s,d,o-d)),d=c,4&r.wrap&&(r.flags?l:gm(l))!==r.check){e.msg="incorrect data check",r.mode=ym;break}l=0,h=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;h<32;){if(0===a)break e;a--,l+=n[i++]<<h,h+=8}if(4&r.wrap&&l!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=ym;break}l=0,h=0}r.mode=16208;case 16208:S=em;break e;case ym:S=nm;break e;case 16210:return sm;default:return rm}return e.next_out=o,e.avail_out=c,e.next_in=i,e.avail_in=a,r.hold=l,r.bits=h,(r.wsize||d!==e.avail_out&&r.mode<ym&&(r.mode<fm||t!==Zg))&&km(e,e.output,e.next_out,d-e.avail_out),u-=e.avail_in,d-=e.avail_out,e.total_in+=u,e.total_out+=d,r.total+=d,4&r.wrap&&d&&(e.adler=r.check=r.flags?my(r.check,s,d,e.next_out-d):yy(r.check,s,d,e.next_out-d)),e.data_type=r.bits+(r.last?64:0)+(r.mode===lm?128:0)+(r.mode===dm||r.mode===um?256:0),(0===u&&0===d||t===Zg)&&S===Xg&&(S=im),S},Nm=e=>{if(wm(e))return rm;let t=e.state;return t.window&&(t.window=null),e.state=null,Xg},Dm=(e,t)=>{if(wm(e))return rm;const r=e.state;return 0==(2&r.wrap)?rm:(r.head=t,t.done=!1,Xg)},Om=(e,t)=>{const r=t.length;let n,s,i;return wm(e)?rm:(n=e.state,0!==n.wrap&&n.mode!==cm?rm:n.mode===cm&&(s=1,s=yy(s,t,r,0),s!==n.check)?nm:(i=km(e,t,r,r),i?(n.mode=16210,sm):(n.havedict=1,Xg)))},xm=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Lm=Object.prototype.toString,{Z_NO_FLUSH:Bm,Z_FINISH:Mm,Z_OK:Um,Z_STREAM_END:zm,Z_NEED_DICT:Vm,Z_STREAM_ERROR:Fm,Z_DATA_ERROR:jm,Z_MEM_ERROR:Km}=by;function $m(e){this.options=_g({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Cg,this.strm.avail_out=0;let r=Cm(this.strm,t.windowBits);if(r!==Um)throw new Error(wy[r]);if(this.header=new xm,Dm(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Rg(t.dictionary):"[object ArrayBuffer]"===Lm.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Om(this.strm,t.dictionary),r!==Um)))throw new Error(wy[r])}function Hm(e,t){const r=new $m(t);if(r.push(e),r.err)throw r.msg||wy[r.err];return r.result}$m.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let i,o,a;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Mm:Bm,"[object ArrayBuffer]"===Lm.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),i=Pm(r,o),i===Vm&&s&&(i=Om(r,s),i===Um?i=Pm(r,o):i===jm&&(i=Vm));r.avail_in>0&&i===zm&&r.state.wrap>0&&0!==e[r.next_in];)Tm(r),i=Pm(r,o);switch(i){case Fm:case jm:case Vm:case Km:return this.onEnd(i),this.ended=!0,!1}if(a=r.avail_out,r.next_out&&(0===r.avail_out||i===zm))if("string"===this.options.to){let e=Tg(r.output,r.next_out),t=r.next_out-e,s=kg(r.output,e);r.next_out=t,r.avail_out=n-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(s)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(i!==Um||0!==a){if(i===zm)return i=Nm(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},$m.prototype.onData=function(e){this.chunks.push(e)},$m.prototype.onEnd=function(e){e===Um&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Sg(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var qm={Inflate:$m,inflate:Hm,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Hm(e,t)},ungzip:Hm,constants:by};const{Deflate:Gm,deflate:Wm,deflateRaw:Ym,gzip:Zm}=jg,{Inflate:Qm,inflate:Jm,inflateRaw:Xm,ungzip:ew}=qm;var tw={Deflate:Gm,deflate:Wm,deflateRaw:Ym,gzip:Zm,Inflate:Qm,inflate:Jm,inflateRaw:Xm,ungzip:ew,constants:by};class rw{constructor({preload:e,repo:t,hashers:r,options:n}){const s=function({repo:e,preload:t,hashers:r,options:n}){const s=n&&n.sharding;return zo((async function*(n,i={}){const o=Qp({shardSplitThreshold:s?1e3:1/0,strategy:"balanced"},i,{...Wp(i.chunker)});o.hashAlg&&"sha2-256"!==o.hashAlg&&1!==o.cidVersion&&(o.cidVersion=1),o.trickle&&(o.strategy="trickle"),"trickle"===o.strategy&&(o.leafType="raw",o.reduceSingleLeafToSelf=!1),o.cidVersion>0&&void 0===o.rawLeaves&&(o.rawLeaves=!0),void 0!==o.hashAlg&&void 0===o.rawLeaves&&(o.rawLeaves=!0),delete o.trickle;const a={};if(o.progress){const e=o.progress;o.progress=(t,r)=>{a[r]||(a[r]=0),a[r]+=t,e(a[r],r)}}let c;null!=o.hashAlg&&(c=await r.getHasher(o.hashAlg));const l=Xu(qp(n,Qd),(t=>Hp(t,e.blocks,{...o,hasher:c,pin:!1})),function(e){return async function*(t){for await(const r of t){let t=r.cid;1===e.cidVersion&&(t=t.toV1());let n=r.path?r.path:t.toString();e.wrapWithDirectory&&!r.path&&(n=""),yield{path:n,cid:t,size:r.size,mode:r.unixfs&&r.unixfs.mode,mtime:r.unixfs&&r.unixfs.mtime}}}}(o),function(e,t){return async function*(r){for await(const n of r)(!n.path||t.wrapWithDirectory?""===n.path:!n.path.includes("/"))&&!t.onlyHash&&!1!==t.preload&&e(n.cid),yield n}}(t,o),function(e,t){return async function*(r){for await(const n of r){const r=!(n.path&&n.path.includes("/"));(null==t.pin||t.pin)&&r&&!t.onlyHash&&await e.pins.pinRecursively(n.cid),yield n}}}(e,o)),h=await e.gcLock.readLock();try{for await(const e of l){const t=e.path??e.cid.toString();delete a[t],yield{...e,path:t}}}finally{h()}}))}({preload:e,repo:t,options:n,hashers:r});this.addAll=s,this.add=function({addAll:e}){return async function(t,r={}){const n=await Xa(e(ep(t),r));if(null==n)throw Error("Failed to add a file, if you see this please report a bug");return n}}({addAll:s}),this.cat=function({repo:e,preload:t}){return zo((async function*(r,n={}){if(r=Ho(r),!1!==n.preload){const e=r.split("/");t(kt.parse(e[0]))}const s=await df(r,e.blocks,n);if("directory"===s.type)throw new Error("this dag node is a directory");if(!s.content)throw new Error("this dag node has no content");yield*s.content(n)}))}({repo:t,preload:e}),this.get=function({repo:e,preload:t}){return zo((async function*(r,n={}){if(null!=n.compressionLevel&&(n.compressionLevel<-1||n.compressionLevel>9))throw qe(new Error("Compression level must be between -1 and 9"),"ERR_INVALID_PARAMS");if(!1!==n.preload){let e;try{e=Ho(r).split("/")}catch(e){throw qe(e,"ERR_INVALID_PATH")}t(kt.parse(e[0]))}const s=kt.asCID(r)||r,i=await df(s,e.blocks,n);if("file"===i.type||"raw"===i.type){const e=[];return n.compress&&!0!==n.archive?e.push(i.content):e.push([{header:{name:i.path,mode:"file"===i.type&&i.unixfs.mode,mtime:"file"===i.type&&i.unixfs.mtime?new Date(1e3*i.unixfs.mtime.secs):void 0,size:i.size,type:"file"},body:i.content()}],Lf()),n.compress&&e.push((async function*(e){const t=await yf(e);yield tw.gzip(t,{level:n.compressionLevel||6})})),void(yield*Xu(...e))}if("directory"!==i.type)throw qe(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS");{const t=[pf(s,e.blocks,n),async function*(e){for await(const t of e){const e={header:{name:t.path,size:t.size}};if("file"===t.type)e.header.type="file",e.header.mode=null!=t.unixfs.mode?t.unixfs.mode:void 0,e.header.mtime=t.unixfs.mtime?new Date(1e3*t.unixfs.mtime.secs):void 0,e.body=t.content();else if("raw"===t.type)e.header.type="file",e.body=t.content();else{if("directory"!==t.type)throw qe(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS");e.header.type="directory",e.header.mode=null!=t.unixfs.mode?t.unixfs.mode:void 0,e.header.mtime=t.unixfs.mtime?new Date(1e3*t.unixfs.mtime.secs):void 0}yield e}},Lf()];if(n.compress){if(!n.archive)throw qe(new Error("file is not regular"),"ERR_INVALID_PATH");n.compress&&t.push((async function*(e){const t=await yf(e);yield tw.gzip(t,{level:n.compressionLevel||6})}))}yield*Xu(...t)}}))}({repo:t,preload:e}),this.ls=function({repo:e,preload:t}){return zo((async function*(r,n={}){const s=Ho(r),i=s.split("/");!1!==n.preload&&t(kt.parse(i[0]));const o=kt.asCID(s)||s,a=await df(o,e.blocks,n);if("file"!==a.type){if("directory"!==a.type)throw qe(new Error(`Unknown UnixFS type ${a.type}`),"ERR_UNKNOWN_UNIXFS_TYPE");for await(const e of a.content())yield Go(e)}else yield Go(a)}))}({repo:t,preload:e})}}const nw="0.17.0",sw=He("ipfs:components:id");var iw=function(e,t,r){var n,s,i;if(Array.isArray(t)&&(n=t.slice(0)),"string"==typeof t&&(n=t.split(".")),"symbol"==typeof t&&(n=[t]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");if(!(s=n.pop()))return!1;for(ow(s);i=n.shift();)if(ow(i),void 0===e[i]&&(e[i]={}),!(e=e[i])||"object"!=typeof e)return!1;return e[s]=r,!0};function ow(e){if("__proto__"==e||"constructor"==e||"prototype"==e)throw new Error("setting of prototype values not supported")}const aw={server:{description:"Recommended for nodes with public IPv4 address (servers, VPSes, etc.), disables host and content discovery and UPnP in local networks.",transform:e=>(iw(e,"Discovery.MDNS.Enabled",!1),iw(e,"Discovery.webRTCStar.Enabled",!1),e.Swarm={...e.Swarm||{},DisableNatPortMap:!0},e)},"local-discovery":{description:"Sets default values to fields affected by `server` profile, enables discovery and UPnP in local networks.",transform:e=>(iw(e,"Discovery.MDNS.Enabled",!0),iw(e,"Discovery.webRTCStar.Enabled",!0),iw(e,"Swarm",{...e.Swarm||{},DisableNatPortMap:!1}),e)},test:{description:"Reduces external interference, useful for running ipfs in test environments. Note that with these settings node won't be able to talk to the rest of the network without manual bootstrap.",transform:e=>{const t={Swarm:[],Announce:[],NoAnnounce:[],API:"",Gateway:"",RPC:"",Delegates:["/dns4/node0.delegate.ipfs.io/tcp/443/https","/dns4/node1.delegate.ipfs.io/tcp/443/https","/dns4/node2.delegate.ipfs.io/tcp/443/https","/dns4/node3.delegate.ipfs.io/tcp/443/https"]};return iw(e,"Addresses.API",t.API?"/ip4/127.0.0.1/tcp/0":""),iw(e,"Addresses.Gateway",t.Gateway?"/ip4/127.0.0.1/tcp/0":""),iw(e,"Addresses.Swarm",t.Swarm.length?["/ip4/127.0.0.1/tcp/0"]:[]),iw(e,"Addresses.Delegates",[]),iw(e,"Bootstrap",[]),iw(e,"Discovery.MDNS.Enabled",!1),iw(e,"Discovery.webRTCStar.Enabled",!1),iw(e,"Swarm",{...e.Swarm||{},DisableNatPortMap:!0}),e}},"default-networking":{description:"Restores default network settings. Inverse profile of the `test` profile.",transform:e=>{const t={Swarm:[],Announce:[],NoAnnounce:[],API:"",Gateway:"",RPC:"",Delegates:["/dns4/node0.delegate.ipfs.io/tcp/443/https","/dns4/node1.delegate.ipfs.io/tcp/443/https","/dns4/node2.delegate.ipfs.io/tcp/443/https","/dns4/node3.delegate.ipfs.io/tcp/443/https"]},r={MDNS:{Enabled:!1,Interval:10},webRTCStar:{Enabled:!0}},n=["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"];return iw(e,"Addresses.API",t.API),iw(e,"Addresses.Gateway",t.Gateway),iw(e,"Addresses.Swarm",t.Swarm),iw(e,"Addresses.Delegates",t.Delegates),iw(e,"Bootstrap",n),iw(e,"Discovery.MDNS.Enabled",r.MDNS.Enabled),iw(e,"Discovery.webRTCStar.Enabled",r.webRTCStar.Enabled),iw(e,"Swarm",{...e.Swarm||{},DisableNatPortMap:!1}),e}},lowpower:{description:"Reduces daemon overhead on the system. May affect node functionality,performance of content discovery and data fetching may be degraded. Recommended for low power systems.",transform:e=>{const t=e.Swarm||{},r=t.ConnMgr||{};return r.LowWater=20,r.HighWater=40,t.ConnMgr=r,e.Swarm=t,e}},"default-power":{description:'Inverse of "lowpower" profile.',transform:e=>(e.Swarm={ConnMgr:{LowWater:5,HighWater:20},DisableNatPortMap:!0},e)}},cw=He("ipfs:core:config");async function lw(e){return Object.keys(aw).map((e=>({name:e,description:aw[e].description})))}function hw({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*uw(e,t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))for(const[r,n]of t.entries()){const t=[...e,r],s=kt.asCID(n);s?yield[t.join("/"),s]:"object"==typeof n&&(yield*dw(n,t))}else{const r=kt.asCID(t);r?yield[e.join("/"),r]:yield*dw(t,e)}}function*dw(e,t){if(!(null==e||e instanceof Uint8Array))for(const[r,n]of Object.entries(e)){const e=[...t,r];yield*uw(e,n)}}function*pw(e,t){if(Array.isArray(t))for(const[r,n]of t.entries()){const t=[...e,r];yield t.join("/"),"object"!=typeof n||kt.asCID(n)||(yield*fw(n,t))}else yield*fw(t,e)}function*fw(e,t){if(null!=e&&"object"==typeof e)for(const[r,n]of Object.entries(e)){const e=[...t,r];yield e.join("/"),null==n||n instanceof Uint8Array||"object"!=typeof n||kt.asCID(n)||(yield*pw(e,n))}}class yw{constructor({cid:e,bytes:t,value:r}){if(!e||!t||void 0===r)throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:hw(),bytes:hw(),value:hw(),asBlock:hw()})}links(){return dw(this.value,[])}tree(){return fw(this.value,[])}get(e="/"){return function(e,t){let r=e;for(const[e,n]of t.entries()){if(r=r[n],null==r)throw new Error(`Object has no property at ${t.slice(0,e+1).map((e=>`[${JSON.stringify(e)}]`)).join("")}`);const s=kt.asCID(r);if(s)return{value:s,remaining:t.slice(e+1).join("/")}}return{value:r}}(this.value,e.split("/").filter(Boolean))}}function gw({bytes:e,cid:t,value:r,codec:n}){const s=void 0!==r?r:n&&n.decode(e);if(void 0===s)throw new Error('Missing required argument, must either provide "value" or "codec"');return new yw({cid:t,bytes:e,value:s})}function mw(e){const t=Ln({version:1,roots:e}),r=ui.encode(t.length),n=new Uint8Array(r.length+t.length);return n.set(r,0),n.set(t,r.length),n}function ww(){}const bw={Null:e=>null===e,Int:e=>Number.isInteger(e),Float:e=>"number"==typeof e&&Number.isFinite(e),String:e=>"string"==typeof e,Bool:e=>"boolean"==typeof e,Bytes:e=>e instanceof Uint8Array,Link:e=>!bw.Null(e)&&"object"==typeof e&&e.asCID===e,List:e=>Array.isArray(e),Map:e=>!bw.Null(e)&&"object"==typeof e&&e.asCID!==e&&!bw.List(e)&&!bw.Bytes(e)},vw={Int:bw.Int,"CarHeader > version":e=>vw.Int(e),"CarHeader > roots (anon) > valueType (anon)":bw.Link,"CarHeader > roots (anon)":e=>bw.List(e)&&Array.prototype.every.call(e,vw["CarHeader > roots (anon) > valueType (anon)"]),"CarHeader > roots":e=>vw["CarHeader > roots (anon)"](e),CarHeader:e=>{const t=e&&Object.keys(e);return bw.Map(e)&&["version"].every((e=>t.includes(e)))&&Object.entries(e).every((([e,t])=>vw["CarHeader > "+e]&&vw["CarHeader > "+e](t)))}},Ew=vw.CarHeader;async function _w(e){const t=await e.upTo(8);if(!t.length)throw new Error("Unexpected end of data");const r=ui.decode(t);return e.seek(ui.decode.bytes),r}async function Sw(e,t){const r=await _w(e);if(0===r)throw new Error("Invalid CAR header (zero length)");const n=await e.exactly(r);e.seek(r);const s=Bn(n);if(!Ew(s))throw new Error("Invalid CAR header format");if(1!==s.version&&2!==s.version||void 0!==t&&s.version!==t)throw new Error(`Invalid CAR version: ${s.version}${void 0!==t?` (expected ${t})`:""}`);const i=Array.isArray(s.roots);if(1===s.version&&!i||2===s.version&&i)throw new Error("Invalid CAR header format");if(1===s.version)return s;const o=await async function(e){const t=await e.exactly(40),r=new DataView(t.buffer,t.byteOffset,t.byteLength);let n=0;const s={version:2,characteristics:[r.getBigUint64(n,!0),r.getBigUint64(n+=8,!0)],dataOffset:Number(r.getBigUint64(n+=8,!0)),dataSize:Number(r.getBigUint64(n+=8,!0)),indexOffset:Number(r.getBigUint64(n+=8,!0))};return e.seek(40),s}(e);e.seek(o.dataOffset-e.pos);const a=await Sw(e,1);return Object.assign(a,o)}async function Aw(e){const t=await e.exactly(2);if(18===t[0]&&32===t[1]){const t=await e.exactly(34);e.seek(34);const r=St(t);return kt.create(0,112,r)}const r=await _w(e);if(1!==r)throw new Error(`Unexpected CID version (${r})`);const n=await _w(e),s=await async function(e){const t=await e.upTo(8);ui.decode(t);const r=ui.decode.bytes,n=ui.decode(t.subarray(ui.decode.bytes)),s=r+ui.decode.bytes+n,i=await e.exactly(s);return e.seek(s),i}(e),i=St(s);return kt.create(r,n,i)}async function Iw(e){const t=e.pos;let r=await _w(e);if(0===r)throw new Error("Invalid CAR section (zero length)");return r+=e.pos-t,{cid:await Aw(e),length:r,blockLength:r-Number(e.pos-t)}}async function Rw(e){const{cid:t,blockLength:r}=await Iw(e),n=await e.exactly(r);return e.seek(r),{bytes:n,cid:t}}async function kw(e){const t=e.pos,{cid:r,length:n,blockLength:s}=await Iw(e),i={cid:r,length:n,blockLength:s,offset:t,blockOffset:e.pos};return e.seek(i.blockLength),i}function Tw(e){let t=0;return{upTo:async r=>e.subarray(t,t+Math.min(r,e.length-t)),async exactly(r){if(r>e.length-t)throw new Error("Unexpected end of data");return e.subarray(t,t+r)},seek(e){t+=e},get pos(){return t}}}class Cw{constructor(e,t){this._encoder=t,this._mutex=t.setRoots(e),this._ended=!1}async put(e){if(!(e.bytes instanceof Uint8Array&&e.cid))throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");const t=kt.asCID(e.cid);if(!t)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then((()=>this._encoder.writeBlock({cid:t,bytes:e.bytes}))),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}static create(e){e=function(e){if(void 0===e)return[];if(!Array.isArray(e)){const t=kt.asCID(e);if(!t)throw new TypeError("roots must be a single CID or an array of CIDs");return[t]}const t=[];for(const r of e){const e=kt.asCID(r);if(!e)throw new TypeError("roots must be a single CID or an array of CIDs");t.push(e)}return t}(e);const{encoder:t,iterator:r}=Nw();return{writer:new Cw(e,t),out:new Pw(r)}}static createAppender(){const{encoder:e,iterator:t}=Nw();return e.setRoots=()=>Promise.resolve(),{writer:new Cw([],e),out:new Pw(t)}}static async updateRootsInBytes(e,t){const r=Tw(e);await Sw(r);const n=mw(t);if(Number(r.pos)!==n.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${r.pos} bytes, new header is ${n.length} bytes)`);return e.set(n,0),e}}class Pw{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}}function Nw(){const e=function(){const e=[];let t=null,r=ww,n=!1,s=null,i=ww;const o=()=>(t||(t=new Promise((e=>{r=()=>{t=null,r=ww,e()}}))),t),a={write(t){e.push(t);const r=o();return i(),r},async end(){n=!0;const e=o();i(),await e}},c={async next(){const t=e.shift();return t?(0===e.length&&r(),{done:!1,value:t}):n?(r(),{done:!0,value:void 0}):(s||(s=new Promise((e=>{i=()=>(s=null,i=ww,e(c.next()))}))),s)}};return{writer:a,iterator:c}}(),{writer:t,iterator:r}=e,n=function(e){return{async setRoots(t){const r=mw(t);await e.write(r)},async writeBlock(t){const{cid:r,bytes:n}=t;await e.write(new Uint8Array(ui.encode(r.bytes.length+n.length))),await e.write(r.bytes),n.length&&await e.write(n)},async close(){await e.end()}}}(t);return{encoder:n,iterator:r}}const Dw=async({cid:e,load:t,seen:r})=>{r=r||new Set;const n=e.toString(Pe);if(r.has(n))return;const s=await t(e);if(r.add(n),null!==s)for(const[,e]of s.links())await Dw({cid:e,load:t,seen:r})},Ow=He("ipfs:components:dag:import"),xw=[ks,Os];async function Lw(e){for await(const t of e)return t}class Bw{constructor(e,t,r){this._version=e,this._roots=t,this._iterable=r,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}}class Mw extends Bw{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(e){const{version:t,roots:r,iterator:n}=await zw(e);return new Mw(t,r,n)}static async fromIterable(e){const{version:t,roots:r,iterator:n}=await Vw(e);return new Mw(t,r,n)}}class Uw extends(null){[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");this._decoded=!0;const e=this._iterable[Symbol.asyncIterator]();return{async next(){const t=await e.next();return t.done?t:{done:!1,value:t.value.cid}}}}static async fromBytes(e){const{version:t,roots:r,iterator:n}=await zw(e);return new Uw(t,r,n)}static async fromIterable(e){const{version:t,roots:r,iterator:n}=await Vw(e);return new Uw(t,r,n)}}async function zw(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return Fw(Tw(e))}async function Vw(e){if(!e||"function"!=typeof e[Symbol.asyncIterator])throw new TypeError("fromIterable() requires an async iterable");return Fw(function(e){const t=e[Symbol.asyncIterator]();return function(e){let t=0,r=0,n=0,s=new Uint8Array(0);const i=async t=>{r=s.length-n;const i=[s.subarray(n)];for(;r<t;){const t=await e();if(null==t)break;r<0?t.length>r&&i.push(t.subarray(-r)):i.push(t),r+=t.length}s=new Uint8Array(i.reduce(((e,t)=>e+t.length),0));let o=0;for(const e of i)s.set(e,o),o+=e.length;n=0};return{upTo:async e=>(s.length-n<e&&await i(e),s.subarray(n,n+Math.min(s.length-n,e))),async exactly(e){if(s.length-n<e&&await i(e),s.length-n<e)throw new Error("Unexpected end of data");return s.subarray(n,n+e)},seek(e){t+=e,n+=e},get pos(){return t}}}((async function(){const e=await t.next();return e.done?null:e.value}))}(e))}async function Fw(e){const t=function(e){const t=(async()=>{const t=await Sw(e);if(2===t.version){const r=e.pos-t.dataOffset;e=function(e,t){let r=0;return{async upTo(n){let s=await e.upTo(n);return s.length+r>t&&(s=s.subarray(0,t-r)),s},async exactly(n){const s=await e.exactly(n);if(s.length+r>t)throw new Error("Unexpected end of data");return s},seek(t){r+=t,e.seek(t)},get pos(){return e.pos}}}(e,t.dataSize-r)}return t})();return{header:()=>t,async*blocks(){for(await t;(await e.upTo(8)).length>0;)yield await Rw(e)},async*blocksIndex(){for(await t;(await e.upTo(8)).length>0;)yield await kw(e)}}}(e),{version:r,roots:n}=await t.header();return{version:r,roots:n,iterator:t.blocks()}}const jw=He("ipfs:components:dag:import");async function Kw(e,t,r){const n=await Mw.fromIterable(r),s=await n.getRoots();return await dd(e.blocks.putMany(zd(n,(({cid:e,bytes:t})=>(jw(`Import block ${e}`),{key:e,value:t}))),{signal:t.signal})),s}class $w{constructor({repo:e,codecs:t,hashers:r,preload:n}){this.export=function({repo:e,preload:t,codecs:r}){return zo((async function*(n,s={}){!1!==s.preload&&t(n);const i=kt.asCID(n);if(!i)throw new Error(`Unexpected error converting CID type: ${n}`);Ow(`Exporting ${i} as car`);const{writer:o,out:a}=await Cw.create([i]);let c=null;(async()=>{try{const t=function(e,t,r,n){return async s=>{const i=await n.getCodec(s.code);if(!i)throw new Error(`Can't decode links in block with codec 0x${s.code.toString(16)} to form complete DAG`);const o=await e.blocks.get(s,r);return Ow(`Adding block ${s} to car`),await t.put({cid:s,bytes:o}),xw.includes(s.code)?null:gw({bytes:o,cid:s,codec:i})}}(e,o,{signal:s.signal,timeout:s.timeout},r);await Dw({cid:i,load:t})}catch(e){c=e}finally{o.close()}})();for await(const e of a){if(c)break;yield e}if(c)throw c}))}({repo:e,preload:n,codecs:t}),this.get=function({codecs:e,repo:t,preload:r}){return zo((async function(n,s={}){if(!1!==s.preload&&r(n),s.path){const r=s.localResolve?await Lw(Yo(n,s.path,e,t,s)):await Xa(Yo(n,s.path,e,t,s));if(!r)throw qe(new Error("Not found"),"ERR_NOT_FOUND");return r}const i=await e.getCodec(n.code),o=await t.blocks.get(n,s);return{value:i.decode(o),remainderPath:""}}))}({codecs:t,repo:e,preload:n}),this.import=function({repo:e}){return zo((async function*(t,r={}){const n=await e.gcLock.readLock();try{const s={signal:r.signal,timeout:r.timeout},i=$d(t),{value:o,done:a}=await i.peek();if(a)return;let c;o&&i.push(o),c=o instanceof Uint8Array?[i]:i;for await(const t of c){const n=await Kw(e,s,t);if(!1!==r.pinRoots)for(const t of n){let r="";try{await e.blocks.has(t)?(jw(`Pinning root ${t}`),await e.pins.pinRecursively(t)):r="blockstore: block not found"}catch(e){r=e.message}yield{root:{cid:t,pinErrorMsg:r}}}}}finally{n()}}))}({repo:e}),this.resolve=function({repo:e,codecs:t,preload:r}){return zo((async function(n,s={}){const{cid:i}=Fo(n);return!1!==s.preload&&r(i),qo(e,t,n,s)}))}({repo:e,codecs:t,preload:n}),this.put=function({repo:e,codecs:t,hashers:r,preload:n}){return zo((async function(s,i={}){const o=i.pin?await e.gcLock.readLock():null;try{const a=await t.getCodec(i.storeCodec||"dag-cbor");if(!a)throw new Error(`Unknown storeCodec ${i.storeCodec}, please configure additional BlockCodecs for this IPFS instance`);if(i.inputCodec){if(!(s instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");const e=await t.getCodec(i.inputCodec);if(!e)throw new Error(`Unknown inputCodec ${i.inputCodec}, please configure additional BlockCodecs for this IPFS instance`);s=e.decode(s)}const c=null!=i.version?i.version:1,l=await r.getHasher(i.hashAlg||"sha2-256");if(!l)throw new Error(`Unknown hash algorithm ${i.hashAlg}, please configure additional MultihashHashers for this IPFS instance`);const h=a.encode(s),u=await l.digest(h),d=kt.create(c,a.code,u);return await e.blocks.put(d,h,{signal:i.signal}),i.pin&&await e.pins.pinRecursively(d),!1!==i.preload&&n(d),d}finally{o&&o()}}))}({repo:e,codecs:t,hashers:r,preload:n})}}const Hw=(e,t)=>t,qw={ip4:Hw,ip6:(e,t,r,n)=>1===n.length&&"ip6"===n[0].protocol?t:`[${t}]`,tcp:(e,t,r,n,s)=>n.some((e=>["http","https","ws","wss"].includes(e.protocol)))?`${e}:${t}`:((e,t,r,n)=>{if(null!=n&&!1===n.assumeHttp)return`tcp://${e}:${t}`;let s="tcp",i=`:${t}`;return"tcp"===r[r.length-1].protocol&&(s="443"===t?"https":"http",i="443"===t||"80"===t?"":i),`${s}://${e}${i}`})(e,t,n,s),udp:(e,t)=>`udp://${e}:${t}`,dnsaddr:Hw,dns4:Hw,dns6:Hw,ipfs:(e,t)=>`${e}/ipfs/${t}`,p2p:(e,t)=>`${e}/p2p/${t}`,http:e=>`http://${e}`,https:e=>`https://${e}`,ws:e=>`ws://${e}`,wss:e=>`wss://${e}`,"p2p-websocket-star":e=>`${e}/p2p-websocket-star`,"p2p-webrtc-star":e=>`${e}/p2p-webrtc-star`,"p2p-webrtc-direct":e=>`${e}/p2p-webrtc-direct`};function Gw(e,t){const r=Ki(e),n=r.toString().split("/").slice(1);return r.tuples().map((e=>({protocol:n.shift()??"",content:null!=e[1]?n.shift()??"":""}))).reduce(((e,r,n,s)=>{const i=qw[r.protocol];if(null==i)throw new Error(`Unsupported protocol ${r.protocol}`);return i(e,r.content,n,s,t)}),"")}const Ww=He("ipfs:preload"),Yw=new(Ma.default?Ma.default:Ma)({concurrency:4});function Zw(e,t={}){return Ww(e),Yw.add((async()=>{const r=(await Ua.post(e,{signal:t.signal})).body.getReader();try{for(;;){const{done:e}=await r.read();if(e)return}}finally{r.releaseLock()}}))}const Qw=He("ipfs:preload");function Jw(e={}){if(e.enabled=Boolean(e.enabled),e.addresses=e.addresses||[],e.cache=e.cache||1e3,!e.enabled||!e.addresses.length){Qw("preload disabled");const e=()=>{};return Object.assign(e,{start:()=>{},stop:()=>{}})}let t=!0,r=[];const n=e.addresses.map((e=>Gw(e))),s=Qo(e.cache),i=async e=>{try{if(t)throw new Error(`preload ${e} but preloader is not started`);const i=e.toString();if(s.has(i))return;s.set(i,!0);const o=function(e){if(!Array.isArray(e))throw new TypeError("Expected an array, got "+typeof e);for(let t=(e=[...e]).length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}(n);let a=!1;const c=Date.now();for(const e of o){if(t)throw new Error(`preload aborted for ${i}`);let n;try{n=new AbortController,r=r.concat(n),await Zw(`${e}/api/v0/refs?r=true&arg=${encodeURIComponent(i)}`,{signal:n.signal}),a=!0}catch(e){"aborted"!==e.type&&Qw.error(e)}finally{r=r.filter((e=>e!==n))}if(a)break}Qw(`${a?"":"un"}successfully preloaded ${i} in ${Date.now()-c}ms`)}catch(e){Qw.error(e)}};return i.start=()=>{t=!1},i.stop=()=>{t=!0,Qw(`aborting ${r.length} pending preload request(s)`),r.forEach((e=>e.abort())),r=[]},i}const Xw=He("ipfs:mfs-preload");class eb extends Error{constructor(e){super(e),this.name="TimeoutError"}}class tb extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const rb=e=>void 0===globalThis.DOMException?new tb(e):new DOMException(e),nb=e=>{const t=void 0===e.reason?rb("This operation was aborted."):e.reason;return t instanceof Error?t:rb(t)},sb="lock:worker:request-read",ib="lock:worker:release-read",ob="lock:master:grant-read",ab="lock:worker:request-write",cb="lock:worker:release-write",lb="lock:master:grant-write",hb={},ub=e=>{e.addEventListener("message",(t=>{ub.dispatchEvent("message",e,t)})),null!=e.port&&e.port.addEventListener("message",(t=>{ub.dispatchEvent("message",e,t)}))};ub.addEventListener=(e,t)=>{null==hb[e]&&(hb[e]=[]),hb[e].push(t)},ub.removeEventListener=(e,t)=>{null!=hb[e]&&(hb[e]=hb[e].filter((e=>e===t)))},ub.dispatchEvent=function(e,t,r){null!=hb[e]&&hb[e].forEach((e=>e(t,r)))};const db=ub,pb=(e,t,r,n,s)=>(i,o)=>{if(o.data.type!==r)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};e.dispatchEvent(new MessageEvent(t,{data:{name:a.name,handler:async()=>(i.postMessage({type:s,name:a.name,identifier:a.identifier}),await new Promise((e=>{const t=r=>{if(null==r||null==r.data)return;const s=r.data.type,o=(r.data.name,r.data.identifier);s===n&&o===a.identifier&&(i.removeEventListener("message",t),e())};i.addEventListener("message",t)})))}}))},fb=(e,t,r,n)=>async()=>{const s=To();return globalThis.postMessage({type:t,identifier:s,name:e}),await new Promise((t=>{const i=o=>{if(null==o||null==o.data)return;const a=o.data.type,c=o.data.identifier;a===r&&c===s&&(globalThis.removeEventListener("message",i),t((()=>{globalThis.postMessage({type:n,identifier:s,name:e})})))};globalThis.addEventListener("message",i)}))},yb={singleProcess:!1},gb={};let mb;async function wb(e,t){let r;const n=new Promise((e=>{r=e}));return e.add((async()=>await function(e,t){const{milliseconds:r,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout}}=t;let o;const a=new Promise(((a,c)=>{if("number"!=typeof r||1!==Math.sign(r))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(r!==Number.POSITIVE_INFINITY){if(t.signal){const{signal:e}=t;e.aborted&&c(nb(e)),e.addEventListener("abort",(()=>{c(nb(e))}))}o=i.setTimeout.call(void 0,(()=>{if(n){try{a(n())}catch(e){c(e)}return}const t=s instanceof Error?s:new eb("string"==typeof s?s:`Promise timed out after ${r} milliseconds`);"function"==typeof e.cancel&&e.cancel(),c(t)}),r),(async()=>{try{a(await e)}catch(e){c(e)}finally{i.clearTimeout.call(void 0,o)}})()}else a(e)}));return a.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},a}((async()=>await new Promise((e=>{r((()=>{e()}))})))(),{milliseconds:t.timeout}))),await n}const bb={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function vb(e){const t=Object.assign({},bb,e);return null==mb&&(mb=(e=>{if(e=Object.assign({},yb,e),Boolean(globalThis.document)||e.singleProcess){const e=new EventTarget;return db.addEventListener("message",pb(e,"requestReadLock",sb,ib,ob)),db.addEventListener("message",pb(e,"requestWriteLock",ab,cb,lb)),e}return{isWorker:!0,readLock:e=>fb(e,sb,ob,ib),writeLock:e=>fb(e,ab,lb,cb)}})(t),!0!==mb.isWorker&&(mb.addEventListener("requestReadLock",(e=>{null!=gb[e.data.name]&&gb[e.data.name].readLock().then((async t=>await e.data.handler().finally((()=>t()))))})),mb.addEventListener("requestWriteLock",(async e=>{null!=gb[e.data.name]&&gb[e.data.name].writeLock().then((async t=>await e.data.handler().finally((()=>t()))))})))),null==gb[t.name]&&(gb[t.name]=((e,t)=>{if(!0===mb.isWorker)return{readLock:mb.readLock(e,t),writeLock:mb.writeLock(e,t)};const r=new Ma({concurrency:1});let n;return{async readLock(){if(null!=n)return await wb(n,t);n=new Ma({concurrency:t.concurrency,autoStart:!1});const e=n,s=wb(n,t);return r.add((async()=>(e.start(),await e.onIdle().then((()=>{n===e&&(n=null)}))))),await s},writeLock:async()=>(n=null,await wb(r,t))}})(t.name,t)),gb[t.name]}let Eb;function _b(e=!1){if(Eb)return Eb;const t=vb({singleProcess:e});return Eb={readLock:e=>async(...r)=>{const n=await t.readLock();try{return await e.apply(null,r)}finally{n()}},writeLock:e=>async(...r)=>{const n=await t.writeLock();try{return await e.apply(null,r)}finally{n()}}},Eb}const Sb=He("ipfs:mfs:utils:with-mfs-root");async function Ab(e,t){if(t&&t.signal&&t.signal.aborted)throw qe(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});let r;await e.repo.datastore.open();try{const t=await e.repo.datastore.get(Ko);r=kt.decode(t)}catch(n){if("ERR_NOT_FOUND"!==n.code)throw n;Sb("Creating new MFS root");const s=ir({Data:new ot({type:"directory"}).marshal(),Links:[]}),i=await As.digest(s);if(r=kt.createV0(i),await e.repo.blocks.put(r,s),t&&t.signal&&t.signal.aborted)throw qe(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});await e.repo.datastore.put(Ko,r.bytes)}return Sb(`Loaded MFS root /ipfs/${r}`),r}function Ib(e=""){return(e.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean)}const Rb=async(e,t,r)=>{const n=await Ab(e,r);let s={entryType:"file"},i="";if(i=kt.asCID(t)?`/ipfs/${t}`:t.toString(),i=i.trim(),i=i.replace(/(\/\/+)/g,"/"),i.endsWith("/")&&i.length>1&&(i=i.substring(0,i.length-1)),!i)throw qe(new Error("paths must not be empty"),"ERR_NO_PATH");if("/"!==i.substring(0,1))throw qe(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");"/"===i.substring(i.length-1)&&(i=i.substring(0,i.length-1));const o=Ib(i);if("ipfs"===o[0]){let e;e=2===o.length?`/${o.join("/")}`:`/${o.slice(0,o.length-1).join("/")}`,s={type:"ipfs",depth:o.length-2,entryType:"file",mfsPath:`/${o.join("/")}`,mfsDirectory:e,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}else{const e=`/ipfs/${n}${o.length?"/"+o.join("/"):""}`,t=`/ipfs/${n}/${o.slice(0,o.length-1).join("/")}`;s={type:"mfs",depth:o.length,entryType:"file",mfsDirectory:t,mfsPath:e,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}const a="mfs"===s.type?s.mfsPath:s.path;try{const t=await df(a,e.repo.blocks,r);s.cid=t.cid,s.mfsPath=`/ipfs/${t.path}`,s.entryType=t.type,s.content=t.content,"file"!==s.entryType&&"directory"!==s.entryType||"file"!==t.type&&"directory"!==t.type||(s.unixfs=t.unixfs)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}return s.exists=Boolean(s.cid),s},kb=ye.bind({ignoreUndefined:!0}),Tb=He("ipfs:mfs:stat"),Cb={withLocal:!1};function Pb(e){return zo((async function(t,r={}){r=kb(Cb,r),Tb(`Fetching stats for ${t}`);const{type:n,cid:s,mfsPath:i}=await Rb(e,t,r),o="ipfs"===n&&s?s:i;let a;try{a=await df(o,e.repo.blocks)}catch(e){if("ERR_NOT_FOUND"===e.code)throw qe(new Error(`${t} does not exist`),"ERR_NOT_FOUND");throw e}if(!Nb[a.type])throw new Error(`Cannot stat codec ${a.cid.code}`);return Nb[a.type](a)}))}const Nb={raw:e=>({cid:e.cid,size:e.node.length,cumulativeSize:e.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1}),file:e=>{const t={cid:e.cid,type:"file",size:e.unixfs.fileSize(),cumulativeSize:ir(e.node).length+(e.node.Links||[]).reduce(((e,t)=>e+(t.Tsize||0)),0),blocks:e.unixfs.blockSizes.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:e.unixfs.mode};return e.unixfs.mtime&&(t.mtime=e.unixfs.mtime),t},directory:e=>{const t={cid:e.cid,type:"directory",size:0,cumulativeSize:ir(e.node).length+(e.node.Links||[]).reduce(((e,t)=>e+(t.Tsize||0)),0),blocks:e.node.Links.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:e.unixfs.mode};return e.unixfs.mtime&&(t.mtime=e.unixfs.mtime),t},object:e=>({cid:e.cid,size:e.node.length,cumulativeSize:e.node.length,type:"file",blocks:0,local:void 0,sizeLocal:void 0,withLocality:!1}),identity:e=>({cid:e.cid,size:e.node.length,cumulativeSize:e.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1})},Db=He("ipfs:mfs:utils:to-trail");async function Ob(e,t){Db(`Creating trail for path ${t}`);const r=[];for await(const n of uf(t,e.repo.blocks))r.push({name:n.name,cid:n.cid,size:n.size,type:n.type});return r}const xb=async(e,t,r)=>{r.codec||(r.codec=o),r.hasher||(r.hasher=As),void 0===r.cidVersion&&(r.cidVersion=1),r.codec===o&&r.hasher!==As&&(r.cidVersion=1);const n=await r.hasher.digest(e),s=kt.create(r.cidVersion,r.codec.code,n);return r.onlyHash||await t.put(s,e,{signal:r.signal}),s},Lb=sp.code;async function Bb(e){return(await sp.encode(e)).subarray(0,8).reverse()}class Mb{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}}class Ub extends Mb{constructor(e,t){super(e,t),this._bucket=Up({hashFn:Bb,bits:8})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){yield*zb(this._bucket,e,this,this.options)}}async function*zb(e,t,r,n){const s=e._children,i=[];let o=0;for(let e=0;e<s.length;e++){const r=s.get(e);if(!r)continue;const a=e.toString(16).toUpperCase().padStart(2,"0");if(r instanceof kp){let e;for await(const s of await zb(r,t,null,n))e=s;if(!e)throw new Error("Could not flush sharded directory, no subshard found");i.push({Name:a,Tsize:e.size,Hash:e.cid}),o+=e.size}else if("function"==typeof r.value.flush){const e=r.value;let n;for await(const r of e.flush(t))n=r,yield n;const s=a+r.key;i.push({Name:s,Tsize:n.size,Hash:n.cid}),o+=n.size}else{const e=r.value;if(!e.cid)continue;const t=a+r.key,n=e.size;i.push({Name:t,Tsize:n,Hash:e.cid}),o+=n}}const a=Uint8Array.from(s.bitField().reverse()),c={Data:new ot({type:"hamt-sharded-directory",data:a,fanout:e.tableSize(),hashType:Lb,mtime:r&&r.mtime,mode:r&&r.mode}).marshal(),Links:i},l=ir(Xt(c)),h=await xb(l,t,n),u=l.length+o;yield{cid:h,node:c,size:u}}const Vb=He("ipfs:mfs:core:utils:hamt-utils"),Fb=async(e,t,r,n)=>{if(!n.parent.Data)throw new Error("Could not update HAMT directory because parent had no data");const s=Uint8Array.from(r._children.bitField().reverse()),i=ot.unmarshal(n.parent.Data),o=new ot({type:"hamt-sharded-directory",data:s,fanout:r.tableSize(),hashType:Lb,mode:i.mode,mtime:i.mtime}),a=await e.hashers.getHasher(n.hashAlg),c={Data:o.marshal(),Links:t.sort(((e,t)=>(e.Name||"").localeCompare(t.Name||"")))},l=ir(c),h=await a.digest(l),u=kt.create(n.cidVersion,sr,h);return n.flush&&await e.repo.blocks.put(u,l),{node:c,cid:u,size:t.reduce(((e,t)=>e+(t.Tsize||0)),l.length)}},jb=async(e,t,r,n,s)=>{const i=new kp({hash:r._options.hash,bits:r._options.bits},n,s);return n._putObjectAt(s,i),await $b(e,t,i,r),i},Kb=async e=>{const t=Up({hashFn:Bb,bits:8});return await Promise.all(e.map((async e=>{const r=e.Name||"";if(2===r.length){const e=parseInt(r,16),n=new kp({hash:t._options.hash,bits:t._options.bits},t,e);return t._putObjectAt(e,n),Promise.resolve()}return t.put(r.substring(2),{size:e.Tsize,cid:e.Hash})}))),t},$b=async(e,t,r,n)=>{await Promise.all(t.map((async t=>{const s=t.Name||"";if(2===s.length){Vb("Populating sub bucket",s);const i=parseInt(s,16),o=or(await e.repo.blocks.get(t.Hash)),a=new kp({hash:n._options.hash,bits:n._options.bits},r,i);return r._putObjectAt(i,a),await $b(e,o.Links,a,n),Promise.resolve()}return n.put(s.substring(2),{size:t.Tsize,cid:t.Hash})})))},Hb=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),qb=He("ipfs:mfs:core:utils:add-link");async function Gb(e,t){let r=t.parent;if(t.parentCid){const n=kt.asCID(t.parentCid);if(null===n)throw qe(new Error("Invalid CID passed to addLink"),"EINVALIDPARENTCID");if(n.code!==sr)throw qe(new Error("Unsupported codec. Only DAG-PB is supported"),"EINVALIDPARENTCID");qb(`Loading parent node ${n}`),r=or(await e.repo.blocks.get(n))}if(!r)throw qe(new Error("No parent node or CID passed to addLink"),"EINVALIDPARENT");if(!t.cid)throw qe(new Error("No child cid passed to addLink"),"EINVALIDCHILDCID");if(!t.name)throw qe(new Error("No child name passed to addLink"),"EINVALIDCHILDNAME");if(!t.size&&0!==t.size)throw qe(new Error("No child size passed to addLink"),"EINVALIDCHILDSIZE");if(!r.Data)throw qe(new Error("Parent node with no data passed to addLink"),"ERR_INVALID_PARENT");const n=ot.unmarshal(r.Data);return"hamt-sharded-directory"===n.type?(qb("Adding link to sharded directory"),Zb(e,{...t,parent:r})):r.Links.length>=t.shardSplitThreshold?(qb("Converting directory to sharded directory"),Wb(e,{...t,parent:r,mtime:n.mtime,mode:n.mode})):(qb(`Adding ${t.name} (${t.cid}) to regular directory`),Yb(e,{...t,parent:r}))}const Wb=async(e,t)=>{const r=await(async(e,t,r={})=>{const n=new Ub({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:r.mtime,mode:r.mode},r);for(let e=0;e<t.length;e++)await n._bucket.put(t[e].name,{size:t[e].size,cid:t[e].cid});const s=await Xa(n.flush(e.repo.blocks));if(!s)throw new Error("Flushing shard yielded no result");return s})(e,t.parent.Links.map((e=>({name:e.Name||"",size:e.Tsize||0,cid:e.Hash}))).concat({name:t.name,size:t.size,cid:t.cid}),t);return qb(`Converted directory to sharded directory ${r.cid}`),r},Yb=async(e,t)=>{const r=t.parent.Links.filter((e=>e.Name!==t.name));if(r.push({Name:t.name,Tsize:t.size,Hash:t.cid}),!t.parent.Data)throw qe(new Error("Parent node with no data passed to addToDirectory"),"ERR_INVALID_PARENT");const n=ot.unmarshal(t.parent.Data);let s;if(n.mtime){const e=Date.now(),t=Math.floor(e/1e3);n.mtime={secs:t,nsecs:1e3*(e-1e3*t)},s=n.marshal()}else s=t.parent.Data;t.parent=Xt({Data:s,Links:r});const i=await e.hashers.getHasher(t.hashAlg),o=ir(t.parent),a=await i.digest(o),c=kt.create(t.cidVersion,sr,a);return t.flush&&await e.repo.blocks.put(c,o),{node:t.parent,cid:c,size:o.length}},Zb=async(e,t)=>{const{shard:r,path:n}=await Qb(e,t),s=await Xa(r.flush(e.repo.blocks));if(!s)throw new Error("No result from flushing shard");const i=or(await e.repo.blocks.get(s.cid)),o=t.parent.Links.filter((e=>(e.Name||"").substring(0,2)!==n[0].prefix)),a=i.Links.find((e=>(e.Name||"").substring(0,2)===n[0].prefix));if(!a)throw new Error(`No link found with prefix ${n[0].prefix}`);return o.push(a),Fb(e,o,n[0].bucket,t)},Qb=async(e,t)=>{const r={name:t.name,cid:t.cid,size:t.size};if(!t.parent.Data)throw qe(new Error("Parent node with no data passed to addFileToShardedDirectory"),"ERR_INVALID_PARENT");const n=await Kb(t.parent.Links),s=ot.unmarshal(t.parent.Data),i=new Ub({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mode:s.mode},t);i._bucket=n,s.mtime&&(i.mtime={secs:Math.round(Date.now()/1e3)});const o=await n._findNewBucketAndPos(r.name),a=Jb(o);a[0].node=t.parent;let c=0;for(;c<a.length;){const t=a[c];c++;const s=t.node;if(!s)throw new Error("Segment had no node");const i=s.Links.find((e=>(e.Name||"").substring(0,2)===t.prefix));if(!i){qb(`Link ${t.prefix}${r.name} will be added`),c=a.length;break}if(i.Name===`${t.prefix}${r.name}`){qb(`Link ${t.prefix}${r.name} will be replaced`),c=a.length;break}if((i.Name||"").length>2){qb(`Link ${i.Name} ${i.Hash} will be replaced with a subshard`),c=a.length;break}qb(`Found subshard ${t.prefix}`);const o=or(await e.repo.blocks.get(i.Hash));if(!a[c]){qb(`Loaded new subshard ${t.prefix}`),await jb(e,o.Links,n,t.bucket,parseInt(t.prefix,16));const s=await n._findNewBucketAndPos(r.name);a.push({bucket:s.bucket,prefix:Hb(s.pos),node:o});break}const l=a[c];await $b(e,o.Links,l.bucket,n),l.node=o}return await i._bucket.put(r.name,{size:r.size,cid:r.cid}),{shard:i,path:a}},Jb=e=>{const t=[{bucket:e.bucket,prefix:Hb(e.pos)}];let r=e.bucket._parent,n=e.bucket._posAtParent;for(;r;)t.push({bucket:r,prefix:Hb(n)}),n=r._posAtParent,r=r._parent;return t.reverse(),t},Xb=He("ipfs:mfs:utils:update-tree"),ev={shardSplitThreshold:1e3};async function tv(e,t,r){r=Object.assign({},ev,r),Xb("Trail",t),t=t.slice().reverse();let n,s=0;for await(const i of e.repo.blocks.getMany(t.map((e=>e.cid)))){const o=or(i),a=t[s].cid,c=t[s].name;if(s++,!n){n={cid:a,name:c,size:i.length};continue}const l=await Gb(e,{parent:o,name:n.name,cid:n.cid,size:n.size,flush:r.flush,shardSplitThreshold:r.shardSplitThreshold,hashAlg:r.hashAlg,cidVersion:r.cidVersion});n={cid:l.cid,name:c,size:l.size}}const{cid:i}=n;return Xb(`Final CID ${i}`),i}const rv=He("ipfs:mfs:utils:update-mfs-root");async function nv(e,t,r){if(r&&r.signal&&r.signal.aborted)throw qe(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});return rv(`New MFS root will be ${t}`),await e.repo.datastore.put(Ko,t.bytes),t}const sv=ye.bind({ignoreUndefined:!0}),iv=He("ipfs:mfs:mkdir"),ov={parents:!1,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3,flush:!0};function av(e){return zo((async function(t,r={}){const n=sv(ov,r);if(!t)throw new Error("no path given to Mkdir");if("/"===(t=t.trim())){if(n.parents)return;throw qe(new Error("cannot create directory '/': Already exists"),"ERR_INVALID_PATH")}if("/"!==t.substring(0,1))throw qe(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");iv(`Creating ${t}`);const s=Ib(t);if("ipfs"===s[0])throw qe(new Error("path cannot have the prefix 'ipfs'"),"ERR_INVALID_PATH");const i=await Ab(e,n);let o;const a=[],c=await async function(e,t,r){const n=new ot({type:"directory",mode:r.mode,mtime:r.mtime}),s=await e.hashers.getHasher(r.hashAlg),i={Data:n.marshal(),Links:[]},o=ir(i),a=await s.digest(o),c=kt.create(r.cidVersion,sr,a);return r.flush&&await e.repo.blocks.put(c,o),{cid:c,node:i}}(e,0,n);for(let r=0;r<=s.length;r++){const l=s.slice(0,r),h=`/ipfs/${i}/${l.join("/")}`;try{if(o=await df(h,e.repo.blocks),"file"!==o.type&&"directory"!==o.type)throw qe(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(r===s.length){if(n.parents)return;throw qe(new Error("file already exists"),"ERR_ALREADY_EXISTS")}a.push({name:o.name,cid:o.cid})}catch(t){if("ERR_NOT_FOUND"!==t.code)throw t;if(r<s.length&&!n.parents)throw qe(new Error(`Intermediate directory path ${h} does not exist, use the -p flag to create it`),"ERR_NOT_FOUND");await cv(e,l[l.length-1],c,a[a.length-1],a,n)}}const l=await tv(e,a,n);await nv(e,l,n)}))}const cv=async(e,t,r,n,s,i)=>{iv(`Adding empty dir called ${t} to ${n.cid}`);const o=await Gb(e,{parent:n.node,parentCid:n.cid,size:0,cid:r.cid,name:t,hashAlg:i.hashAlg,cidVersion:i.cidVersion,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold});s[s.length-1].cid=o.cid,s.push({name:t,cid:r.cid})},lv=ye.bind({ignoreUndefined:!0}),hv=He("ipfs:mfs:cp"),uv={parents:!1,flush:!0,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3};function dv(e){return zo((async function(t,r,n={}){const s=lv(uv,n);Array.isArray(t)||(t=[t]);const i=await Promise.all(t.map((t=>Rb(e,t,s))));let o=await Rb(e,r,s);if(!i.length||!o)throw qe(new Error("Please supply at least one source"),"ERR_INVALID_PARAMS");const a=i.find((e=>!e.exists));if(a)throw qe(new Error(`${a.path} does not exist`),"ERR_INVALID_PARAMS");const c=pv(o);if(o.exists){if(hv("Destination exists"),1===i.length&&!c)throw qe(new Error("directory already has entry by that name"),"ERR_ALREADY_EXISTS")}else if(hv("Destination does not exist"),i.length>1){if(!s.parents)throw qe(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await av(e)(o.path,s),o=await Rb(e,o.path,s)}else if(o.parts.length>1){const t=`/${o.parts.slice(0,-1).join("/")}`;try{await Pb(e)(t,s)}catch(r){if("ERR_NOT_FOUND"!==r.code)throw r;if(!s.parents)throw qe(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await av(e)(t,s),o=await Rb(e,o.path,s)}}const l=pv(o)?o.mfsPath:o.mfsDirectory,h=await Ob(e,l);if(1===i.length){const t=i.pop();if(!t)throw qe(new Error("could not find source"),"ERR_INVALID_PARAMS");const r=c?t.name:o.name;return hv(`Only one source, copying to destination ${c?"directory":"file"} ${r}`),fv(e,t,r,h,s)}return hv("Multiple sources, wrapping in a directory"),yv(e,i,o,h,s)}))}const pv=e=>e.unixfs&&e.unixfs.type&&e.unixfs.type.includes("directory"),fv=async(e,t,r,n,s)=>{let i=n.pop();if(!i)throw qe(new Error("destination had no parent"),"ERR_INVALID_PARAMS");i=await gv(e,t,r,i,s),n.push(i);const o=await tv(e,n,s);await nv(e,o,s)},yv=async(e,t,r,n,s)=>{for(let n=0;n<t.length;n++){const i=t[n];r=await gv(e,i,i.name,r,s)}n[n.length-1]=r;const i=await tv(e,n,s);await nv(e,i,s)},gv=async(e,t,r,n,s)=>{const i=await e.repo.blocks.get(t.cid),{node:o,cid:a,size:c}=await Gb(e,{parentCid:n.cid,size:i.length,cid:t.cid,name:r,hashAlg:s.hashAlg,cidVersion:s.cidVersion,flush:s.flush,shardSplitThreshold:s.shardSplitThreshold});return n.node=o,n.cid=a,n.size=c,n},mv=He("ipfs:mfs:core:utils:remove-link"),wv=async(e,t,r,n)=>{const s=t.pop();if(!s)throw qe(new Error("Could not find parent"),"EINVALIDPARENT");const{bucket:i,prefix:o,node:a}=s;if(!a)throw qe(new Error("Could not find parent"),"EINVALIDPARENT");const c=a.Links.find((e=>(e.Name||"").substring(0,2)===o));if(!c)throw qe(new Error(`No link found with prefix ${o} for file ${r}`),"ERR_NOT_FOUND");if(c.Name===`${o}${r}`){mv(`Removing existing link ${c.Name}`);const t=a.Links.filter((e=>e.Name!==c.Name));return await i.del(r),Fb(e,t,i,n)}mv(`Descending into sub-shard ${c.Name} for ${o}${r}`);const l=await wv(e,t,r,n);let h=l.cid,u=l.size,d=o;if(1===l.node.Links.length){mv(`Removing subshard for ${o}`);const e=l.node.Links[0];d=`${o}${(e.Name||"").substring(2)}`,h=e.Hash,u=e.Tsize||0}return mv(`Updating shard ${o} with name ${d}`),bv(e,i,a,o,d,u,h,n)},bv=(e,t,r,n,s,i,o,a)=>{const c=r.Links.filter((e=>e.Name!==n));return c.push({Name:s,Tsize:i,Hash:o}),Fb(e,c,t,a)},vv=ye.bind({ignoreUndefined:!0}),Ev={recursive:!1,cidVersion:0,hashAlg:"sha2-256",flush:!0,shardSplitThreshold:1e3};function _v(e){return zo((async function(t,r={}){const n=vv(Ev,r);Array.isArray(t)||(t=[t]);const s=await Promise.all(t.map((t=>Rb(e,t,n))));if(!s.length)throw qe(new Error("Please supply at least one path to remove"),"ERR_INVALID_PARAMS");s.forEach((e=>{if("/"===e.path)throw qe(new Error("Cannot delete root"),"ERR_INVALID_PARAMS")}));for(const t of s)await Sv(e,t.path,n)}))}const Sv=async(e,t,r)=>{const n=await Rb(e,t,r),s=await Ob(e,n.mfsPath),i=s[s.length-1];s.pop();const o=s[s.length-1];if(!o)throw qe(new Error(`${t} does not exist`),"ERR_NOT_FOUND");if("directory"===i.type&&!r.recursive)throw qe(new Error(`${t} is a directory, use -r to remove directories`),"ERR_WAS_DIR");const{cid:a}=await async function(e,t){let r=t.parent;if(t.parentCid){const n=kt.asCID(t.parentCid);if(null===n)throw qe(new Error("Invalid CID passed to removeLink"),"EINVALIDPARENTCID");mv(`Loading parent node ${n}`),r=or(await e.repo.blocks.get(n))}if(!r)throw qe(new Error("No parent node or CID passed to removeLink"),"EINVALIDPARENT");if(!t.name)throw qe(new Error("No child name passed to removeLink"),"EINVALIDCHILDNAME");if(!r.Data)throw qe(new Error("Parent node had no data"),"ERR_INVALID_NODE");return"hamt-sharded-directory"===ot.unmarshal(r.Data).type?(mv(`Removing ${t.name} from sharded directory`),(async(e,t)=>{const{rootBucket:r,path:n}=await(async(e,t,r)=>{const n=await Kb(r.Links),s=await n._findNewBucketAndPos(t),i=[{bucket:s.bucket,prefix:Hb(s.pos)}];let o=s.bucket;for(;o!==n;)i.push({bucket:o,prefix:Hb(o._posAtParent)}),o=o._parent;i.reverse(),i[0].node=r;for(let r=0;r<i.length;r++){const s=i[r];if(!s.node)throw new Error("Could not generate HAMT path");const o=s.node.Links.filter((e=>(e.Name||"").substring(0,2)===s.prefix)).pop();if(!o){Vb(`Link ${s.prefix}${t} will be added`);continue}if(o.Name===`${s.prefix}${t}`){Vb(`Link ${s.prefix}${t} will be replaced`);continue}Vb(`Found subshard ${s.prefix}`);const a=or(await e.repo.blocks.get(o.Hash));if(!i[r+1]){Vb(`Loaded new subshard ${s.prefix}`),await jb(e,a.Links,n,s.bucket,parseInt(s.prefix,16));const r=await n._findNewBucketAndPos(t);i.push({bucket:r.bucket,prefix:Hb(r.pos),node:a});continue}const c=i[r+1];await $b(e,a.Links,c.bucket,n),c.node=a}return await n.put(t,!0),i.reverse(),{rootBucket:n,path:i}})(e,t.name,t.parent);await r.del(t.name);const{node:s}=await wv(e,n,t.name,t);return Fb(e,s.Links,r,t)})(e,{...t,parent:r})):(mv(`Removing link ${t.name} regular directory`),(async(e,t)=>{t.parent.Links=t.parent.Links.filter((e=>e.Name!==t.name));const r=await ir(t.parent),n=await e.hashers.getHasher(t.hashAlg),s=await n.digest(r),i=kt.create(t.cidVersion,sr,s);return await e.repo.blocks.put(i,r),mv(`Updated regular directory ${i}`),{node:t.parent,cid:i}})(e,{...t,parent:r}))}(e,{parentCid:o.cid,name:i.name,hashAlg:r.hashAlg,cidVersion:r.cidVersion,flush:r.flush,shardSplitThreshold:r.shardSplitThreshold});o.cid=a;const c=await tv(e,s,r);await nv(e,c,r)},Av=ye.bind({ignoreUndefined:!0}),Iv=He("ipfs:mfs:touch"),Rv={flush:!0,shardSplitThreshold:1e3,hashAlg:"sha2-256",cidVersion:0,recursive:!1};function kv(e,t){if(e instanceof String||"string"==typeof e){const r=`${e}`;e=r.match(/^\d+$/g)?parseInt(r,8):0+r.split(",").reduce(((e,r)=>function(e,t,r){t||(t=0);const n=e.match(/^(u?g?o?a?)(-?\+?=?)?(r?w?x?X?s?t?)$/);if(!n)throw new Error(`Invalid file mode: ${e}`);let[,s,i,o]=n;"a"!==s&&s||(s="ugo");let a=function(e,t,r){let n=0;return(e.includes("x")||e.includes("X")&&(r||1&t||8&t||64&t))&&(n+=1),e.includes("w")&&(n+=2),e.includes("r")&&(n+=4),n}(o,t,r);return a=function(e,t){let r=0;return e.includes("u")&&(r+=t<<6),e.includes("g")&&(r+=t<<3),e.includes("o")&&(r+=t),r}(s,a),a=function(e,t,r){return t.includes("t")&&(r+=parseInt("1000",8)),t.includes("s")&&(e.includes("u")&&(r+=parseInt("4000",8)),e.includes("g")&&(r+=parseInt("2000",8))),r}(s,o,a),"="===i?(s.includes("u")&&(t&=parseInt("7077",8),t|=a),s.includes("g")&&(t&=parseInt("7707",8),t|=a),s.includes("o")&&(t&=parseInt("7770",8),t|=a),t):"+"===i?a|t:"-"===i?a^t:t}(r,e,t.isDirectory())),t.mode||0)}return e}const Tv=ye.bind({ignoreUndefined:!0}),Cv={},Pv=ye.bind({ignoreUndefined:!0}),Nv={parents:!1,flush:!0,cidVersion:0,hashAlg:"sha2-256",shardSplitThreshold:1e3},Dv=ye.bind({ignoreUndefined:!0}),Ov=He("ipfs:mfs:touch"),xv={flush:!0,shardSplitThreshold:1e3,cidVersion:0,hashAlg:"sha2-256"},Lv=ye.bind({ignoreUndefined:!0}),Bv={offset:0,length:1/0},Mv=He("ipfs:mfs:utils:to-async-iterator"),Uv=ye.bind({ignoreUndefined:!0}),zv=He("ipfs:mfs:write"),Vv={offset:0,length:1/0,create:!1,truncate:!1,rawLeaves:!1,reduceSingleLeafToSelf:!1,cidVersion:0,hashAlg:"sha2-256",parents:!1,progress:(e,t)=>{},strategy:"trickle",flush:!0,leafType:"raw",shardSplitThreshold:1e3},Fv=async(e,t,r,n)=>{r.exists?zv(`Overwriting file ${r.cid} offset ${n.offset} length ${n.length}`):zv(`Writing file offset ${n.offset} length ${n.length}`);const s=[];if(n.offset>0)if(r.unixfs){if(zv(`Writing first ${n.offset} bytes of original file`),s.push((()=>r.content({offset:0,length:n.offset}))),r.unixfs.fileSize()<n.offset){const e=n.offset-r.unixfs.fileSize();zv(`Writing zeros for extra ${e} bytes`),s.push(Kv(e))}}else zv(`Writing zeros for first ${n.offset} bytes`),s.push(Kv(n.offset));s.push(jv(t,n.length));const i=Hv($v(s),(e=>{if(r.unixfs&&!n.truncate){const t=r.unixfs.fileSize();if(t>e)return zv(`Writing last ${t-e} of ${t} bytes from original file starting at offset ${e}`),r.content({offset:e});zv("Not writing last bytes from original file")}return{[Symbol.asyncIterator]:async function*(){}}}));let o,a;void 0!==n.mode&&null!==n.mode?o=st(n.mode):r&&r.unixfs&&(o=r.unixfs.mode),null!=n.mtime?a=it(n.mtime):r&&r.unixfs&&(a=r.unixfs.mtime);const c=await e.hashers.getHasher(n.hashAlg),l=await Xa(Hp([{content:i,mode:o,mtime:a}],e.repo.blocks,{progress:n.progress,hasher:c,cidVersion:n.cidVersion,strategy:n.strategy,rawLeaves:n.rawLeaves,reduceSingleLeafToSelf:n.reduceSingleLeafToSelf,leafType:n.leafType}));if(!l)throw qe(new Error(`cannot write to ${parent.name}`),"ERR_COULD_NOT_WRITE");return zv(`Wrote ${l.cid}`),{cid:l.cid,size:l.size}},jv=(e,t)=>async function*(){let r=0;for await(const n of e){if(r+=n.length,r>t)return void(yield n.subarray(0,t-r));yield n}},Kv=(e,t=262144)=>{const r=new Uint8Array(t);return jv(async function*(){for(;;)yield r}(),e)},$v=async function*(e){for(let t=0;t<e.length;t++)yield*e[t]()},Hv=async function*(e,t){let r=0;for await(const t of e)r+=t.length,yield t;for await(const e of t(r))r+=e.length,yield e},qv=e=>{const t={cid:e.cid,name:e.name,type:"directory"===e.type?"directory":"file",size:e.size};return"file"!==e.type&&"directory"!==e.type||(t.mode=e.unixfs.mode,t.mtime=e.unixfs.mtime),t},Gv={stat:Pb},Wv={chmod:function(e){return zo((async function(t,r,n={}){const s=Av(Rv,n);Iv(`Fetching stats for ${t}`);const{cid:i,mfsDirectory:o,name:a}=await Rb(e,t,s);if(i.code!==sr)throw qe(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(s.recursive){const n=await Xu((async function*(){for await(const n of pf(i,e.repo.blocks)){if("file"!==n.type&&"directory"!==n.type)throw qe(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");n.unixfs.mode=kv(r,n.unixfs);const e=Xt({Data:n.unixfs.marshal(),Links:n.node.Links});yield{path:n.path,content:e}}}),(t=>Hp(t,e.repo.blocks,{...s,pin:!1,dagBuilder:async function*(e,t,r){for await(const n of e)yield async function(){const e=n.content,s=ir(e),i=await xb(s,t,r);if(!e.Data)throw qe(new Error(`${i} had no data`),"ERR_INVALID_NODE");const o=ot.unmarshal(e.Data);return{cid:i,size:s.length,path:n.path,unixfs:o}}}})),(e=>Xa(e)));if(!n)throw qe(new Error(`Could not chmod ${t}`),"ERR_COULD_NOT_CHMOD");return await _v(e)(t,s),void await dv(e)(`/ipfs/${n.cid}`,t,s)}const c=or(await e.repo.blocks.get(i));if(!c.Data)throw qe(new Error(`${i} had no data`),"ERR_INVALID_NODE");const l=ot.unmarshal(c.Data);l.mode=kv(r,l);const h=ir({Data:l.marshal(),Links:c.Links}),u=s.hashAlg||Rv.hashAlg,d=await e.hashers.getHasher(u),p=await d.digest(h),f=kt.create(s.cidVersion,sr,p);s.flush&&await e.repo.blocks.put(f,h);const y=await Ob(e,o),g=y[y.length-1],m=kt.decode(g.cid.bytes),w=or(await e.repo.blocks.get(m)),b=await Gb(e,{parent:w,name:a,cid:f,size:h.length,flush:s.flush,hashAlg:u,cidVersion:i.version,shardSplitThreshold:1/0});g.cid=b.cid;const v=await tv(e,y,s);await nv(e,v,s)}))},cp:dv,flush:function(e){return zo((async function(t,r={}){r=Tv(Cv,r);const{cid:n}=await Pb(e)(t,r);return n}))},mkdir:av,mv:function(e){return zo((async function(t,r,n={}){const s=Pv(Nv,n);await dv(e)(t,r,s),await _v(e)(t,{...s,recursive:!0})}))},rm:_v,touch:function(e){return zo((async function(t,r={}){const n=Dv(xv,r);n.mtime=n.mtime||new Date,Ov(`Touching ${t} mtime: ${n.mtime}`);const{cid:s,mfsDirectory:i,name:o,exists:a}=await Rb(e,t,n),c=r.hashAlg||xv.hashAlg,l=await e.hashers.getHasher(c);let h,u,d=n.cidVersion;if(a){if(s.code!==sr)throw qe(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");d=s.version;const r=or(await e.repo.blocks.get(s));if(!r.Data)throw qe(new Error(`${t} had no data`),"ERR_INVALID_NODE");const i=ot.unmarshal(r.Data);i.mtime=n.mtime,h=ir({Data:i.marshal(),Links:r.Links});const o=await l.digest(h);u=kt.create(n.cidVersion,sr,o),n.flush&&await e.repo.blocks.put(u,h)}else{h=ir({Data:new ot({type:"file",mtime:n.mtime}).marshal(),Links:[]});const t=await l.digest(h);u=kt.create(n.cidVersion,sr,t),n.flush&&await e.repo.blocks.put(u,h)}const p=await Ob(e,i),f=p[p.length-1],y=f.cid,g=or(await e.repo.blocks.get(y)),m=await Gb(e,{parent:g,name:o,cid:u,size:h.length,flush:n.flush,shardSplitThreshold:n.shardSplitThreshold,hashAlg:n.hashAlg,cidVersion:d});f.cid=m.cid;const w=await tv(e,p,n);await nv(e,w,n)}))}},Yv={write:function(e){return zo((async function(t,r,n={}){const s=Uv(Vv,n);let i,o,a;if(zv("Reading source, destination and parent"),await _b().readLock((async()=>{i=await function(e){if(!e)throw qe(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");if(("string"==typeof e||e instanceof String)&&(Mv("Content was a string"),e=Xs(e.toString())),e.length)return Mv("Content was array-like"),{[Symbol.asyncIterator]:function*(){yield e}};if(e[Symbol.asyncIterator])return Mv("Content was an async iterator"),e;if(e[Symbol.iterator])return Mv("Content was an iterator"),e;if(global.Blob&&e instanceof global.Blob){Mv("Content was an HTML5 Blob");let t=0;const r={next:()=>t>e.size?{done:!0}:new Promise(((r,n)=>{const s=e.slice(t,$o);t+=$o;const i=new global.FileReader,o=e=>{if(i.removeEventListener("loadend",o,!1),e.error)return n(e.error);r({done:!1,value:new Uint8Array(i.result)})};i.addEventListener("loadend",o),i.readAsArrayBuffer(s)}))};return{[Symbol.asyncIterator]:()=>r}}throw qe(new Error(`Don't know how to convert ${e} into an async iterator`),"ERR_INVALID_PARAMS")}(r),o=await Rb(e,t,s),a=await Rb(e,o.mfsDirectory,s)}))(),zv("Read source, destination and parent"),!s.parents&&!a.exists)throw qe(new Error("directory does not exist"),"ERR_NO_EXIST");if(null==i)throw qe(new Error("could not create source"),"ERR_NO_SOURCE");if(null==o)throw qe(new Error("could not create destination"),"ERR_NO_DESTINATION");if(!s.create&&!o.exists)throw qe(new Error("file does not exist"),"ERR_NO_EXIST");if("file"!==o.entryType)throw qe(new Error("not a file"),"ERR_NOT_A_FILE");return(async(e,t,r,n,s)=>{const i=await Fv(e,r,n,s);await _b().writeLock((async()=>{const r=Ib(t),n=r.pop();if(null==n)throw qe(new Error("source does not exist"),"ERR_NO_EXIST");let o=!1;try{await Pb(e)(`/${r.join("/")}`,s),o=!0}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}o||await av(e)(`/${r.join("/")}`,s);const a=await Rb(e,t,s),c=await Ob(e,a.mfsDirectory),l=c[c.length-1];if(!l)throw qe(new Error("directory does not exist"),"ERR_NO_EXIST");if(!l.type||!l.type.includes("directory"))throw qe(new Error(`cannot write to ${l.name}: Not a directory`),"ERR_NOT_A_DIRECTORY");const h=or(await e.repo.blocks.get(l.cid)),u=await Gb(e,{parent:h,name:n,cid:i.cid,size:i.size,flush:s.flush,shardSplitThreshold:s.shardSplitThreshold,hashAlg:s.hashAlg,cidVersion:s.cidVersion});l.cid=u.cid;const d=await tv(e,c,s);await nv(e,d,s)}))()})(e,t,i,o,s)}))},read:function(e){return zo((function(t,r={}){return r=Lv(Bv,r),{[Symbol.asyncIterator]:async function*(){const n=await Rb(e,t,r),s=await df(n.mfsPath,e.repo.blocks);if("file"!==s.type)throw qe(new Error(`${t} was not a file`),"ERR_NOT_FILE");if(!s.content)throw qe(new Error(`Could not load content stream from ${t}`),"ERR_NO_CONTENT");for await(const e of s.content({offset:r.offset,length:r.length}))yield e}}}))},ls:function(e){return zo((async function*(t,r={}){const n=await Rb(e,t,r),s=await df(n.mfsPath,e.repo.blocks);"directory"!==s.type?yield qv(s):yield*zd(s.content(r),qv)}))}},Zv=({options:e,mfs:t,operations:r,lock:n})=>{Object.keys(r).forEach((s=>{t[s]=n(r[s](e))}))},Qv={repoOwner:!0,repo:null};const Jv="Ed25519";class Xv{constructor({keychain:e}){this.gen=function({keychain:e}){return zo(((t,r={type:Jv,size:2048})=>e.createKey(t,r.type||Jv,r.size||2048)))}({keychain:e}),this.list=function({keychain:e}){return zo((()=>e.listKeys()))}({keychain:e}),this.rm=function({keychain:e}){return zo((t=>e.removeKey(t)))}({keychain:e}),this.rename=function({keychain:e}){return zo((async(t,r)=>{const n=await e.renameKey(t,r);return{was:t,now:n.name,id:n.id,overwrite:!1}}))}({keychain:e}),this.export=function({keychain:e}){return zo(((t,r)=>e.exportKey(t,r)))}({keychain:e}),this.import=function({keychain:e}){return zo(((t,r,n)=>e.importKey(t,r,n)))}({keychain:e}),this.info=function({keychain:e}){return zo((t=>e.findKeyByName(t)))}({keychain:e})}}function eE({repo:e,preload:t}){return zo((async function(r,n={}){return!1!==n.preload&&t(r),or(await e.blocks.get(r,n))}))}function tE(e,t=[]){for(const r in e){const n=e[r];if("/"===r&&1===Object.keys(e).length)try{t.push({Name:"",Tsize:0,Hash:kt.parse(n)});continue}catch(e){}const s=kt.asCID(n);s?t.push({Name:"",Tsize:0,Hash:s}):(Array.isArray(n)&&tE(n,t),n&&"object"==typeof n&&tE(n,t))}return t}function rE({repo:e,codecs:t}){return zo((async function(r,n={}){const s=await t.getCodec(r.code),i=await e.blocks.get(r,n),o=s.decode(i);switch(r.code){case ks:return[];case sr:return o.Links;case xn:case Gn:return tE(o);default:throw new Error(`Cannot resolve links from codec ${r.code}`)}}))}function nE({repo:e,preload:t}){return zo((async function(r,n={}){const s=await e.gcLock.readLock();try{const i=ir(r),o=await As.digest(i),a=kt.createV1(sr,o);return await e.blocks.put(a,i,{signal:n.signal}),!1!==n.preload&&t(a),n.pin&&await e.pins.pinRecursively(a,{signal:n.signal}),a}finally{s()}}))}class sE{constructor({repo:e,preload:t}){this.addLink=function({repo:e,preload:t}){const r=eE({repo:e,preload:t}),n=nE({repo:e,preload:t});return zo((async function(e,t,s={}){const i=await r(e,s);return n({...i,Links:i.Links.concat([t])},s)}))}({repo:e,preload:t}),this.appendData=function({repo:e,preload:t}){const r=eE({repo:e,preload:t}),n=nE({repo:e,preload:t});return zo((async function(e,t,s={}){const i=await r(e,s),o=di([i.Data||[],t]);return n({...i,Data:o},s)}))}({repo:e,preload:t}),this.rmLink=function({repo:e,preload:t}){const r=eE({repo:e,preload:t}),n=nE({repo:e,preload:t});return zo((async function(e,t,s={}){const i=await r(e,s),o=("string"==typeof t?t:t.Name)||"";return i.Links=i.Links.filter((e=>e.Name!==o)),n(i,s)}))}({repo:e,preload:t}),this.setData=function({repo:e,preload:t}){const r=eE({repo:e,preload:t}),n=nE({repo:e,preload:t});return zo((async function(e,t,s={}){const i=await r(e,s);return n({...i,Data:t},s)}))}({repo:e,preload:t})}}class iE{constructor({repo:e,codecs:t,preload:r}){this.data=function({repo:e,preload:t}){const r=eE({repo:e,preload:t});return zo((async function(e,t={}){return(await r(e,t)).Data||new Uint8Array(0)}))}({repo:e,preload:r}),this.get=eE({repo:e,preload:r}),this.links=rE({repo:e,codecs:t}),this.new=function({repo:e,preload:t}){return zo((async function(r={}){let n;if(r.template){if("unixfs-dir"!==r.template)throw new Error("unknown template");n=new ot({type:"directory"}).marshal()}const s=ir({Data:n,Links:[]}),i=await As.digest(s),o=kt.createV0(i);return await e.blocks.put(o,s,{signal:r.signal}),!1!==r.preload&&t(o),o}))}({repo:e,preload:r}),this.put=nE({repo:e,preload:r}),this.stat=function({repo:e,preload:t}){const r=eE({repo:e,preload:t});return zo((async function(e,t={}){const n=await r(e,t),s=ir(n).length,i=n.Links.reduce(((e,t)=>e+(t.Tsize||0)),0);return{Hash:e,NumLinks:n.Links.length,BlockSize:s,LinksSize:s-(n.Data||[]).length,DataSize:(n.Data||[]).length,CumulativeSize:s+i}}))}({repo:e,preload:r}),this.patch=new sE({repo:e,preload:r})}}const oE=He("ipfs:repo:gc");function aE({repo:e}){return zo((async function(t={}){const r=await e.stat();return{numObjects:BigInt(r.numObjects.toString()),repoSize:BigInt(r.repoSize.toString()),repoPath:r.repoPath,version:`${r.version}`,storageMax:BigInt(r.storageMax.toString())}}))}class cE{constructor({repo:e,hashers:t}){this.gc=function({repo:e,hashers:t}){return zo((async function*(r={}){const n=Date.now();let s;try{s=await Ab({repo:e,hashers:t},r),await e.pins.pinRecursively(s),yield*e.gc()}finally{s&&await e.pins.unpin(s)}oE(`Complete (${Date.now()-n}ms)`)}))}({repo:e,hashers:t}),this.stat=aE({repo:e}),this.version=function({repo:e}){return zo((async function(t={}){try{await e._checkInitialized(t)}catch(e){if([/Key not found in database \[\/version\]/,/ENOENT/,/repo is not initialized yet/].some((t=>t.test(e.message))))return 12;throw e}return e.version.get()}))}({repo:e}),this.setApiAddr=t=>e.apiAddr.set(t)}}function lE(e,t){let r;if(r=e.metrics?t.peer?e.metrics.forPeer(t.peer):t.proto?e.metrics.forProtocol(t.proto):e.metrics.getGlobal():void 0,!r)return{totalIn:BigInt(0),totalOut:BigInt(0),rateIn:0,rateOut:0};const n=r.getMovingAverages(),s=r.getSnapshot();return{totalIn:s.dataReceived,totalOut:s.dataSent,rateIn:n.dataReceived[6e4].movingAverage/60,rateOut:n.dataSent[6e4].movingAverage/60}}class hE{constructor({repo:e,network:t}){this.repo=aE({repo:e}),this.bw=function({network:e}){return zo((async function*(t={}){const{libp2p:r}=await e.use(t);if(!t.poll)return void(yield lE(r,t));const n=t.interval||1e3;let s,i=-1;try{if(i="string"==typeof n?Mo(n)||-1:n,!i||i<0)throw new Error("invalid duration")}catch(e){throw qe(e,"ERR_INVALID_POLL_INTERVAL")}try{for(;;)yield lE(r,t),await new Promise((e=>{s=setTimeout(e,i)}))}finally{clearTimeout(s)}}))}({network:t}),this.bitswap=Dd({network:t})}}var uE=function(e,t,r){if(!e)return r;var n,s;if(Array.isArray(t)&&(n=t.slice(0)),"string"==typeof t&&(n=t.split(".")),"symbol"==typeof t&&(n=[t]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");for(;n.length;){if(s=n.shift(),!e)return r;if(void 0===(e=e[s]))return r}return e};async function dE(e){let t=0;for await(const r of e)t++;return t}const pE=me("ipfs:repo:migrator:migration-8");function fE(e){return e.child?fE(e.child):e}function yE(e){try{const t=De.decode(`b${e.toString().toLowerCase().slice(1)}`),r=kt.decode(t).multihash.bytes,n=De.encode(r).slice(1).toUpperCase();return new Do(`/${n}`,!1)}catch(t){return e}}function gE(e){try{const t=De.decode(`b${e.toString().toLowerCase().slice(1)}`),r=St(t),n=De.encode(kt.createV1(ks,r).bytes).slice(1);return new Do(`/${n.toUpperCase()}`,!1)}catch{return e}}async function mE(e,t,r){const n=e.blocks;await n.open();const s=fE(n),i=await dE(s.queryKeys({filters:[e=>r(e).toString()!==e.toString()]}));try{let e=0;for await(const n of s.query({})){const o=r(n.key);o.toString()!==n.key.toString()&&(e+=1,pE(`Migrating Block from ${n.key} to ${o}`,await s.has(n.key)),await s.delete(n.key),await s.put(o,n.value),t(e/i*100,`Migrated Block from ${n.key} to ${o}`))}}finally{await n.close()}}const wE={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:(e,t=(()=>{}))=>mE(e,t,yE),revert:(e,t=(()=>{}))=>mE(e,t,gE)},bE=Ge.Reader,vE=Ge.Writer,EE=(Ge.util,Ge.roots.default||(Ge.roots.default={})),_E=EE.ipfs=(()=>{const e={};return e.pin=function(){const e={};return e.Set=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.version=0,e.prototype.fanout=0,e.prototype.seed=0,e.encode=function(e,t){return t||(t=vE.create()),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(8).uint32(e.version),null!=e.fanout&&Object.hasOwnProperty.call(e,"fanout")&&t.uint32(16).uint32(e.fanout),null!=e.seed&&Object.hasOwnProperty.call(e,"seed")&&t.uint32(29).fixed32(e.seed),t},e.decode=function(e,t){e instanceof bE||(e=bE.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new EE.ipfs.pin.Set;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.version=e.uint32();break;case 2:n.fanout=e.uint32();break;case 3:n.seed=e.fixed32();break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof EE.ipfs.pin.Set)return e;var t=new EE.ipfs.pin.Set;return null!=e.version&&(t.version=e.version>>>0),null!=e.fanout&&(t.fanout=e.fanout>>>0),null!=e.seed&&(t.seed=e.seed>>>0),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.version=0,r.fanout=0,r.seed=0),null!=e.version&&e.hasOwnProperty("version")&&(r.version=e.version),null!=e.fanout&&e.hasOwnProperty("fanout")&&(r.fanout=e.fanout),null!=e.seed&&e.hasOwnProperty("seed")&&(r.seed=e.seed),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e}(),e}(),e})();var SE=r(122);const AE=new Do("/local/pins"),IE=kt.parse("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),RE="direct",kE="recursive";function TE(e){return new Do(`/${De.encode(e.multihash.bytes).toUpperCase().substring(1)}`)}function CE(e,t){for(let r=0;r<e.byteLength;r++){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}const PE=_E.pin.Set;async function*NE(e,t){const r=function(e){const t=e.Data;if(!t)throw new Error("No data present");const r=ui.decode(t),n=ui.decode.bytes;if(n<=0)throw new Error("Invalid Set header length");if(n+r>t.length)throw new Error("Impossibly large set header length");const s=t.slice(n,r+n),i=PE.toObject(PE.decode(s),{defaults:!1,arrays:!0,longs:Number,objects:!1});if(1!==i.version)throw new Error(`Unsupported Set version: ${i.version}`);if(i.fanout>e.Links.length)throw new Error("Impossibly large fanout");return{header:i,data:t.slice(r+n)}}(t);let n=0;for(const s of t.Links){if(n<r.header.fanout){const t=s.Hash;if(!IE.equals(t)){const r=or(await e.get(t));yield*NE(e,r)}}else yield s.Hash;n++}}async function*DE(e,t,r){const n=t.Links.find((e=>e.Name===r));if(!n)throw new Error("No link found with name "+r);const s=or(await e.get(n.Hash));yield*NE(e,s)}async function OE(e,t,r){const n=await function(e,t){return async function t(r,n){const s=PE.encode({version:1,fanout:256,seed:n}).finish(),i=di([ui.encode(s.length),s]),o=[];for(let e=0;e<256;e++)o.push({Name:"",Tsize:1,Hash:IE});if(r.length<=8192){const e=r.map((e=>({link:{Name:"",Tsize:1,Hash:e.key},data:e.data||new Uint8Array}))).sort(((e,t)=>CE(e.link.Hash.bytes,t.link.Hash.bytes))),t=o.concat(e.map((e=>e.link)));return{Data:di([i,...e.map((e=>e.data))]),Links:t}}{const e=r.reduce(((e,t)=>{const r=function(e,t){const r=new Uint8Array(4);new DataView(r.buffer).setUint32(0,e,!0);const n=Xs(t.toString()),s=di([r,n],r.byteLength+n.byteLength);return SE(ni(s))}(n,t.key)%256;return e[r]=r in e?e[r].concat([t]):[t],e}),[]);let s=0;for(const r of e){const e=await t(r,n+1);await a(e,s),s++}return{Data:i,Links:o}}async function a(t,r){const n=ir(t),s=await As.digest(n),i=kt.createV0(s);await e.put(i,n);const a=t.Links.reduce(((e,t)=>e+(t.Tsize||0)),0)+n.length;o[r]={Name:"",Tsize:a,Hash:i}}}(t,0)}(e,r.map((e=>({key:e})))),s=ir(n),i=await As.digest(s),o=kt.createV0(i);return await e.put(o,s),{Name:t,Tsize:n.Links.reduce(((e,t)=>e+t.Tsize),0)+s.length,Hash:o}}async function xE(e,t,r,n){if(!await t.has(AE))return;const s=await t.get(AE),i=kt.decode(s),o=or(await e.get(i));let a=0;const c=await dE(DE(e,o,kE))+await dE(DE(e,o,RE));for await(const t of DE(e,o,kE)){a++;const e={depth:1/0};0!==t.version&&(e.version=t.version),t.code!==sr&&(e.codec=t.code),await r.put(TE(t),An(e)),n(a/c*100,`Migrated recursive pin ${t}`)}for await(const t of DE(e,o,RE)){a++;const e={depth:0};0!==t.version&&(e.version=t.version),t.code!==sr&&(e.codec=t.code),await r.put(TE(t),An(e)),n(a/c*100,`Migrated direct pin ${t}`)}await e.delete(i),await t.delete(AE)}async function LE(e,t,r,n){const s=[],i=[];let o=0;const a=await dE(r.queryKeys({}));for await(const{key:e,value:t}of r.query({})){o++;const r=Pn(t),c=kt.create(r.version||0,r.codec||sr,St(De.decode("b"+e.toString().toLowerCase().split("/").pop())));0===r.depth?(n(o/a*100,`Reverted direct pin ${c}`),i.push(c)):(n(o/a*100,`Reverted recursive pin ${c}`),s.push(c))}n(100,"Updating pin root");const c=ir({Links:[await OE(e,RE,i),await OE(e,kE,s)]}),l=await As.digest(c),h=kt.createV0(l);await e.put(h,c),await t.put(AE,h.bytes)}async function BE(e,t,r){const n=e.blocks,s=e.datastore,i=e.pins;await n.open(),await s.open(),await i.open();try{await r(n,s,i,t)}finally{await i.close(),await s.close(),await n.close()}}const ME={version:9,description:"Migrates pins to datastore",migrate:(e,t=(()=>{}))=>BE(e,t,xE),revert:(e,t=(()=>{}))=>BE(e,t,LE)},UE=new Do("/config"),zE=new Do("/version");function VE(e){let t=e;for(;t.db||t.child;)if(t=t.db||t.child,"level-js"===t.type||"Level"===t.constructor.name)return t}function FE(e){const t=e.get.bind(e),r=e.has.bind(e);return e.get=n=>async function(e,t,r,n){if(await r(e))return t(e);const s=VE(n);if(!s)throw cc();return new Promise(((t,r)=>{const n=s.store("readonly").get(e.toString());n.transaction.onabort=()=>{r(n.transaction.error)},n.transaction.oncomplete=()=>{if(n.result)return t(n.result);r(cc())}}))}(n,t,r,e),e.has=t=>async function(e,t,r){const n=await t(e);if(n)return n;const s=VE(r);return!!s&&new Promise(((t,r)=>{const n=s.store("readonly").get(e.toString());n.transaction.onabort=()=>{r(n.transaction.error)},n.transaction.oncomplete=()=>{t(Boolean(n.result))}}))}(t,r,e),e}function jE(e){return{...e,root:FE(e.root),datastore:FE(e.datastore),pins:FE(e.pins),keys:FE(e.keys)}}async function KE(e,t,r=(()=>{})){const n=VE(t);n?(r(`Upgrading ${e}`),await WE(n,((e,t)=>[{type:"del",key:e},{type:"put",key:Xs(e),value:t}]))):r(`${e} did not need an upgrade`)}async function $E(e,t,r=(()=>{})){const n=VE(t);n?(r(`Downgrading ${e}`),await WE(n,((e,t)=>[{type:"del",key:e},{type:"put",key:ni(e),value:t}]))):r(`${e} did not need a downgrade`)}function HE(e){return e.child?HE(e.child):e}async function qE(e,t,r){const n=Object.entries(e).map((([e,t])=>({key:e,backend:HE(t)}))).filter((({key:e,backend:t})=>"LevelDatastore"===t.constructor.name)).map((({key:e,backend:t})=>({name:e,store:t})));t(0,`Migrating ${n.length} dbs`);let s=0;const i=e=>{t(Math.round(s/n.length*100),e)};for(const{name:e,store:t}of n){await t.open();try{await r(e,t,i)}finally{s++,await t.close()}}t(100,`Migrated ${n.length} dbs`)}const GE={version:10,description:"Migrates datastore-level keys to binary",migrate:(e,t=(()=>{}))=>qE(e,t,KE),revert:(e,t=(()=>{}))=>qE(e,t,$E)};function WE(e,t){return new Promise(((r,n)=>{const s=e.iterator();s._deserializeKey=s._deserializeValue=e=>e,function i(){s.next(((o,a,c)=>{if(o||void 0===a){const e=e=>{e?n(e):r()};s.end(e)}else!function(t,r){const n=e.store("readwrite"),s=n.transaction;let i,o=0;s.onabort=()=>r(i||s.error||new Error("aborted by user")),s.oncomplete=()=>r(),function e(){const r=t[o++],a=r.key;let c;try{c="del"===r.type?n.delete(a):n.put(r.value,a)}catch(e){return i=e,void s.abort()}o<t.length&&(c.onsuccess=e)}()}(t(a,c),i)}))}()}))}const YE=new Do("/local/filesroot"),ZE={version:11,description:"Store mfs root in the datastore",migrate:async function(e,t=(()=>{})){if(t(100,"Migrating MFS root to repo datastore"),await e.root.open(),await e.datastore.open(),await e.root.has(YE)){const t=await e.root.get(YE);await e.datastore.put(YE,t),await e.root.delete(YE)}await e.datastore.close(),await e.root.close(),t(100,"Stored MFS root in repo datastore")},revert:async function(e,t=(()=>{})){if(t(100,"Migrating MFS root to repo root datastore"),await e.root.open(),await e.datastore.open(),await e.datastore.has(YE)){const t=await e.datastore.get(YE);await e.root.put(YE,t),await e.datastore.delete(YE)}await e.datastore.close(),await e.root.close(),t(100,"Stored MFS root in repo root datastore")}},QE=Ge.Reader,JE=Ge.Writer,XE=Ge.util,e_=Ge.roots.default||(Ge.roots.default={}),t_=e_.Protocols=(()=>{function e(e){if(this.protocols=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.protocols=XE.emptyArray,e.encode=function(e,t){if(t||(t=JE.create()),null!=e.protocols&&e.protocols.length)for(var r=0;r<e.protocols.length;++r)t.uint32(10).string(e.protocols[r]);return t},e.decode=function(e,t){e instanceof QE||(e=QE.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new e_.Protocols;e.pos<r;){var s=e.uint32();s>>>3==1?(n.protocols&&n.protocols.length||(n.protocols=[]),n.protocols.push(e.string())):e.skipType(7&s)}return n},e.fromObject=function(e){if(e instanceof e_.Protocols)return e;var t=new e_.Protocols;if(e.protocols){if(!Array.isArray(e.protocols))throw TypeError(".Protocols.protocols: array expected");t.protocols=[];for(var r=0;r<e.protocols.length;++r)t.protocols[r]=String(e.protocols[r])}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.protocols=[]),e.protocols&&e.protocols.length){r.protocols=[];for(var n=0;n<e.protocols.length;++n)r.protocols[n]=e.protocols[n]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e})(),r_=Ge.Reader,n_=Ge.Writer,s_=Ge.util,i_=Ge.roots.default||(Ge.roots.default={}),o_=i_.Addresses=(()=>{function e(e){if(this.addrs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.addrs=s_.emptyArray,e.prototype.certifiedRecord=null,e.encode=function(e,t){if(t||(t=n_.create()),null!=e.addrs&&e.addrs.length)for(var r=0;r<e.addrs.length;++r)i_.Addresses.Address.encode(e.addrs[r],t.uint32(10).fork()).ldelim();return null!=e.certifiedRecord&&Object.hasOwnProperty.call(e,"certifiedRecord")&&i_.Addresses.CertifiedRecord.encode(e.certifiedRecord,t.uint32(18).fork()).ldelim(),t},e.decode=function(e,t){e instanceof r_||(e=r_.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new i_.Addresses;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.addrs&&n.addrs.length||(n.addrs=[]),n.addrs.push(i_.Addresses.Address.decode(e,e.uint32()));break;case 2:n.certifiedRecord=i_.Addresses.CertifiedRecord.decode(e,e.uint32());break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof i_.Addresses)return e;var t=new i_.Addresses;if(e.addrs){if(!Array.isArray(e.addrs))throw TypeError(".Addresses.addrs: array expected");t.addrs=[];for(var r=0;r<e.addrs.length;++r){if("object"!=typeof e.addrs[r])throw TypeError(".Addresses.addrs: object expected");t.addrs[r]=i_.Addresses.Address.fromObject(e.addrs[r])}}if(null!=e.certifiedRecord){if("object"!=typeof e.certifiedRecord)throw TypeError(".Addresses.certifiedRecord: object expected");t.certifiedRecord=i_.Addresses.CertifiedRecord.fromObject(e.certifiedRecord)}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.addrs=[]),t.defaults&&(r.certifiedRecord=null),e.addrs&&e.addrs.length){r.addrs=[];for(var n=0;n<e.addrs.length;++n)r.addrs[n]=i_.Addresses.Address.toObject(e.addrs[n],t)}return null!=e.certifiedRecord&&e.hasOwnProperty("certifiedRecord")&&(r.certifiedRecord=i_.Addresses.CertifiedRecord.toObject(e.certifiedRecord,t)),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e.Address=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}let t;return e.prototype.multiaddr=s_.newBuffer([]),e.prototype.isCertified=null,Object.defineProperty(e.prototype,"_isCertified",{get:s_.oneOfGetter(t=["isCertified"]),set:s_.oneOfSetter(t)}),e.encode=function(e,t){return t||(t=n_.create()),null!=e.multiaddr&&Object.hasOwnProperty.call(e,"multiaddr")&&t.uint32(10).bytes(e.multiaddr),null!=e.isCertified&&Object.hasOwnProperty.call(e,"isCertified")&&t.uint32(16).bool(e.isCertified),t},e.decode=function(e,t){e instanceof r_||(e=r_.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new i_.Addresses.Address;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.multiaddr=e.bytes();break;case 2:n.isCertified=e.bool();break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof i_.Addresses.Address)return e;var t=new i_.Addresses.Address;return null!=e.multiaddr&&("string"==typeof e.multiaddr?s_.base64.decode(e.multiaddr,t.multiaddr=s_.newBuffer(s_.base64.length(e.multiaddr)),0):e.multiaddr.length&&(t.multiaddr=e.multiaddr)),null!=e.isCertified&&(t.isCertified=Boolean(e.isCertified)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.multiaddr="":(r.multiaddr=[],t.bytes!==Array&&(r.multiaddr=s_.newBuffer(r.multiaddr)))),null!=e.multiaddr&&e.hasOwnProperty("multiaddr")&&(r.multiaddr=t.bytes===String?s_.base64.encode(e.multiaddr,0,e.multiaddr.length):t.bytes===Array?Array.prototype.slice.call(e.multiaddr):e.multiaddr),null!=e.isCertified&&e.hasOwnProperty("isCertified")&&(r.isCertified=e.isCertified,t.oneofs&&(r._isCertified="isCertified")),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e}(),e.CertifiedRecord=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=s_.Long?s_.Long.fromBits(0,0,!0):0,e.prototype.raw=s_.newBuffer([]),e.encode=function(e,t){return t||(t=n_.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.raw&&Object.hasOwnProperty.call(e,"raw")&&t.uint32(18).bytes(e.raw),t},e.decode=function(e,t){e instanceof r_||(e=r_.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new i_.Addresses.CertifiedRecord;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.seq=e.uint64();break;case 2:n.raw=e.bytes();break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof i_.Addresses.CertifiedRecord)return e;var t=new i_.Addresses.CertifiedRecord;return null!=e.seq&&(s_.Long?(t.seq=s_.Long.fromValue(e.seq)).unsigned=!0:"string"==typeof e.seq?t.seq=parseInt(e.seq,10):"number"==typeof e.seq?t.seq=e.seq:"object"==typeof e.seq&&(t.seq=new s_.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0))),null!=e.raw&&("string"==typeof e.raw?s_.base64.decode(e.raw,t.raw=s_.newBuffer(s_.base64.length(e.raw)),0):e.raw.length&&(t.raw=e.raw)),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if(s_.Long){var n=new s_.Long(0,0,!0);r.seq=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.seq=t.longs===String?"0":0;t.bytes===String?r.raw="":(r.raw=[],t.bytes!==Array&&(r.raw=s_.newBuffer(r.raw)))}return null!=e.seq&&e.hasOwnProperty("seq")&&("number"==typeof e.seq?r.seq=t.longs===String?String(e.seq):e.seq:r.seq=t.longs===String?s_.Long.prototype.toString.call(e.seq):t.longs===Number?new s_.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0):e.seq),null!=e.raw&&e.hasOwnProperty("raw")&&(r.raw=t.bytes===String?s_.base64.encode(e.raw,0,e.raw.length):t.bytes===Array?Array.prototype.slice.call(e.raw):e.raw),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e}(),e})(),a_=Ge.Reader,c_=Ge.Writer,l_=Ge.util,h_=Ge.roots.default||(Ge.roots.default={}),u_=h_.Peer=(()=>{function e(e){if(this.addresses=[],this.protocols=[],this.metadata=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}let t;return e.prototype.addresses=l_.emptyArray,e.prototype.protocols=l_.emptyArray,e.prototype.metadata=l_.emptyArray,e.prototype.pubKey=null,e.prototype.peerRecordEnvelope=null,Object.defineProperty(e.prototype,"_pubKey",{get:l_.oneOfGetter(t=["pubKey"]),set:l_.oneOfSetter(t)}),Object.defineProperty(e.prototype,"_peerRecordEnvelope",{get:l_.oneOfGetter(t=["peerRecordEnvelope"]),set:l_.oneOfSetter(t)}),e.encode=function(e,t){if(t||(t=c_.create()),null!=e.addresses&&e.addresses.length)for(var r=0;r<e.addresses.length;++r)h_.Address.encode(e.addresses[r],t.uint32(10).fork()).ldelim();if(null!=e.protocols&&e.protocols.length)for(r=0;r<e.protocols.length;++r)t.uint32(18).string(e.protocols[r]);if(null!=e.metadata&&e.metadata.length)for(r=0;r<e.metadata.length;++r)h_.Metadata.encode(e.metadata[r],t.uint32(26).fork()).ldelim();return null!=e.pubKey&&Object.hasOwnProperty.call(e,"pubKey")&&t.uint32(34).bytes(e.pubKey),null!=e.peerRecordEnvelope&&Object.hasOwnProperty.call(e,"peerRecordEnvelope")&&t.uint32(42).bytes(e.peerRecordEnvelope),t},e.decode=function(e,t){e instanceof a_||(e=a_.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new h_.Peer;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.addresses&&n.addresses.length||(n.addresses=[]),n.addresses.push(h_.Address.decode(e,e.uint32()));break;case 2:n.protocols&&n.protocols.length||(n.protocols=[]),n.protocols.push(e.string());break;case 3:n.metadata&&n.metadata.length||(n.metadata=[]),n.metadata.push(h_.Metadata.decode(e,e.uint32()));break;case 4:n.pubKey=e.bytes();break;case 5:n.peerRecordEnvelope=e.bytes();break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof h_.Peer)return e;var t=new h_.Peer;if(e.addresses){if(!Array.isArray(e.addresses))throw TypeError(".Peer.addresses: array expected");t.addresses=[];for(var r=0;r<e.addresses.length;++r){if("object"!=typeof e.addresses[r])throw TypeError(".Peer.addresses: object expected");t.addresses[r]=h_.Address.fromObject(e.addresses[r])}}if(e.protocols){if(!Array.isArray(e.protocols))throw TypeError(".Peer.protocols: array expected");for(t.protocols=[],r=0;r<e.protocols.length;++r)t.protocols[r]=String(e.protocols[r])}if(e.metadata){if(!Array.isArray(e.metadata))throw TypeError(".Peer.metadata: array expected");for(t.metadata=[],r=0;r<e.metadata.length;++r){if("object"!=typeof e.metadata[r])throw TypeError(".Peer.metadata: object expected");t.metadata[r]=h_.Metadata.fromObject(e.metadata[r])}}return null!=e.pubKey&&("string"==typeof e.pubKey?l_.base64.decode(e.pubKey,t.pubKey=l_.newBuffer(l_.base64.length(e.pubKey)),0):e.pubKey.length&&(t.pubKey=e.pubKey)),null!=e.peerRecordEnvelope&&("string"==typeof e.peerRecordEnvelope?l_.base64.decode(e.peerRecordEnvelope,t.peerRecordEnvelope=l_.newBuffer(l_.base64.length(e.peerRecordEnvelope)),0):e.peerRecordEnvelope.length&&(t.peerRecordEnvelope=e.peerRecordEnvelope)),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.addresses=[],r.protocols=[],r.metadata=[]),e.addresses&&e.addresses.length){r.addresses=[];for(var n=0;n<e.addresses.length;++n)r.addresses[n]=h_.Address.toObject(e.addresses[n],t)}if(e.protocols&&e.protocols.length)for(r.protocols=[],n=0;n<e.protocols.length;++n)r.protocols[n]=e.protocols[n];if(e.metadata&&e.metadata.length)for(r.metadata=[],n=0;n<e.metadata.length;++n)r.metadata[n]=h_.Metadata.toObject(e.metadata[n],t);return null!=e.pubKey&&e.hasOwnProperty("pubKey")&&(r.pubKey=t.bytes===String?l_.base64.encode(e.pubKey,0,e.pubKey.length):t.bytes===Array?Array.prototype.slice.call(e.pubKey):e.pubKey,t.oneofs&&(r._pubKey="pubKey")),null!=e.peerRecordEnvelope&&e.hasOwnProperty("peerRecordEnvelope")&&(r.peerRecordEnvelope=t.bytes===String?l_.base64.encode(e.peerRecordEnvelope,0,e.peerRecordEnvelope.length):t.bytes===Array?Array.prototype.slice.call(e.peerRecordEnvelope):e.peerRecordEnvelope,t.oneofs&&(r._peerRecordEnvelope="peerRecordEnvelope")),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e})(),d_=(h_.Address=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}let t;return e.prototype.multiaddr=l_.newBuffer([]),e.prototype.isCertified=null,Object.defineProperty(e.prototype,"_isCertified",{get:l_.oneOfGetter(t=["isCertified"]),set:l_.oneOfSetter(t)}),e.encode=function(e,t){return t||(t=c_.create()),null!=e.multiaddr&&Object.hasOwnProperty.call(e,"multiaddr")&&t.uint32(10).bytes(e.multiaddr),null!=e.isCertified&&Object.hasOwnProperty.call(e,"isCertified")&&t.uint32(16).bool(e.isCertified),t},e.decode=function(e,t){e instanceof a_||(e=a_.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new h_.Address;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.multiaddr=e.bytes();break;case 2:n.isCertified=e.bool();break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof h_.Address)return e;var t=new h_.Address;return null!=e.multiaddr&&("string"==typeof e.multiaddr?l_.base64.decode(e.multiaddr,t.multiaddr=l_.newBuffer(l_.base64.length(e.multiaddr)),0):e.multiaddr.length&&(t.multiaddr=e.multiaddr)),null!=e.isCertified&&(t.isCertified=Boolean(e.isCertified)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.multiaddr="":(r.multiaddr=[],t.bytes!==Array&&(r.multiaddr=l_.newBuffer(r.multiaddr)))),null!=e.multiaddr&&e.hasOwnProperty("multiaddr")&&(r.multiaddr=t.bytes===String?l_.base64.encode(e.multiaddr,0,e.multiaddr.length):t.bytes===Array?Array.prototype.slice.call(e.multiaddr):e.multiaddr),null!=e.isCertified&&e.hasOwnProperty("isCertified")&&(r.isCertified=e.isCertified,t.oneofs&&(r._isCertified="isCertified")),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e})(),h_.Metadata=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.key="",e.prototype.value=l_.newBuffer([]),e.encode=function(e,t){return t||(t=c_.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).bytes(e.value),t},e.decode=function(e,t){e instanceof a_||(e=a_.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new h_.Metadata;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.key=e.string();break;case 2:n.value=e.bytes();break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof h_.Metadata)return e;var t=new h_.Metadata;return null!=e.key&&(t.key=String(e.key)),null!=e.value&&("string"==typeof e.value?l_.base64.decode(e.value,t.value=l_.newBuffer(l_.base64.length(e.value)),0):e.value.length&&(t.value=e.value)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.key="",t.bytes===String?r.value="":(r.value=[],t.bytes!==Array&&(r.value=l_.newBuffer(r.value)))),null!=e.key&&e.hasOwnProperty("key")&&(r.key=e.key),null!=e.value&&e.hasOwnProperty("value")&&(r.value=t.bytes===String?l_.base64.encode(e.value,0,e.value.length):t.bytes===Array?Array.prototype.slice.call(e.value):e.value),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e})(),Ge.Reader),p_=Ge.Writer,f_=Ge.util,y_=Ge.roots.default||(Ge.roots.default={}),g_=y_.Envelope=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.publicKey=f_.newBuffer([]),e.prototype.payloadType=f_.newBuffer([]),e.prototype.payload=f_.newBuffer([]),e.prototype.signature=f_.newBuffer([]),e.encode=function(e,t){return t||(t=p_.create()),null!=e.publicKey&&Object.hasOwnProperty.call(e,"publicKey")&&t.uint32(10).bytes(e.publicKey),null!=e.payloadType&&Object.hasOwnProperty.call(e,"payloadType")&&t.uint32(18).bytes(e.payloadType),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(26).bytes(e.payload),null!=e.signature&&Object.hasOwnProperty.call(e,"signature")&&t.uint32(42).bytes(e.signature),t},e.decode=function(e,t){e instanceof d_||(e=d_.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new y_.Envelope;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.publicKey=e.bytes();break;case 2:n.payloadType=e.bytes();break;case 3:n.payload=e.bytes();break;case 5:n.signature=e.bytes();break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof y_.Envelope)return e;var t=new y_.Envelope;return null!=e.publicKey&&("string"==typeof e.publicKey?f_.base64.decode(e.publicKey,t.publicKey=f_.newBuffer(f_.base64.length(e.publicKey)),0):e.publicKey.length&&(t.publicKey=e.publicKey)),null!=e.payloadType&&("string"==typeof e.payloadType?f_.base64.decode(e.payloadType,t.payloadType=f_.newBuffer(f_.base64.length(e.payloadType)),0):e.payloadType.length&&(t.payloadType=e.payloadType)),null!=e.payload&&("string"==typeof e.payload?f_.base64.decode(e.payload,t.payload=f_.newBuffer(f_.base64.length(e.payload)),0):e.payload.length&&(t.payload=e.payload)),null!=e.signature&&("string"==typeof e.signature?f_.base64.decode(e.signature,t.signature=f_.newBuffer(f_.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.publicKey="":(r.publicKey=[],t.bytes!==Array&&(r.publicKey=f_.newBuffer(r.publicKey))),t.bytes===String?r.payloadType="":(r.payloadType=[],t.bytes!==Array&&(r.payloadType=f_.newBuffer(r.payloadType))),t.bytes===String?r.payload="":(r.payload=[],t.bytes!==Array&&(r.payload=f_.newBuffer(r.payload))),t.bytes===String?r.signature="":(r.signature=[],t.bytes!==Array&&(r.signature=f_.newBuffer(r.signature)))),null!=e.publicKey&&e.hasOwnProperty("publicKey")&&(r.publicKey=t.bytes===String?f_.base64.encode(e.publicKey,0,e.publicKey.length):t.bytes===Array?Array.prototype.slice.call(e.publicKey):e.publicKey),null!=e.payloadType&&e.hasOwnProperty("payloadType")&&(r.payloadType=t.bytes===String?f_.base64.encode(e.payloadType,0,e.payloadType.length):t.bytes===Array?Array.prototype.slice.call(e.payloadType):e.payloadType),null!=e.payload&&e.hasOwnProperty("payload")&&(r.payload=t.bytes===String?f_.base64.encode(e.payload,0,e.payload.length):t.bytes===Array?Array.prototype.slice.call(e.payload):e.payload),null!=e.signature&&e.hasOwnProperty("signature")&&(r.signature=t.bytes===String?f_.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e})(),m_=Ge.Reader,w_=Ge.Writer,b_=Ge.util,v_=Ge.roots.default||(Ge.roots.default={}),E_=v_.PeerRecord=(()=>{function e(e){if(this.addresses=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.peerId=b_.newBuffer([]),e.prototype.seq=b_.Long?b_.Long.fromBits(0,0,!0):0,e.prototype.addresses=b_.emptyArray,e.encode=function(e,t){if(t||(t=w_.create()),null!=e.peerId&&Object.hasOwnProperty.call(e,"peerId")&&t.uint32(10).bytes(e.peerId),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.addresses&&e.addresses.length)for(var r=0;r<e.addresses.length;++r)v_.PeerRecord.AddressInfo.encode(e.addresses[r],t.uint32(26).fork()).ldelim();return t},e.decode=function(e,t){e instanceof m_||(e=m_.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new v_.PeerRecord;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.peerId=e.bytes();break;case 2:n.seq=e.uint64();break;case 3:n.addresses&&n.addresses.length||(n.addresses=[]),n.addresses.push(v_.PeerRecord.AddressInfo.decode(e,e.uint32()));break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof v_.PeerRecord)return e;var t=new v_.PeerRecord;if(null!=e.peerId&&("string"==typeof e.peerId?b_.base64.decode(e.peerId,t.peerId=b_.newBuffer(b_.base64.length(e.peerId)),0):e.peerId.length&&(t.peerId=e.peerId)),null!=e.seq&&(b_.Long?(t.seq=b_.Long.fromValue(e.seq)).unsigned=!0:"string"==typeof e.seq?t.seq=parseInt(e.seq,10):"number"==typeof e.seq?t.seq=e.seq:"object"==typeof e.seq&&(t.seq=new b_.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0))),e.addresses){if(!Array.isArray(e.addresses))throw TypeError(".PeerRecord.addresses: array expected");t.addresses=[];for(var r=0;r<e.addresses.length;++r){if("object"!=typeof e.addresses[r])throw TypeError(".PeerRecord.addresses: object expected");t.addresses[r]=v_.PeerRecord.AddressInfo.fromObject(e.addresses[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.addresses=[]),t.defaults)if(t.bytes===String?r.peerId="":(r.peerId=[],t.bytes!==Array&&(r.peerId=b_.newBuffer(r.peerId))),b_.Long){var n=new b_.Long(0,0,!0);r.seq=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.seq=t.longs===String?"0":0;if(null!=e.peerId&&e.hasOwnProperty("peerId")&&(r.peerId=t.bytes===String?b_.base64.encode(e.peerId,0,e.peerId.length):t.bytes===Array?Array.prototype.slice.call(e.peerId):e.peerId),null!=e.seq&&e.hasOwnProperty("seq")&&("number"==typeof e.seq?r.seq=t.longs===String?String(e.seq):e.seq:r.seq=t.longs===String?b_.Long.prototype.toString.call(e.seq):t.longs===Number?new b_.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0):e.seq),e.addresses&&e.addresses.length){r.addresses=[];for(var s=0;s<e.addresses.length;++s)r.addresses[s]=v_.PeerRecord.AddressInfo.toObject(e.addresses[s],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e.AddressInfo=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.multiaddr=b_.newBuffer([]),e.encode=function(e,t){return t||(t=w_.create()),null!=e.multiaddr&&Object.hasOwnProperty.call(e,"multiaddr")&&t.uint32(10).bytes(e.multiaddr),t},e.decode=function(e,t){e instanceof m_||(e=m_.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new v_.PeerRecord.AddressInfo;e.pos<r;){var s=e.uint32();s>>>3==1?n.multiaddr=e.bytes():e.skipType(7&s)}return n},e.fromObject=function(e){if(e instanceof v_.PeerRecord.AddressInfo)return e;var t=new v_.PeerRecord.AddressInfo;return null!=e.multiaddr&&("string"==typeof e.multiaddr?b_.base64.decode(e.multiaddr,t.multiaddr=b_.newBuffer(b_.base64.length(e.multiaddr)),0):e.multiaddr.length&&(t.multiaddr=e.multiaddr)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.multiaddr="":(r.multiaddr=[],t.bytes!==Array&&(r.multiaddr=b_.newBuffer(r.multiaddr)))),null!=e.multiaddr&&e.hasOwnProperty("multiaddr")&&(r.multiaddr=t.bytes===String?b_.base64.encode(e.multiaddr,0,e.multiaddr.length):t.bytes===Array?Array.prototype.slice.call(e.multiaddr):e.multiaddr),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e}(),e})();Ge.util.Long=void 0,Ge.configure();const __={version:12,description:"Store each peerstore peer under a single datastore key",migrate:async function(e,t=(()=>{})){t(0,"Storing each peerstore key under a single datastore key"),await e.datastore.open();const r={},n=[];for await(const{key:t,value:s}of e.datastore.query({prefix:"/peers"})){n.push(t);const e=t.toString(),[,i,o,a,c]=e.split("/");if("peers"===i&&["protos","addrs","metadata","keys"].includes(o)&&a)if(r[a]=r[a]||{addresses:[],protocols:[],metadata:[]},"protos"===o){const e=t_.decode(s);r[a].protocols=e.protocols.sort()}else if("addrs"===o){const e=o_.decode(s);r[a].addresses=e.addrs.sort(((e,t)=>Ki(e.multiaddr).toString().localeCompare(Ki(t.multiaddr).toString()))),e.certifiedRecord&&e.certifiedRecord.raw&&(r[a].peerRecordEnvelope=e.certifiedRecord.raw)}else"metadata"===o?r[a].metadata.push({key:c,value:s}):"keys"===o&&(r[a].pubKey=s)}t(33,"Read peer data from store");for(const t of n)await e.datastore.delete(t);t(66,"Removed existing peer data from store");for(const t of Object.keys(r)){const n=r[t];n.metadata=n.metadata.sort(((e,t)=>e.key.localeCompare(t.key)));const s=u_.encode(n).finish();await e.datastore.put(new Do(`/peers/${t}`),s)}await e.datastore.close(),t(100,"Stored each peerstore key under a single datastore key")},revert:async function(e,t=(()=>{})){t(0,"Storing each peerstore key under a multiple datastore keys"),await e.datastore.open();const r={},n=[];for await(const{key:t,value:s}of e.datastore.query({prefix:"/peers"})){n.push(t);const e=t.toString(),[,,i]=e.split("/");r[i]=u_.decode(s)}t(33,"Read peer data from store");for(const t of n)await e.datastore.delete(t);t(66,"Removed existing peer data from store");for(const[t,n]of Object.entries(r)){if(n.protocols&&n.protocols.length>0&&await e.datastore.put(new Do(`/peers/protos/${t}`),t_.encode({protocols:n.protocols}).finish()),n.addresses&&n.addresses.length>0){const r=n.peerRecordEnvelope;let s;if(r){const e=g_.decode(r);s={raw:r,seq:E_.decode(e.payload).seq}}await e.datastore.put(new Do(`/peers/addrs/${t}`),o_.encode({addrs:n.addresses,certifiedRecord:s}).finish())}if(n.metadata&&n.metadata.length>0)for(const{key:r,value:s}of n.metadata)await e.datastore.put(new Do(`/peers/metadata/${t}/${r}`),s);n.pubKey&&await e.datastore.put(new Do(`/peers/keys/${t}`),n.pubKey)}await e.datastore.close(),t(100,"Stored each peerstore key under multiple datastore keys")}},S_={description:"Empty migration.",migrate:()=>{},revert:()=>{},empty:!0},A_=[Object.assign({version:1},S_),Object.assign({version:2},S_),Object.assign({version:3},S_),Object.assign({version:4},S_),Object.assign({version:5},S_),Object.assign({version:6},S_),Object.assign({version:7},S_),wE,ME,GE,ZE,__];class I_ extends Error{constructor(e){super(e),this.name="NonReversibleMigrationError",this.code=I_.code,this.message=e}}I_.code="ERR_NON_REVERSIBLE_MIGRATION";class R_ extends Error{constructor(e){super(e),this.name="NotInitializedRepoError",this.code=R_.code,this.message=e}}R_.code="ERR_NOT_INITIALIZED_REPO";class k_ extends Error{constructor(e){super(e),this.name="RequiredParameterError",this.code=k_.code,this.message=e}}k_.code="ERR_REQUIRED_PARAMETER";class T_ extends Error{constructor(e){super(e),this.name="InvalidValueError",this.code=T_.code,this.message=e}}T_.code="ERR_INVALID_VALUE";class C_ extends Error{constructor(e){super(e),this.name="MissingRepoOptionsError",this.code=C_.code,this.message=e}}C_.code="ERR_MISSING_REPO_OPTIONS";const P_=me("ipfs:repo:migrator:repo:init");async function N_(e){if(!await async function(e){if(!e)throw new C_("Please pass repo options when trying to open a repo");const t=e.root;try{await t.open();const e=await t.has(zE),r=await t.has(UE);return!(!e||!r)||(P_(`Version entry present: ${e}`),P_(`Config entry present: ${r}`),!1)}catch(e){return P_("While checking if repo is initialized error was thrown: "+e.message),!1}finally{if(void 0!==t)try{await t.close()}catch{}}}(e))throw new R_("Repo is not initialized!");const t=e.root;await t.open();try{return parseInt(ni(await t.get(zE)))}finally{await t.close()}}async function D_(e,t){if(!t)throw new C_("Please pass repo options when trying to open a repo");const r=t.root;await r.open(),await r.put(zE,Xs(String(e))),await r.close()}const O_=me("ipfs:repo:migrator");function x_(e,t,r,n=!1){let s=0;for(const i of e){if(i.version>r)break;if(i.version>t){if(n&&!i.revert)throw new L_.NonReversibleMigrationError(`It is not possible to revert to version ${t} because migration version ${i.version} is not reversible. Cancelling reversion.`);s++}}if(s!==r-t)throw new L_.InvalidValueError(`The ipfs-repo-migrations package does not have all migration to migrate from version ${t} to ${r}`)}const L_=A;var B_=r(13434);class M_ extends Error{constructor(e){super(e),this.name="LockExistsError",this.code=M_.code}}M_.code="ERR_LOCK_EXISTS";class U_ extends Error{constructor(e){super(e),this.name="NotFoundError",this.code=U_.code}}U_.code="ERR_NOT_FOUND";class z_ extends Error{constructor(e){super(e),this.name="InvalidRepoVersionError",this.code=z_.code}}z_.code="ERR_INVALID_REPO_VERSION";const V_="ERR_REPO_NOT_INITIALIZED";async function F_(e,t,r){const n=await t(e);if(n)return n;const s=K_(r);return!!s&&new Promise(((t,r)=>{const n=s.store("readonly").get(e.toString());n.transaction.onabort=()=>{r(n.transaction.error)},n.transaction.oncomplete=()=>{t(Boolean(n.result))}}))}async function j_(e,t,r,n){if(await r(e))return t(e);const s=K_(n);if(!s)throw new U_;return new Promise(((t,r)=>{const n=s.store("readonly").get(e.toString());n.transaction.onabort=()=>{r(n.transaction.error)},n.transaction.oncomplete=()=>{if(n.result)return t(n.result);r(new U_)}}))}function K_(e){let t=e;for(;t.db||t.child;)if(t=t.db||t.child,"level-js"===t.type||"Level"===t.constructor.name)return t}const $_=me("ipfs:repo:version"),H_=new Do("version"),q_=Ma.default?Ma.default:Ma,G_=new Do("config");function W_(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)}const Y_=new Do("datastore_spec");const Z_=new Do("api");async function*Q_(e,t){for await(const r of e)await t(r)&&(yield r)}function J_(e){const t=kt.asCID(e);if(null==t)throw qe(new Error("Not a valid cid"),"ERR_INVALID_CID");return t.multihash.code!==hs.code?{isIdentity:!1}:{isIdentity:!0,digest:t.multihash.digest}}const X_=me("ipfs:repo:lock:memory"),eS="repo.lock",tS={},rS={lock:async function(e){const t=e+"/"+eS;if(X_("locking %s",t),!0===tS[t])throw new M_(`Lock already being held for file: ${t}`);return tS[t]=!0,{async close(){tS[t]&&delete tS[t]}}},locked:async function(e){const t=e+"/"+eS;return X_(`checking lock: ${t}`),Boolean(tS[t])}},nS={autoMigrate:!0,onMigrationProgress:()=>{},repoOwner:!0,repoLock:rS},sS={Spec:{type:"mount",mounts:[{mountpoint:"/blocks",type:"measure",prefix:"flatfs.datastore",child:{type:"flatfs",path:"blocks",sync:!0,shardFunc:"/repo/flatfs/shard/v1/next-to-last/2"}},{mountpoint:"/",type:"measure",prefix:"leveldb.datastore",child:{type:"levelds",path:"datastore",compression:"none"}}]}};function iS(e){const t=kt.asCID(e);if(null==t)throw qe(new Error("Not a valid cid"),"ERR_INVALID_CID");const r=De.encode(t.multihash.bytes);return new Do("/"+r.slice(1).toUpperCase(),!1)}function oS(e){return St(De.decode(`b${e.toString().toLowerCase().substring(1)}`))}const aS=me("ipfs:repo:utils:walk-dag");async function*cS(e,t,r,n){try{const s=gw({bytes:await t.get(e,n),cid:e,codec:await r(e.code)});for(const[,e]of s.links())yield e,yield*cS(e,t,r,n)}catch(t){throw aS("Could not walk DAG for CID",e.toString(),t),t}}class lS extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"==typeof e.maxAge&&0===e.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if("function"==typeof this.onEviction)for(const[t,r]of e)this.onEviction(t,r.value)}_deleteIfExpired(e,t){return"number"==typeof t.expiry&&t.expiry<=Date.now()&&("function"==typeof this.onEviction&&this.onEviction(e,t.value),this.delete(e))}_getOrDeleteIfExpired(e,t){if(!1===this._deleteIfExpired(e,t))return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const r=t.get(e);return this._getItemValue(e,r)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||!1===this._deleteIfExpired(t,r)&&(yield e)}for(const e of this.cache){const[t,r]=e;!1===this._deleteIfExpired(t,r)&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(!1===this._deleteIfExpired(e,t))return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:r=this.maxAge}={}){const n="number"==typeof r&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;this.cache.has(e)?this.cache.set(e,{value:t,expiry:n}):this._set(e,{value:t,expiry:n})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):!!this.oldCache.has(e)&&!this._deleteIfExpired(e,this.oldCache.get(e))}peek(e){return this.cache.has(e)?this._peek(e,this.cache):this.oldCache.has(e)?this._peek(e,this.oldCache):void 0}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],r=t.length-e;r<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(r>0&&this._emitEvictions(t.slice(0,r)),this.oldCache=new Map(t.slice(r)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,r]=e;!1===this._deleteIfExpired(t,r)&&(yield[t,r.value])}for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||!1===this._deleteIfExpired(t,r)&&(yield[t,r.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const r=e[t],[n,s]=r;!1===this._deleteIfExpired(n,s)&&(yield[n,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const r=e[t],[n,s]=r;this.cache.has(n)||!1===this._deleteIfExpired(n,s)&&(yield[n,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[r,n]of this.entriesAscending())e.call(t,n,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}class hS{constructor({pinstore:e,blockstore:t,loadCodec:r}){this.pinstore=e,this.blockstore=t,this.loadCodec=r,this.log=me("ipfs:repo:pin"),this.directPins=new Set,this.recursivePins=new Set}async pinDirectly(e,t={}){await this.blockstore.get(e,t);const r={depth:0};return 0!==e.version&&(r.version=e.version),e.code!==sr&&(r.codec=e.code),t.metadata&&(r.metadata=t.metadata),this.pinstore.put(iS(e),An(r))}unpin(e,t){return this.pinstore.delete(iS(e),t)}async pinRecursively(e,t={}){await this.fetchCompleteDag(e,t);const r={depth:1/0};0!==e.version&&(r.version=e.version),e.code!==sr&&(r.codec=e.code),t.metadata&&(r.metadata=t.metadata),await this.pinstore.put(iS(e),An(r))}async*directKeys(e){for await(const e of this.pinstore.query({filters:[e=>0===Pn(e.value).depth]})){const t=Pn(e.value),r=t.version||0,n=null!=t.codec?t.codec:sr,s=oS(e.key);yield{cid:kt.create(r,n,s),metadata:t.metadata}}}async*recursiveKeys(e){for await(const e of this.pinstore.query({filters:[e=>Pn(e.value).depth===1/0]})){const t=Pn(e.value),r=t.version||0,n=null!=t.codec?t.codec:sr,s=oS(e.key);yield{cid:kt.create(r,n,s),metadata:t.metadata}}}async*indirectKeys(e){for await(const{cid:t}of this.recursiveKeys())for await(const r of cS(t,this.blockstore,this.loadCodec,e)){const e=[rc.recursive];(await this.isPinnedWithType(r,e)).pinned||(yield r)}}async isPinnedWithType(e,t,r){Array.isArray(t)||(t=[t]);const n=t.includes(rc.all),s=t.includes(rc.direct),i=t.includes(rc.recursive),o=t.includes(rc.indirect);if(i||s||n){const r=await Lw(this.pinstore.query({prefix:iS(e).toString(),filters:[e=>{if(n)return!0;const r=Pn(e.value);return t.includes(0===r.depth?rc.direct:rc.recursive)}],limit:1}));if(r){const t=Pn(r.value);return{cid:e,pinned:!0,reason:0===t.depth?rc.direct:rc.recursive,metadata:t.metadata}}}const a=this;if(n||o){const t=await Lw(async function*(e,t){for await(const{cid:r}of t)for await(const t of cS(r,a.blockstore,a.loadCodec))if(t.equals(e))return void(yield r)}(e,this.recursiveKeys()));if(t)return{cid:e,pinned:!0,reason:rc.indirect,parent:t}}return{cid:e,pinned:!1}}async fetchCompleteDag(e,t={}){const r=new lS({maxSize:t.cidCacheMaxSize??2048}),n=async(e,t)=>{if(r.has(e.toString()))return;r.set(e.toString(),!0);const s=gw({bytes:await this.blockstore.get(e,t),cid:e,codec:await this.loadCodec(e.code)});await Promise.all([...s.links()].map((([,e])=>n(e,t))))};await n(e,t)}static checkPinType(e){if("string"!=typeof e||!Object.keys(rc).includes(e))throw function(e){return qe(new Error(`Invalid type '${e}', must be one of {direct, indirect, recursive, all}`),"ERR_INVALID_PIN_TYPE")}(e);return!0}}async function uS(e,t){const{pinned:r,reason:n}=await t.isPinnedWithType(e,rc.all);if(r)throw qe(new Error(`pinned: ${n}`),"ERR_BLOCK_PINNED")}async function*dS(...e){const t=ju({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(e.map((async e=>{for await(const r of e)t.push(r)}))),t.end()}catch(e){t.end(e)}})),yield*t}const pS=me("ipfs:repo:gc"),fS=cc().code,yS=new Do("/local/filesroot");const gS=me("ipfs:repo"),mS=Number.MAX_SAFE_INTEGER;class wS{constructor(e,t,r,n){if("string"!=typeof e)throw new Error("missing repo path");if("function"!=typeof t)throw new Error("missing codec loader");this.options=ye(nS,n),this.closed=!0,this.path=e,this.root=r.root,this.datastore=r.datastore,this.keys=r.keys;const s=r.blocks,i=r.pins;this.pins=new hS({pinstore:i,blockstore:s,loadCodec:t});const o=(a=this.pins,c=s,{open:()=>c.open(),close:()=>c.close(),query:(e,t)=>c.query(e,t),queryKeys:(e,t)=>c.queryKeys(e,t),get:async(e,t)=>c.get(e,t),async*getMany(e,t){yield*c.getMany(e,t)},async put(e,t,r){await c.put(e,t,r)},async*putMany(e,t){yield*c.putMany(e,t)},has:(e,t)=>c.has(e,t),delete:async(e,t)=>(await uS(e,a),c.delete(e,t)),deleteMany:(e,t)=>c.deleteMany(zd(e,(async e=>(await uS(e,a),e))),t),batch:()=>c.batch()});var a,c;this.blocks=function(e){return{open:()=>e.open(),close:()=>e.close(),query:(t,r)=>e.query(t,r),queryKeys:(t,r)=>e.queryKeys(t,r),async get(t,r){const n=J_(t);return n.isIdentity?Promise.resolve(n.digest):e.get(t,r)},async*getMany(e,t){for await(const r of e)yield this.get(r,t)},async put(t,r,n){const{isIdentity:s}=J_(t);s||await e.put(t,r,n)},async*putMany(t,r){const n=ju({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)((async()=>{try{await dd(e.putMany(async function*(){for await(const{key:e,value:r}of t)J_(e).isIdentity||(yield{key:e,value:r}),n.push({key:e,value:r})}())),n.end()}catch(e){n.end(e)}})),yield*n},has(t,r){const{isIdentity:n}=J_(t);return n?Promise.resolve(!0):e.has(t,r)},delete(t,r){const{isIdentity:n}=J_(t);return n?Promise.resolve():e.delete(t,r)},deleteMany:(t,r)=>e.deleteMany(Q_(t,(e=>!J_(e).isIdentity)),r),batch(){const t=e.batch();return{put(e,r){const{isIdentity:n}=J_(e);n||t.put(e,r)},delete(e){const{isIdentity:r}=J_(e);r||t.delete(e)},commit:e=>t.commit(e)}}}}(o),this.version=function(e){return{exists:async()=>F_(H_,e.has.bind(e),e),async get(){const t=await j_(H_,e.get.bind(e),e.has.bind(e),e);return parseInt(ni(t),10)},set:t=>e.put(H_,Xs(String(t))),async check(e){const t=await this.get();return $_("comparing version: %s and %s",t,e),t===e||6===t&&7===e||6===e&&7===t}}}(this.root),this.config=function(e){const t=new q_({concurrency:1}),r={async getAll(t={}){const r=await j_(G_,e.get.bind(e),e.has.bind(e),e);return JSON.parse(ni(r))},async get(e,t={}){if(null==e)throw new U_(`Key ${e} does not exist in config`);const r=await this.getAll(t),n=uE(r,e);if(void 0===n)throw new U_(`Key ${e} does not exist in config`);return n},set(e,r,s={}){if("string"!=typeof e&&!(e instanceof String))throw qe(new Error("Invalid key type: "+typeof e),"ERR_INVALID_KEY");if(void 0===r||r instanceof Uint8Array)throw qe(new Error("Invalid value type: "+typeof r),"ERR_INVALID_VALUE");return t.add((()=>n({key:e,value:r},s.signal)))},replace(e,r={}){if(!e||e instanceof Uint8Array)throw qe(new Error("Invalid value type: "+typeof e),"ERR_INVALID_VALUE");return t.add((()=>n({key:void 0,value:e},r.signal)))},exists:async()=>F_(G_,e.has.bind(e),e)};return r;async function n(e,t){if(t&&t.aborted)return;const n=e.key,i=e.value;if(n){const e=await r.getAll();return"object"==typeof e&&null!==e&&iw(e,n,i),s(e)}return s(i)}function s(t){const r=Xs(JSON.stringify(t,null,2));return e.put(G_,r)}}(this.root),this.spec=function(e){return{exists:()=>e.has(Y_),async get(){const t=await e.get(Y_);return JSON.parse(ni(t))},set:async t=>e.put(Y_,Xs(JSON.stringify(function(e,t={}){if(!W_(e)&&!Array.isArray(e))throw new TypeError("Expected a plain object or array");const{deep:r,compare:n}=t,s=[],i=[],o=e=>{const t=s.indexOf(e);if(-1!==t)return i[t];const r=[];return s.push(e),i.push(r),r.push(...e.map((e=>Array.isArray(e)?o(e):W_(e)?a(e):e))),r},a=e=>{const t=s.indexOf(e);if(-1!==t)return i[t];const c={},l=Object.keys(e).sort(n);s.push(e),i.push(c);for(const t of l){const n=e[t];let s;s=r&&Array.isArray(n)?o(n):r&&W_(n)?a(n):n,Object.defineProperty(c,t,{...Object.getOwnPropertyDescriptor(e,t),value:s})}return c};return Array.isArray(e)?r?o(e):e.slice():a(e)}(t,{deep:!0}))))}}(this.root),this.apiAddr=function(e){return{async get(){const t=await e.get(Z_);return t&&t.toString()},set:t=>e.put(Z_,Xs(t.toString())),delete:()=>e.delete(Z_)}}(this.root),this.gcLock=vb({name:e,singleProcess:!1!==this.options.repoOwner}),this.gc=function({gcLock:e,pins:t,blockstore:r,root:n,loadCodec:s}){return async function*(){const i=Date.now();pS("Creating set of marked blocks");const o=await e.writeLock();try{const e=await async function({pins:e,blockstore:t,loadCodec:r,root:n}){const s=async function*(){let e;try{e=await n.get(yS)}catch(e){if(e.code===fS)return void pS("No blocks in MFS");throw e}const s=kt.decode(e);yield s,yield*cS(s,t,r)}(),i=dS(zd(e.recursiveKeys(),(({cid:e})=>e)),e.indirectKeys(),zd(e.directKeys(),(({cid:e})=>e)),s),o=new Set;for await(const e of dS(i,s))o.add(De.encode(e.multihash.bytes));return o}({pins:t,blockstore:r,root:n,loadCodec:s}),a=r.queryKeys({});yield*async function*({blockstore:e},t,r){let n=0,s=0;yield*Xu(rp(zd(r,(async r=>async function(){n++;try{const n=De.encode(r.multihash.bytes);if(t.has(n))return null;try{await e.delete(r),s++}catch(e){return{err:new Error(`Could not delete block with CID ${r}: ${e.message}`)}}return{cid:r}}catch(e){const t=`Could delete block with CID ${r}`;return pS(t,e),{err:new Error(t+`: ${e.message}`)}}})),256),(e=>Q_(e,Boolean))),pS(`Marked set has ${t.size} unique blocks. Blockstore has ${n} blocks. Deleted ${s} blocks.`)}({blockstore:r},e,a),pS(`Complete (${Date.now()-i}ms)`)}finally{o()}}}({gcLock:this.gcLock,pins:this.pins,blockstore:this.blocks,root:this.root,loadCodec:t})}async init(e){var t;gS("initializing at: %s",this.path),await this._openRoot(),await this.config.replace((t=e,t.Datastore=Object.assign({},sS,uE(t,"datastore")),t)),await this.spec.set(function(e){const t={...sS.Spec,...uE(e,"Datastore.Spec")};return{type:t.type,mounts:t.mounts.map((e=>({mountpoint:e.mountpoint,type:e.child.type,path:e.child.path,shardFunc:e.child.shardFunc})))}}(e)),await this.version.set(12)}async isInitialized(){if(!this.closed)return!0;try{return await this._openRoot(),await this._checkInitialized(),await this.root.close(),!0}catch(e){return!1}}async open(){if(!this.closed)throw qe(new Error("repo is already open"),"ERR_REPO_ALREADY_OPEN");gS("opening at: %s",this.path);try{if(await this._openRoot(),await this._checkInitialized(),this._lockfile=await this._openLock(),gS("acquired repo.lock"),!await this.version.check(12)){if(!await this._isAutoMigrationEnabled())throw new z_("Incompatible repo versions. Automatic migrations disabled. Please migrate the repo manually.");await this._migrate(12,{root:this.root,datastore:this.datastore,pins:this.pins.pinstore,blocks:this.pins.blockstore,keys:this.keys})}gS("creating datastore"),await this.datastore.open(),gS("creating blocks"),await this.blocks.open(),gS("creating keystore"),await this.keys.open(),gS("creating pins"),await this.pins.pinstore.open(),this.closed=!1,gS("all opened")}catch(e){if(this._lockfile)try{await this._closeLock(),this._lockfile=null}catch(e){gS("error removing lock",e)}throw e}}async _openRoot(){try{await this.root.open()}catch(e){if("Already open"!==e.message)throw e}}async _openLock(){const e=await this.options.repoLock.lock(this.path);if("function"!=typeof e.close)throw qe(new Error("Locks must have a close method"),"ERR_NO_CLOSE_FUNCTION");return e}_closeLock(){return this._lockfile&&this._lockfile.close()}async _checkInitialized(){let e;gS("init check");try{[e]=await Promise.all([this.config.exists(),this.spec.exists(),this.version.exists()])}catch(e){if("ERR_NOT_FOUND"===e.code)throw qe(new Error("repo is not initialized yet"),V_,{path:this.path});throw e}if(!e)throw qe(new Error("repo is not initialized yet"),V_,{path:this.path})}async close(){if(this.closed)throw qe(new Error("repo is already closed"),"ERR_REPO_ALREADY_CLOSED");gS("closing at: %s",this.path);try{await this.apiAddr.delete()}catch(e){if(e.code!==V_&&!e.message.startsWith("ENOENT"))throw e}await Promise.all([this.root,this.blocks,this.keys,this.datastore,this.pins.pinstore].map((e=>e&&e.close()))),gS("unlocking"),this.closed=!0,await this._closeLock()}exists(){return this.version.exists()}async stat(){if(this.datastore&&this.keys){const[e,t,r,n,s]=await Promise.all([this._storageMaxStat(),this._blockStat(),this.version.get(),bS(this.datastore),bS(this.keys)]),i=t.size+n+s;return{repoPath:this.path,storageMax:e,version:r,numObjects:t.count,repoSize:i}}throw qe(new Error("repo is not initialized yet"),V_,{path:this.path})}async _isAutoMigrationEnabled(){if(void 0!==this.options.autoMigrate)return this.options.autoMigrate;let e;try{e=await this.config.get("repoAutoMigrate")}catch(t){if(t.code!==U_.code)throw t;e=!0}return e}async _migrate(e,t){return await this.version.get()>e?(gS(`reverting to version ${e}`),async function(e,t,r,n,s={}){const i=s.ignoreLock??!1,o=s.onProgress,a=s.isDryRun??!1,c=s.migrations??A_;if(!e)throw new L_.RequiredParameterError("Path argument is required!");if(!r)throw new L_.RequiredParameterError("repoOptions argument is required!");if(!n)throw new L_.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");if(!Number.isInteger(n)||n<=0)throw new L_.InvalidValueError("Version has to be positive integer!");t=jE(t);const l=await N_(t);if(l===n)return void O_("Nothing to revert.");if(l<n)throw new L_.InvalidValueError(`Current repo's version (${l}) is lower then toVersion (${n}), you probably wanted to migrate it?`);let h;x_(c,n,l,!0),a||i||(h=await r.repoLock.lock(e)),O_(`Reverting from version ${l} to ${n}`);try{const e=c.slice().reverse();for(const r of e){if(r.version<=n)break;if(!(r.version>l)){O_(`Reverting migration version ${r.version}`);try{if(!a){let e=()=>{};o&&(e=(e,t)=>o(r.version,e.toFixed(2),t)),await r.revert(t,e)}}catch(e){const n=r.version;throw O_(`An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ${n}`),await D_(n,t),e.message=`During reversion to version ${r.version} exception was raised: ${e.message}`,e}O_(`Reverting to version ${r.version} finished`)}}a||await D_(n,t),O_(`All migrations successfully reverted to version ${n}!`)}finally{a||i||!h||await h.close()}}(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress})):(gS(`migrating to version ${e}`),async function(e,t,r,n,s={}){const i=s.ignoreLock??!1,o=s.onProgress,a=s.isDryRun??!1,c=s.migrations??A_;if(!e)throw new L_.RequiredParameterError("Path argument is required!");if(!r)throw new L_.RequiredParameterError("repoOptions argument is required!");if(!n)throw new L_.RequiredParameterError("toVersion argument is required!");if(!Number.isInteger(n)||n<=0)throw new L_.InvalidValueError("Version has to be positive integer!");t=jE(t);const l=await N_(t);if(l===n)return void O_("Nothing to migrate.");if(l>n)throw new L_.InvalidValueError(`Current repo's version (${l}) is higher then toVersion (${n}), you probably wanted to revert it?`);let h;x_(c,l,n),a||i||(h=await r.repoLock.lock(e));try{for(const e of c){if(void 0!==n&&e.version>n)break;if(!(e.version<=l)){O_(`Migrating version ${e.version}`);try{if(!a){let r=()=>{};o&&(r=(t,r)=>o(e.version,t.toFixed(2),r)),await e.migrate(t,r)}}catch(r){const n=e.version-1;throw O_(`An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ${n}`),await D_(n,t),new Error(`During migration to version ${e.version} exception was raised: ${r.stack||r.message||r}`)}O_(`Migrating to version ${e.version} finished`)}}a||await D_(n||function(e){return e=e||A_,Array.isArray(e)&&0!==e.length?e[e.length-1].version:0}(c),t),O_("Repo successfully migrated",void 0!==n?`to version ${n}!`:"to latest version!")}finally{a||i||!h||await h.close()}}(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress}))}async _storageMaxStat(){try{const e=await this.config.get("Datastore.StorageMax");return BigInt(B_(e))}catch(e){return BigInt(mS)}}async _blockStat(){let e=BigInt(0),t=BigInt(0);if(this.blocks)for await(const{key:r,value:n}of this.blocks.query({}))e+=BigInt(1),t+=BigInt(n.byteLength),t+=BigInt(r.bytes.byteLength);return{count:e,size:t}}}async function bS(e){let t=BigInt(0);for await(const r of e.query({}))t+=BigInt(r.value.byteLength),t+=BigInt(r.key.uint8Array().byteLength);return t}async function*vS(e,t){for await(const r of e)await t(r)&&(yield r)}async function*ES(e,t){let r=0;if(!(t<1))for await(const n of e)if(yield n,r++,r===t)return}async function*_S(e,t){const r=await Hd(e);yield*r.sort(t)}var SS=r(35562);class AS extends zu{constructor(e,t={}){super(),this.db="string"==typeof e?new SS.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw ic(e)}}async put(e,t){try{await this.db.put(e.toString(),t)}catch(e){throw ac(e)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(e){if(e.notFound)throw cc(e);throw ac(e)}return t}async has(e){try{await this.db.get(e.toString())}catch(e){if(e.notFound)return!1;throw e}return!0}async delete(e){try{await this.db.del(e.toString())}catch(e){throw oc(e)}}close(){return this.db&&this.db.close()}batch(){const e=[];return{put:(t,r)=>{e.push({type:"put",key:t.toString(),value:r})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:()=>this.db.batch(e)}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>vS(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>_S(e,t)),t));const{offset:r,limit:n}=e;if(r){let e=0;t=vS(t,(()=>e++>=r))}return n&&(t=ES(t,n)),t}queryKeys(e){let t=zd(this._query({values:!1,prefix:e.prefix}),(({key:e})=>e));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>vS(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>_S(e,t)),t));const{offset:r,limit:n}=e;if(r){let e=0;t=vS(t,(()=>e++>=r))}return n&&(t=ES(t,n)),t}_query(e){const t={keys:!0,keyEncoding:"buffer",values:e.values};if(null!=e.prefix){const r=e.prefix.toString();t.gte=r,t.lt=r+""}const r=this.db.iterator(t);if(r[Symbol.asyncIterator])return async function*(e){for await(const[t,r]of e)yield{key:new Do(t,!1),value:r};await e.close()}(r);if(null!=r.next&&null!=r.end)return n=r,{[Symbol.asyncIterator]:()=>({next:()=>new Promise(((e,t)=>{n.next(((r,s,i)=>r?t(r):null==s?n.end((r=>{if(r)return t(r);e({done:!0,value:void 0})})):void e({done:!1,value:{key:new Do(s,!1),value:i}})))})),return:()=>new Promise(((e,t)=>{n.end((r=>{if(r)return t(r);e({done:!0,value:void 0})}))}))})};var n;throw new Error("Level returned incompatible iterator")}}var IS=r(80630),RS=r(16276);const kS=(e,t)=>async function*(){const r=await RS(e);yield*r.sort(t)}();class TS{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await IS(this.putMany(e,r)),e=[],await IS(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix&&(r=Mu(r,(t=>t.key.toString().startsWith(e.prefix||"")))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>Mu(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>kS(e,t)),r)),null!=e.offset){let t=0;r=Mu(r,(()=>t++>=(e.offset||0)))}return null!=e.limit&&(r=Uu(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix&&(r=Mu(r,(t=>t.toString().startsWith(e.prefix||"")))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>Mu(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>kS(e,t)),r)),null!=e.offset){let t=0;r=Mu(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=Uu(r,e.limit)),r}}function CS(e){const t=kt.asCID(e);if(!t)throw qe(new Error("Not a valid cid"),"ERR_INVALID_CID");return new Do("/"+De.encode(t.multihash.bytes).slice(1).toUpperCase(),!1)}function PS(e){return kt.createV1(ks,St(De.decode("b"+e.toString().slice(1).toLowerCase())))}function NS(e){const t=e.substring(0,1);if("/"===t)return NS(e.substring(1));let r,n;r="b"===t.toLowerCase()?e=>De.decode(e.toLowerCase()).subarray(2):"c"===t.toLowerCase()?e=>xe.decode(e.toLowerCase()).subarray(2):"z"===t?e=>Pe.decode(e).subarray(2):"Q"===t?e=>Pe.decode("z"+e):e=>De.decode("b"+e.toLowerCase()).subarray(2);for(let t=1;t<e.length;t++)try{n=r(e.substring(0,t))}catch(e){if("Unexpected end of data"!==e.message)throw e}let s="/C";return n&&(s=`/${De.encode(n).slice(1,-1).toUpperCase()||"C"}`),s}class DS extends TS{constructor(e){super(),this.child=e}open(){return this.child.open()}close(){return this.child.close()}async*query(e,t){for await(const{key:r,value:n}of this.child.query(function(e){return{...e,prefix:e.prefix?NS(e.prefix):void 0,filters:e.filters?e.filters.map((e=>t=>e({key:PS(t.key),value:t.value}))):void 0,orders:e.orders?e.orders.map((e=>(t,r)=>e({key:PS(t.key),value:t.value},{key:PS(r.key),value:r.value}))):void 0}}(e),t))yield{key:PS(r),value:n}}async*queryKeys(e,t){for await(const r of this.child.queryKeys(function(e){return{...e,prefix:e.prefix?NS(e.prefix):void 0,filters:e.filters?e.filters.map((e=>t=>e(PS(t)))):void 0,orders:e.orders?e.orders.map((e=>(t,r)=>e(PS(t),PS(r)))):void 0}}(e),t))yield PS(r)}async get(e,t){return this.child.get(CS(e),t)}async*getMany(e,t){for await(const r of e)yield this.get(r,t)}async put(e,t,r){await this.child.put(CS(e),t,r)}async*putMany(e,t){const r=ju({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)((async()=>{try{const n=this.child;await dd(this.child.putMany(async function*(){for await(const s of e){const e=CS(s.key);await n.has(e,t)||(yield{key:e,value:s.value}),r.push(s)}}())),r.end()}catch(e){r.end(e)}})),yield*r}has(e,t){return this.child.has(CS(e),t)}delete(e,t){return this.child.delete(CS(e),t)}deleteMany(e,t){const r=ju({objectMode:!0});return dd(this.child.deleteMany(async function*(){for await(const t of e)yield CS(t),r.push(t);r.end()}(),t)).catch((e=>{r.end(e)})),r}}function OS(e,t,r){const n=r.path||"ipfs";return function(e,r,n,s){return new wS(e,(e=>t.getCodec(e)),n,s)}(n,0,{root:new AS(n,{prefix:"",version:2}),blocks:new DS(new AS(`${n}/blocks`,{prefix:"",version:2})),datastore:new AS(`${n}/datastore`,{prefix:"",version:2}),keys:new AS(`${n}/keys`,{prefix:"",version:2}),pins:new AS(`${n}/pins`,{prefix:"",version:2})},{autoMigrate:r.autoMigrate,onMigrationProgress:r.onMigrationProgress||e,repoLock:rS})}var xS;function LS(e){return e instanceof Uint8Array?{get:t=>e[t],set(t,r){e[t]=r}}:{get:t=>e.get(t),set(t,r){e.set(t,r)}}}!function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.publicKey&&e.publicKey.byteLength>0)&&(t.uint32(10),t.bytes(e.publicKey)),(!0===r.writeDefaults||null!=e.payloadType&&e.payloadType.byteLength>0)&&(t.uint32(18),t.bytes(e.payloadType)),(!0===r.writeDefaults||null!=e.payload&&e.payload.byteLength>0)&&(t.uint32(26),t.bytes(e.payload)),(!0===r.writeDefaults||null!=e.signature&&e.signature.byteLength>0)&&(t.uint32(42),t.bytes(e.signature)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.publicKey=e.bytes();break;case 2:r.payloadType=e.bytes();break;case 3:r.payload=e.bytes();break;case 5:r.signature=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(xS||(xS={}));const BS=4294967296;class MS{constructor(e=0,t=0){this.hi=e,this.lo=t}toBigInt(e){if(!0===e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!=0){const e=1+~this.lo>>>0;let t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(BigInt(e)+(BigInt(t)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(e){return Number(this.toBigInt(e))}zzDecode(){const e=-(1&this.lo),t=((this.lo>>>1|this.hi<<31)^e)>>>0,r=(this.hi>>>1^e)>>>0;return new MS(r,t)}zzEncode(){const e=this.hi>>31,t=((this.hi<<1|this.lo>>>31)^e)>>>0,r=(this.lo<<1^e)>>>0;return new MS(t,r)}toBytes(e,t=0){const r=LS(e);for(;this.hi>0;)r.set(t++,127&this.lo|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)r.set(t++,127&this.lo|128),this.lo=this.lo>>>7;r.set(t++,this.lo)}static fromBigInt(e){if(0n===e)return new MS;const t=e<0;t&&(e=-e);let r=0|Number(e>>32n),n=0|Number(e-(BigInt(r)<<32n));return t&&(r=~r>>>0,n=~n>>>0,++n>BS&&(n=0,++r>BS&&(r=0))),new MS(r,n)}static fromNumber(e){if(0===e)return new MS;const t=e<0;t&&(e=-e);let r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new MS(n,r)}static fromBytes(e,t=0){const r=LS(e),n=new MS;let s=0;if(e.length-t>4){for(;s<4;++s)if(n.lo=(n.lo|(127&r.get(t))<<7*s)>>>0,r.get(t++)<128)return n;if(n.lo=(n.lo|(127&r.get(t))<<28)>>>0,n.hi=(n.hi|(127&r.get(t))>>4)>>>0,r.get(t++)<128)return n;s=0}else for(;s<4;++s){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(n.lo=(n.lo|(127&r.get(t))<<7*s)>>>0,r.get(t++)<128)return n}if(e.length-t>4){for(;s<5;++s)if(n.hi=(n.hi|(127&r.get(t))<<7*s+3)>>>0,r.get(t++)<128)return n}else if(t<e.byteLength)for(;s<5;++s){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(n.hi=(n.hi|(127&r.get(t))<<7*s+3)>>>0,r.get(t++)<128)return n}throw RangeError("invalid varint encoding")}}const US=Math.pow(2,7),zS=Math.pow(2,14),VS=Math.pow(2,21),FS=Math.pow(2,28),jS=Math.pow(2,35),KS=Math.pow(2,42),$S=Math.pow(2,49),HS=Math.pow(2,56),qS=Math.pow(2,63),GS={encodingLength:e=>e<US?1:e<zS?2:e<VS?3:e<FS?4:e<jS?5:e<KS?6:e<$S?7:e<HS?8:e<qS?9:10,encode(e,t,r=0){if(null!=Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return null==t&&(t=Ws(GS.encodingLength(e))),MS.fromNumber(e).toBytes(t,r),t},decode:(e,t=0)=>MS.fromBytes(e,t).toNumber(!0)};class WS{constructor(e){const{peerId:t,payloadType:r,payload:n,signature:s}=e;this.peerId=t,this.payloadType=r,this.payload=n,this.signature=s}marshal(){if(null==this.peerId.publicKey)throw new Error("Missing public key");return null==this.marshaled&&(this.marshaled=xS.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return Ti(this.marshal(),e.marshal())}async validate(e){const t=YS(e,this.payloadType,this.payload);if(null==this.peerId.publicKey)throw new Error("Missing public key");const r=eu(this.peerId.publicKey);return await r.verify(t.subarray(),this.signature)}}WS.createFromProtobuf=async e=>{const t=xS.decode(e),r=await Ja(t.publicKey);return new WS({peerId:r,payloadType:t.payloadType,payload:t.payload,signature:t.signature})},WS.seal=async(e,t)=>{if(null==t.privateKey)throw new Error("Missing private key");const r=e.domain,n=e.codec,s=e.marshal(),i=YS(r,n,s),o=await ru(t.privateKey),a=await o.sign(i.subarray());return new WS({peerId:t,payloadType:n,payload:s,signature:a})},WS.openAndCertify=async(e,t)=>{const r=await WS.createFromProtobuf(e);if(!await r.validate(t))throw qe(new Error("envelope signature is not valid for the given domain"),"ERR_SIGNATURE_NOT_VALID");return r};const YS=(e,t,r)=>{const n=Xs(e),s=GS.encode(n.byteLength),i=GS.encode(t.length),o=GS.encode(r.length);return new mp(s,n,i,t,o,r)};var ZS;!function(e){let t,r;!function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.multiaddr&&e.multiaddr.byteLength>0)&&(t.uint32(10),t.bytes(e.multiaddr)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={multiaddr:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();t>>>3==1?r.multiaddr=e.bytes():e.skipType(7&t)}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(t=e.AddressInfo||(e.AddressInfo={})),e.codec=()=>(null==r&&(r=Ac(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),(!0===n.writeDefaults||null!=t.peerId&&t.peerId.byteLength>0)&&(r.uint32(10),r.bytes(t.peerId)),!0!==n.writeDefaults&&0n===t.seq||(r.uint32(16),r.uint64(t.seq)),null!=t.addresses)for(const n of t.addresses)r.uint32(26),e.AddressInfo.codec().encode(n,r,{writeDefaults:!0});!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={peerId:new Uint8Array(0),seq:0n,addresses:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){const r=t.uint32();switch(r>>>3){case 1:n.peerId=t.bytes();break;case 2:n.seq=t.uint64();break;case 3:n.addresses.push(e.AddressInfo.codec().decode(t,t.uint32()));break;default:t.skipType(7&r)}}return n}))),r),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(ZS||(ZS={}));const QS=Uint8Array.from([3,1]);class JS{constructor(e){this.domain=JS.DOMAIN,this.codec=JS.CODEC;const{peerId:t,multiaddrs:r,seqNumber:n}=e;this.peerId=t,this.multiaddrs=r??[],this.seqNumber=n??BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=ZS.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map((e=>({multiaddr:e.bytes})))})),this.marshaled}equals(e){return e instanceof JS&&!!this.peerId.equals(e.peerId)&&this.seqNumber===e.seqNumber&&!!function(e,t){const r=(e,t)=>e.toString().localeCompare(t.toString());return e.length===t.length&&(t.sort(r),e.sort(r).every(((e,r)=>t[r].equals(e))))}(this.multiaddrs,e.multiaddrs)}}JS.createFromProtobuf=e=>{const t=ZS.decode(e),r=Qa(t.peerId),n=(t.addresses??[]).map((e=>Ki(e.multiaddr))),s=t.seq;return new JS({peerId:r,multiaddrs:n,seqNumber:s})},JS.DOMAIN="libp2p-peer-record",JS.CODEC=QS;const XS=Symbol.for("@libp2p/topology"),eA=()=>{};class tA{constructor(e){this.min=e.min??0,this.max=e.max??1/0,this.peers=new Set,this.onConnect=e.onConnect??eA,this.onDisconnect=e.onDisconnect??eA}get[Symbol.toStringTag](){return XS.toString()}get[XS](){return!0}async setRegistrar(e){this.registrar=e}disconnect(e){this.onDisconnect(e)}}function rA(e){return new tA(e)}var nA,sA=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class iA extends EventTarget{constructor(){super(...arguments),nA.set(this,new Map)}listenerCount(e){const t=sA(this,nA,"f").get(e);return null==t?0:t.length}addEventListener(e,t,r){super.addEventListener(e,t,r);let n=sA(this,nA,"f").get(e);null==n&&(n=[],sA(this,nA,"f").set(e,n)),n.push({callback:t,once:(!0!==r&&!1!==r&&r?.once)??!1})}removeEventListener(e,t,r){super.removeEventListener(e.toString(),t??null,r);let n=sA(this,nA,"f").get(e);null!=n&&(n=n.filter((({callback:e})=>e!==t)),sA(this,nA,"f").set(e,n))}dispatchEvent(e){const t=super.dispatchEvent(e);let r=sA(this,nA,"f").get(e.type);return null==r||(r=r.filter((({once:e})=>!e)),sA(this,nA,"f").set(e.type,r)),t}}nA=new WeakMap;class oA extends Event{constructor(e,t){super(e,t),this.detail=t?.detail}}const aA=globalThis.CustomEvent??oA;class cA{constructor(e,t,r){this.gossip=e,this.msgs=new Map,this.history=[],this.msgIdToStrFn=r;for(let e=0;e<t;e++)this.history[e]=[]}get size(){return this.msgs.size}put(e,t,r=!1){const{msgIdStr:n}=e;return!this.msgs.has(n)&&(this.msgs.set(n,{message:t,validated:r,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),!0)}observeDuplicate(e,t){const r=this.msgs.get(e);r&&!r.validated&&r.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){const r=this.msgs.get(e);if(!r)return null;const n=(r.iwantCounts.get(t)??0)+1;return r.iwantCounts.set(t,n),{msg:r.message,count:n}}getGossipIDs(e){const t=new Map;for(let r=0;r<this.gossip;r++)this.history[r].forEach((r=>{const n=this.msgs.get(r.msgIdStr);if(n&&n.validated&&e.has(r.topic)){let e=t.get(r.topic);e||(e=[],t.set(r.topic,e)),e.push(r.msgId)}}));return t}validate(e){const t=this.msgs.get(e);if(!t)return null;const{message:r,originatingPeers:n}=t;return t.validated=!0,t.originatingPeers=new Set,{message:r,originatingPeers:n}}shift(){this.history[this.history.length-1].forEach((e=>{this.msgs.delete(e.msgIdStr)})),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t?(this.msgs.delete(e),t):null}}var lA=r(64482);const{RPC:hA}=lA,uA="/floodsub/1.0.0",dA="/meshsub/1.0.0",pA="/meshsub/1.1.0",fA=5e3;function yA(e=[],t){return{subscriptions:[],messages:e,control:t?{graft:t.graft||[],prune:t.prune||[],ihave:t.ihave||[],iwant:t.iwant||[]}:void 0}}function gA(e){if(e.length<=1)return e;for(let t=0;t<e.length;t++){const r=Math.floor(Math.random()*Math.floor(e.length)),n=e[t];e[t]=e[r],e[r]=n}return e}const mA=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==r[o])throw new TypeError(i+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,s=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*l+1>>>0,o=new Uint8Array(i);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var u=0,d=i-1;(0!==h||u<s)&&-1!==d;d--,u++)h+=a*o[d]>>>0,o[d]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");s=u,t++}if(" "!==e[t]){for(var p=i-s;p!==i&&0===o[p];)p++;for(var f=new Uint8Array(n+(i-p)),y=n;p!==i;)f[y++]=o[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var o=(i-s)*h+1>>>0,l=new Uint8Array(o);s!==i;){for(var u=t[s],d=0,p=o-1;(0!==u||d<n)&&-1!==p;p--,d++)u+=256*l[p]>>>0,l[p]=u%a>>>0,u=u/a>>>0;if(0!==u)throw new Error("Non-zero carry");n=d,s++}for(var f=o-n;f!==o&&0===l[f];)f++;for(var y=c.repeat(r);f<o;++f)y+=e.charAt(l[f]);return y},decodeUnsafe:u,decode:function(e){var r=u(e);if(r)return r;throw new Error(`Non-${t} character`)}}},wA=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class bA{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class vA{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return _A(this,e)}}class EA{constructor(e){this.decoders=e}or(e){return _A(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const _A=(e,t)=>new EA({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class SA{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new bA(e,t,r),this.decoder=new vA(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const AA=({name:e,prefix:t,encode:r,decode:n})=>new SA(e,t,r,n),IA=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:s}=mA(r,t);return AA({prefix:e,name:t,encode:n,decode:e=>wA(s(e))})},RA=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>AA({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],s=(1<<r)-1;let i="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,i+=t[s&a>>o];if(o&&(i+=t[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i})(e,n,r),decode:t=>((e,t,r,n)=>{const s={};for(let e=0;e<t.length;++e)s[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,l=0;for(let t=0;t<i;++t){const i=s[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),kA=AA({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),TA=RA({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),CA=RA({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),PA=IA({prefix:"9",name:"base10",alphabet:"0123456789"}),NA=RA({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),DA=RA({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),OA=RA({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),xA=RA({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),LA=RA({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),BA=RA({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),MA=RA({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),UA=RA({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),zA=RA({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),VA=RA({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),FA=RA({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),jA=IA({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),KA=IA({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),$A=IA({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),HA=IA({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),qA=RA({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),GA=RA({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),WA=RA({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),YA=RA({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ZA=Array.from(""),QA=ZA.reduce(((e,t,r)=>(e[r]=t,e)),[]),JA=ZA.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]),XA=AA({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+QA[t]),"")},decode:function(e){const t=[];for(const r of e){const e=JA[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var eI=Math.pow(2,31),tI=Math.pow(2,7),rI=Math.pow(2,14),nI=Math.pow(2,21),sI=Math.pow(2,28),iI=Math.pow(2,35),oI=Math.pow(2,42),aI=Math.pow(2,49),cI=Math.pow(2,56),lI=Math.pow(2,63),hI={encode:function e(t,r,n){r=r||[];for(var s=n=n||0;t>=eI;)r[n++]=255&t|128,t/=128;for(;-128&t;)r[n++]=255&t|128,t>>>=7;return r[n]=0|t,e.bytes=n-s+1,r},decode:function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(127&n)<<i:(127&n)*Math.pow(2,i),i+=7}while(n>=128);return e.bytes=o-r,s},encodingLength:function(e){return e<tI?1:e<rI?2:e<nI?3:e<sI?4:e<iI?5:e<oI?6:e<aI?7:e<cI?8:e<lI?9:10}};const uI=hI,dI=(e,t,r=0)=>(uI.encode(e,t,r),t),pI=e=>uI.encodingLength(e),fI=(e,t)=>{const r=t.byteLength,n=pI(e),s=n+pI(r),i=new Uint8Array(s+r);return dI(e,i,0),dI(r,i,n),i.set(t,s),new yI(e,r,t,i)};class yI{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const gI=({name:e,code:t,encode:r})=>new mI(e,t,r);class mI{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?fI(this.code,t):t.then((e=>fI(this.code,e)))}throw Error("Unknown type, must be binary type")}}const wI=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),bI=gI({name:"sha2-256",code:18,encode:wI("SHA-256")}),vI=gI({name:"sha2-512",code:19,encode:wI("SHA-512")}),EI=wA,_I={code:0,name:"identity",encode:EI,digest:e=>fI(0,EI(e))},SI="raw",AI=85,II=e=>wA(e),RI=e=>wA(e),kI=new TextEncoder,TI=new TextDecoder,CI="json",PI=512,NI=e=>kI.encode(JSON.stringify(e)),DI=e=>JSON.parse(TI.decode(e));r(82784);class OI{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this.byteOffset=n.byteOffset,this.byteLength=n.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:cid_hidden,byteLength:cid_hidden,code:cid_readonly,version:cid_readonly,multihash:cid_readonly,bytes:cid_readonly,_baseCache:cid_hidden,asCID:cid_hidden})}toV0(){if(0===this.version)return this;{const{code:e,multihash:t}=this;if(e!==cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return OI.createV0(t)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return OI.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Digest.equals(this.multihash,e.multihash)}toString(e){const{bytes:t,version:r,_baseCache:n}=this;return 0===r?cid_toStringV0(t,n,e||base58btc.encoder):cid_toStringV1(t,n,e||base32.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return deprecate(/^0\.0/,IS_CID_DEPRECATION),!(!e||!e[cid_cidSymbol]&&e.asCID!==e)}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof OI)return e;if(null!=e&&e.asCID===e){const{version:t,code:r,multihash:n,bytes:s}=e;return new OI(t,r,n,s||cid_encodeCID(t,r,n.bytes))}if(null!=e&&!0===e[cid_cidSymbol]){const{version:t,multihash:r,code:n}=e,s=Digest.decode(r);return OI.create(t,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");switch(e){case 0:if(t!==cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${cid_DAG_PB_CODE}) block encoding`);return new OI(e,t,r,r.bytes);case 1:{const n=cid_encodeCID(e,t,r.bytes);return new OI(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return OI.create(0,cid_DAG_PB_CODE,e)}static createV1(e,t){return OI.create(1,e,t)}static decode(e){const[t,r]=OI.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=OI.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),i=new Digest.Digest(t.multihashCode,t.digestSize,s,n);return[0===t.version?OI.createV0(i):OI.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){const t=()=>{const[t,r]=varint.decode(e.subarray(0));return t};let r=t(),n=cid_DAG_PB_CODE;if(18===r||1===r&&t(),0!==r&&1!==r)throw new RangeError(`Invalid CID version ${r}`);const s=t(),i=t(),o=0+i;return{version:r,codec:n,multihashCode:s,digestSize:i,multihashSize:o-0,size:o}}static parse(e,t){const[r,n]=cid_parseCIDtoBytes(e,t),s=OI.decode(n);return s._baseCache.set(r,e),s}}Symbol.for("@ipld/js-cid/CID");const xI={...I,...R,...k,...T,...C,...P,...N,...D,...O,...x};function LI(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function BI(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?LI(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function MI(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const UI=MI("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),zI=MI("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=BI((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),VI={utf8:UI,"utf-8":UI,hex:xI.base16,latin1:zI,ascii:zI,binary:zI,...xI};function FI(e,t="utf8"){const r=VI[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}function jI(e){return FI(e,"base64")}const KI="StrictSign",$I="StrictNoSign";var HI,qI,GI,WI,YI,ZI;function QI(e){switch(e){case GI.Ignore:return WI.Ignore;case GI.Reject:return WI.Reject}}!function(e){e.StrictSign="StrictSign",e.StrictNoSign="StrictNoSign"}(HI||(HI={})),function(e){e[e.Signing=0]="Signing",e[e.Anonymous=1]="Anonymous"}(qI||(qI={})),function(e){e.Accept="accept",e.Ignore="ignore",e.Reject="reject"}(GI||(GI={})),function(e){e.Error="error",e.Ignore="ignore",e.Reject="reject",e.Blacklisted="blacklisted"}(WI||(WI={})),function(e){e.InvalidSignature="invalid_signature",e.InvalidSeqno="invalid_seqno",e.InvalidPeerId="invalid_peerid",e.SignaturePresent="signature_present",e.SeqnoPresent="seqno_present",e.FromPresent="from_present",e.TransformFailed="transform_failed"}(YI||(YI={})),function(e){e.duplicate="duplicate",e.invalid="invalid",e.valid="valid"}(ZI||(ZI={}));const JI="ERR_INVALID_PEER_SCORE_PARAMS",XI={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},eR={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function tR(e={}){return{...XI,...e,topics:e.topics?Object.entries(e.topics).reduce(((e,[t,r])=>(e[t]=function(e={}){return{...eR,...e}}(r),e)),{}):{}}}function rR(e){if(e.topicWeight<0)throw qe(new Error("invalid topic weight; must be >= 0"),JI);if(0===e.timeInMeshQuantum)throw qe(new Error("invalid TimeInMeshQuantum; must be non zero"),JI);if(e.timeInMeshWeight<0)throw qe(new Error("invalid TimeInMeshWeight; must be positive (or 0 to disable)"),JI);if(0!==e.timeInMeshWeight&&e.timeInMeshQuantum<=0)throw qe(new Error("invalid TimeInMeshQuantum; must be positive"),JI);if(0!==e.timeInMeshWeight&&e.timeInMeshCap<=0)throw qe(new Error("invalid TimeInMeshCap; must be positive"),JI);if(e.firstMessageDeliveriesWeight<0)throw qe(new Error("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)"),JI);if(0!==e.firstMessageDeliveriesWeight&&(e.firstMessageDeliveriesDecay<=0||e.firstMessageDeliveriesDecay>=1))throw qe(new Error("invalid FirstMessageDeliveriesDecay; must be between 0 and 1"),JI);if(0!==e.firstMessageDeliveriesWeight&&e.firstMessageDeliveriesCap<=0)throw qe(new Error("invalid FirstMessageDeliveriesCap; must be positive"),JI);if(e.meshMessageDeliveriesWeight>0)throw qe(new Error("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)"),JI);if(0!==e.meshMessageDeliveriesWeight&&(e.meshMessageDeliveriesDecay<=0||e.meshMessageDeliveriesDecay>=1))throw qe(new Error("invalid MeshMessageDeliveriesDecay; must be between 0 and 1"),JI);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesCap<=0)throw qe(new Error("invalid MeshMessageDeliveriesCap; must be positive"),JI);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesThreshold<=0)throw qe(new Error("invalid MeshMessageDeliveriesThreshold; must be positive"),JI);if(e.meshMessageDeliveriesWindow<0)throw qe(new Error("invalid MeshMessageDeliveriesWindow; must be non-negative"),JI);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesActivation<1e3)throw qe(new Error("invalid MeshMessageDeliveriesActivation; must be at least 1s"),JI);if(e.meshFailurePenaltyWeight>0)throw qe(new Error("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)"),JI);if(0!==e.meshFailurePenaltyWeight&&(e.meshFailurePenaltyDecay<=0||e.meshFailurePenaltyDecay>=1))throw qe(new Error("invalid MeshFailurePenaltyDecay; must be between 0 and 1"),JI);if(e.invalidMessageDeliveriesWeight>0)throw qe(new Error("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)"),JI);if(e.invalidMessageDeliveriesDecay<=0||e.invalidMessageDeliveriesDecay>=1)throw qe(new Error("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1"),JI)}const nR={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function sR(e={}){return{...nR,...e}}function iR(e,t,r,n){let s=0;Object.entries(t.topics).forEach((([e,t])=>{const n=r.topics[e];if(void 0===n)return;let i=0;if(t.inMesh){let e=t.meshTime/n.timeInMeshQuantum;e>n.timeInMeshCap&&(e=n.timeInMeshCap),i+=e*n.timeInMeshWeight}let o=t.firstMessageDeliveries;if(o>n.firstMessageDeliveriesCap&&(o=n.firstMessageDeliveriesCap),i+=o*n.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<n.meshMessageDeliveriesThreshold){const e=n.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;i+=e*e*n.meshMessageDeliveriesWeight}i+=t.meshFailurePenalty*n.meshFailurePenaltyWeight,i+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*n.invalidMessageDeliveriesWeight,s+=i*n.topicWeight})),r.topicScoreCap>0&&s>r.topicScoreCap&&(s=r.topicScoreCap);const i=r.appSpecificScore(e);if(s+=i*r.appSpecificWeight,t.ips.forEach((e=>{if(r.IPColocationFactorWhitelist.has(e))return;const t=n.get(e),i=t?t.size:0;if(i>r.IPColocationFactorThreshold){const e=i-r.IPColocationFactorThreshold;s+=e*e*r.IPColocationFactorWeight}})),t.behaviourPenalty>r.behaviourPenaltyThreshold){const e=t.behaviourPenalty-r.behaviourPenaltyThreshold;s+=e*e*r.behaviourPenaltyWeight}return s}var oR,aR=r(19301);!function(e){e[e.unknown=0]="unknown",e[e.valid=1]="valid",e[e.invalid=2]="invalid",e[e.ignored=3]="ignored"}(oR||(oR={}));class cR{constructor(){this.records=new Map,this.queue=new aR}ensureRecord(e){let t=this.records.get(e);if(t)return t;t={status:oR.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const r={msgId:e,expire:Date.now()+12e4};return this.queue.push(r),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}function lR(e){return null!=e&&"function"==typeof e.start&&"function"==typeof e.stop}function hR(e){return null!=e&&"function"==typeof e.init}class uR{constructor(e={}){this.started=!1,null!=e.peerId&&this.setPeerId(e.peerId),null!=e.addressManager&&this.setAddressManager(e.addressManager),null!=e.peerStore&&this.setPeerStore(e.peerStore),null!=e.upgrader&&this.setUpgrader(e.upgrader),null!=e.metrics&&this.setMetrics(e.metrics),null!=e.registrar&&this.setRegistrar(e.registrar),null!=e.connectionManager&&this.setConnectionManager(e.connectionManager),null!=e.transportManager&&this.setTransportManager(e.transportManager),null!=e.connectionGater&&this.setConnectionGater(e.connectionGater),null!=e.contentRouting&&this.setContentRouting(e.contentRouting),null!=e.peerRouting&&this.setPeerRouting(e.peerRouting),null!=e.datastore&&this.setDatastore(e.datastore),null!=e.connectionProtector&&this.setConnectionProtector(e.connectionProtector),null!=e.dht&&this.setDHT(e.dht),null!=e.pubsub&&this.setPubSub(e.pubsub),null!=e.dialer&&this.setDialer(e.dialer)}isStarted(){return this.started}async beforeStart(){await Promise.all(Object.values(this).filter((e=>lR(e))).map((async e=>{null!=e.beforeStart&&await e.beforeStart()})))}async start(){await Promise.all(Object.values(this).filter((e=>lR(e))).map((async e=>{await e.start()}))),this.started=!0}async afterStart(){await Promise.all(Object.values(this).filter((e=>lR(e))).map((async e=>{null!=e.afterStart&&await e.afterStart()})))}async beforeStop(){await Promise.all(Object.values(this).filter((e=>lR(e))).map((async e=>{null!=e.beforeStop&&await e.beforeStop()})))}async stop(){await Promise.all(Object.values(this).filter((e=>lR(e))).map((async e=>{await e.stop()}))),this.started=!1}async afterStop(){await Promise.all(Object.values(this).filter((e=>lR(e))).map((async e=>{null!=e.afterStop&&await e.afterStop()})))}setPeerId(e){return this.peerId=e,e}getPeerId(){if(null==this.peerId)throw qe(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this.peerId}setMetrics(e){return this.metrics=e,hR(e)&&e.init(this),e}getMetrics(){return this.metrics}setAddressManager(e){return this.addressManager=e,hR(e)&&e.init(this),e}getAddressManager(){if(null==this.addressManager)throw qe(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this.addressManager}setPeerStore(e){return this.peerStore=e,hR(e)&&e.init(this),e}getPeerStore(){if(null==this.peerStore)throw qe(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this.peerStore}setUpgrader(e){return this.upgrader=e,hR(e)&&e.init(this),e}getUpgrader(){if(null==this.upgrader)throw qe(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this.upgrader}setRegistrar(e){return this.registrar=e,hR(e)&&e.init(this),e}getRegistrar(){if(null==this.registrar)throw qe(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this.registrar}setConnectionManager(e){return this.connectionManager=e,hR(e)&&e.init(this),e}getConnectionManager(){if(null==this.connectionManager)throw qe(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this.connectionManager}setTransportManager(e){return this.transportManager=e,hR(e)&&e.init(this),e}getTransportManager(){if(null==this.transportManager)throw qe(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this.transportManager}setConnectionGater(e){return this.connectionGater=e,hR(e)&&e.init(this),e}getConnectionGater(){if(null==this.connectionGater)throw qe(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this.connectionGater}setContentRouting(e){return this.contentRouting=e,hR(e)&&e.init(this),e}getContentRouting(){if(null==this.contentRouting)throw qe(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this.contentRouting}setPeerRouting(e){return this.peerRouting=e,hR(e)&&e.init(this),e}getPeerRouting(){if(null==this.peerRouting)throw qe(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this.peerRouting}setDatastore(e){return this.datastore=e,hR(e)&&e.init(this),e}getDatastore(){if(null==this.datastore)throw qe(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this.datastore}setConnectionProtector(e){return this.connectionProtector=e,hR(e)&&e.init(this),e}getConnectionProtector(){return this.connectionProtector}setDHT(e){return this.dht=e,hR(e)&&e.init(this),e}getDHT(){if(null==this.dht)throw qe(new Error("dht not set"),"ERR_SERVICE_MISSING");return this.dht}setPubSub(e){return this.pubsub=e,hR(e)&&e.init(this),e}getPubSub(){if(null==this.pubsub)throw qe(new Error("pubsub not set"),"ERR_SERVICE_MISSING");return this.pubsub}setDialer(e){return this.dialer=e,hR(e)&&e.init(this),e}getDialer(){if(null==this.dialer)throw qe(new Error("dialer not set"),"ERR_SERVICE_MISSING");return this.dialer}}const dR=He("libp2p:gossipsub:score");class pR{constructor(e,t,r){this.params=e,this.metrics=t,this.peerStats=new Map,this.peerIPs=new Map,this.scoreCache=new Map,this.deliveryRecords=new cR,this.components=new uR,function(e){for(const[t,r]of Object.entries(e.topics))try{rR(r)}catch(e){throw qe(new Error(`invalid score parameters for topic ${t}: ${e.message}`),JI)}if(e.topicScoreCap<0)throw qe(new Error("invalid topic score cap; must be positive (or 0 for no cap)"),JI);if(null===e.appSpecificScore||void 0===e.appSpecificScore)throw qe(new Error("missing application specific score function"),JI);if(e.IPColocationFactorWeight>0)throw qe(new Error("invalid IPColocationFactorWeight; must be negative (or 0 to disable)"),JI);if(0!==e.IPColocationFactorWeight&&e.IPColocationFactorThreshold<1)throw qe(new Error("invalid IPColocationFactorThreshold; must be at least 1"),JI);if(e.behaviourPenaltyWeight>0)throw qe(new Error("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)"),JI);if(0!==e.behaviourPenaltyWeight&&(e.behaviourPenaltyDecay<=0||e.behaviourPenaltyDecay>=1))throw qe(new Error("invalid BehaviourPenaltyDecay; must be between 0 and 1"),JI);if(e.decayInterval<1e3)throw qe(new Error("invalid DecayInterval; must be at least 1s"),JI);if(e.decayToZero<=0||e.decayToZero>=1)throw qe(new Error("invalid DecayToZero; must be between 0 and 1"),JI)}(e),this.scoreCacheValidityMs=r.scoreCacheValidityMs,this.computeScore=r.computeScore??iR}init(e){this.components=e}get size(){return this.peerStats.size}start(){this._backgroundInterval?dR("Peer score already running"):(this._backgroundInterval=setInterval((()=>this.background()),this.params.decayInterval),dR("started"))}stop(){this._backgroundInterval?(clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),dR("stopped")):dR("Peer score already stopped")}background(){this.refreshScores(),this.updateIPs(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map((([e,t])=>[e,t])))}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach(((r,n)=>{r.connected?(Object.entries(r.topics).forEach((([r,n])=>{const s=this.params.topics[r];void 0!==s&&(n.firstMessageDeliveries*=s.firstMessageDeliveriesDecay,n.firstMessageDeliveries<t&&(n.firstMessageDeliveries=0),n.meshMessageDeliveries*=s.meshMessageDeliveriesDecay,n.meshMessageDeliveries<t&&(n.meshMessageDeliveries=0),n.meshFailurePenalty*=s.meshFailurePenaltyDecay,n.meshFailurePenalty<t&&(n.meshFailurePenalty=0),n.invalidMessageDeliveries*=s.invalidMessageDeliveriesDecay,n.invalidMessageDeliveries<t&&(n.invalidMessageDeliveries=0),n.inMesh&&(n.meshTime=e-n.graftTime,n.meshTime>s.meshMessageDeliveriesActivation&&(n.meshMessageDeliveriesActive=!0)))})),r.behaviourPenalty*=this.params.behaviourPenaltyDecay,r.behaviourPenalty<t&&(r.behaviourPenalty=0)):e>r.expire&&(this.removeIPs(n,r.ips),this.peerStats.delete(n),this.scoreCache.delete(n))}))}score(e){this.metrics?.scoreFnCalls.inc();const t=this.peerStats.get(e);if(!t)return 0;const r=Date.now(),n=this.scoreCache.get(e);if(n&&n.cacheUntil>r)return n.score;this.metrics?.scoreFnRuns.inc();const s=this.computeScore(e,t,this.params,this.peerIPs),i=r+this.scoreCacheValidityMs;return n?(this.metrics?.scoreCachedDelta.observe(Math.abs(s-n.score)),n.score=s,n.cacheUntil=i):this.scoreCache.set(e,{score:s,cacheUntil:i}),s}addPenalty(e,t,r){const n=this.peerStats.get(e);n&&(n.behaviourPenalty+=t,this.metrics?.onScorePenalty(r))}addPeer(e){const t={connected:!0,expire:0,topics:{},ips:[],behaviourPenalty:0};this.peerStats.set(e,t);const r=this.getIPs(e);this.setIPs(e,r,t.ips),t.ips=r}removePeer(e){const t=this.peerStats.get(e);if(t){if(this.score(e)>0)return this.removeIPs(e,t.ips),void this.peerStats.delete(e);Object.entries(t.topics).forEach((([e,t])=>{t.firstMessageDeliveries=0;const r=this.params.topics[e].meshMessageDeliveriesThreshold;if(t.inMesh&&t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<r){const e=r-t.meshMessageDeliveries;t.meshFailurePenalty+=e*e}t.inMesh=!1,t.meshMessageDeliveriesActive=!1})),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);e&&(e.inMesh=!0,e.graftTime=Date.now(),e.meshTime=0,e.meshMessageDeliveriesActive=!1)}}prune(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);if(e){const r=this.params.topics[t].meshMessageDeliveriesThreshold;if(e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<r){const t=r-e.meshMessageDeliveries;e.meshFailurePenalty+=t*t}e.meshMessageDeliveriesActive=!1,e.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,r){this.markFirstMessageDelivery(e,r);const n=this.deliveryRecords.ensureRecord(t),s=Date.now();n.status===oR.unknown?(n.status=oR.valid,n.validated=s,n.peers.forEach((t=>{t!==e.toString()&&this.markDuplicateMessageDelivery(t,r)}))):dR("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-n.firstSeen,oR[n.status])}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,r,n){switch(n){case WI.Error:return void this.markInvalidMessageDelivery(e,r);case WI.Blacklisted:return}const s=this.deliveryRecords.ensureRecord(t);if(s.status===oR.unknown){if(n===WI.Ignore)return s.status=oR.ignored,void s.peers.clear();s.status=oR.invalid,this.markInvalidMessageDelivery(e,r),s.peers.forEach((e=>{this.markInvalidMessageDelivery(e,r)})),s.peers.clear()}else dR("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeen,oR[s.status])}duplicateMessage(e,t,r){const n=this.deliveryRecords.ensureRecord(t);if(!n.peers.has(e))switch(n.status){case oR.unknown:n.peers.add(e);break;case oR.valid:n.peers.add(e),this.markDuplicateMessageDelivery(e,r,n.validated);break;case oR.invalid:this.markInvalidMessageDelivery(e,r);case oR.ignored:}}markInvalidMessageDelivery(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);e&&(e.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);if(e){let r=this.params.topics[t].firstMessageDeliveriesCap;e.firstMessageDeliveries=Math.min(r,e.firstMessageDeliveries+1),e.inMesh&&(r=this.params.topics[t].meshMessageDeliveriesCap,e.meshMessageDeliveries=Math.min(r,e.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,r){const n=this.peerStats.get(e);if(n){const e=void 0!==r?Date.now():0,s=this.getPtopicStats(n,t);if(s&&s.inMesh){const n=this.params.topics[t];if(void 0!==r){const s=e-r,i=s>n.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,s,i),i)return}const i=n.meshMessageDeliveriesCap;s.meshMessageDeliveries=Math.min(i,s.meshMessageDeliveries+1)}}}getIPs(e){return this.components.getConnectionManager().getConnections(Za(e)).map((e=>e.remoteAddr.toOptions().host))}setIPs(e,t,r){e:for(const n of t){for(const e of r)if(n===e)continue e;let t=this.peerIPs.get(n);t||(t=new Set,this.peerIPs.set(n,t)),t.add(e)}e:for(const n of r){for(const e of t)if(n===e)continue e;const r=this.peerIPs.get(n);r&&(r.delete(e),r.size||this.peerIPs.delete(n))}}removeIPs(e,t){t.forEach((t=>{const r=this.peerIPs.get(t);r&&(r.delete(e),r.size||this.peerIPs.delete(t))}))}updateIPs(){this.peerStats.forEach(((e,t)=>{const r=this.getIPs(t);this.setIPs(t,r,e.ips),e.ips=r}))}getPtopicStats(e,t){let r=e.topics[t];return void 0!==r?r:void 0!==this.params.topics[t]?(r={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=r,r):null}}class fR{constructor(e,t,r){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=r,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const r=t[Math.floor(Math.random()*t.length)],n=this.msgIdToStrFn(r);let s=this.promises.get(n);s||(s=new Map,this.promises.set(n,s));const i=Date.now();s.has(e)||(s.set(e,i+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(n)||this.requestMsByMsg.set(n,i)))}getBrokenPromises(){const e=Date.now(),t=new Map;let r=0;return this.promises.forEach(((n,s)=>{n.forEach(((s,i)=>{s<e&&(t.set(i,(t.get(i)??0)+1),n.delete(i),r++)})),n.size||this.promises.delete(s)})),this.metrics?.iwantPromiseBroken.inc(r),t}deliverMessage(e){this.trackMessage(e);const t=this.promises.get(e);t&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(t.size)))}rejectMessage(e,t){this.trackMessage(e),t!==WI.Error&&this.promises.delete(e)}clear(){this.promises.clear()}prune(){const e=Date.now()-this.requestMsByMsgExpire;for(const[t,r]of this.requestMsByMsg.entries()){if(!(r<e))break;this.requestMsByMsg.delete(t)}}trackMessage(e){if(this.metrics){const t=this.requestMsByMsg.get(e);void 0!==t&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}class yR{constructor(e){this.entries=new Map,this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs})}prune(){const e=Date.now();for(const[t,r]of this.entries.entries()){if(!(r.validUntilMs<e))break;this.entries.delete(t)}}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var gR,mR,wR,bR,vR,ER;function _R(e,t){t||(t=e.reduce(((e,t)=>e+t.length),0));const r=BI(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return LI(r)}!function(e){e.forward="forward",e.publish="publish"}(gR||(gR={})),function(e){e.Fanout="fanout",e.Random="random",e.Subscribed="subscribed",e.Outbound="outbound",e.NotEnough="not_enough",e.Opportunistic="opportunistic"}(mR||(mR={})),function(e){e.Dc="disconnected",e.BadScore="bad_score",e.Prune="prune",e.Unsub="unsubscribed",e.Excess="excess"}(wR||(wR={})),function(e){e.GraftBackoff="graft_backoff",e.BrokenPromise="broken_promise",e.MessageDeficit="message_deficit",e.IPColocation="IP_colocation"}(bR||(bR={})),function(e){e.LowScore="low_score",e.MaxIhave="max_ihave",e.MaxIasked="max_iasked"}(vR||(vR={})),function(e){e.graylist="graylist",e.publish="publish",e.gossip="gossip",e.mesh="mesh"}(ER||(ER={})),r(35564);var SR=r(28584);const AR={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function IR(e,t,r,n,s){if("sha1"!==s&&"sha2-256"!==s&&"sha2-512"!==s){const e=Object.keys(AR).join(" / ");throw qe(new Error(`Hash '${s}' is unknown or not supported. Must be ${e}`),"ERR_UNSUPPORTED_HASH_TYPE")}const i=SR(e,t,r,n,AR[s]);return kc.encode64(i,null)}const RR=function(e,t="utf8"){const r=VI[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):LI(globalThis.Buffer.from(e,"utf-8"))}("libp2p-pubsub:");const kR=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==r[o])throw new TypeError(i+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,s=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*l+1>>>0,o=new Uint8Array(i);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var u=0,d=i-1;(0!==h||u<s)&&-1!==d;d--,u++)h+=a*o[d]>>>0,o[d]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");s=u,t++}if(" "!==e[t]){for(var p=i-s;p!==i&&0===o[p];)p++;for(var f=new Uint8Array(n+(i-p)),y=n;p!==i;)f[y++]=o[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var o=(i-s)*h+1>>>0,l=new Uint8Array(o);s!==i;){for(var u=t[s],d=0,p=o-1;(0!==u||d<n)&&-1!==p;p--,d++)u+=256*l[p]>>>0,l[p]=u%a>>>0,u=u/a>>>0;if(0!==u)throw new Error("Non-zero carry");n=d,s++}for(var f=o-n;f!==o&&0===l[f];)f++;for(var y=c.repeat(r);f<o;++f)y+=e.charAt(l[f]);return y},decodeUnsafe:u,decode:function(e){var r=u(e);if(r)return r;throw new Error(`Non-${t} character`)}}},TR=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class CR{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class PR{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return DR(this,e)}}class NR{constructor(e){this.decoders=e}or(e){return DR(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const DR=(e,t)=>new NR({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class OR{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new CR(e,t,r),this.decoder=new PR(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const xR=({name:e,prefix:t,encode:r,decode:n})=>new OR(e,t,r,n),LR=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:s}=kR(r,t);return xR({prefix:e,name:t,encode:n,decode:e=>TR(s(e))})},BR=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>xR({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],s=(1<<r)-1;let i="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,i+=t[s&a>>o];if(o&&(i+=t[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i})(e,n,r),decode:t=>((e,t,r,n)=>{const s={};for(let e=0;e<t.length;++e)s[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,l=0;for(let t=0;t<i;++t){const i=s[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),MR=xR({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),UR=BR({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),zR=BR({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),VR=LR({prefix:"9",name:"base10",alphabet:"0123456789"}),FR=BR({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),jR=BR({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),KR=BR({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),$R=BR({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),HR=BR({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),qR=BR({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),GR=BR({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),WR=BR({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),YR=BR({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ZR=BR({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),QR=BR({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),JR=LR({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),XR=LR({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ek=LR({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),tk=LR({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),rk=BR({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),nk=BR({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),sk=BR({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ik=BR({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ok=Array.from(""),ak=ok.reduce(((e,t,r)=>(e[r]=t,e)),[]),ck=ok.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]),lk=xR({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+ak[t]),"")},decode:function(e){const t=[];for(const r of e){const e=ck[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var hk=Math.pow(2,31),uk=Math.pow(2,7),dk=Math.pow(2,14),pk=Math.pow(2,21),fk=Math.pow(2,28),yk=Math.pow(2,35),gk=Math.pow(2,42),mk=Math.pow(2,49),wk=Math.pow(2,56),bk=Math.pow(2,63),vk={encode:function e(t,r,n){r=r||[];for(var s=n=n||0;t>=hk;)r[n++]=255&t|128,t/=128;for(;-128&t;)r[n++]=255&t|128,t>>>=7;return r[n]=0|t,e.bytes=n-s+1,r},decode:function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(127&n)<<i:(127&n)*Math.pow(2,i),i+=7}while(n>=128);return e.bytes=o-r,s},encodingLength:function(e){return e<uk?1:e<dk?2:e<pk?3:e<fk?4:e<yk?5:e<gk?6:e<mk?7:e<wk?8:e<bk?9:10}};const Ek=vk,_k=(e,t,r=0)=>(Ek.encode(e,t,r),t),Sk=e=>Ek.encodingLength(e),Ak=(e,t)=>{const r=t.byteLength,n=Sk(e),s=n+Sk(r),i=new Uint8Array(s+r);return _k(e,i,0),_k(r,i,n),i.set(t,s),new Ik(e,r,t,i)};class Ik{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Rk=({name:e,code:t,encode:r})=>new kk(e,t,r);class kk{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ak(this.code,t):t.then((e=>Ak(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Tk=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ck=Rk({name:"sha2-256",code:18,encode:Tk("SHA-256")}),Pk=Rk({name:"sha2-512",code:19,encode:Tk("SHA-512")}),Nk=TR,Dk={code:0,name:"identity",encode:Nk,digest:e=>Ak(0,Nk(e))},Ok="raw",xk=85,Lk=e=>TR(e),Bk=e=>TR(e),Mk=new TextEncoder,Uk=new TextDecoder,zk="json",Vk=512,Fk=e=>Mk.encode(JSON.stringify(e)),jk=e=>JSON.parse(Uk.decode(e));r(82784);class Kk{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this.byteOffset=n.byteOffset,this.byteLength=n.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:src_cid_hidden,byteLength:src_cid_hidden,code:src_cid_readonly,version:src_cid_readonly,multihash:src_cid_readonly,bytes:src_cid_readonly,_baseCache:src_cid_hidden,asCID:src_cid_hidden})}toV0(){if(0===this.version)return this;{const{code:e,multihash:t}=this;if(e!==src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Kk.createV0(t)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return Kk.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Digest.equals(this.multihash,e.multihash)}toString(e){const{bytes:t,version:r,_baseCache:n}=this;return 0===r?src_cid_toStringV0(t,n,e||base58btc.encoder):src_cid_toStringV1(t,n,e||base32.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return cid_deprecate(/^0\.0/,cid_IS_CID_DEPRECATION),!(!e||!e[src_cid_cidSymbol]&&e.asCID!==e)}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof Kk)return e;if(null!=e&&e.asCID===e){const{version:t,code:r,multihash:n,bytes:s}=e;return new Kk(t,r,n,s||src_cid_encodeCID(t,r,n.bytes))}if(null!=e&&!0===e[src_cid_cidSymbol]){const{version:t,multihash:r,code:n}=e,s=Digest.decode(r);return Kk.create(t,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");switch(e){case 0:if(t!==src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${src_cid_DAG_PB_CODE}) block encoding`);return new Kk(e,t,r,r.bytes);case 1:{const n=src_cid_encodeCID(e,t,r.bytes);return new Kk(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Kk.create(0,src_cid_DAG_PB_CODE,e)}static createV1(e,t){return Kk.create(1,e,t)}static decode(e){const[t,r]=Kk.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Kk.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),i=new Digest.Digest(t.multihashCode,t.digestSize,s,n);return[0===t.version?Kk.createV0(i):Kk.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){const t=()=>{const[t,r]=varint.decode(e.subarray(0));return t};let r=t(),n=src_cid_DAG_PB_CODE;if(18===r||1===r&&t(),0!==r&&1!==r)throw new RangeError(`Invalid CID version ${r}`);const s=t(),i=t(),o=0+i;return{version:r,codec:n,multihashCode:s,digestSize:i,multihashSize:o-0,size:o}}static parse(e,t){const[r,n]=src_cid_parseCIDtoBytes(e,t),s=Kk.decode(n);return s._baseCache.set(r,e),s}}Symbol.for("@ipld/js-cid/CID");const $k={...z,...V,...F,...j,...K,...$,...H,...q,...G,...W};function Hk(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function qk(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Gk=qk("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Wk=qk("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=function(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?Hk(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),Yk={utf8:Gk,"utf-8":Gk,hex:$k.base16,latin1:Wk,ascii:Wk,binary:Wk,...$k};function Zk(e){if("signed"!==e.type)throw new Error("expected signed message type");if(null==e.sequenceNumber)throw Error("missing seqno field");return((e,t)=>{const r=function(e,t="utf8"){const r=Yk[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):Hk(globalThis.Buffer.from(e,"utf-8"))}(t.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(e.length+r.length);return n.set(e,0),n.set(r,e.length),n})(e.from.toBytes(),e.sequenceNumber)}async function Qk(e){return await bI.encode(e.data)}function Jk(e,t,r,n,s){let i=0;const o=new Map;if(Object.entries(t.topics).forEach((([e,t])=>{const n=s.get(e)??"unknown",a=r.topics[e];if(void 0===a)return;let c=o.get(n);c||(c={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(n,c));let l=0,h=0,u=0,d=0,p=0;t.inMesh&&(l+=Math.max(t.meshTime/a.timeInMeshQuantum,a.timeInMeshCap)*a.timeInMeshWeight);let f=t.firstMessageDeliveries;if(f>a.firstMessageDeliveriesCap&&(f=a.firstMessageDeliveriesCap),h+=f*a.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<a.meshMessageDeliveriesThreshold){const e=a.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;u+=e*e*a.meshMessageDeliveriesWeight}d+=t.meshFailurePenalty*a.meshFailurePenaltyWeight,p+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*a.invalidMessageDeliveriesWeight,i+=(l+h+u+d+p)*a.topicWeight,c.p1w+=l,c.p2w+=h,c.p3w+=u,c.p3bw+=d,c.p4w+=p})),r.topicScoreCap>0&&i>r.topicScoreCap){i=r.topicScoreCap;const e=r.topicScoreCap/i;for(const t of o.values())t.p1w*=e,t.p2w*=e,t.p3w*=e,t.p3bw*=e,t.p4w*=e}let a=0,c=0,l=0;return a+=r.appSpecificScore(e)*r.appSpecificWeight,t.ips.forEach((e=>{if(r.IPColocationFactorWhitelist.has(e))return;const t=n.get(e),s=t?t.size:0;if(s>r.IPColocationFactorThreshold){const e=s-r.IPColocationFactorThreshold;c+=e*e*r.IPColocationFactorWeight}})),l+=t.behaviourPenalty*t.behaviourPenalty*r.behaviourPenaltyWeight,i+=a+c+l,{byTopic:o,p5w:a,p6w:c,p7w:l,score:i}}function Xk(e,t,r=(()=>!0)){const n=new Set;if(t<=0)return n;for(const s of e){if(n.size>=t)break;r(s)&&(n.add(s),e.delete(s))}return n}class eT extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function tT(e,t,r){const n=r??{},s=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const i=()=>{null!=r&&r()};for(t.addEventListener("abort",i);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new eT(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new eT(e,r))}}));o=await Promise.race([e,s.next()]),r=null}catch(r){t.removeEventListener("abort",i);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&await n.onAbort(e),"function"==typeof s.return)try{const e=s.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",i)}()}function rT(e,t,r){return n=>e(tT(n,t,r))}function nT(e,t,r){return{sink:rT(e.sink,t,{...r,onAbort:void 0}),source:tT(e.source,t,r)}}const sT=e=>{const t=GS.encodingLength(e),r=(n=t,null!=globalThis?.Buffer?.allocUnsafe?globalThis.Buffer.allocUnsafe(n):new Uint8Array(n));var n;return GS.encode(e,r),sT.bytes=t,r};function iT(e){const t=(e=e??{}).lengthEncoder??sT;return async function*(e){for await(const r of e){const e=t(r.byteLength);e instanceof Uint8Array?yield e:yield*e,r instanceof Uint8Array?yield r:yield*r}}}var oT;sT.bytes=0,iT.single=(e,t)=>{const r=(t=t??{}).lengthEncoder??sT;return new mp(r(e.byteLength),e)},function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(oT||(oT={}));const aT=e=>{const t=GS.decode(e);return aT.bytes=GS.encodingLength(t),t};function cT(e){return async function*(t){const r=new mp;let n=oT.LENGTH,s=-1;const i=e?.lengthDecoder??aT,o=e?.maxLengthLength??8,a=e?.maxDataLength??4194304;for await(const c of t)for(r.append(c);r.byteLength>0;){if(n===oT.LENGTH)try{if(s=i(r),s<0)throw qe(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(s>a)throw qe(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const t=i.bytes;r.consume(t),null!=e?.onLength&&e.onLength(s),n=oT.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw qe(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw e}if(n===oT.DATA){if(r.byteLength<s)break;const t=r.sublist(0,s);r.consume(s),null!=e?.onData&&e.onData(t),yield t,n=oT.LENGTH}}if(r.byteLength>0)throw qe(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}aT.bytes=0,cT.fromReader=(e,t)=>{let r=1;const n=async function*(){for(;;)try{const{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}();return cT({...t??{},onLength:e=>{r=e}})(n)};class lT{constructor(e,t,r){this.rawStream=e,this.pushable=ju({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=r.maxBufferSize??1/0,Xu(tT(this.pushable,this.closeController.signal,{returnOnAbort:!0}),iT(),this.rawStream).catch(t)}get protocol(){return this.rawStream.stat.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}}class hT{constructor(e){this.rawStream=e,this.closeController=new AbortController,this.source=tT(Xu(this.rawStream,cT()),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}}var uT;!function(e){e[e.started=0]="started",e[e.stopped=1]="stopped"}(uT||(uT={}));class dT extends iA{constructor(e={}){super(),this.multicodecs=[pA,dA],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=ju({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.components=new uR,this.directPeerInitial=null,this.status={code:uT.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{const e=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch((e=>{this.log("Error running heartbeat",e)})).finally((()=>{if(null!=e&&e(),this.status.code===uT.started){clearTimeout(this.status.heartbeatTimeout);let e=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;e<.25*this.opts.heartbeatInterval&&(e+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,e)}}))};const t={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...e,scoreParams:tR(e.scoreParams),scoreThresholds:sR(e.scoreThresholds)};if(this.globalSignaturePolicy=t.globalSignaturePolicy??KI,t.fallbackToFloodsub&&this.multicodecs.push(uA),this.log=He(t.debugName??"libp2p:gossipsub"),this.opts=t,this.direct=new Set(t.directPeers.map((e=>e.id.toString()))),this.seenCache=new yR({validityMs:t.seenTTL}),this.publishedMessageIds=new yR({validityMs:t.seenTTL}),e.msgIdFn)this.msgIdFn=e.msgIdFn;else switch(this.globalSignaturePolicy){case KI:this.msgIdFn=Zk;break;case $I:this.msgIdFn=Qk}if(e.fastMsgIdFn&&(this.fastMsgIdFn=e.fastMsgIdFn,this.fastMsgIdCache=new yR({validityMs:t.seenTTL})),this.msgIdToStrFn=e.msgIdToStrFn??jI,this.mcache=e.messageCache||new cA(t.mcacheGossip,t.mcacheLength,this.msgIdToStrFn),e.dataTransform&&(this.dataTransform=e.dataTransform),e.metricsRegister){if(!e.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");const r=Math.max(...Object.values(t.scoreParams.topics).map((e=>e.meshMessageDeliveriesWindow)),1e3),n=function(e,t,r){return{protocolsEnabled:e.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:e.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:e.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:e.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),meshPeerChurnEvents:e.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),peersPerProtocol:e.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:e.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:e.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:e.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result for each topic",labelNames:["topic","acceptance"]}),asyncValidationMcacheHit:e.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),rpcRecvBytes:e.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:e.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:e.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:e.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:e.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:e.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:e.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:e.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:e.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcRecvNotAccepted:e.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:e.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:e.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:e.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:e.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:e.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:e.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:e.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:e.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:e.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:e.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeers:e.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:e.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["topic","peerGroup"]}),msgPublishBytes:e.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:e.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:e.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:e.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedStatus:e.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["topic","status"]}),msgReceivedInvalid:e.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["topic","error"]}),duplicateMsgDeliveryDelay:e.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*r.maxMeshMessageDeliveriesWindowSec,.5*r.maxMeshMessageDeliveriesWindowSec,1*r.maxMeshMessageDeliveriesWindowSec,2*r.maxMeshMessageDeliveriesWindowSec,4*r.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:e.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),scoreFnCalls:e.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:e.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:e.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:e.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:e.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores",labelNames:["topic","p"]}),scoreWeights:e.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:e.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:e.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:e.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*r.behaviourPenaltyThreshold,.5*r.behaviourPenaltyThreshold,1*r.behaviourPenaltyThreshold,2*r.behaviourPenaltyThreshold,4*r.behaviourPenaltyThreshold]}),ihaveRcvIgnored:e.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:e.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:e.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:e.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:e.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:e.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:e.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedPeers:e.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:e.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantPromiseDeliveryTime:e.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*r.gossipPromiseExpireSec,1*r.gossipPromiseExpireSec,2*r.gossipPromiseExpireSec,4*r.gossipPromiseExpireSec]}),cacheSize:e.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:e.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),topicStrToLabel:t,toTopic(e){return this.topicStrToLabel.get(e)??e},onJoin(e){this.topicSubscriptionStatus.set({topicStr:e},1),this.meshPeerCounts.set({topicStr:e},0)},onLeave(e){this.topicSubscriptionStatus.set({topicStr:e},0),this.meshPeerCounts.set({topicStr:e},0)},onAddToMesh(e,t,r){const n=this.toTopic(e);this.meshPeerInclusionEvents.inc({topic:n,reason:t},r)},onRemoveFromMesh(e,t,r){const n=this.toTopic(e);this.meshPeerChurnEvents.inc({topic:n,reason:t},r)},onReportValidationMcacheHit(e){this.asyncValidationMcacheHit.inc({hit:e?"hit":"miss"})},onReportValidation(e,t){const r=this.toTopic(e);this.asyncValidationResult.inc({topic:r,acceptance:t})},onScorePenalty(e){this.scoringPenalties.inc({penalty:e},1)},onIhaveRcv(e,t,r){const n=this.toTopic(e);this.ihaveRcvMsgids.inc({topic:n},t),this.ihaveRcvNotSeenMsgids.inc({topic:n},r)},onIwantRcv(e,t){for(const[t,r]of e){const e=this.toTopic(t);this.iwantRcvMsgids.inc({topic:e},r)}this.iwantRcvDonthaveMsgids.inc(t)},onForwardMsg(e,t){const r=this.toTopic(e);this.msgForwardCount.inc({topic:r},1),this.msgForwardPeers.inc({topic:r},t)},onPublishMsg(e,t,r,n){const s=this.toTopic(e);this.msgPublishCount.inc({topic:s},1),this.msgPublishBytes.inc({topic:s},r*n),this.msgPublishPeers.inc({topic:s},r),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"direct"},t.direct),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"floodsub"},t.floodsub),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"mesh"},t.mesh),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"fanout"},t.fanout)},onMsgRecvPreValidation(e){const t=this.toTopic(e);this.msgReceivedPreValidation.inc({topic:t},1)},onMsgRecvResult(e,t){const r=this.toTopic(e);this.msgReceivedStatus.inc({topic:r,status:t})},onMsgRecvInvalid(e,t){const r=this.toTopic(e),n=t.reason===WI.Error?t.error:t.reason;this.msgReceivedInvalid.inc({topic:r,error:n},1)},onDuplicateMsgDelivery(e,t,r){if(this.duplicateMsgDeliveryDelay.observe(t/1e3),r){const t=this.toTopic(e);this.duplicateMsgLateDelivery.inc({topic:t},1)}},onRpcRecv(e,t){this.rpcRecvBytes.inc(t),this.rpcRecvCount.inc(1),e.subscriptions&&this.rpcRecvSubscription.inc(e.subscriptions.length),e.messages&&this.rpcRecvMessage.inc(e.messages.length),e.control&&(this.rpcRecvControl.inc(1),e.control.ihave&&this.rpcRecvIHave.inc(e.control.ihave.length),e.control.iwant&&this.rpcRecvIWant.inc(e.control.iwant.length),e.control.graft&&this.rpcRecvGraft.inc(e.control.graft.length),e.control.prune&&this.rpcRecvPrune.inc(e.control.prune.length))},onRpcSent(e,t){if(this.rpcSentBytes.inc(t),this.rpcSentCount.inc(1),e.subscriptions&&this.rpcSentSubscription.inc(e.subscriptions.length),e.messages&&this.rpcSentMessage.inc(e.messages.length),e.control){const t=e.control.ihave?.length??0,r=e.control.iwant?.length??0,n=e.control.graft?.length??0,s=e.control.prune?.length??0;t>0&&this.rpcSentIHave.inc(t),r>0&&this.rpcSentIWant.inc(r),n>0&&this.rpcSentGraft.inc(n),s>0&&this.rpcSentPrune.inc(s),(t>0||r>0||n>0||s>0)&&this.rpcSentControl.inc(1)}},registerScores(e,t){let r=0,n=0,s=0,i=0;for(const o of e)o>=t.graylistThreshold&&r++,o>=t.publishThreshold&&n++,o>=t.gossipThreshold&&s++,o>=0&&i++;this.peersByScoreThreshold.set({threshold:ER.graylist},r),this.peersByScoreThreshold.set({threshold:ER.publish},n),this.peersByScoreThreshold.set({threshold:ER.gossip},s),this.peersByScoreThreshold.set({threshold:ER.mesh},i),this.score.set(e)},registerScoreWeights(e){for(const[t,r]of e.byTopic)this.scoreWeights.set({topic:t,p:"p1"},r.p1w),this.scoreWeights.set({topic:t,p:"p2"},r.p2w),this.scoreWeights.set({topic:t,p:"p3"},r.p3w),this.scoreWeights.set({topic:t,p:"p3b"},r.p3bw),this.scoreWeights.set({topic:t,p:"p4"},r.p4w);this.scoreWeights.set({p:"p5"},e.p5w),this.scoreWeights.set({p:"p6"},e.p6w),this.scoreWeights.set({p:"p7"},e.p7w)},registerScorePerMesh(e,t){const r=new Map;e.forEach(((e,t)=>{const n=this.topicStrToLabel.get(t)??"unknown";let s=r.get(n);s||(s=new Set,r.set(n,s)),e.forEach((e=>s?.add(e)))}));for(const[e,n]of r){const r=[];n.forEach((e=>{r.push(t.get(e)??0)})),this.scorePerMesh.set({topic:e},r)}}}}(e.metricsRegister,e.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:t.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:r/1e3});n.mcacheSize.addCollect((()=>this.onScrapeMetrics(n)));for(const e of this.multicodecs)n.protocolsEnabled.set({protocol:e},1);this.metrics=n}else this.metrics=null;this.gossipTracer=new fR(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new pR(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:t.heartbeatInterval}),this.maxInboundStreams=e.maxInboundStreams,this.maxOutboundStreams=e.maxOutboundStreams}getPeers(){return[...this.peers.keys()].map((e=>Za(e)))}isStarted(){return this.status.code===uT.started}async init(e){this.components=e,this.score.init(e)}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await async function(e,t){switch(e){case KI:{if(!t)throw Error("Must provide PeerId");if(null==t.privateKey)throw Error("Cannot sign message, no private key present");if(null==t.publicKey)throw Error("Cannot sign message, no public key present");const e=await ru(t.privateKey);return{type:qI.Signing,author:t,key:t.publicKey,privateKey:e}}case $I:return{type:qI.Anonymous};default:throw new Error(`Unknown signature policy "${e}"`)}}(this.globalSignaturePolicy,this.components.getPeerId()),this.outboundInflightQueue=ju({objectMode:!0}),Xu(this.outboundInflightQueue,(async e=>{for await(const{peerId:t,connection:r}of e)await this.createOutboundStream(t,r)})).catch((e=>this.log.error("outbound inflight queue error",e))),await Promise.all(this.opts.directPeers.map((async e=>{await this.components.getPeerStore().addressBook.add(e.id,e.addrs)})));const e=this.components.getRegistrar();await Promise.all(this.multicodecs.map((t=>e.handle(t,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))));const t=rA({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),r=await Promise.all(this.multicodecs.map((r=>e.register(r,t)))),n=setTimeout(this.runHeartbeat,100);this.status={code:uT.started,registrarTopologyIds:r,heartbeatTimeout:n,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout((()=>{Promise.resolve().then((async()=>{await Promise.all(Array.from(this.direct).map((async e=>await this.connect(e))))})).catch((e=>{this.log(e)}))}),1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==uT.started)return;const{registrarTopologyIds:e}=this.status;this.status={code:uT.stopped};const t=this.components.getRegistrar();e.forEach((e=>t.unregister(e))),this.outboundInflightQueue.end();for(const e of this.streamsOutbound.values())e.close();this.streamsOutbound.clear();for(const e of this.streamsInbound.values())e.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;const r=t.remotePeer;this.addPeer(r,t.stat.direction),this.createInboundStream(r,e),this.outboundInflightQueue.push({peerId:r,connection:t})}onPeerConnected(e,t){this.isStarted()&&(this.addPeer(e,t.stat.direction),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;const r=e.toString();if(this.peers.has(r)&&!this.streamsOutbound.has(r))try{const n=new lT(await t.newStream(this.multicodecs),(e=>this.log.error("outbound pipe error",e)),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(r,n);const s=n.protocol;s===uA&&this.floodsubPeers.add(r),this.metrics?.peersPerProtocol.inc({protocol:s},1),this.subscriptions.size>0&&(this.log("send subscriptions to",r),this.sendSubscriptions(r,Array.from(this.subscriptions),!0))}catch(e){this.log.error("createOutboundStream error",e)}}async createInboundStream(e,t){if(!this.isStarted())return;const r=e.toString();if(!this.peers.has(r))return;const n=this.streamsInbound.get(r);void 0!==n&&(this.log("replacing existing inbound steam %s",r),n.close()),this.log("create inbound stream %s",r);const s=new hT(t);this.streamsInbound.set(r,s),this.pipePeerReadStream(e,s.source).catch((e=>this.log(e)))}addPeer(e,t){const r=e.toString();this.peers.has(r)||(this.log("new peer %p",e),this.peers.add(r),this.score.addPeer(r),this.outbound.has(r)||this.outbound.set(r,"outbound"===t))}removePeer(e){const t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);const r=this.streamsOutbound.get(t),n=this.streamsInbound.get(t);r&&this.metrics?.peersPerProtocol.inc({protocol:r.protocol},-1),r?.close(),n?.close(),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(const e of this.topics.values())e.delete(t);for(const[e,r]of this.mesh)!0===r.delete(t)&&this.metrics?.onRemoveFromMesh(e,wR.Dc,1);for(const e of this.fanout.values())e.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===uT.started}getMeshPeers(e){const t=this.mesh.get(e);return t?Array.from(t):[]}getSubscribers(e){const t=this.topics.get(e);return(t?Array.from(t):[]).map((e=>Za(e)))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await Xu(t,(async t=>{for await(const r of t)try{const t=r.subarray(),n=hA.decode(t);this.metrics?.onRpcRecv(n,t.length),this.opts.awaitRpcHandler?await this.handleReceivedRpc(e,n):this.handleReceivedRpc(e,n).catch((e=>this.log(e)))}catch(e){this.log(e)}}))}catch(t){this.log.error(t),this.onPeerDisconnected(e)}}async handleReceivedRpc(e,t){if(!this.acceptFrom(e.toString()))return this.log("received message from unacceptable peer %p",e),void this.metrics?.rpcRecvNotAccepted.inc();if(this.log("rpc from %p",e),t.subscriptions&&t.subscriptions.length>0&&(t.subscriptions.forEach((t=>{this.handleReceivedSubscription(e,t)})),this.dispatchEvent(new aA("subscription-change",{detail:{peerId:e,subscriptions:t.subscriptions.filter((e=>null!==e.topic)).map((e=>({topic:e.topic??"",subscribe:Boolean(e.subscribe)})))}}))),t.messages)for(const r of t.messages){const t=this.handleReceivedMessage(e,r).catch((e=>this.log(e)));this.opts.awaitRpcMessageHandler&&await t}t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t){if(null==t.topic)return;this.log("subscription update from %p topic %s",e,t.topic);let r=this.topics.get(t.topic);null==r&&(r=new Set,this.topics.set(t.topic,r)),t.subscribe?r.add(e.toString()):r.delete(e.toString())}async handleReceivedMessage(e,t){this.metrics?.onMsgRecvPreValidation(t.topic);const r=await this.validateReceivedMessage(e,t);switch(this.metrics?.onMsgRecvResult(t.topic,r.code),r.code){case ZI.duplicate:return this.score.duplicateMessage(e.toString(),r.msgIdStr,t.topic),void this.mcache.observeDuplicate(r.msgIdStr,e.toString());case ZI.invalid:if(r.msgIdStr){const n=r.msgIdStr;this.score.rejectMessage(e.toString(),n,t.topic,r.reason),this.gossipTracer.rejectMessage(n,r.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);return void this.metrics?.onMsgRecvInvalid(t.topic,r);case ZI.valid:this.score.validateMessage(r.messageId.msgIdStr),this.gossipTracer.deliverMessage(r.messageId.msgIdStr),this.mcache.put(r.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)&&(this.components.getPeerId().equals(e)&&!this.opts.emitSelf||(super.dispatchEvent(new aA("gossipsub:message",{detail:{propagationSource:e,msgId:r.messageId.msgIdStr,msg:r.msg}})),super.dispatchEvent(new aA("message",{detail:r.msg})))),this.opts.asyncValidation||this.forwardMessage(r.messageId.msgIdStr,t,e.toString())}}async validateReceivedMessage(e,t){const r=this.fastMsgIdFn?.(t),n=r?this.fastMsgIdCache?.get(r):void 0;if(n)return{code:ZI.duplicate,msgIdStr:n};const s=await async function(e,t){switch(e){case $I:return null!=t.signature?{valid:!1,error:YI.SignaturePresent}:null!=t.seqno?{valid:!1,error:YI.SeqnoPresent}:null!=t.key?{valid:!1,error:YI.FromPresent}:{valid:!0,message:{type:"unsigned",topic:t.topic,data:t.data??new Uint8Array(0)}};case KI:{if(null==t.seqno)return{valid:!1,error:YI.InvalidSeqno};if(8!==t.seqno.length)return{valid:!1,error:YI.InvalidSeqno};if(null==t.signature)return{valid:!1,error:YI.InvalidSignature};if(null==t.from)return{valid:!1,error:YI.InvalidPeerId};let e,r;try{e=Qa(t.from)}catch(e){return{valid:!1,error:YI.InvalidPeerId}}if(t.key){if(r=eu(t.key),void 0!==e.publicKey&&!function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}(r.bytes,e.publicKey))return{valid:!1,error:YI.InvalidPeerId}}else{if(null==e.publicKey)return{valid:!1,error:YI.InvalidPeerId};r=eu(e.publicKey)}const n={from:t.from,data:t.data,seqno:t.seqno,topic:t.topic,signature:void 0,key:void 0},s=_R([RR,hA.Message.encode(n).finish()]);return await r.verify(s,t.signature)?{valid:!0,message:{type:"signed",from:e,data:t.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${FI(t.seqno,"base16")}`),topic:t.topic,signature:t.signature,key:t.key??tu(r)}}:{valid:!1,error:YI.InvalidSignature}}}}(this.globalSignaturePolicy,t);if(!s.valid)return{code:ZI.invalid,reason:WI.Error,error:s.error};const i=s.message;try{this.dataTransform&&(i.data=this.dataTransform.inboundTransform(t.topic,i.data))}catch(e){return this.log("Invalid message, transform failed",e),{code:ZI.invalid,reason:WI.Error,error:YI.TransformFailed}}const o=await this.msgIdFn(i),a=this.msgIdToStrFn(o),c={msgId:o,msgIdStr:a};if(r&&this.fastMsgIdCache?.put(r,a),this.seenCache.has(a))return{code:ZI.duplicate,msgIdStr:a};this.seenCache.put(a);const l=this.topicValidators.get(t.topic);if(null!=l){let t;try{t=await l(i.topic,i,e)}catch(e){const r=e.code;"ERR_TOPIC_VALIDATOR_IGNORE"===r&&(t=GI.Ignore),t="ERR_TOPIC_VALIDATOR_REJECT"===r?GI.Reject:GI.Ignore}if(t!==GI.Accept)return{code:ZI.invalid,reason:QI(t),msgIdStr:a}}return{code:ZI.valid,messageId:c,msg:i}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,r){this.sendRpc(e,{subscriptions:t.map((e=>({topic:e,subscribe:r}))),messages:[]})}async handleControlMessage(e,t){if(void 0===t)return;const r=t.ihave?this.handleIHave(e,t.ihave):[],n=t.iwant?this.handleIWant(e,t.iwant):[],s=t.graft?await this.handleGraft(e,t.graft):[];t.prune&&await this.handlePrune(e,t.prune),(r.length||n.length||s.length)&&this.sendRpc(e,yA(n,{iwant:r,prune:s}))}acceptFrom(e){if(this.direct.has(e))return!0;const t=Date.now(),r=this.acceptFromWhitelist.get(e);if(r&&r.messagesAccepted<128&&r.acceptUntil>=t)return r.messagesAccepted+=1,!0;const n=this.score.score(e);return n>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+1e3}):this.acceptFromWhitelist.delete(e),n>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){if(!t.length)return[];const r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,r),this.metrics?.ihaveRcvIgnored.inc({reason:vR.LowScore}),[];const n=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,n),n>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:vR.MaxIhave}),[];const s=this.iasked.get(e)??0;if(s>=fA)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,s),this.metrics?.ihaveRcvIgnored.inc({reason:vR.MaxIasked}),[];const i=new Map;if(t.forEach((({topicID:e,messageIDs:t})=>{if(!e||!t||!this.mesh.has(e))return;let r=0;t.forEach((e=>{const t=this.msgIdToStrFn(e);this.seenCache.has(t)||(i.set(t,e),r++)})),this.metrics?.onIhaveRcv(e,t.length,r)})),!i.size)return[];let o=i.size;o+s>fA&&(o=fA-s),this.log("IHAVE: Asking for %d out of %d messages from %s",o,i.size,e);let a=Array.from(i.values());return gA(a),a=a.slice(0,o),this.iasked.set(e,s+o),this.gossipTracer.addPromise(e,a),[{messageIDs:a}]}handleIWant(e,t){if(!t.length)return[];const r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,r),[];const n=new Map,s=new Map;let i=0;return t.forEach((({messageIDs:t})=>{t&&t.forEach((t=>{const r=this.msgIdToStrFn(t),o=this.mcache.getWithIWantCount(r,e);null!=o?(s.set(o.msg.topic,1+(s.get(o.msg.topic)??0)),o.count>3?this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,t):n.set(r,o.msg)):i++}))})),this.metrics?.onIwantRcv(s,i),n.size?(this.log("IWANT: Sending %d messages to %s",n.size,e),Array.from(n.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,t){const r=[],n=this.score.score(e),s=Date.now();let i=this.opts.doPX;return t.forEach((({topicID:t})=>{if(!t)return;const o=this.mesh.get(t);if(!o)return void(i=!1);if(o.has(e))return;if(this.direct.has(e))return this.log("GRAFT: ignoring request from direct peer %s",e),r.push(t),void(i=!1);const a=this.backoff.get(t)?.get(e);if("number"==typeof a&&s<a){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,bR.GraftBackoff),i=!1;const n=a+this.opts.graftFloodThreshold-this.opts.pruneBackoff;return s<n&&this.score.addPenalty(e,1,bR.GraftBackoff),this.addBackoff(e,t),void r.push(t)}return n<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,n,t),r.push(t),i=!1,void this.addBackoff(e,t)):o.size>=this.opts.Dhi&&!this.outbound.get(e)?(r.push(t),void this.addBackoff(e,t)):(this.log("GRAFT: Add mesh link from %s in %s",e,t),this.score.graft(e,t),o.add(e),void this.metrics?.onAddToMesh(t,mR.Subscribed,1))})),r.length?await Promise.all(r.map((t=>this.makePrune(e,t,i)))):[]}async handlePrune(e,t){const r=this.score.score(e);for(const{topicID:n,backoff:s,peers:i}of t){if(null==n)continue;const t=this.mesh.get(n);if(!t)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,n),this.score.prune(e,n),t.has(e)&&(t.delete(e),this.metrics?.onRemoveFromMesh(n,wR.Unsub,1)),"number"==typeof s&&s>0?this.doAddBackoff(e,n,1e3*s):this.addBackoff(e,n),i&&i.length){if(r<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,r,n);continue}await this.pxConnect(i)}}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,r){let n=this.backoff.get(t);n||(n=new Map,this.backoff.set(t,n));const s=Date.now()+r;(n.get(e)??0)<s&&n.set(e,s)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach(((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,bR.BrokenPromise)}))}clearBackoff(){if(this.heartbeatTicks%15!=0)return;const e=Date.now();this.backoff.forEach(((t,r)=>{t.forEach(((r,n)=>{r<e&&t.delete(n)})),0===t.size&&this.backoff.delete(r)}))}async directConnect(){const e=[];this.direct.forEach((t=>{this.streamsOutbound.has(t)||e.push(t)})),await Promise.all(e.map((async e=>await this.connect(e))))}async pxConnect(e){e.length>this.opts.prunePeers&&(gA(e),e=e.slice(0,this.opts.prunePeers));const t=[];await Promise.all(e.map((async e=>{if(!e.peerID)return;const r=Qa(e.peerID).toString();if(!this.peers.has(r))if(e.signedPeerRecord)try{const n=await WS.openAndCertify(e.signedPeerRecord,"libp2p-peer-record"),s=n.peerId;if(!n.peerId.equals(r))return void this.log("bogus peer record obtained through px: peer ID %p doesn't match expected peer %p",s,r);if(!await this.components.getPeerStore().addressBook.consumePeerRecord(n))return void this.log("bogus peer record obtained through px: could not add peer record to address book");t.push(r)}catch(e){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}else t.push(r)}))),t.length&&await Promise.all(t.map((async e=>await this.connect(e))))}async connect(e){this.log("Initiating connection with %s",e);const t=Za(e),r=await this.components.getConnectionManager().openConnection(t);for(const e of this.multicodecs)for(const n of this.components.getRegistrar().getTopologies(e))n.onConnect(t,r)}subscribe(e){if(this.status.code!==uT.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==uT.started)throw new Error("Pubsub is not started");const t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!1);this.leave(e).catch((e=>{this.log(e)}))}join(e){if(this.status.code!==uT.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);const t=new Set,r=this.fanout.get(e);if(r&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),r.forEach((e=>{!this.direct.has(e)&&this.score.score(e)>=0&&t.add(e)})),this.metrics?.onAddToMesh(e,mR.Fanout,t.size)),t.size<this.opts.D){const r=t.size;this.getRandomGossipPeers(e,this.opts.D,(e=>!t.has(e)&&!this.direct.has(e)&&this.score.score(e)>=0)).forEach((e=>{t.add(e)})),this.metrics?.onAddToMesh(e,mR.Random,t.size-r)}this.mesh.set(e,t),t.forEach((t=>{this.log("JOIN: Add mesh link to %s in %s",t,e),this.sendGraft(t,e)}))}async leave(e){if(this.status.code!==uT.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);const t=this.mesh.get(e);t&&(await Promise.all(Array.from(t).map((async t=>(this.log("LEAVE: Remove mesh link to %s in %s",t,e),await this.sendPrune(t,e))))),this.mesh.delete(e))}selectPeersToForward(e,t,r){const n=new Set,s=this.topics.get(e);s&&(this.direct.forEach((e=>{s.has(e)&&t!==e&&!r?.has(e)&&n.add(e)})),this.floodsubPeers.forEach((e=>{s.has(e)&&t!==e&&!r?.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&n.add(e)})));const i=this.mesh.get(e);return i&&i.size>0&&i.forEach((e=>{t===e||r?.has(e)||n.add(e)})),n}selectPeersToPublish(e){const t=new Set,r={direct:0,floodsub:0,mesh:0,fanout:0},n=this.topics.get(e);if(n)if(this.opts.floodPublish)n.forEach((e=>{this.direct.has(e)?(t.add(e),r.direct++):this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)}));else{this.direct.forEach((e=>{n.has(e)&&(t.add(e),r.direct++)})),this.floodsubPeers.forEach((e=>{n.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)}));const s=this.mesh.get(e);if(s&&s.size>0)s.forEach((e=>{t.add(e),r.mesh++}));else{const n=this.fanout.get(e);if(n&&n.size>0)n.forEach((e=>{t.add(e),r.fanout++}));else{const n=this.getRandomGossipPeers(e,this.opts.D,(e=>this.score.score(e)>=this.opts.scoreThresholds.publishThreshold));n.size>0&&(this.fanout.set(e,n),n.forEach((e=>{t.add(e),r.fanout++})))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:r}}forwardMessage(e,t,r,n){r&&this.score.deliverMessage(r,e,t.topic);const s=this.selectPeersToForward(t.topic,r,n),i=yA([t]);s.forEach((e=>{this.sendRpc(e,i)})),this.metrics?.onForwardMsg(t.topic,s.size)}async publish(e,t){const r=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");const{raw:n,msg:s}=await async function(e,t,r,n){switch(e.type){case qI.Signing:{const s={from:e.author.toBytes(),data:n,seqno:Cl(8),topic:t,signature:void 0,key:void 0},i=_R([RR,hA.Message.encode(s).finish()]);return s.signature=await e.privateKey.sign(i),s.key=e.key,{raw:s,msg:{type:"signed",from:e.author,data:r,sequenceNumber:BigInt(`0x${FI(s.seqno,"base16")}`),topic:t,signature:s.signature,key:s.key}}}case qI.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:t,signature:void 0,key:void 0},msg:{type:"unsigned",data:r,topic:t}}}}(this.publishConfig,e,t,r),i=await this.msgIdFn(s),o=this.msgIdToStrFn(i);if(this.seenCache.has(o))throw Error("PublishError.Duplicate");const{tosend:a,tosendCount:c}=this.selectPeersToPublish(e),l=!0===this.opts.emitSelf&&this.subscriptions.has(e);if(0===a.size&&!this.opts.allowPublishToZeroPeers&&!l)throw Error("PublishError.InsufficientPeers");this.seenCache.put(o),this.mcache.put({msgId:i,msgIdStr:o},n,!0),this.publishedMessageIds.put(o);const h=yA([n]);for(const e of a)this.sendRpc(e,h)||a.delete(e);return this.metrics?.onPublishMsg(e,c,a.size,null!=n.data?n.data.length:0),l&&(a.add(this.components.getPeerId().toString()),super.dispatchEvent(new aA("gossipsub:message",{detail:{propagationSource:this.components.getPeerId(),msgId:o,msg:s}})),super.dispatchEvent(new aA("message",{detail:s}))),{recipients:Array.from(a.values()).map((e=>Za(e)))}}reportMessageValidationResult(e,t,r){if(r===GI.Accept){const n=this.mcache.validate(e);if(this.metrics?.onReportValidationMcacheHit(null!==n),null!=n){const{message:s,originatingPeers:i}=n;this.score.deliverMessage(t.toString(),e,s.topic),this.forwardMessage(e,n.message,t.toString(),i),this.metrics?.onReportValidation(s.topic,r)}}else{const n=this.mcache.remove(e);if(this.metrics?.onReportValidationMcacheHit(null!==n),n){const s=QI(r),{message:i,originatingPeers:o}=n;this.score.rejectMessage(t.toString(),e,i.topic,s);for(const t of o)this.score.rejectMessage(t,e,i.topic,s);this.metrics?.onReportValidation(i.topic,r)}}}sendGraft(e,t){const r=yA([],{graft:[{topicID:t}]});this.sendRpc(e,r)}async sendPrune(e,t){const r=yA([],{prune:[await this.makePrune(e,t,this.opts.doPX)]});this.sendRpc(e,r)}sendRpc(e,t){const r=this.streamsOutbound.get(e);if(!r)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;const n=this.control.get(e);n&&(this.piggybackControl(e,t,n),this.control.delete(e));const s=this.gossip.get(e);s&&(this.piggybackGossip(e,t,s),this.gossip.delete(e));const i=hA.encode(t).finish();try{r.push(i)}catch(t){return this.log.error(`Cannot send rpc to ${e}`,t),n&&this.control.set(e,n),s&&this.gossip.set(e,s),!1}return this.metrics?.onRpcSent(t,i.length),!0}piggybackControl(e,t,r){const n=(r.graft||[]).filter((({topicID:t})=>(t&&this.mesh.get(t)||new Set).has(e))),s=(r.prune||[]).filter((({topicID:t})=>!(t&&this.mesh.get(t)||new Set).has(e)));(n.length||s.length)&&(t.control?(t.control.graft=t.control.graft&&t.control.graft.concat(n),t.control.prune=t.control.prune&&t.control.prune.concat(s)):t.control={graft:n,prune:s,ihave:[],iwant:[]})}piggybackGossip(e,t,r){t.control||(t.control={ihave:[],iwant:[],graft:[],prune:[]}),t.control.ihave=r}async sendGraftPrune(e,t,r){const n=this.opts.doPX;for(const[s,i]of e){const e=i.map((e=>({topicID:e})));let o=[];const a=t.get(s);a&&(o=await Promise.all(a.map((async e=>await this.makePrune(s,e,n&&!r.get(s))))),t.delete(s));const c=yA([],{graft:e,prune:o});this.sendRpc(s,c)}for(const[e,s]of t){const t=yA([],{prune:await Promise.all(s.map((async t=>await this.makePrune(e,t,n&&!r.get(e)))))});this.sendRpc(e,t)}}emitGossip(e){const t=this.mcache.getGossipIDs(new Set(e.keys()));for(const[r,n]of e)this.doEmitGossip(r,n,t.get(r)??[])}doEmitGossip(e,t,r){if(!r.length)return;if(gA(r),r.length>fA&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",r.length),!t.size)return;let n=this.opts.Dlazy;const s=.25*t.size;let i=t;s>n&&(n=s),n>i.size?n=i.size:i=gA(Array.from(i)).slice(0,n),i.forEach((t=>{let n=r;r.length>fA&&(n=gA(n.slice()).slice(0,fA)),this.pushGossip(t,{topicID:e,messageIDs:n})}))}flush(){for(const[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,yA([],{ihave:t}));for(const[e,t]of this.control.entries())this.control.delete(e),this.sendRpc(e,yA([],{graft:t.graft,prune:t.prune}))}pushGossip(e,t){this.log("Add gossip to %s",e);const r=this.gossip.get(e)||[];this.gossip.set(e,r.concat(t))}async makePrune(e,t,r){if(this.score.prune(e,t),this.streamsOutbound.get(e).protocol===dA)return{topicID:t,peers:[]};const n=this.opts.pruneBackoff/1e3;if(!r)return{topicID:t,peers:[],backoff:n};const s=this.getRandomGossipPeers(t,this.opts.prunePeers,(t=>t!==e&&this.score.score(t)>=0)),i=await Promise.all(Array.from(s).map((async e=>{const t=Za(e);return{peerID:t.toBytes(),signedPeerRecord:await this.components.getPeerStore().addressBook.getRawEnvelope(t)}})));return{topicID:t,peers:i,backoff:n}}async heartbeat(){const{D:e,Dlo:t,Dhi:r,Dscore:n,Dout:s,fanoutTTL:i}=this.opts;this.heartbeatTicks++;const o=new Map,a=e=>{let t=o.get(e);return void 0===t&&(t=this.score.score(e),o.set(e,t)),t},c=new Map,l=new Map,h=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks==0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const u=new Map;this.mesh.forEach(((i,o)=>{const d=this.topics.get(o),p=new Set,f=new Set;if(u.set(o,f),d){const e=gA(Array.from(d)),t=this.backoff.get(o);for(const r of e){const e=this.streamsOutbound.get(r);if(e&&this.multicodecs.includes(e.protocol)&&!i.has(r)&&!this.direct.has(r)){const e=a(r);t&&t.has(r)||!(e>=0)||p.add(r),e>=this.opts.scoreThresholds.gossipThreshold&&f.add(r)}}}const y=(e,t)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",e,o),this.addBackoff(e,o),i.delete(e),a(e)>=this.opts.scoreThresholds.gossipThreshold&&f.add(e),this.metrics?.onRemoveFromMesh(o,t,1);const r=l.get(e);r?r.push(o):l.set(e,[o])},g=(e,t)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",e,o),this.score.graft(e,o),i.add(e),f.delete(e),this.metrics?.onAddToMesh(o,t,1);const r=c.get(e);r?r.push(o):c.set(e,[o])};if(i.forEach((e=>{const t=a(e);t<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",e,t,o),y(e,wR.BadScore),h.set(e,!0))})),i.size<t){(m=p,w=e-i.size,Xk(m,w,(()=>!0))).forEach((e=>{g(e,mR.NotEnough)}))}var m,w;if(i.size>r){let t=Array.from(i);t.sort(((e,t)=>a(t)-a(e))),t=t.slice(0,n).concat(gA(t.slice(n)));let r=0;if(t.slice(0,e).forEach((e=>{this.outbound.get(e)&&r++})),r<s){const n=e=>{const r=t[e];for(let r=e;r>0;r--)t[r]=t[r-1];t[0]=r};if(r>0){let s=r;for(let r=1;r<e&&s>0;r++)this.outbound.get(t[r])&&(n(r),s--)}let s=e-r;for(let r=e;r<t.length&&s>0;r++)this.outbound.get(t[r])&&(n(r),s--)}t.slice(e).forEach((e=>{y(e,wR.Excess)}))}if(i.size>=t){let e=0;i.forEach((t=>{this.outbound.get(t)&&e++})),e<s&&Xk(p,s-e,(e=>!0===this.outbound.get(e))).forEach((e=>{g(e,mR.Outbound)}))}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks==0&&i.size>1){const e=Array.from(i).sort(((e,t)=>a(e)-a(t))),t=Math.floor(i.size/2),r=a(e[t]);if(r<this.opts.scoreThresholds.opportunisticGraftThreshold){const e=Xk(p,this.opts.opportunisticGraftPeers,(e=>a(e)>r));for(const t of e)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",t,o),g(t,mR.Opportunistic)}}}));const d=Date.now();this.fanoutLastpub.forEach(((e,t)=>{e+i<d&&(this.fanout.delete(t),this.fanoutLastpub.delete(t))})),this.fanout.forEach(((t,r)=>{const n=this.topics.get(r);t.forEach((e=>{(!n.has(e)||a(e)<this.opts.scoreThresholds.publishThreshold)&&t.delete(e)}));const s=this.topics.get(r),i=[],o=new Set;if(u.set(r,o),s){const e=gA(Array.from(s));for(const r of e){const e=this.streamsOutbound.get(r);if(e&&this.multicodecs.includes(e.protocol)&&!t.has(r)&&!this.direct.has(r)){const e=a(r);e>=this.opts.scoreThresholds.publishThreshold&&i.push(r),e>=this.opts.scoreThresholds.gossipThreshold&&o.add(r)}}}if(t.size<e){const r=e-t.size;i.slice(0,r).forEach((e=>{t.add(e),o?.delete(e)}))}})),this.emitGossip(u),await this.sendGraftPrune(c,l,h),this.flush(),this.mcache.shift(),this.dispatchEvent(new aA("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,r=(()=>!0)){const n=this.topics.get(e);if(!n)return new Set;let s=[];return n.forEach((e=>{const t=this.streamsOutbound.get(e);t&&this.multicodecs.includes(t.protocol)&&r(e)&&s.push(e)})),s=gA(s),t>0&&s.length>t&&(s=s.slice(0,t)),new Set(s)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0;for(const e of this.backoff.values())t+=e.size;e.cacheSize.set({cache:"backoff"},t);for(const[t,r]of this.topics)e.topicPeersCount.set({topicStr:t},r.size);for(const[t,r]of this.mesh)e.meshPeerCounts.set({topicStr:t},r.size);const r=[],n=new Map;e.behaviourPenalty.reset();for(const t of this.peers.keys()){const s=this.score.score(t);r.push(s),n.set(t,s),e.behaviourPenalty.observe(this.score.peerStats.get(t)?.behaviourPenalty??0)}e.registerScores(r,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,n);const s=function(e,t,r,n,s){const i={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of e){const e=t.get(o);if(e){const t=Jk(o,e,r,n,s);for(const[e,r]of t.byTopic){let t=i.byTopic.get(e);t||(t={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},i.byTopic.set(e,t)),t.p1w.push(r.p1w),t.p2w.push(r.p2w),t.p3w.push(r.p3w),t.p3bw.push(r.p3bw),t.p4w.push(r.p4w)}i.p5w.push(t.p5w),i.p6w.push(t.p6w),i.p7w.push(t.p7w),i.score.push(t.score)}else i.p5w.push(0),i.p6w.push(0),i.p7w.push(0),i.score.push(0)}return i}(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(s)}}dT.multicodec=pA;const pT=He("libp2p-delegated-peer-routing");var fT,yT;!function(e){e[e.SENDING_QUERY=0]="SENDING_QUERY",e[e.PEER_RESPONSE=1]="PEER_RESPONSE",e[e.FINAL_PEER=2]="FINAL_PEER",e[e.QUERY_ERROR=3]="QUERY_ERROR",e[e.PROVIDER=4]="PROVIDER",e[e.VALUE=5]="VALUE",e[e.ADDING_PEER=6]="ADDING_PEER",e[e.DIALING_PEER=7]="DIALING_PEER"}(fT||(fT={})),function(e){e[e.PUT_VALUE=0]="PUT_VALUE",e[e.GET_VALUE=1]="GET_VALUE",e[e.ADD_PROVIDER=2]="ADD_PROVIDER",e[e.GET_PROVIDERS=3]="GET_PROVIDERS",e[e.FIND_NODE=4]="FIND_NODE",e[e.PING=5]="PING"}(yT||(yT={}));class gT{constructor(e){if(null==e)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new Ma({concurrency:4});const{protocol:t,host:r,port:n}=e.getEndpointConfig();pT(`enabled DelegatedPeerRouting via ${t}://${r}:${n}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async findPeer(e,t={}){pT("findPeer starts: %p",e),t.timeout=t.timeout??3e4,t.signal=Oo([this.abortController.signal].concat(null!=t.signal?[t.signal]:[]));const r=Bd(),n=Bd();this.httpQueue.add((async()=>(r.resolve(),await n.promise)));try{await r.promise;for await(const r of this.client.dht.findPeer(e,t))if("FINAL_PEER"===r.name)return{id:r.peer.id,multiaddrs:r.peer.multiaddrs,protocols:[]}}catch(e){throw pT.error("findPeer errored: %o",e),e}finally{n.resolve(),pT("findPeer finished: %p",e)}throw qe(new Error("Not found"),"ERR_NOT_FOUND")}async*getClosestPeers(e,t={}){let r;const n=kt.asCID(e);r=null!=n?n:Qa(e),pT("getClosestPeers starts: %s",r),t.timeout=t.timeout??3e4,t.signal=Oo([this.abortController.signal].concat(null!=t.signal?[t.signal]:[]));const s=Bd(),i=Bd();this.httpQueue.add((async()=>(s.resolve(),await i.promise)));try{await s.promise;for await(const e of this.client.dht.query(r,t))"PEER_RESPONSE"===e.name&&(yield*e.closer.map((e=>({id:e.id,multiaddrs:e.multiaddrs,protocols:[]}))))}catch(e){throw pT.error("getClosestPeers errored:",e),e}finally{i.resolve(),pT("getClosestPeers finished: %b",e)}}}var mT=r(98935);const wT=He("libp2p:delegated-content-routing"),bT=3e4;var vT,ET;!function(e){e[e.SENDING_QUERY=0]="SENDING_QUERY",e[e.PEER_RESPONSE=1]="PEER_RESPONSE",e[e.FINAL_PEER=2]="FINAL_PEER",e[e.QUERY_ERROR=3]="QUERY_ERROR",e[e.PROVIDER=4]="PROVIDER",e[e.VALUE=5]="VALUE",e[e.ADDING_PEER=6]="ADDING_PEER",e[e.DIALING_PEER=7]="DIALING_PEER"}(vT||(vT={})),function(e){e[e.PUT_VALUE=0]="PUT_VALUE",e[e.GET_VALUE=1]="GET_VALUE",e[e.ADD_PROVIDER=2]="ADD_PROVIDER",e[e.GET_PROVIDERS=3]="GET_PROVIDERS",e[e.FIND_NODE=4]="FIND_NODE",e[e.PING=5]="PING"}(ET||(ET={}));class _T{constructor(e){if(null==e)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new Ma({concurrency:4}),this.httpQueueRefs=new Ma({concurrency:2});const{protocol:t,host:r,port:n}=e.getEndpointConfig();wT(`enabled DelegatedContentRouting via ${t}://${r}:${n}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.httpQueueRefs.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async*findProviders(e,t={}){wT("findProviders starts: %c",e),t.timeout=t.timeout??bT,t.signal=Oo([this.abortController.signal].concat(null!=t.signal?[t.signal]:[]));const r=Bd(),n=Bd();this.httpQueue.add((async()=>(r.resolve(),await n.promise)));try{await r.promise;for await(const r of this.client.dht.findProvs(e,t))"PROVIDER"===r.name&&(yield*r.providers.map((e=>({id:e.id,protocols:[],multiaddrs:e.multiaddrs}))))}catch(e){throw wT.error("findProviders errored:",e),e}finally{n.resolve(),wT("findProviders finished: %c",e)}}async provide(e,t={}){wT("provide starts: %c",e),t.timeout=t.timeout??bT,t.signal=Oo([this.abortController.signal].concat(null!=t.signal?[t.signal]:[])),await this.httpQueueRefs.add((async()=>{await this.client.block.stat(e,t),await mT(this.client.dht.provide(e,t))})),wT("provide finished: %c",e)}async put(e,t,r={}){wT("put value start: %b",e),r.timeout=r.timeout??bT,r.signal=Oo([this.abortController.signal].concat(null!=r.signal?[r.signal]:[])),await this.httpQueue.add((async()=>{await mT(this.client.dht.put(e,t,r))})),wT("put value finished: %b",e)}async get(e,t={}){return wT("get value start: %b",e),t.timeout=t.timeout??bT,t.signal=Oo([this.abortController.signal].concat(null!=t.signal?[t.signal]:[])),await this.httpQueue.add((async()=>{for await(const r of this.client.dht.get(e,t))if("VALUE"===r.name)return wT("get value finished: %b",e),r.value;throw qe(new Error("Not found"),"ERR_NOT_FOUND")}))}}const ST=e=>Promise.reject(new Error(`No base found for "${e}"`));class AT{constructor(e){this._basesByName={},this._basesByPrefix={},this._loadBase=e.loadBase||ST;for(const t of e.bases)this.addBase(t)}addBase(e){if(this._basesByName[e.name]||this._basesByPrefix[e.prefix])throw new Error(`Codec already exists for codec "${e.name}"`);this._basesByName[e.name]=e,this._basesByPrefix[e.prefix]=e}removeBase(e){delete this._basesByName[e.name],delete this._basesByPrefix[e.prefix]}async getBase(e){if(this._basesByName[e])return this._basesByName[e];if(this._basesByPrefix[e])return this._basesByPrefix[e];const t=await this._loadBase(e);return null==this._basesByName[t.name]&&null==this._basesByPrefix[t.prefix]&&this.addBase(t),t}listBases(){return Object.values(this._basesByName)}}const IT=e=>Promise.reject(new Error(`No codec found for "${e}"`));class RT{constructor(e){this._codecsByName={},this._codecsByCode={},this._loadCodec=e.loadCodec||IT;for(const t of e.codecs)this.addCodec(t)}addCodec(e){if(this._codecsByName[e.name]||this._codecsByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._codecsByName[e.name]=e,this._codecsByCode[e.code]=e}removeCodec(e){delete this._codecsByName[e.name],delete this._codecsByCode[e.code]}async getCodec(e){const t="string"==typeof e?this._codecsByName:this._codecsByCode;if(t[e])return t[e];const r=await this._loadCodec(e);return null==t[e]&&this.addCodec(r),r}listCodecs(){return Object.values(this._codecsByName)}}const kT=e=>Promise.reject(new Error(`No hasher found for "${e}"`));class TT{constructor(e){this._hashersByName={},this._hashersByCode={},this._loadHasher=e.loadHasher||kT;for(const t of e.hashers)this.addHasher(t)}addHasher(e){if(this._hashersByName[e.name]||this._hashersByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._hashersByName[e.name]=e,this._hashersByCode[e.code]=e}removeHasher(e){delete this._hashersByName[e.name],delete this._hashersByCode[e.code]}async getHasher(e){const t="string"==typeof e?this._hashersByName:this._hashersByCode;if(t[e])return t[e];const r=await this._loadHasher(e);return null==t[e]&&this.addHasher(r),r}listHashers(){return Object.values(this._hashersByName)}}function CT(e){try{e=Gw(Ki(e))}catch(e){}return e.toString()}const PT=He("ipfs-http-client:lib:error-handler"),NT=ye.bind({ignoreUndefined:!0}),DT=ge.isBrowser||ge.isWebWorker?location.protocol:"http",OT=ge.isBrowser||ge.isWebWorker?location.hostname:"localhost",xT=ge.isBrowser||ge.isWebWorker?location.port:"5001",LT=async e=>{let t;try{if((e.headers.get("Content-Type")||"").startsWith("application/json")){const r=await e.json();PT(r),t=r.Message||r.message}else t=await e.text()}catch(e){PT("Failed to parse error response",e),t=e.message}let r=new Ua.HTTPError(e);throw t&&(t.includes("deadline has elapsed")&&(r=new Ua.TimeoutError),t&&t.includes("context deadline exceeded")&&(r=new Ua.TimeoutError)),t&&t.includes("request timed out")&&(r=new Ua.TimeoutError),t&&(r.message=t),r},BT=/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,MT=e=>e.replace(BT,(function(e){return"-"+e.toLowerCase()})),UT=e=>"string"==typeof e?Mo(e):e;class zT extends Ua{constructor(e={}){const t=((e={})=>{let t,r,n={};if("string"==typeof e||Fi(e))t=new URL(CT(e));else if(e instanceof URL)t=e;else if("string"==typeof e.url||Fi(e.url))t=new URL(CT(e.url)),n=e;else if(e.url instanceof URL)t=e.url,n=e;else{n=e||{};const r=(n.protocol||DT).replace(":",""),s=(n.host||OT).split(":")[0],i=n.port||xT;t=new URL(`${r}://${s}:${i}`)}if(n.apiPath?t.pathname=n.apiPath:"/"!==t.pathname&&void 0!==t.pathname||(t.pathname="api/v0"),ge.isNode){const e=void 0;r=n.agent||new e({keepAlive:!0,maxSockets:6})}return{...n,host:t.host,protocol:t.protocol.replace(":",""),port:Number(t.port),apiPath:t.pathname,url:t,agent:r}})(e);super({timeout:UT(t.timeout||0)||void 0,headers:t.headers,base:`${t.url}`,handleError:LT,transformSearchParams:e=>{const t=new URLSearchParams;for(const[r,n]of e)"undefined"!==n&&"null"!==n&&"signal"!==r&&t.append(MT(r),n),"timeout"!==r||isNaN(n)||t.append(MT(r),n);return t},agent:t.agent}),delete this.get,delete this.put,delete this.delete,delete this.options;const r=this.fetch;this.fetch=(e,n={})=>("string"!=typeof e||e.startsWith("/")||(e=`${t.url}/${e}`),r.call(this,e,NT(n,{method:"POST"})))}}Ua.HTTPError;const VT=e=>t=>e(new zT(t),t);function FT(e){if(null!=e)return"string"==typeof e?e:e.toString(8).padStart(4,"0")}function jT(e){if(null==e)return;let t;if(null!=e.secs&&(t={secs:e.secs,nsecs:e.nsecs}),null!=e.Seconds&&(t={secs:e.Seconds,nsecs:e.FractionalNanoseconds}),Array.isArray(e)&&(t={secs:e[0],nsecs:e[1]}),e instanceof Date){const r=e.getTime(),n=Math.floor(r/1e3);t={secs:n,nsecs:1e3*(r-1e3*n)}}if(Object.prototype.hasOwnProperty.call(t,"secs")){if(null!=t&&null!=t.nsecs&&(t.nsecs<0||t.nsecs>999999999))throw qe(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return t}}function KT({arg:e,searchParams:t,hashAlg:r,mtime:n,mode:s,...i}={}){t&&(i={...i,...t}),r&&(i.hash=r),null!=n&&(n=jT(n),i.mtime=n.secs,i.mtimeNsecs=n.nsecs),null!=s&&(i.mode=FT(s)),i.timeout&&!isNaN(i.timeout)&&(i.timeout=`${i.timeout}ms`),null==e?e=[]:Array.isArray(e)||(e=[e]);const o=new URLSearchParams(i);return e.forEach((e=>o.append("arg",e))),o}const $T=VT((e=>async function(t={}){return((await(await e.post("bitswap/wantlist",{signal:t.signal,searchParams:KT(t),headers:t.headers})).json()).Keys||[]).map((e=>kt.parse(e["/"])))})),HT=VT((e=>async function(t,r={}){return((await(await e.post("bitswap/wantlist",{signal:r.signal,searchParams:KT({...r,peer:t.toString()}),headers:r.headers})).json()).Keys||[]).map((e=>kt.parse(e["/"])))})),qT=VT((e=>async function(t={}){const r=await e.post("bitswap/stat",{searchParams:KT(t),signal:t.signal,headers:t.headers});return function(e){return{provideBufLen:e.ProvideBufLen,wantlist:(e.Wantlist||[]).map((e=>kt.parse(e["/"]))),peers:(e.Peers||[]).map((e=>Za(e))),blocksReceived:BigInt(e.BlocksReceived),dataReceived:BigInt(e.DataReceived),blocksSent:BigInt(e.BlocksSent),dataSent:BigInt(e.DataSent),dupBlksReceived:BigInt(e.DupBlksReceived),dupDataReceived:BigInt(e.DupDataReceived)}}(await r.json())})),GT=VT((e=>async function(t,r={}){return(await e.post("bitswap/unwant",{signal:r.signal,searchParams:KT({arg:t.toString(),...r}),headers:r.headers})).json()}));function WT(e){return{wantlist:$T(e),wantlistForPeer:HT(e),unwant:GT(e),stat:qT(e)}}const YT=VT((e=>async function(t,r={}){const n=await e.post("block/get",{signal:r.signal,searchParams:KT({arg:t.toString(),...r}),headers:r.headers});return new Uint8Array(await n.arrayBuffer())}));async function ZT(e){if(qd(e))return new Blob([e]);if("string"==typeof e||e instanceof String)return new Blob([e.toString()]);if(Gd(e))return e;if(Yd(e)&&(e=Kd(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const t=$d(e),{value:r,done:n}=await t.peek();if(n)return QT(t);if(t.push(r),Number.isInteger(r))return new Blob([Uint8Array.from(await Hd(t))]);if(qd(r)||"string"==typeof r||r instanceof String)return QT(t)}throw qe(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT")}async function QT(e){const t=[];for await(const r of e)t.push(r);return new Blob(t)}function JT(e){if(null!=e)return"string"==typeof e?e:e.toString(8).padStart(4,"0")}async function XT(e,t,r={}){const n=[],s=new FormData;let i=0,o=0;for await(const{content:t,path:r,mode:a,mtime:c}of qp(e,ZT)){let e="";i>0&&(e=`-${i}`);let l=(t?"file":"dir")+e;const h=[];if(null!=a&&h.push(`mode=${JT(a)}`),null!=c){const{secs:e,nsecs:t}=c;h.push(`mtime=${e}`),null!=t&&h.push(`mtime-nsecs=${t}`)}if(h.length&&(l=`${l}?${h.join("&")}`),t){s.set(l,t,null!=r?encodeURIComponent(r):void 0);const e=o+t.size;n.push({name:r,start:o,end:e}),o=e}else{if(null==r)throw new Error("path or content or both must be set");s.set(l,new File([""],encodeURIComponent(r),{type:"application/x-directory"}))}i++}return{total:o,parts:n,headers:r,body:s}}function eC(...e){return(0,Oo.anySignal)(function(e){return e.filter(Boolean)}(e))}const tC=VT((e=>async function t(r,n={}){const s=eC((new AbortController).signal,n.signal);let i;try{const t=await e.post("block/put",{signal:s,searchParams:KT(n),...await XT([r],0,n.headers)});i=await t.json()}catch(e){if("dag-pb"===n.format)return t(r,{...n,format:"protobuf"});if("dag-cbor"===n.format)return t(r,{...n,format:"cbor"});throw e}return kt.parse(i.Key)})),rC=VT((e=>async function*(t,r={}){Array.isArray(t)||(t=[t]);const n=await e.post("block/rm",{signal:r.signal,searchParams:KT({arg:t.map((e=>e.toString())),"stream-channels":!0,...r}),headers:r.headers});for await(const e of n.ndjson())yield nC(e)}));function nC(e){const t={cid:kt.parse(e.Hash)};return e.Error&&(t.error=new Error(e.Error)),t}const sC=VT((e=>async function(t,r={}){const n=await e.post("block/stat",{signal:r.signal,searchParams:KT({arg:t.toString(),...r}),headers:r.headers}),s=await n.json();return{cid:kt.parse(s.Key),size:s.Size}}));function iC(e){return{get:YT(e),put:tC(e),rm:rC(e),stat:sC(e)}}const oC=VT((e=>async function(t,r={}){const n=await e.post("bootstrap/add",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers}),{Peers:s}=await n.json();return{Peers:s.map((e=>Ki(e)))}})),aC=VT((e=>async function(t={}){const r=await e.post("bootstrap/rm",{signal:t.signal,searchParams:KT({...t,all:!0}),headers:t.headers}),{Peers:n}=await r.json();return{Peers:n.map((e=>Ki(e)))}})),cC=VT((e=>async function(t={}){const r=await e.post("bootstrap/list",{signal:t.signal,searchParams:KT(t),headers:t.headers}),{Peers:n}=await r.json();return{Peers:n.map((e=>Ki(e)))}})),lC=VT((e=>async function(t={}){const r=await e.post("bootstrap/add",{signal:t.signal,searchParams:KT({...t,default:!0}),headers:t.headers}),{Peers:n}=await r.json();return{Peers:n.map((e=>Ki(e)))}})),hC=VT((e=>async function(t,r={}){const n=await e.post("bootstrap/rm",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers}),{Peers:s}=await n.json();return{Peers:s.map((e=>Ki(e)))}}));function uC(e){return{add:oC(e),clear:aC(e),list:cC(e),reset:lC(e),rm:hC(e)}}const dC=VT((e=>async function(t,r={}){const n=await e.post("config/profile/apply",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers}),s=await n.json();return{original:s.OldCfg,updated:s.NewCfg}}));function pC(e){if(null==e)return e;const t=/^[A-Z]+$/;return Object.keys(e).reduce(((r,n)=>(t.test(n)?r[n.toLowerCase()]=e[n]:t.test(n[0])?r[n[0].toLowerCase()+n.slice(1)]=e[n]:r[n]=e[n],r)),{})}const fC=VT((e=>async function(t={}){const r=await e.post("config/profile/list",{signal:t.signal,searchParams:KT(t),headers:t.headers});return(await r.json()).map((e=>pC(e)))}));function yC(e){return{apply:dC(e),list:fC(e)}}const gC=VT((e=>async(t,r={})=>{if(!t)throw new Error("key argument is required");const n=await e.post("config",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers});return(await n.json()).Value})),mC=VT((e=>async(t={})=>{const r=await e.post("config/show",{signal:t.signal,searchParams:KT({...t}),headers:t.headers});return await r.json()})),wC=VT((e=>async(t,r={})=>{const n=eC((new AbortController).signal,r.signal),s=await e.post("config/replace",{signal:n,searchParams:KT(r),...await XT([Xs(JSON.stringify(t))],0,r.headers)});await s.text()})),bC=VT((e=>async(t,r,n={})=>{if("string"!=typeof t)throw new Error("Invalid key type");const s={...n,...vC(t,r)},i=await e.post("config",{signal:n.signal,searchParams:KT(s),headers:n.headers});await i.text()})),vC=(e,t)=>{switch(typeof t){case"boolean":return{arg:[e,t.toString()],bool:!0};case"string":return{arg:[e,t]};default:return{arg:[e,JSON.stringify(t)],json:!0}}};function EC(e){return{getAll:mC(e),get:gC(e),set:bC(e),replace:wC(e),profiles:yC(e)}}const _C=VT((e=>async function*(t,r={}){const n=await e.post("dag/export",{signal:r.signal,searchParams:KT({arg:t.toString()}),headers:r.headers});yield*n.iterator()}));async function*SC(e,t,r,n,s){const i=async e=>{const t=await r.getCodec(e.code),i=await n(e,s);return t.decode(i)},o=t.split("/").filter(Boolean);let a=await i(e),c=e;for(;o.length;){const e=o.shift();if(!e)throw qe(new Error(`Could not resolve path "${t}"`),"ERR_INVALID_PATH");if(!Object.prototype.hasOwnProperty.call(a,e))throw qe(new Error(`no link named "${e}" under ${c}`),"ERR_NO_LINK");a=a[e],yield{value:a,remainderPath:o.join("/")};const r=kt.asCID(a);r&&(c=r,a=await i(a))}yield{value:a,remainderPath:""}}const AC=(e,t)=>{const r=VT(((t,r)=>{const n=YT(r);return async(t,r={})=>{if(r.path){const s=r.localResolve?await Lw(SC(t,r.path,e,n,r)):await Xa(SC(t,r.path,e,n,r));if(!s)throw qe(new Error("Not found"),"ERR_NOT_FOUND");return s}const s=await e.getCodec(t.code),i=await n(t,r);return{value:s.decode(i),remainderPath:""}}}));return r(t)},IC=VT((e=>async function*(t,r={}){const n=eC((new AbortController).signal,r.signal),{headers:s,body:i}=await XT(t,0,r.headers),o=await e.post("dag/import",{signal:n,headers:s,body:i,searchParams:KT({"pin-roots":r.pinRoots})});for await(const{Root:e}of o.ndjson())if(void 0!==e){const{Cid:{"/":t},PinErrorMsg:r}=e;yield{root:{cid:kt.parse(t),pinErrorMsg:r}}}})),RC=(e,t)=>{const r=VT((t=>async(r,n={})=>{const s={storeCodec:"dag-cbor",hashAlg:"sha2-256",...n};let i;if(s.inputCodec){if(!(r instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");i=r}else i=(await e.getCodec(s.storeCodec)).encode(r),s.inputCodec=s.storeCodec;const o=eC((new AbortController).signal,s.signal),a=await t.post("dag/put",{timeout:s.timeout,signal:o,searchParams:KT(s),...await XT([i],0,s.headers)}),c=await a.json();return kt.parse(c.Cid["/"])}));return r(t)},kC=VT((e=>async(t,r={})=>{const n=await e.post("dag/resolve",{signal:r.signal,searchParams:KT({arg:`${t}${r.path?`/${r.path}`.replace(/\/[/]+/g,"/"):""}`,...r}),headers:r.headers}),s=await n.json();return{cid:kt.parse(s.Cid["/"]),remainderPath:s.RemPath}}));function TC(e,t){return{export:_C(t),get:AC(e,t),import:IC(t),put:RC(e,t),resolve:kC(t)}}const CC=e=>{if(0===e.Type)return{name:"SENDING_QUERY",type:e.Type};if(1===e.Type)return{from:Za(e.ID),name:"PEER_RESPONSE",type:e.Type,messageType:0,messageName:"PUT_VALUE",closer:(e.Responses||[]).map((({ID:e,Addrs:t})=>({id:Za(e),multiaddrs:t.map((e=>Ki(e))),protocols:[]}))),providers:(e.Responses||[]).map((({ID:e,Addrs:t})=>({id:Za(e),multiaddrs:t.map((e=>Ki(e))),protocols:[]})))};if(2===e.Type){let t={id:e.ID??Za(e.ID),multiaddrs:[],protocols:[]};return e.Responses&&e.Responses.length&&(t={id:Za(e.Responses[0].ID),multiaddrs:e.Responses[0].Addrs.map((e=>Ki(e))),protocols:[]}),{name:"FINAL_PEER",type:e.Type,peer:t}}if(3===e.Type)return{name:"QUERY_ERROR",type:e.Type,error:new Error(e.Extra)};if(4===e.Type)return{name:"PROVIDER",type:e.Type,providers:e.Responses.map((({ID:e,Addrs:t})=>({id:Za(e),multiaddrs:t.map((e=>Ki(e))),protocols:[]})))};if(5===e.Type)return{name:"VALUE",type:e.Type,value:Xs(e.Extra,"base64pad")};if(6===e.Type){const t=e.Responses.map((({ID:e})=>Za(e)));if(!t.length)throw new Error("No peer found");return{name:"ADDING_PEER",type:e.Type,peer:t[0]}}if(7===e.Type)return{name:"DIALING_PEER",type:e.Type,peer:Za(e.ID)};throw new Error("Unknown DHT event type")},PC=VT((e=>async function*(t,r={}){const n=await e.post("dht/findpeer",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers});for await(const e of n.ndjson())yield CC(e)})),NC=VT((e=>async function*(t,r={}){const n=await e.post("dht/findprovs",{signal:r.signal,searchParams:KT({arg:t.toString(),...r}),headers:r.headers});for await(const e of n.ndjson())yield CC(e)})),DC=VT((e=>async function*(t,r={}){const n=await e.post("dht/get",{signal:r.signal,searchParams:KT({arg:t instanceof Uint8Array?ni(t):t.toString(),...r}),headers:r.headers});for await(const e of n.ndjson())yield CC(e)})),OC=VT((e=>async function*(t,r={recursive:!1}){const n=Array.isArray(t)?t:[t],s=await e.post("dht/provide",{signal:r.signal,searchParams:KT({arg:n.map((e=>e.toString())),...r}),headers:r.headers});for await(const e of s.ndjson())yield CC(e)})),xC=VT((e=>async function*(t,r,n={}){const s=eC((new AbortController).signal,n.signal),i=await e.post("dht/put",{signal:s,searchParams:KT({arg:t instanceof Uint8Array?ni(t):t.toString(),...n}),...await XT([r],0,n.headers)});for await(const e of i.ndjson())yield CC(e)})),LC=VT((e=>async function*(t,r={}){const n=await e.post("dht/query",{signal:r.signal,searchParams:KT({arg:t.toString(),...r}),headers:r.headers});for await(const e of n.ndjson())yield CC(e)}));function BC(e){return{findPeer:PC(e),findProvs:NC(e),get:DC(e),provide:OC(e),put:xC(e),query:LC(e)}}const MC=VT((e=>async function(t={}){return(await e.post("diag/cmds",{signal:t.signal,searchParams:KT(t),headers:t.headers})).json()})),UC=VT((e=>async function(t={}){return(await e.post("diag/net",{signal:t.signal,searchParams:KT(t),headers:t.headers})).json()})),zC=VT((e=>async function(t={}){return(await e.post("diag/sys",{signal:t.signal,searchParams:KT(t),headers:t.headers})).json()}));function VC(e){return{cmds:MC(e),net:UC(e),sys:zC(e)}}const FC=VT((e=>async function(t,r,n={}){const s=await e.post("files/chmod",{signal:n.signal,searchParams:KT({arg:t,mode:r,...n}),headers:n.headers});await s.text()})),jC=VT((e=>async function(t,r,n={}){const s=Array.isArray(t)?t:[t],i=await e.post("files/cp",{signal:n.signal,searchParams:KT({arg:s.concat(r).map((e=>kt.asCID(e)?`/ipfs/${e}`:e)),...n}),headers:n.headers});await i.text()})),KC=VT((e=>async function(t,r={}){if(!t||"string"!=typeof t)throw new Error("ipfs.files.flush requires a path");const n=await e.post("files/flush",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers}),s=await n.json();return kt.parse(s.Cid)}));function $C(e){const t=pC(e);return Object.prototype.hasOwnProperty.call(t,"mode")&&(t.mode=parseInt(t.mode,8)),Object.prototype.hasOwnProperty.call(t,"mtime")&&(t.mtime={secs:t.mtime,nsecs:t.mtimeNsecs||0},delete t.mtimeNsecs),t}const HC=VT((e=>async function*(t,r={}){if(!t)throw new Error("ipfs.files.ls requires a path");const n=await e.post("files/ls",{signal:r.signal,searchParams:KT({arg:kt.asCID(t)?`/ipfs/${t}`:t,long:!0,...r,stream:!0}),headers:r.headers});for await(const e of n.ndjson())if("Entries"in e)for(const t of e.Entries||[])yield qC($C(t));else yield qC($C(e))}));function qC(e){return e.hash&&(e.cid=kt.parse(e.hash)),delete e.hash,e.type=1===e.type?"directory":"file",e}const GC=VT((e=>async function(t,r={}){const n=await e.post("files/mkdir",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers});await n.text()})),WC=VT((e=>async function(t,r,n={}){Array.isArray(t)||(t=[t]);const s=await e.post("files/mv",{signal:n.signal,searchParams:KT({arg:t.concat(r),...n}),headers:n.headers});await s.text()}));var YC=r(18901);const ZC=VT((e=>async function*(t,r={}){const n=await e.post("files/read",{signal:r.signal,searchParams:KT({arg:t,count:r.length,...r}),headers:r.headers});yield*YC(n.body)})),QC=VT((e=>async function(t,r={}){const n=await e.post("files/rm",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers}),s=await n.text();if(""!==s){const e=new Ua.HTTPError(n);throw e.message=s,e}})),JC=VT((e=>async function(t,r={}){const n=await e.post("files/stat",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers}),s=await n.json();return s.WithLocality=s.WithLocality||!1,(i=$C(s)).cid=kt.parse(i.hash),delete i.hash,i;var i})),XC=VT((e=>async function(t,r={}){const n=await e.post("files/touch",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers});await n.text()})),eP=VT((e=>async function(t,r,n={}){const s=eC((new AbortController).signal,n.signal),i=await e.post("files/write",{signal:s,searchParams:KT({arg:t,streamChannels:!0,count:n.length,...n}),...await XT([{content:r,path:"arg",mode:FT(n.mode),mtime:jT(n.mtime)}],0,n.headers)});await i.text()}));function tP(e){return{chmod:FC(e),cp:jC(e),flush:KC(e),ls:HC(e),mkdir:GC(e),mv:WC(e),read:ZC(e),rm:QC(e),stat:JC(e),touch:XC(e),write:eP(e)}}const rP=VT((e=>async(e,t,r={})=>{throw qe(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")})),nP=VT((e=>async function(t,r={type:"Ed25519"}){const n=await e.post("key/gen",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers});return pC(await n.json())})),sP=VT((e=>async function(t,r,n,s={}){const i=await e.post("key/import",{signal:s.signal,searchParams:KT({arg:t,pem:r,password:n,...s}),headers:s.headers});return pC(await i.json())})),iP=VT((e=>async(e,t={})=>{throw qe(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")})),oP=VT((e=>async function(t={}){const r=await e.post("key/list",{signal:t.signal,searchParams:KT(t),headers:t.headers});return((await r.json()).Keys||[]).map((e=>pC(e)))})),aP=VT((e=>async function(t,r,n={}){const s=await e.post("key/rename",{signal:n.signal,searchParams:KT({arg:[t,r],...n}),headers:n.headers});return pC(await s.json())})),cP=VT((e=>async function(t,r={}){const n=await e.post("key/rm",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers});return pC((await n.json()).Keys[0])}));function lP(e){return{export:rP(e),gen:nP(e),import:sP(e),info:iP(e),list:oP(e),rename:aP(e),rm:cP(e)}}const hP=VT((e=>async function(t,r,n={}){const s=await e.post("log/level",{signal:n.signal,searchParams:KT({arg:[t,r],...n}),headers:n.headers});return pC(await s.json())})),uP=VT((e=>async function(t={}){const r=await e.post("log/ls",{signal:t.signal,searchParams:KT(t),headers:t.headers});return(await r.json()).Strings})),dP=VT((e=>async function*(t={}){const r=await e.post("log/tail",{signal:t.signal,searchParams:KT(t),headers:t.headers});yield*r.ndjson()}));function pP(e){return{level:hP(e),ls:uP(e),tail:dP(e)}}const fP=VT((e=>async function(t,r={}){const n=await e.post("name/publish",{signal:r.signal,searchParams:KT({arg:`${t}`,...r}),headers:r.headers});return pC(await n.json())})),yP=VT((e=>async function*(t,r={}){const n=await e.post("name/resolve",{signal:r.signal,searchParams:KT({arg:t,stream:!0,...r}),headers:r.headers});for await(const e of n.ndjson())yield e.Path})),gP=VT((e=>async function(t,r={}){const n=await e.post("name/pubsub/cancel",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers});return pC(await n.json())})),mP=VT((e=>async function(t={}){const r=await e.post("name/pubsub/state",{signal:t.signal,searchParams:KT(t),headers:t.headers});return pC(await r.json())})),wP=VT((e=>async function(t={}){const r=await e.post("name/pubsub/subs",{signal:t.signal,searchParams:KT(t),headers:t.headers});return(await r.json()).Strings||[]}));function bP(e){return{cancel:gP(e),state:mP(e),subs:wP(e)}}function vP(e){return{publish:fP(e),resolve:yP(e),pubsub:bP(e)}}const EP=VT((e=>async function(t,r={}){const n=await e.post("object/data",{signal:r.signal,searchParams:KT({arg:`${t instanceof Uint8Array?kt.decode(t):t}`,...r}),headers:r.headers}),s=await n.arrayBuffer();return new Uint8Array(s,0,s.byteLength)})),_P=VT((e=>async function(t,r={}){const n=await e.post("object/get",{signal:r.signal,searchParams:KT({arg:`${t instanceof Uint8Array?kt.decode(t):t}`,dataEncoding:"base64",...r}),headers:r.headers}),s=await n.json();return{Data:Xs(s.Data,"base64pad"),Links:(s.Links||[]).map((e=>({Name:e.Name,Hash:kt.parse(e.Hash),Tsize:e.Size})))}})),SP=VT((e=>async function(t,r={}){const n=await e.post("object/links",{signal:r.signal,searchParams:KT({arg:`${t instanceof Uint8Array?kt.decode(t):t}`,...r}),headers:r.headers});return((await n.json()).Links||[]).map((e=>({Name:e.Name,Tsize:e.Size,Hash:kt.parse(e.Hash)})))})),AP=VT((e=>async function(t={}){const r=await e.post("object/new",{signal:t.signal,searchParams:KT({arg:t.template,...t}),headers:t.headers}),{Hash:n}=await r.json();return kt.parse(n)})),IP=(e,t)=>{const r=VT((r=>{const n=RC(e,t);return async function(e,t={}){return n(e,{...t,storeCodec:"dag-pb",hashAlg:"sha2-256",version:1})}}));return r(t)},RP=VT((e=>async function(t,r={}){const n=await e.post("object/stat",{signal:r.signal,searchParams:KT({arg:`${t}`,...r}),headers:r.headers}),s=await n.json();return{...s,Hash:kt.parse(s.Hash)}})),kP=VT((e=>async function(t,r,n={}){const s=await e.post("object/patch/add-link",{signal:n.signal,searchParams:KT({arg:[`${t}`,r.Name||r.name||"",(r.Hash||r.cid||"").toString()||null],...n}),headers:n.headers}),{Hash:i}=await s.json();return kt.parse(i)})),TP=VT((e=>async function(t,r,n={}){const s=eC((new AbortController).signal,n.signal),i=await e.post("object/patch/append-data",{signal:s,searchParams:KT({arg:`${t}`,...n}),...await XT([r],0,n.headers)}),{Hash:o}=await i.json();return kt.parse(o)})),CP=VT((e=>async function(t,r,n={}){const s=await e.post("object/patch/rm-link",{signal:n.signal,searchParams:KT({arg:[`${t}`,r.Name||r.name||null],...n}),headers:n.headers}),{Hash:i}=await s.json();return kt.parse(i)})),PP=VT((e=>async function(t,r,n={}){const s=eC((new AbortController).signal,n.signal),i=await e.post("object/patch/set-data",{signal:s,searchParams:KT({arg:[`${t}`],...n}),...await XT([r],0,n.headers)}),{Hash:o}=await i.json();return kt.parse(o)}));function NP(e){return{addLink:kP(e),appendData:TP(e),rmLink:CP(e),setData:PP(e)}}function DP(e,t){return{data:EP(t),get:_P(t),links:SP(t),new:AP(t),put:IP(e,t),stat:RP(t),patch:NP(t)}}const OP=VT((e=>async function*(t,r={}){for await(const{path:n,recursive:s,metadata:i}of ec(t)){const t=await e.post("pin/add",{signal:r.signal,searchParams:KT({...r,arg:n,recursive:s,metadata:i?JSON.stringify(i):void 0,stream:!0}),headers:r.headers});for await(const e of t.ndjson())if(e.Pins)for(const t of e.Pins)yield kt.parse(t);else yield kt.parse(e)}}));function xP(e){const t=OP(e);return VT((()=>async function(e,r={}){return Xa(t([{path:e,...r}],r))}))(e)}function LP(e,t,r){const n={type:e,cid:kt.parse(t)};return r&&(n.metadata=r),n}const BP=VT((e=>async function*(t={}){let r=[];t.paths&&(r=Array.isArray(t.paths)?t.paths:[t.paths]);const n=await e.post("pin/ls",{signal:t.signal,searchParams:KT({...t,arg:r.map((e=>`${e}`)),stream:!0}),headers:t.headers});for await(const e of n.ndjson()){if(e.Keys){for(const t of Object.keys(e.Keys))yield LP(e.Keys[t].Type,t,e.Keys[t].Metadata);return}yield LP(e.Type,e.Cid,e.Metadata)}})),MP=VT((e=>async function*(t,r={}){for await(const{path:n,recursive:s}of ec(t)){const t=new URLSearchParams(r.searchParams);t.append("arg",`${n}`),null!=s&&t.set("recursive",String(s));const i=await e.post("pin/rm",{signal:r.signal,headers:r.headers,searchParams:KT({...r,arg:`${n}`,recursive:s})});for await(const e of i.ndjson())e.Pins?yield*e.Pins.map((e=>kt.parse(e))):yield kt.parse(e)}})),UP=e=>{const t=MP(e);return VT((()=>async function(e,r={}){return Xa(t([{path:e,...r}],r))}))(e)},zP=({Name:e,Status:t,Cid:r})=>({cid:kt.parse(r),name:e,status:t}),VP=e=>{if("string"==typeof e&&""!==e)return e;throw new TypeError("service name must be passed")},FP=e=>{if(kt.asCID(e))return e.toString();throw new TypeError("CID instance expected instead of "+typeof e)},jP=({service:e,cid:t,name:r,status:n,all:s})=>{const i=KT({service:VP(e),name:r,force:!!s||void 0});if(t)for(const e of t)i.append("cid",FP(e));if(n)for(const e of n)i.append("status",e);return i},KP=({cid:e,service:t,background:r,name:n,origins:s})=>{const i=KT({arg:FP(e),service:VP(t),name:n,background:!!r||void 0});if(s)for(const e of s)i.append("origin",e.toString());return i};function $P(e){return async function(t,{timeout:r,signal:n,headers:s,...i}){const o=await e.post("pin/remote/add",{timeout:r,signal:n,headers:s,searchParams:KP({cid:t,...i})});return zP(await o.json())}}function HP(e){return async function*({timeout:t,signal:r,headers:n,...s}){const i=await e.post("pin/remote/ls",{timeout:t,signal:r,headers:n,searchParams:jP(s)});for await(const e of i.ndjson())yield zP(e)}}function qP(e){return async function({timeout:t,signal:r,headers:n,...s}){await e.post("pin/remote/rm",{timeout:t,signal:r,headers:n,searchParams:jP({...s,all:!1})})}}function GP(e){return async function({timeout:t,signal:r,headers:n,...s}){await e.post("pin/remote/rm",{timeout:t,signal:r,headers:n,searchParams:jP({...s,all:!0})})}}function WP(e){const t=String(e);if("undefined"===t)throw Error("endpoint is required");return"/"===t[t.length-1]?t.slice(0,-1):t}function YP(e){return{service:e.Service,endpoint:new URL(e.ApiEndpoint),...e.Stat&&{stat:ZP(e.Stat)}}}function ZP(e){switch(e.Status){case"valid":{const{Pinning:t,Pinned:r,Queued:n,Failed:s}=e.PinCount;return{status:"valid",pinCount:{queued:n,pinning:t,pinned:r,failed:s}}}case"invalid":return{status:"invalid"};default:return{status:e.Status}}}function QP(e){return async function(t,r){const{endpoint:n,key:s,headers:i,timeout:o,signal:a}=r;await e.post("pin/remote/service/add",{timeout:o,signal:a,searchParams:KT({arg:[t,WP(n),s]}),headers:i})}}function JP(e){return async function(t={}){const{stat:r,headers:n,timeout:s,signal:i}=t,o=await e.post("pin/remote/service/ls",{timeout:s,signal:i,headers:n,searchParams:!0===r?KT({stat:r}):void 0}),{RemoteServices:a}=await o.json();return a.map(YP)}}function XP(e){return async function(t,r={}){await e.post("pin/remote/service/rm",{signal:r.signal,headers:r.headers,searchParams:KT({arg:t})})}}function eN(e){const t=new zT(e);return{add:QP(t),ls:JP(t),rm:XP(t)}}function tN(e){const t=new zT(e);return{add:$P(t),ls:HP(t),rm:qP(t),rmAll:GP(t),service:eN(e)}}function rN(e){return{addAll:OP(e),add:xP(e),ls:BP(e),rmAll:MP(e),rm:UP(e),remote:tN(e)}}const nN=e=>ni(sN(e)),sN=e=>Ke.decode(e),iN=e=>Ke.encode(Xs(e)),oN=VT((e=>async function(t={}){const{Strings:r}=await(await e.post("pubsub/ls",{signal:t.signal,searchParams:KT(t),headers:t.headers})).json();return n=r,(Array.isArray(n)?n.map(nN):n)||[];var n})),aN=VT((e=>async function(t,r={}){const n=await e.post("pubsub/peers",{signal:r.signal,searchParams:KT({arg:iN(t),...r}),headers:r.headers}),{Strings:s}=await n.json();return s||[]})),cN=VT((e=>async function(t,r,n={}){const s=KT({arg:iN(t),...n}),i=eC((new AbortController).signal,n.signal),o=await e.post("pubsub/pub",{signal:i,searchParams:s,...await XT([r],0,n.headers)});await o.text()})),lN=He("ipfs-http-client:pubsub:subscribe"),hN=(e,t)=>VT((e=>async function(r,n,s={}){let i,o;s.signal=t.subscribe(r,n,s.signal);const a=new Promise(((e,t)=>{i=e,o=t})),c=setTimeout((()=>i()),1e3);return e.post("pubsub/sub",{signal:s.signal,searchParams:KT({arg:iN(r),...s}),headers:s.headers}).catch((e=>{t.unsubscribe(r,n),o(e)})).then((e=>{clearTimeout(c),e&&(async function(e,{onMessage:t,onEnd:r,onError:n}){n=n||lN;try{for await(const r of e.ndjson())try{if(!r.from)continue;null!=r.from&&null!=r.seqno?t({type:"signed",from:Za(r.from),data:sN(r.data),sequenceNumber:(s=r.seqno,BigInt(`0x${ni(Ke.decode(s),"base16")}`)),topic:nN(r.topicIDs[0]),key:sN(r.key??"u"),signature:sN(r.signature??"u")}):t({type:"unsigned",data:sN(r.data),topic:nN(r.topicIDs[0])})}catch(e){e.message=`Failed to parse pubsub message: ${e.message}`,n(e,!1,r)}}catch(e){uN(e)||n(e,!0)}finally{r()}var s}(e,{onMessage:e=>{n&&("function"!=typeof n?"function"==typeof n.handleEvent&&n.handleEvent(e):n(e))},onEnd:()=>t.unsubscribe(r,n),onError:s.onError}),i())})),a}))(e),uN=e=>{switch(e.type){case"aborted":case"abort":return!0;default:return"AbortError"===e.name}};class dN{constructor(){this._subs=new Map}subscribe(e,t,r){const n=this._subs.get(e)||[];if(n.find((e=>e.handler===t)))throw new Error(`Already subscribed to ${e} with this handler`);const s=new AbortController;return this._subs.set(e,[{handler:t,controller:s}].concat(n)),r&&r.addEventListener("abort",(()=>this.unsubscribe(e,t))),s.signal}unsubscribe(e,t){const r=this._subs.get(e)||[];let n;t?(this._subs.set(e,r.filter((e=>e.handler!==t))),n=r.filter((e=>e.handler===t))):(this._subs.set(e,[]),n=r),(this._subs.get(e)||[]).length||this._subs.delete(e),n.forEach((e=>e.controller.abort()))}}function pN(e){const t=new dN;return{ls:oN(e),peers:aN(e),publish:cN(e),subscribe:hN(e,t),unsubscribe:(r=t,async function(e,t){r.unsubscribe(e,t)})};var r}const fN=VT((e=>async function*(t={}){const r=await e.post("refs/local",{signal:t.signal,transform:pC,searchParams:KT(t),headers:t.headers});yield*r.ndjson()})),yN=VT(((e,t)=>Object.assign((async function*(t,r={}){const n=Array.isArray(t)?t:[t],s=await e.post("refs",{signal:r.signal,searchParams:KT({arg:n.map((e=>`${e instanceof Uint8Array?kt.decode(e):e}`)),...r}),headers:r.headers,transform:pC});yield*s.ndjson()}),{local:fN(t)}))),gN=VT((e=>async function*(t={}){const r=await e.post("repo/gc",{signal:t.signal,searchParams:KT(t),headers:t.headers,transform:e=>({err:e.Error?new Error(e.Error):null,cid:(e.Key||{})["/"]?kt.parse(e.Key["/"]):null})});yield*r.ndjson()})),mN=VT((e=>async function(t={}){const r=await e.post("repo/stat",{signal:t.signal,searchParams:KT(t),headers:t.headers}),n=await r.json();return{numObjects:BigInt(n.NumObjects),repoSize:BigInt(n.RepoSize),repoPath:n.RepoPath,version:n.Version,storageMax:BigInt(n.StorageMax)}})),wN=VT((e=>async function(t={}){return(await(await e.post("repo/version",{signal:t.signal,searchParams:KT(t),headers:t.headers})).json()).Version}));function bN(e){return{gc:gN(e),stat:mN(e),version:wN(e)}}const vN=VT((e=>async function*(t={}){const r=await e.post("stats/bw",{signal:t.signal,searchParams:KT(t),headers:t.headers,transform:e=>({totalIn:BigInt(e.TotalIn),totalOut:BigInt(e.TotalOut),rateIn:parseFloat(e.RateIn),rateOut:parseFloat(e.RateOut)})});yield*r.ndjson()}));function EN(e){return{bitswap:qT(e),repo:mN(e),bw:vN(e)}}const _N=VT((e=>async function(t={}){const r=await e.post("swarm/addrs",{signal:t.signal,searchParams:KT(t),headers:t.headers}),{Addrs:n}=await r.json();return Object.keys(n).map((e=>({id:Za(e),addrs:(n[e]||[]).map((e=>Ki(e)))})))})),SN=VT((e=>async function(t,r={}){const n=await e.post("swarm/connect",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers}),{Strings:s}=await n.json();return s||[]})),AN=VT((e=>async function(t,r={}){const n=await e.post("swarm/disconnect",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers}),{Strings:s}=await n.json();return s||[]})),IN=VT((e=>async function(t={}){const r=await e.post("swarm/addrs/local",{signal:t.signal,searchParams:KT(t),headers:t.headers}),{Strings:n}=await r.json();return(n||[]).map((e=>Ki(e)))})),RN=VT((e=>async function(t={}){const r=await e.post("swarm/peers",{signal:t.signal,searchParams:KT(t),headers:t.headers}),{Peers:n}=await r.json();return(n||[]).map((e=>({addr:Ki(e.Addr),peer:Za(e.Peer),muxer:e.Muxer,latency:e.Latency,streams:e.Streams,direction:null==e.Direction?void 0:0===e.Direction?"inbound":"outbound"})))}));function kN(e){return{addrs:_N(e),connect:SN(e),disconnect:AN(e),localAddrs:IN(e),peers:RN(e)}}const TN=VT((e=>async function*(t,r={}){const n=eC((new AbortController).signal,r.signal),{headers:s,body:i,total:o,parts:a}=await XT(t,0,r.headers),[c,l]="function"==typeof r.progress?CN(o,a,r.progress):[void 0,void 0],h=await e.post("add",{searchParams:KT({"stream-channels":!0,...r,progress:Boolean(c)}),onUploadProgress:l,signal:n,headers:s,body:i});for await(let e of h.ndjson())e=pC(e),void 0!==e.hash?yield NN(e):c&&c(e.bytes||0,e.name)})),CN=(e,t,r)=>t?[void 0,PN(e,t,r)]:[r,void 0],PN=(e,t,r)=>{let n=0;const s=t.length;return({loaded:i,total:o})=>{const a=Math.floor(i/o*e);for(;n<s;){const{start:e,end:s,name:i}=t[n];if(a<s){r(a-e,i);break}r(s-e,i),n+=1}}};function NN({name:e,hash:t,size:r,mode:n,mtime:s,mtimeNsecs:i}){const o={path:e,cid:kt.parse(t),size:parseInt(r)};return null!=n&&(o.mode=parseInt(n,8)),null!=s&&(o.mtime={secs:s,nsecs:i||0}),o}function DN(e){const t=TN(e);return VT((()=>async function(e,r={}){return await Xa(t(ep(e),r))}))(e)}const ON=VT((e=>async function*(t,r={}){const n=await e.post("cat",{signal:r.signal,searchParams:KT({arg:t.toString(),...r}),headers:r.headers});yield*n.iterator()})),xN=VT((e=>async(t={})=>(await e.post("commands",{signal:t.signal,searchParams:KT(t),headers:t.headers})).json())),LN=VT((e=>async(t,r={})=>{const n=await e.post("dns",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers});return(await n.json()).Path})),BN=VT((e=>()=>{const t=new URL(e.opts.base||"");return{host:t.hostname,port:t.port,protocol:t.protocol,pathname:t.pathname,"api-path":t.pathname}})),MN=VT((e=>async function*(t,r={}){const n={arg:`${t instanceof Uint8Array?kt.decode(t):t}`,...r};n.compressionLevel&&(n["compression-level"]=n.compressionLevel,delete n.compressionLevel);const s=await e.post("get",{signal:r.signal,searchParams:KT(n),headers:r.headers});yield*s.iterator()})),UN=VT((e=>async function(t={}){const r=await e.post("id",{signal:t.signal,searchParams:KT({arg:t.peerId?t.peerId.toString():void 0,...t}),headers:t.headers}),n={...pC(await r.json())};return n.id=Za(n.id),n.addresses&&(n.addresses=n.addresses.map((e=>Ki(e)))),n})),zN=e=>{const t=UN(e);return async function(e={}){const r=await t(e);return Boolean(r&&r.addresses&&r.addresses.length)}},VN=VT(((e,t)=>async function*(r,n={}){const s=`${r instanceof Uint8Array?kt.decode(r):r}`;async function i(e){let r=e.Hash;if(r.includes("/")){const e=r.startsWith("/ipfs/")?r:`/ipfs/${r}`;r=(await JC(t)(e)).cid}else r=kt.parse(r);const n={name:e.Name,path:s+(e.Name?`/${e.Name}`:""),size:e.Size,cid:r,type:FN(e)};return e.Mode&&(n.mode=parseInt(e.Mode,8)),void 0!==e.Mtime&&null!==e.Mtime&&(n.mtime={secs:e.Mtime},void 0!==e.MtimeNsecs&&null!==e.MtimeNsecs&&(n.mtime.nsecs=e.MtimeNsecs)),n}const o=await e.post("ls",{signal:n.signal,searchParams:KT({arg:s,...n}),headers:n.headers});for await(let e of o.ndjson()){if(e=e.Objects,!e)throw new Error("expected .Objects in results");if(e=e[0],!e)throw new Error("expected one array in results.Objects");const t=e.Links;if(!Array.isArray(t))throw new Error("expected one array in results.Objects[0].Links");if(!t.length)return void(yield i(e));yield*t.map(i)}}));function FN(e){switch(e.Type){case 1:case 5:return"dir";default:return"file"}}const jN=VT((e=>async function(t={}){const r=await e.post("dns",{signal:t.signal,searchParams:KT(t),headers:t.headers});return pC(await r.json())})),KN=VT((e=>async function*(t,r={}){const n=await e.post("ping",{signal:r.signal,searchParams:KT({arg:`${t}`,...r}),headers:r.headers,transform:pC});yield*n.ndjson()})),$N=VT((e=>async function(t,r={}){const n=await e.post("resolve",{signal:r.signal,searchParams:KT({arg:t,...r}),headers:r.headers}),{Path:s}=await n.json();return s})),HN=VT((e=>async(e={})=>{throw qe(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")})),qN=VT((e=>async function(t={}){const r=await e.post("shutdown",{signal:t.signal,searchParams:KT(t),headers:t.headers});await r.text()})),GN=VT((e=>async function(t={}){const r=await e.post("version",{signal:t.signal,searchParams:KT(t),headers:t.headers});return{...pC(await r.json()),"ipfs-http-client":"1.0.0"}}));r(41415),r(36074);const WN=Object.create(null);WN.open="0",WN.close="1",WN.ping="2",WN.pong="3",WN.message="4",WN.upgrade="5",WN.noop="6";const YN=Object.create(null);Object.keys(WN).forEach((e=>{YN[WN[e]]=e}));const ZN={type:"error",data:"parser error"},QN="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),JN="function"==typeof ArrayBuffer,XN=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+e)},r.readAsDataURL(e)},eD=({type:e,data:t},r,n)=>{return QN&&t instanceof Blob?r?n(t):XN(t,n):JN&&(t instanceof ArrayBuffer||(s=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer))?r?n(t):XN(new Blob([t]),n):n(WN[e]+(t||""));var s},tD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",rD="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<tD.length;e++)rD[tD.charCodeAt(e)]=e;const nD="function"==typeof ArrayBuffer,sD=(e,t)=>{if(nD){const r=(e=>{let t,r,n,s,i,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const l=new ArrayBuffer(o),h=new Uint8Array(l);for(t=0;t<a;t+=4)r=rD[e.charCodeAt(t)],n=rD[e.charCodeAt(t+1)],s=rD[e.charCodeAt(t+2)],i=rD[e.charCodeAt(t+3)],h[c++]=r<<2|n>>4,h[c++]=(15&n)<<4|s>>2,h[c++]=(3&s)<<6|63&i;return l})(e);return iD(r,t)}return{base64:!0,data:e}},iD=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e,oD=(e,t)=>{if("string"!=typeof e)return{type:"message",data:iD(e,t)};const r=e.charAt(0);return"b"===r?{type:"message",data:sD(e.substring(1),t)}:YN[r]?e.length>1?{type:YN[r],data:e.substring(1)}:{type:YN[r]}:ZN},aD=String.fromCharCode(30);function cD(e){if(e)return function(e){for(var t in cD.prototype)e[t]=cD.prototype[t];return e}(e)}cD.prototype.on=cD.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},cD.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},cD.prototype.off=cD.prototype.removeListener=cD.prototype.removeAllListeners=cD.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;s<n.length;s++)if((r=n[s])===t||r.fn===t){n.splice(s,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},cD.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var s=(r=r.slice(0)).length;n<s;++n)r[n].apply(this,t)}return this},cD.prototype.emitReserved=cD.prototype.emit,cD.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},cD.prototype.hasListeners=function(e){return!!this.listeners(e).length};const lD="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function hD(e,...t){return t.reduce(((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t)),{})}const uD=setTimeout,dD=clearTimeout;function pD(e,t){t.useNativeTimers?(e.setTimeoutFn=uD.bind(lD),e.clearTimeoutFn=dD.bind(lD)):(e.setTimeoutFn=setTimeout.bind(lD),e.clearTimeoutFn=clearTimeout.bind(lD))}class fD extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class yD extends cD{constructor(e){super(),this.writable=!1,pD(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new fD(e,t,r)),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=oD(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const gD="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),mD={};let wD,bD=0,vD=0;function ED(e){let t="";do{t=gD[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function _D(){const e=ED(+new Date);return e!==wD?(bD=0,wD=e):e+"."+ED(bD++)}for(;vD<64;vD++)mD[gD[vD]]=vD;function SD(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}let AD=!1;try{AD="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Wy){}const ID=AD;function RD(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||ID))return new XMLHttpRequest}catch(e){}if(!t)try{return new(lD[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function kD(){}const TD=null!=new RD({xdomain:!1}).responseType;class CD extends cD{constructor(e,t){super(),pD(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=hD(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new RD(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=CD.requestsCount++,CD.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=kD,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete CD.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function PD(){for(let e in CD.requests)CD.requests.hasOwnProperty(e)&&CD.requests[e].abort()}CD.requestsCount=0,CD.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",PD):"function"==typeof addEventListener&&addEventListener("onpagehide"in lD?"pagehide":"unload",PD,!1));const ND="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),DD=lD.WebSocket||lD.MozWebSocket;r(83107).Buffer;const OD="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),xD={websocket:class extends yD{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=OD?{}:hD(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=OD?new DD(e,t,r):t?new DD(e,t):new DD(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;eD(r,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}n&&ND((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=_D()),this.supportsBinary||(e.b64=1);const n=SD(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!!DD}},polling:class extends yD{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=TD&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(aD),n=[];for(let e=0;e<r.length;e++){const s=oD(r[e],t);if(n.push(s),"error"===s.type)break}return n})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,n=new Array(r);let s=0;e.forEach(((e,i)=>{eD(e,!1,(e=>{n[i]=e,++s===r&&t(n.join(aD))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=_D()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port);const n=SD(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new CD(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},LD=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,BD=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function MD(e){const t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let s=LD.exec(e||""),i={},o=14;for(;o--;)i[BD[o]]=s[o]||"";return-1!=r&&-1!=n&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(e,t){const r=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1),"/"==t.slice(-1)&&r.splice(r.length-1,1),r}(0,i.path),i.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(r[t]=n)})),r}(0,i.query),i}class UD extends cD{constructor(e,t={}){super(),e&&"object"==typeof e&&(t=e,e=null),e?(e=MD(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=MD(t.host).host),pD(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let e=0,n=r.length;e<n;e++){let n=r[e].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new xD[e](r)}open(){let e;if(this.opts.rememberUpgrade&&UD.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),r=!1;UD.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;UD.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{r||"closed"!==this.readyState&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function s(){r||(r=!0,l(),t.close(),t=null)}const i=e=>{const r=new Error("probe error: "+e);r.transport=t.name,s(),this.emitReserved("upgradeError",r)};function o(){i("transport closed")}function a(){i("socket closed")}function c(e){t&&e.name!==t.name&&s()}const l=()=>{t.removeListener("open",n),t.removeListener("error",i),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",n),t.once("error",i),t.once("close",o),this.once("close",a),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",UD.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(e+="string"==typeof(t=n)?function(e){let t=0,r=0;for(let n=0,s=e.length;n<s;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(t):Math.ceil(1.33*(t.byteLength||t.size))),r>0&&e>this.maxPayload)return this.writeBuffer.slice(0,r);e+=2}var t;return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?r():e()})):this.upgrading?r():e()),this}onError(e){UD.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}UD.protocol=4,UD.protocol;const zD="function"==typeof ArrayBuffer,VD=Object.prototype.toString,FD="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===VD.call(Blob),jD="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===VD.call(File);function KD(e){return zD&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||FD&&e instanceof Blob||jD&&e instanceof File}function $D(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if($D(e[t]))return!0;return!1}if(KD(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return $D(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&$D(e[t]))return!0;return!1}function HD(e){const t=[],r=e.data,n=e;return n.data=qD(r,t),n.attachments=t.length,{packet:n,buffers:t}}function qD(e,t){if(!e)return e;if(KD(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=qD(e[n],t);return r}if("object"==typeof e&&!(e instanceof Date)){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=qD(e[n],t));return r}return e}function GD(e,t){return e.data=WD(e.data,t),e.attachments=void 0,e}function WD(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=WD(e[r],t);else if("object"==typeof e)for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=WD(e[r],t));return e}const YD=5;var ZD;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(ZD||(ZD={}));class QD{constructor(e){this.replacer=e}encode(e){return e.type!==ZD.EVENT&&e.type!==ZD.ACK||!$D(e)?[this.encodeAsString(e)]:(e.type=e.type===ZD.EVENT?ZD.BINARY_EVENT:ZD.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return e.type!==ZD.BINARY_EVENT&&e.type!==ZD.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=HD(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}class JD extends cD{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e),t.type===ZD.BINARY_EVENT||t.type===ZD.BINARY_ACK?(this.reconstructor=new XD(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!KD(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(void 0===ZD[r.type])throw new Error("unknown packet type "+r.type);if(r.type===ZD.BINARY_EVENT||r.type===ZD.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const s=e.substring(n,t);if(s!=Number(s)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(s)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);r.nsp=e.substring(n,t)}else r.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!JD.isPayloadValid(r.type,n))throw new Error("invalid payload");r.data=n}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case ZD.CONNECT:return"object"==typeof t;case ZD.DISCONNECT:return void 0===t;case ZD.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case ZD.EVENT:case ZD.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case ZD.ACK:case ZD.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class XD{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=GD(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function eO(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const tO=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class rO extends cD{constructor(e,t,r){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[eO(e,"open",this.onopen.bind(this)),eO(e,"packet",this.onpacket.bind(this)),eO(e,"error",this.onerror.bind(this)),eO(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(tO.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');t.unshift(e);const r={type:ZD.EVENT,data:t,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,n=t.pop();this._registerAckCallback(e,n),r.id=e}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){const r=this.flags.timeout;if(void 0===r)return void(this.acks[e]=t);const n=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),r);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(n),t.apply(this,[null,...e])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this.packet({type:ZD.CONNECT,data:e})})):this.packet({type:ZD.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ZD.CONNECT:if(e.data&&e.data.sid){const t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ZD.EVENT:case ZD.BINARY_EVENT:this.onevent(e);break;case ZD.ACK:case ZD.BINARY_ACK:this.onack(e);break;case ZD.DISCONNECT:this.ondisconnect();break;case ZD.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,t.packet({type:ZD.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ZD.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function nO(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}nO.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},nO.prototype.reset=function(){this.attempts=0},nO.prototype.setMin=function(e){this.ms=e},nO.prototype.setMax=function(e){this.max=e},nO.prototype.setJitter=function(e){this.jitter=e};class sO extends cD{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,pD(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new nO({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||X;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new UD(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=eO(t,"open",(function(){r.onopen(),e&&e()})),s=eO(t,"error",(t=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",t),e?e(t):r.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;0===e&&n();const r=this.setTimeoutFn((()=>{n(),t.close(),t.emit("error",new Error("timeout"))}),e);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}return this.subs.push(n),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(eO(e,"ping",this.onping.bind(this)),eO(e,"data",this.ondata.bind(this)),eO(e,"error",this.onerror.bind(this)),eO(e,"close",this.onclose.bind(this)),eO(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){ND((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r||(r=new rO(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const iO={};function oO(e,t){"object"==typeof e&&(t=e,e=void 0);const r=function(e,t="",r){let n=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==r?r.protocol+"//"+e:"https://"+e),n=MD(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+t,n.href=n.protocol+"://"+s+(r&&r.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),n=r.source,s=r.id,i=r.path,o=iO[s]&&i in iO[s].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new sO(n,t):(iO[s]||(iO[s]=new sO(n,t)),a=iO[s]),r.query&&!t.query&&(t.query=r.queryKey),a.socket(r.path,t)}Object.assign(oO,{Manager:sO,Socket:rO,io:oO,connect:oO});var aO=r(86085);class cO{constructor(e,t){this.label=e.label,this.open=Bd(),this.channel=e,this.channel.binaryType="arraybuffer",this.log=t.log,"number"==typeof this.channel.bufferedAmountLowThreshold&&(this.channel.bufferedAmountLowThreshold=65536),e.addEventListener("message",(e=>{t.onMessage(e)})),e.addEventListener("bufferedamountlow",(()=>{this.log("stop backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open.resolve()})),e.addEventListener("open",(()=>{this.open.resolve(),t.onOpen()})),e.addEventListener("close",(()=>{t.onClose()})),e.addEventListener("error",(r=>{if("Transport channel closed"===r.error?.message)return this.close();t.log.error('channel encounter an error in state "%s" message: "%s" detail: "%s',e.readyState,r.error?.message,r.error?.errorDetail);const n=r.error instanceof Error?r.error:new Error(`datachannel error: ${r.error?.message} ${r.error?.errorDetail}`);t.onError(qe(n,"ERR_DATA_CHANNEL"))}));let r=!1;this.closingInterval=setInterval((()=>{"closing"===e.readyState?(r&&t.onClose(),r=!0):r=!1}),5e3)}async send(e){await this.open.promise,this.channel.send(e),this.channel.bufferedAmount>65536&&(this.log("start backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open=Bd())}close(){clearInterval(this.closingInterval),this.channel.close()}get bufferedAmount(){return this.channel.bufferedAmount}}var lO=r(41063);const hO={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}]};class uO extends iA{constructor(e){super(),this.id=e.id??ni(aO(4),"hex").slice(0,7),this.log=He(`libp2p:webrtc-peer:${e.logPrefix}:${this.id}`),this.wrtc=e.wrtc??function(){if("undefined"==typeof globalThis)throw qe(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");const e={RTCPeerConnection:globalThis.RTCPeerConnection??globalThis.mozRTCPeerConnection??globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription??globalThis.mozRTCSessionDescription??globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate??globalThis.mozRTCIceCandidate??globalThis.webkitRTCIceCandidate};if(null==e.RTCPeerConnection)throw qe(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");return e}(),this.peerConnection=new this.wrtc.RTCPeerConnection(Object.assign({},hO,e.peerConnectionConfig)),this.closed=!1,this.connected=Bd(),this.source=ju(),this.sink=async e=>{if(await this.connected.promise,null==this.channel)throw qe(new Error("Connected but no channel?!"),"ERR_DATA_CHANNEL");for await(const t of e)await this.channel.send(t);await this.close()}}handleDataChannelEvent(e){const t=e.channel;null!=t?this.channel=new cO(t,{log:this.log,onMessage:e=>{this.source.push(new Uint8Array(e.data))},onOpen:()=>{this.connected.resolve(),this.dispatchEvent(new aA("ready"))},onClose:()=>{this.close().catch((e=>{this.log("error closing connection after channel close",e)}))},onError:e=>{this.close(e).catch((e=>{this.log("error closing connection after channel error",e)}))}}):this.close(qe(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL")).catch((e=>{this.log("Error closing after event channel was found to be null",e)}))}async close(e){if(this.closed=!0,null==e&&null!=this.channel)for(;this.channel.bufferedAmount>0;)await lO(100);this.channel?.close(),this.peerConnection.close(),this.source.end(e),this.dispatchEvent(new aA("close"))}}class dO extends iA{constructor(e){super(),this.log=e.log,this.peerConnection=e.peerConnection,this.wrtc=e.wrtc,this.status="idle",this.peerConnection.addEventListener("negotiationneeded",(()=>{this.log("peer connection negotiation needed"),this.handleRenegotiate({type:"renegotiate"}).catch((e=>{this.log.error("could not renegotiate %o",e)}))}))}async handleSignal(e){return this.log('incoming signal "%s"',e.type),"offer"===e.type?await this.handleOffer(e):"answer"===e.type?await this.handleAnswer(e):"candidate"===e.type?await this.handleCandidate(e):"renegotiate"===e.type?await this.handleRenegotiate(e):"goodbye"===e.type?await this.handleGoodye(e):void this.log(`Unknown signal type ${e.type}`)}async handleOffer(e){}async handleAnswer(e){}async handleRenegotiate(e){}async handleGoodye(e){this.peerConnection.close()}async handleCandidate(e){const t=new this.wrtc.RTCIceCandidate(e.candidate);try{await this.peerConnection.addIceCandidate(t)}catch(e){if(null!=t.address&&!t.address.endsWith(".local"))throw qe(e,"ERR_ADD_ICE_CANDIDATE");this.log("ignoring unsupported ICE candidate.")}}}const pO=He("libp2p:webrtc-peer:receiver");class fO extends uO{constructor(e={}){super({...e,logPrefix:"receiver"}),this.handshake=new yO({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,answerOptions:e.answerOptions}),this.handshake.addEventListener("signal",(e=>this.dispatchEvent(new aA("signal",{detail:e.detail})))),this.peerConnection.addEventListener("datachannel",(e=>{this.handleDataChannelEvent(e)}))}handleSignal(e){this.handshake.handleSignal(e).catch((t=>{this.log("error handling signal %o %o",e,t)}))}}class yO extends dO{constructor(e){super(e),this.options=e,this.status="idle",this.iceCandidates=[]}async handleRenegotiate(){pO.trace("renegotiate"),this.dispatchEvent(new aA("signal",{detail:{type:"renegotiate"}}))}async handleOffer(e){await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e));for(const e of this.iceCandidates)await this.handleCandidate(e);this.iceCandidates=[];const t=await this.peerConnection.createAnswer(this.options.answerOptions);await this.peerConnection.setLocalDescription(t),pO.trace("handle offer",this.peerConnection.localDescription),this.dispatchEvent(new aA("signal",{detail:this.peerConnection.localDescription??t}))}async handleCandidate(e){null!=this.peerConnection.remoteDescription&&null!=this.peerConnection.remoteDescription.type?await super.handleCandidate(e):this.iceCandidates.push(e)}}function gO(e,t,r){"function"==typeof r&&(r={filter:r});const n=function(e,t,r){let n;const s=new Promise(((s,i)=>{if(!((r={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...r}).count>=0)||r.count!==Number.POSITIVE_INFINITY&&!Number.isInteger(r.count))throw new TypeError("The `count` option should be at least 0 or more");const o=[t].flat(),a=[],{addListener:c,removeListener:l}=(e=>{const t=e.on||e.addListener||e.addEventListener,r=e.off||e.removeListener||e.removeEventListener;if(!t||!r)throw new TypeError("Emitter is not compatible");return{addListener:t.bind(e),removeListener:r.bind(e)}})(e),h=(...e)=>{const t=r.multiArgs?e:e[0];r.filter&&!r.filter(t)||(a.push(t),r.count===a.length&&(n(),s(a)))},u=e=>{n(),i(e)};n=()=>{for(const e of o)l(e,h);for(const e of r.rejectionEvents)l(e,u)};for(const e of o)c(e,h);for(const e of r.rejectionEvents)c(e,u);r.resolveImmediately&&s(a)}));if(s.cancel=n,"number"==typeof r.timeout){const e=na(s,r.timeout);return e.cancel=n,e}return s}(e,t,r={...r,count:1,resolveImmediately:!1}),s=n.then((e=>e[0]));return s.cancel=n.cancel,s}const mO=He("libp2p:webrtc-peer:initator");class wO extends uO{constructor(e={}){super({...e,logPrefix:"initiator"}),this.handleDataChannelEvent({channel:this.peerConnection.createDataChannel(e.dataChannelLabel??ni(aO(20),"hex").slice(0,7),e.dataChannelInit)}),this.handshake=new bO({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,offerOptions:e.offerOptions}),this.handshake.addEventListener("signal",(e=>{this.dispatchEvent(new aA("signal",{detail:e.detail}))}))}handleSignal(e){this.handshake.handleSignal(e).catch((t=>{this.log("error handling signal %o %o",e,t)}))}}class bO extends dO{constructor(e){super(e),this.options=e,this.status="idle",this.peerConnection.addEventListener("icecandidate",(e=>{if(null==e.candidate)return;const t={type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}};mO.trace("create candidate",t),this.dispatchEvent(new aA("signal",{detail:t})),this.dispatchEvent(new aA("ice-candidate"))}))}async handleRenegotiate(){if("negotiating"===this.status)return void this.log("already negotiating, queueing");this.status="negotiating";const e=await this.peerConnection.createOffer(this.options.offerOptions);await this.peerConnection.setLocalDescription(e),await gO(this,"ice-candidate"),await lO(1e3),mO.trace("renegotiate",this.peerConnection.localDescription),this.dispatchEvent(new aA("signal",{detail:this.peerConnection.localDescription??e}))}async handleAnswer(e){mO.trace("handle answer",e),await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e)),this.status="idle"}}const vO=He("libp2p:webrtc-star:socket");function EO(e,t){const{sink:r,source:n}=e,s={remoteAddr:t.remoteAddr,async sink(e){null!=t.signal&&(e=tT(e,t.signal));try{await r(e)}catch(e){"aborted"!==e.type&&vO.error(e)}},source:null!=t.signal?tT(n,t.signal):n,timeline:{open:Date.now()},async close(){if(e.closed)return;const t=Date.now(),r=setTimeout((()=>{if(null!=s.remoteAddr){const{host:e,port:r}=s.remoteAddr.toOptions();vO("timeout closing socket to %s:%s after %dms, destroying it manually",e,r,Date.now()-t)}e.closed||e.close().catch((e=>{vO.error("could not close socket",e)}))}),2e3);try{await e.close()}finally{clearTimeout(r)}}};return e.addEventListener("close",(()=>{null==s.timeline.close&&(s.timeline.close=Date.now())}),{once:!0}),s}function _O(e){const t=e.toString().split("/"),r=e.protos()[1].name,n=e.protos()[2].name,s=e.stringTuples()[1][1];if("tcp"!==r||"ws"!==n&&"wss"!==n)throw new Error(`invalid multiaddr: ${e.toString()}`);if(!Fi(i=e)||!i.protos().some((e=>e.resolvable)))return`http://${t[2]}:${t[4]}`;var i;if("ws"===n)return`http://${t[2]}${null==s||"80"===s?"":`:${s}`}`;if("wss"===n)return`https://${t[2]}${null==s||"443"===s?"":`:${s}`}`;throw new Error("invalid multiaddr: "+e.toString())}const SO=He("libp2p:webrtc-star:listener"),AO={transports:["websocket"],path:"/socket.io-next/"};class IO extends iA{constructor(e,t,r,n,s){super(),this.signallingAddr=t,this.socket=oO(e,AO),this.connections=[],this.channels=new Map,this.pendingSignals=new Map,this.upgrader=r,this.handler=n,this.channelOptions=s,this.handleWsHandshake=this.handleWsHandshake.bind(this);let i=!1;this.socket.on("connect_error",(e=>{i&&"TransportError"===e.type||this.dispatchEvent(new aA("error",{detail:e}))})),this.socket.on("error",(e=>{this.dispatchEvent(new aA("error",{detail:e}))})),this.socket.on("ws-handshake",this.handleWsHandshake),this.socket.on("ws-peer",(e=>{this.dispatchEvent(new aA("peer",{detail:e}))})),this.socket.on("connect",(()=>{this.socket.emit("ss-join",this.signallingAddr.toString()),i&&this.dispatchEvent(new aA("reconnect"))})),this.socket.once("connect",(()=>{i=!0,this.dispatchEvent(new aA("listening"))})),this.socket.on("disconnect",(()=>{this.dispatchEvent(new aA("disconnect"))}))}_createChannel(e,t,r){const n={...this.channelOptions},s=new fO(n),i=e=>{const t=e.detail;SO.error("incoming connection errored",t)};return s.addEventListener("error",i),s.addEventListener("close",(()=>{s.removeEventListener("error",i)}),{once:!0}),s.addEventListener("signal",(n=>{const s=n.detail;this.socket.emit("ss-handshake",{intentId:e,srcMultiaddr:t,dstMultiaddr:r,answer:!0,signal:s})})),s.addEventListener("ready",(()=>{const t=EO(s,{remoteAddr:this.signallingAddr});SO("new inbound connection %s",t.remoteAddr);try{this.upgrader.upgradeInbound(t).then((r=>{SO("inbound connection %s upgraded",t.remoteAddr),this.connections.push(t),s.addEventListener("close",(()=>{this.connections=this.connections.filter((e=>e!==t)),this.channels.delete(e),this.pendingSignals.delete(e)}),{once:!0}),this.dispatchEvent(new aA("connection",{detail:r})),this.handler(r)})).catch((e=>{SO.error("inbound connection failed to upgrade",e),t.close().catch((e=>{SO.error("inbound connection failed to close after failing to upgrade",e)}))}))}catch(e){SO.error("inbound connection failed to upgrade",e),t.close().catch((e=>{SO.error("inbound connection failed to close after failing to upgrade",e)}))}}),{once:!0}),s}handleWsHandshake(e){if(SO('incoming handshake. signal type "%s" is answer %s',e.signal.type,e.answer),!0===e.answer||null!=e.err||null==e.intentId)return;const t=e.intentId;let r=this.pendingSignals.get(t);null==r&&(r=[],this.pendingSignals.set(t,r)),r.push(e);let n=this.channels.get(t);if(null==n){if("offer"!==e.signal.type)return void SO("handshake is not an offer and channel does not exist, buffering until we receive an offer");SO("creating new channel to handle offer handshake"),n=this._createChannel(e.intentId,e.srcMultiaddr,e.dstMultiaddr),this.channels.set(t,n)}else SO("channel already exists, using it to handle handshake");for(;r.length>0;){const e=r.shift();null!=e?.signal&&n.handleSignal(e.signal)}}async close(){this.socket.emit("ss-leave",this.signallingAddr.toString()),this.socket.removeAllListeners(),this.socket.close(),await Promise.all([...this.connections.map((async e=>await e.close())),...Array.from(this.channels.values()).map((async e=>await e.close()))]),this.dispatchEvent(new aA("close"))}}class RO extends iA{constructor(e,t,r,n,s){super(),this.upgrader=e,this.handler=t,this.peerId=r,this.transport=n,this.options=s}async listen(e){if(null!=this.listeningAddr)throw qe(new Error("listener already in use"),"ERR_ALREADY_LISTENING");const t=Bd();let r;this.listeningAddr=e,r=e.protoCodes().includes(421)?e:e.encapsulate(`/p2p/${this.peerId.toString()}`);const n=this.signallingUrl=_O(e);SO("connecting to signalling server on: %s",this.signallingUrl);const s=new IO(this.signallingUrl,r,this.upgrader,this.handler,this.options.channelOptions);return s.addEventListener("error",(e=>{const r=e.detail;SO("error connecting to signalling server %o",r),s.close().catch((e=>{SO.error("error closing server after error",e)})),t.reject(r)})),s.addEventListener("listening",(()=>{SO("connected to signalling server"),this.dispatchEvent(new aA("listening")),t.resolve()})),s.addEventListener("peer",(e=>{this.transport.peerDiscovered(e.detail)})),s.addEventListener("connection",(t=>{const r=t.detail;if(null==r.remoteAddr)try{r.remoteAddr=e.decapsulateCode(421).encapsulate(`/p2p/${r.remotePeer.toString()}`)}catch(e){SO.error("could not determine remote address",e)}this.dispatchEvent(new aA("connection",{detail:r}))})),s.addEventListener("disconnect",(()=>{this.transport.sigServers.delete(n)})),s.addEventListener("reconnect",(()=>{this.transport.sigServers.set(n,s)})),this.transport.sigServers.set(this.signallingUrl,s),await t.promise}async close(){if(null!=this.signallingUrl){const e=this.transport.sigServers.get(this.signallingUrl);null!=e&&(await e.close(),this.transport.sigServers.delete(this.signallingUrl))}this.dispatchEvent(new aA("close")),this.listeningAddr=void 0}getAddrs(){return null!=this.listeningAddr?[this.listeningAddr]:[]}}const kO=Symbol.for("@libp2p/transport"),TO=Symbol.for("@libp2p/peer-discovery"),CO="RTCPeerConnection"in globalThis,PO=He("libp2p:webrtc-star"),NO=()=>{};class DO extends iA{constructor(){super(...arguments),this.started=!1}get[TO](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star-discovery"}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}dispatchEvent(e){return!!this.isStarted()&&super.dispatchEvent(e)}}class OO{constructor(e){null!=e?.wrtc&&(this.wrtc=e.wrtc),this.sigServers=new Map,this._discovery=new DO,this.discovery=()=>this._discovery,this.peerDiscovered=this.peerDiscovered.bind(this)}get[kO](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star"}async dial(e,t){const r=EO(await this._connect(e,t),{remoteAddr:e,signal:t.signal});PO("new outbound connection %s",r.remoteAddr);const n=await t.upgrader.upgradeOutbound(r);return PO("outbound connection %s upgraded",r.remoteAddr),n}async _connect(e,t){if(!0===t.signal?.aborted)throw new eT;const r={...t.channelOptions??{}};null!=this.wrtc&&(r.wrtc=this.wrtc);const n=e.toOptions(),s=ni(aO(36),"hex");return await new Promise(((i,o)=>{const a=this.sigServers.get(_O(e));if(null==a?.socket)return o(qe(new Error("unknown signal server to use"),"ERR_UNKNOWN_SIGNAL_SERVER"));let c=!1;PO("dialing %s:%s",n.host,n.port);const l=new wO(r),h=e=>{const t=e.detail;if(!c){const e=`connection error ${n.host}:${n.port}: ${t.message}`;PO.error(e),p(t)}},u=()=>{c=!0,PO("connection opened %s:%s",n.host,n.port),p()},d=()=>{PO.error("connection aborted %s:%s",n.host,n.port),l.close().finally((()=>{p(new eT)}))},p=e=>{l.removeEventListener("ready",u),t.signal?.removeEventListener("abort",d),null==e?i(l):o(e)};l.addEventListener("ready",u,{once:!0}),l.addEventListener("close",(()=>{l.removeEventListener("error",h)})),t.signal?.addEventListener("abort",d),l.addEventListener("signal",(t=>{const r=t.detail;a.socket.emit("ss-handshake",{intentId:s,srcMultiaddr:a.signallingAddr.toString(),dstMultiaddr:e.toString(),signal:r})})),a.socket.on("ws-handshake",(e=>{e.intentId===s&&null!=e.err&&l.close().finally((()=>{o(qe(new Error(e.err),"ERR_SIGNALLING_FAILED"))})),e.intentId!==s||null==e.answer||l.closed||l.handleSignal(e.signal)}))}))}createListener(e){if(!CO&&null==this.wrtc)throw qe(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");if(e.channelOptions=e.channelOptions??{},null!=this.wrtc&&(e.channelOptions.wrtc=this.wrtc),null==this.peerId)throw qe(new Error("PeerId not set"),"ERR_MISSING_PEER_ID");return function(e,t,r,n,s){return new RO(e,t,r,n,s)}(e.upgrader,e.handler??NO,this.peerId,this,e)}filter(e){return(e=Array.isArray(e)?e:[e]).filter((e=>!e.protoCodes().includes(290)&&no.matches(e)))}peerDiscovered(e){PO("peer discovered: %s",e),e=function(e){const t="/libp2p-webrtc-star";if(e.startsWith(t)){let r=Ki(e=e.substring(t.length,e.length));const n=r.stringTuples().filter((e=>421===e[0]))[0];if(null==n[1])throw new Error("invalid multiaddr: "+e);r=r.decapsulate("p2p"),r=r.encapsulate("/p2p-webrtc-star"),r=r.encapsulate(`/p2p/${n[1]}`),e=r.toString()}return e}(e);const t=Ki(e),r=t.getPeerId();if(null==r)return;const n=Za(r);this._discovery.dispatchEvent(new aA("peer",{detail:{id:n,multiaddrs:[t],protocols:[]}}))}}var xO,LO,BO;async function*MO(e,t){for await(const r of e)await t(r)&&(yield r)}async function*UO(e,t){yield*zd(e,(async e=>(await t.addressBook.add(e.id,e.multiaddrs),e)))}function zO(e){const t=new Set;return MO(e,(e=>!t.has(e.id.toString())&&(t.add(e.id.toString()),!0)))}async function*VO(e,t=1){let r=0;for await(const t of e)r++,yield t;if(r<t)throw qe(new Error("not found"),"NOT_FOUND")}!function(e){e.NOT_STARTED_YET="The libp2p node is not started yet",e.DHT_DISABLED="DHT is not available",e.PUBSUB_DISABLED="PubSub is not available",e.CONN_ENCRYPTION_REQUIRED="At least one connection encryption module is required",e.ERR_TRANSPORTS_REQUIRED="At least one transport module is required",e.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",e.NOT_FOUND="Not found"}(xO||(xO={})),(BO=LO||(LO={})).DHT_DISABLED="ERR_DHT_DISABLED",BO.ERR_PUBSUB_DISABLED="ERR_PUBSUB_DISABLED",BO.PUBSUB_NOT_STARTED="ERR_PUBSUB_NOT_STARTED",BO.DHT_NOT_STARTED="ERR_DHT_NOT_STARTED",BO.CONN_ENCRYPTION_REQUIRED="ERR_CONN_ENCRYPTION_REQUIRED",BO.ERR_TRANSPORTS_REQUIRED="ERR_TRANSPORTS_REQUIRED",BO.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",BO.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",BO.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",BO.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",BO.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",BO.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",BO.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",BO.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",BO.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",BO.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",BO.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",BO.ERR_DIALED_SELF="ERR_DIALED_SELF",BO.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",BO.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",BO.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",BO.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",BO.ERR_INVALID_KEY="ERR_INVALID_KEY",BO.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",BO.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",BO.ERR_INVALID_PEER="ERR_INVALID_PEER",BO.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",BO.ERR_NOT_FOUND="ERR_NOT_FOUND",BO.ERR_TIMEOUT="ERR_TIMEOUT",BO.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",BO.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",BO.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",BO.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",BO.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",BO.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",BO.ERR_FIND_SELF="ERR_FIND_SELF",BO.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",BO.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",BO.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",BO.ERR_KEYCHAIN_REQUIRED="ERR_KEYCHAIN_REQUIRED",BO.ERR_INVALID_CMS="ERR_INVALID_CMS",BO.ERR_MISSING_KEYS="ERR_MISSING_KEYS",BO.ERR_NO_KEY="ERR_NO_KEY",BO.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",BO.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",BO.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",BO.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",BO.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",BO.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",BO.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",BO.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",BO.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",BO.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",BO.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",BO.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",BO.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",BO.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",BO.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",BO.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",BO.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",BO.ERR_INVALID_RECORD="ERR_INVALID_RECORD",BO.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",BO.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",BO.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",BO.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",BO.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED";var FO=r(35609),jO=r(3894);const KO=He("libp2p:peer-routing");class $O{constructor(e,t){this.components=e,this.routers=t.routers,this.refreshManagerInit=t.refreshManager??{},this.started=!1,this._findClosestPeersTask=this._findClosestPeersTask.bind(this)}isStarted(){return this.started}async start(){this.started||0===this.routers.length||null!=this.timeoutId||!1===this.refreshManagerInit.enabled||(this.timeoutId=(0,FO.setDelayedInterval)(this._findClosestPeersTask,this.refreshManagerInit.interval,this.refreshManagerInit.bootDelay),this.started=!0)}async _findClosestPeersTask(){if(null==this.abortController)try{this.abortController=new ei.TimeoutController(this.refreshManagerInit.timeout??1e4);try{(0,jO.setMaxListeners)?.(1/0,this.abortController.signal)}catch{}await dd(this.getClosestPeers(this.components.peerId.toBytes(),{signal:this.abortController.signal}))}catch(e){KO.error(e)}finally{this.abortController?.clear(),this.abortController=void 0}}async stop(){(0,FO.clearDelayedInterval)(this.timeoutId),this.abortController?.abort(),this.started=!1}async findPeer(e,t){if(0===this.routers.length)throw qe(new Error("No peer routers available"),LO.ERR_NO_ROUTERS_AVAILABLE);if(e.toString()===this.components.peerId.toString())throw qe(new Error("Should not try to find self"),LO.ERR_FIND_SELF);const r=await Xu(dS(...this.routers.map((r=>async function*(){try{yield await r.findPeer(e,t)}catch(e){KO.error(e)}}()))),(e=>MO(e,Boolean)),(e=>UO(e,this.components.peerStore)),(async e=>await Lw(e)));if(null!=r)return r;throw qe(new Error(xO.NOT_FOUND),LO.ERR_NOT_FOUND)}async*getClosestPeers(e,t){if(0===this.routers.length)throw qe(new Error("No peer routers available"),LO.ERR_NO_ROUTERS_AVAILABLE);yield*Xu(dS(...this.routers.map((r=>r.getClosestPeers(e,t)))),(e=>UO(e,this.components.peerStore)),(e=>zO(e)),(e=>VO(e)))}}class HO{constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(0===this.routers.length)throw qe(new Error("No content this.routers available"),LO.ERR_NO_ROUTERS_AVAILABLE);yield*Xu(dS(...this.routers.map((r=>r.findProviders(e,t)))),(e=>UO(e,this.components.peerStore)),(e=>zO(e)),(e=>VO(e)))}async provide(e,t={}){if(0===this.routers.length)throw qe(new Error("No content routers available"),LO.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map((async r=>await r.provide(e,t))))}async put(e,t,r){if(!this.isStarted())throw qe(new Error(xO.NOT_STARTED_YET),LO.DHT_NOT_STARTED);const n=this.components.dht;null!=n&&await dd(n.put(e,t,r))}async get(e,t){if(!this.isStarted())throw qe(new Error(xO.NOT_STARTED_YET),LO.DHT_NOT_STARTED);const r=this.components.dht;if(null!=r)for await(const n of r.get(e,t))if("VALUE"===n.name)return n.value;throw qe(new Error(xO.NOT_FOUND),LO.ERR_NOT_FOUND)}async*getMany(e,t,r){if(!this.isStarted())throw qe(new Error(xO.NOT_STARTED_YET),LO.DHT_NOT_STARTED);if(null==t||0===t)return;let n=0;const s=this.components.dht;if(null!=s)for await(const i of s.get(e,r))if("VALUE"===i.name&&(yield{from:i.from,val:i.value},n++,n===t))break;if(0===n)throw qe(new Error(xO.NOT_FOUND),LO.ERR_NOT_FOUND)}}function qO(e){if(Ka(e))return{id:e,multiaddrs:[],protocols:[]};let t;return"string"==typeof e&&(e=Ki(e)),Fi(e)&&(t=e,e=function(e){const t=e.getPeerId();if(null==t)throw qe(new Error(`${e.toString()} does not have a valid peer type`),LO.ERR_INVALID_MULTIADDR);try{return Za(t)}catch(t){throw qe(new Error(`${e.toString()} is not a valid peer type`),LO.ERR_INVALID_MULTIADDR)}}(e)),{id:e,multiaddrs:null!=t?[t]:[],protocols:[]}}const GO=e=>e;class WO extends iA{constructor(e,t){super();const{listen:r=[],announce:n=[]}=t;this.components=e,this.listen=new Set(r.map((e=>e.toString()))),this.announce=new Set(n.map((e=>e.toString()))),this.observed=new Set,this.announceFilter=t.announceFilter??GO}getListenAddrs(){return Array.from(this.listen).map((e=>Ki(e)))}getAnnounceAddrs(){return Array.from(this.announce).map((e=>Ki(e)))}getObservedAddrs(){return Array.from(this.observed).map((e=>Ki(e)))}confirmObservedAddr(e){}removeObservedAddr(e){}addObservedAddr(e){let t=Ki(e);const r=t.getPeerId();null!=r&&Za(r).equals(this.components.peerId)&&(t=t.decapsulate(Ki(`/p2p/${this.components.peerId.toString()}`)));const n=t.toString();this.observed.has(n)||(this.observed.add(n),this.dispatchEvent(new aA("change:addresses")))}getAddresses(){let e=this.getAnnounceAddrs().map((e=>e.toString()));0===e.length&&(e=this.components.transportManager.getAddrs().map((e=>e.toString()))),e=e.concat(this.getObservedAddrs().map((e=>e.toString())));const t=new Set(e);return this.announceFilter(Array.from(t).map((e=>Ki(e)))).map((e=>e.getPeerId()===this.components.peerId.toString()?e:e.encapsulate(`/p2p/${this.components.peerId.toString()}`)))}}const YO=He("libp2p:connection-manager:latency-monitor:visibility-change-emitter");class ZO extends iA{constructor(){super(),this.hidden="hidden",this.visibilityChange="visibilityChange",null!=globalThis.document&&(this._initializeVisibilityVarNames(),this._addVisibilityChangeListener())}_initializeVisibilityVarNames(){let e="hidden",t="visibilitychange";void 0!==globalThis.document.hidden?(e="hidden",t="visibilitychange"):void 0!==globalThis.document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):void 0!==globalThis.document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==globalThis.document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),this.hidden=e,this.visibilityChange=t}_addVisibilityChangeListener(){void 0===globalThis.document.addEventListener||void 0===document[this.hidden]?YO("Checking page visibility requires a browser that supports the Page Visibility API."):globalThis.document.addEventListener(this.visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){if(void 0!==this.hidden&&void 0!==document[this.hidden])return null==document[this.hidden]}_handleVisibilityChange(){const e=!1===globalThis.document[this.hidden];YO(e?"Page Visible":"Page Hidden"),this.dispatchEvent(new aA("visibilityChange",{detail:e}))}}const QO=He("libp2p:connection-manager:latency-monitor");class JO extends iA{constructor(e={}){super();const{latencyCheckIntervalMs:t,dataEmitIntervalMs:r,asyncTestFn:n,latencyRandomPercentage:s}=e;this.latencyCheckIntervalMs=t??500,this.latencyRandomPercentage=s??10,this.latencyCheckMultiply=this.latencyRandomPercentage/100*2*this.latencyCheckIntervalMs,this.latencyCheckSubtract=this.latencyCheckMultiply/2,this.dataEmitIntervalMs=null===r||0===r?void 0:r??5e3,QO("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",this.latencyCheckIntervalMs,this.dataEmitIntervalMs),null!=this.dataEmitIntervalMs?QO("Expecting ~%s events per summary",this.latencyCheckIntervalMs/this.dataEmitIntervalMs):QO("Not emitting summaries"),this.asyncTestFn=n,null!=globalThis.process?.hrtime?(QO("Using process.hrtime for timing"),this.now=globalThis.process.hrtime,this.getDeltaMS=e=>{const t=this.now(e);return 1e3*t[0]+t[1]/1e6}):"undefined"!=typeof window&&null!=window.performance?.now?(QO("Using performance.now for timing"),this.now=window.performance.now.bind(window.performance),this.getDeltaMS=e=>Math.round(this.now()-e)):(QO("Using Date.now for timing"),this.now=Date.now,this.getDeltaMS=e=>this.now()-e),this.latencyData=this.initLatencyData()}start(){void 0!==globalThis.window&&(this.visibilityChangeEmitter=new ZO,this.visibilityChangeEmitter.addEventListener("visibilityChange",(e=>{const{detail:t}=e;t?this._startTimers():(this._emitSummary(),this._stopTimers())}))),!0===this.visibilityChangeEmitter?.isVisible()&&this._startTimers()}stop(){this._stopTimers()}_startTimers(){null==this.checkLatencyID&&(this.checkLatency(),null!=this.dataEmitIntervalMs&&(this.emitIntervalID=setInterval((()=>this._emitSummary()),this.dataEmitIntervalMs),"function"==typeof this.emitIntervalID.unref&&this.emitIntervalID.unref()))}_stopTimers(){null!=this.checkLatencyID&&(clearTimeout(this.checkLatencyID),this.checkLatencyID=void 0),null!=this.emitIntervalID&&(clearInterval(this.emitIntervalID),this.emitIntervalID=void 0)}_emitSummary(){const e=this.getSummary();e.events>0&&this.dispatchEvent(new aA("data",{detail:e}))}getSummary(){const e={events:this.latencyData.events,minMs:this.latencyData.minMs,maxMs:this.latencyData.maxMs,avgMs:this.latencyData.events>0?this.latencyData.totalMs/this.latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this.latencyData.startTime)};return this.latencyData=this.initLatencyData(),QO.trace("Summary: %O",e),e}checkLatency(){const e=Math.random()*this.latencyCheckMultiply-this.latencyCheckSubtract,t={deltaOffset:Math.ceil(this.latencyCheckIntervalMs+e),startTime:this.now()},r=()=>{if(null==this.checkLatencyID)return;const e=this.getDeltaMS(t.startTime)-t.deltaOffset;this.checkLatency(),this.latencyData.events++,this.latencyData.minMs=Math.min(this.latencyData.minMs,e),this.latencyData.maxMs=Math.max(this.latencyData.maxMs,e),this.latencyData.totalMs+=e,QO.trace("MS: %s Data: %O",e,this.latencyData)};QO.trace("localData: %O",t),this.checkLatencyID=setTimeout((()=>{null!=this.asyncTestFn?(t.deltaOffset=0,t.startTime=this.now(),this.asyncTestFn(r)):(t.deltaOffset-=1,r())}),t.deltaOffset),"function"==typeof this.checkLatencyID.unref&&this.checkLatencyID.unref()}initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}var XO=r(21233);const ex="OPEN",tx="CLOSING",rx="CLOSED";function nx(e,t){const r={[Symbol.iterator]:()=>r,next:()=>{const r=e.next(),n=r.value;return!0===r.done||null==n?{done:!0,value:void 0}:{done:!1,value:t(n)}}};return r}class sx{constructor(e){if(this.map=new Map,null!=e)for(const[t,r]of e.entries())this.map.set(t.toString(),r)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){this.map.delete(e.toString())}entries(){return nx(this.map.entries(),(e=>[Za(e[0]),e[1]]))}forEach(e){this.map.forEach(((t,r)=>{e(t,Za(r),this)}))}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return nx(this.map.keys(),(e=>Za(e)))}values(){return this.map.values()}get size(){return this.map.size}}class ix{constructor(e){if(this.set=new Set,null!=e)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return nx(this.set.entries(),(e=>{const t=Za(e[0]);return[t,t]}))}forEach(e){this.set.forEach((t=>{const r=Za(t);e(r,r,this)}))}has(e){return this.set.has(e.toString())}values(){return nx(this.set.values(),(e=>Za(e)))}intersection(e){const t=new ix;for(const r of e)this.has(r)&&t.add(r);return t}difference(e){const t=new ix;for(const r of this)e.has(r)||t.add(r);return t}union(e){const t=new ix;for(const r of e)t.add(r);for(const e of this)t.add(e);return t}}class ox{constructor(e){if(this.list=[],null!=e)for(const t of e)this.list.push(t.toString())}[Symbol.iterator](){return mapIterable(this.list.entries(),(e=>peerIdFromString(e[1])))}concat(e){const t=new ox(this);for(const r of e)t.push(r);return t}entries(){return mapIterable(this.list.entries(),(e=>[e[0],peerIdFromString(e[1])]))}every(e){return this.list.every(((t,r)=>e(peerIdFromString(t),r,this)))}filter(e){const t=new ox;return this.list.forEach(((r,n)=>{const s=peerIdFromString(r);e(s,n,this)&&t.push(s)})),t}find(e){const t=this.list.find(((t,r)=>e(peerIdFromString(t),r,this)));if(null!=t)return peerIdFromString(t)}findIndex(e){return this.list.findIndex(((t,r)=>e(peerIdFromString(t),r,this)))}forEach(e){this.list.forEach(((t,r)=>{e(peerIdFromString(t),r,this)}))}includes(e){return this.list.includes(e.toString())}indexOf(e){return this.list.indexOf(e.toString())}pop(){const e=this.list.pop();if(null!=e)return peerIdFromString(e)}push(...e){for(const t of e)this.list.push(t.toString())}shift(){const e=this.list.shift();if(null!=e)return peerIdFromString(e)}unshift(...e){let t=this.list.length;for(let t=e.length-1;t>-1;t--)this.list.unshift(e[t].toString());return t}get length(){return this.list.length}}var ax=r(6633);const cx=He("libp2p:connection-manager"),lx={maxConnections:1/0,minConnections:0,maxData:1/0,maxSentData:1/0,maxReceivedData:1/0,maxEventLoopDelay:1/0,pollInterval:2e3,autoDialInterval:1e4,movingAverageInterval:6e4,inboundConnectionThreshold:5,maxIncomingPendingConnections:10},hx="libp2p",ux="connection-manager";class dx extends iA{constructor(e,t){if(super(),this.opts=ye.call({ignoreUndefined:!0},lx,t),this.opts.maxConnections<this.opts.minConnections)throw qe(new Error("Connection Manager maxConnections must be greater than minConnections"),LO.ERR_INVALID_PARAMETERS);cx("options: %o",this.opts),this.components=e,this.connections=new Map,this.started=!1,this._checkMetrics=this._checkMetrics.bind(this),this.latencyMonitor=new JO({latencyCheckIntervalMs:t.pollInterval,dataEmitIntervalMs:t.pollInterval});try{(0,jO.setMaxListeners)?.(1/0,this)}catch{}this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.startupReconnectTimeout=t.startupReconnectTimeout??6e4,this.dialTimeout=t.dialTimeout??3e4,this.allow=(t.allow??[]).map((e=>Ki(e))),this.deny=(t.deny??[]).map((e=>Ki(e))),this.inboundConnectionRateLimiter=new ax.RateLimiterMemory({points:this.opts.inboundConnectionThreshold,duration:1}),this.incomingPendingConnections=0}isStarted(){return this.started}async start(){null!=this.components.metrics&&(this.timer=this.timer??XO(this._checkMetrics,this.opts.pollInterval)),this.components.metrics?.updateComponentMetric({system:hx,component:ux,metric:"connections",label:"direction",value:()=>{const e={inbound:0,outbound:0};for(const t of this.connections.values())for(const r of t)"inbound"===r.stat.direction?e.inbound++:e.outbound++;return e}}),this.components.metrics?.updateComponentMetric({system:hx,component:ux,metric:"protocol-streams-total",label:"protocol",value:()=>{const e={};for(const t of this.connections.values())for(const r of t)for(const t of r.streams){const r=`${t.stat.direction} ${t.stat.protocol??"unnegotiated"}`;e[r]=(e[r]??0)+1}return e}}),this.components.metrics?.updateComponentMetric({system:hx,component:ux,metric:"protocol-streams-per-connection-90th-percentile",label:"protocol",value:()=>{const e={};for(const t of this.connections.values())for(const r of t){const t={};for(const e of r.streams){const r=`${e.stat.direction} ${e.stat.protocol??"unnegotiated"}`;t[r]=(t[r]??0)+1}for(const[r,n]of Object.entries(t))e[r]=e[r]??[],e[r].push(n)}const t={};for(let[r,n]of Object.entries(e)){n=n.sort(((e,t)=>e-t));const e=Math.floor(.9*n.length);t[r]=n[e]}return t}}),this.latencyMonitor.start(),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this.latencyMonitor.addEventListener("data",this._onLatencyMeasure),this.started=!0,cx("started")}async afterStart(){this.components.upgrader.addEventListener("connection",this.onConnect),this.components.upgrader.addEventListener("connectionEnd",this.onDisconnect),Promise.resolve().then((async()=>{const e=[];for(const t of await this.components.peerStore.all())(await this.components.peerStore.getTags(t.id)).filter((e=>"keep-alive"===e.name)).length>0&&e.push(t.id);this.connectOnStartupController?.clear(),this.connectOnStartupController=new ei.TimeoutController(this.startupReconnectTimeout);try{(0,jO.setMaxListeners)?.(1/0,this.connectOnStartupController.signal)}catch{}await Promise.all(e.map((async e=>{await this.openConnection(e,{signal:this.connectOnStartupController?.signal}).catch((e=>{cx.error(e)}))})))})).catch((e=>{cx.error(e)})).finally((()=>{this.connectOnStartupController?.clear()}))}async beforeStop(){this.connectOnStartupController?.abort(),this.components.upgrader.removeEventListener("connection",this.onConnect),this.components.upgrader.removeEventListener("connectionEnd",this.onDisconnect)}async stop(){this.timer?.clear(),this.latencyMonitor.removeEventListener("data",this._onLatencyMeasure),this.latencyMonitor.stop(),this.started=!1,await this._close(),cx("stopped")}async _close(){const e=[];for(const t of this.connections.values())for(const r of t)e.push((async()=>{try{await r.close()}catch(e){cx.error(e)}})());cx("closing %d connections",e.length),await Promise.all(e),this.connections.clear()}async _checkMetrics(){const e=this.components.metrics;if(null!=e)try{const t=e.getGlobal().getMovingAverages(),r=t.dataReceived[this.opts.movingAverageInterval].movingAverage;await this._checkMaxLimit("maxReceivedData",r);const n=t.dataSent[this.opts.movingAverageInterval].movingAverage;await this._checkMaxLimit("maxSentData",n);const s=r+n;await this._checkMaxLimit("maxData",s),cx.trace("metrics update",s)}finally{this.timer=XO(this._checkMetrics,this.opts.pollInterval)}}onConnect(e){this._onConnect(e).catch((e=>{cx.error(e)}))}async _onConnect(e){const{detail:t}=e;if(!this.started)return void await t.close();const r=t.remotePeer,n=r.toString(),s=this.connections.get(n);null!=s?s.push(t):this.connections.set(n,[t]),null!=r.publicKey&&await this.components.peerStore.keyBook.set(r,r.publicKey);const i=this.getConnections().length,o=i-this.opts.maxConnections;await this._checkMaxLimit("maxConnections",i,o),this.dispatchEvent(new aA("peer:connect",{detail:t}))}onDisconnect(e){const{detail:t}=e;if(!this.started)return;const r=t.remotePeer.toString();let n=this.connections.get(r);null!=n&&n.length>1?(n=n.filter((e=>e.id!==t.id)),this.connections.set(r,n)):null!=n&&(this.connections.delete(r),this.dispatchEvent(new aA("peer:disconnect",{detail:t})),this.components.metrics?.onPeerDisconnected(t.remotePeer))}getConnections(e){if(null!=e)return this.connections.get(e.toString())??[];let t=[];for(const e of this.connections.values())t=t.concat(e);return t}async openConnection(e,t={}){cx("dial to %p",e);const r=this.getConnections(e);if(r.length>0)return cx("had an existing connection to %p",e),r[0];let n;if(null==t?.signal){n=new ei.TimeoutController(this.dialTimeout),t.signal=n.signal;try{(0,jO.setMaxListeners)?.(1/0,n.signal)}catch{}}try{const r=await this.components.dialer.dial(e,t);let s=this.connections.get(e.toString());null==s&&(s=[],this.connections.set(e.toString(),s));let i=!1;for(const e of s)e.id===r.id&&(i=!0);return i||s.push(r),r}finally{null!=n&&n.clear()}}async closeConnections(e){const t=this.connections.get(e.toString())??[];await Promise.all(t.map((async e=>await e.close())))}getAll(e){if(!Ka(e))throw qe(new Error("peerId must be an instance of peer-id"),LO.ERR_INVALID_PARAMETERS);const t=e.toString(),r=this.connections.get(t);return null!=r?r.filter((e=>e.stat.status===ex)):[]}_onLatencyMeasure(e){const{detail:t}=e;this._checkMaxLimit("maxEventLoopDelay",t.avgMs,1).catch((e=>{cx.error(e)}))}async _checkMaxLimit(e,t,r=1){const n=this.opts[e];cx.trace("checking limit of %s. current value: %d of %d",e,t,n),t>n&&(cx("%s: limit exceeded: %p, %d/%d, pruning %d connection(s)",this.components.peerId,e,t,n,r),await this._pruneConnections(r))}async _pruneConnections(e){const t=this.getConnections(),r=new sx;for(const e of t){const t=e.remotePeer;if(r.has(t))continue;const n=await this.components.peerStore.getTags(t);r.set(t,n.reduce(((e,t)=>e+t.value),0))}const n=t.sort(((e,t)=>{const n=r.get(e.remotePeer)??0,s=r.get(t.remotePeer)??0;return n>s?1:n<s?-1:0})),s=[];for(const t of n)if(cx("too many connections open - closing a connection to %p",t.remotePeer),s.push(t),s.length===e)break;await Promise.all(s.map((async e=>{try{await e.close()}catch(e){cx.error(e)}this.onDisconnect(new aA("connectionEnd",{detail:e}))})))}async acceptIncomingConnection(e){if(this.deny.some((t=>e.remoteAddr.toString().startsWith(t.toString()))))return cx("connection from %s refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some((t=>e.remoteAddr.toString().startsWith(t.toString()))))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.opts.maxIncomingPendingConnections)return cx("connection from %s refused - incomingPendingConnections exceeded by peer %s",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const t=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(t,1)}catch{return cx("connection from %s refused - inboundConnectionThreshold exceeded by host %s",t,e.remoteAddr),!1}}return this.getConnections().length<this.opts.maxConnections?(this.incomingPendingConnections++,!0):(cx("connection from %s refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}}const px=He("libp2p:connection-manager:auto-dialler"),fx={enabled:!0,minConnections:0,autoDialInterval:1e4};class yx{constructor(e,t){this.components=e,this.options=ye.call({ignoreUndefined:!0},fx,t),this.running=!1,this._autoDial=this._autoDial.bind(this),px("options: %j",this.options)}isStarted(){return this.running}async start(){this.options.enabled?(this.running=!0,this._autoDial().catch((e=>{px.error("could start autodial",e)})),px("started")):px("not enabled")}async stop(){this.options.enabled?(this.running=!1,null!=this.autoDialTimeout&&this.autoDialTimeout.clear(),px("stopped")):px("not enabled")}async _autoDial(){null!=this.autoDialTimeout&&this.autoDialTimeout.clear();const e=this.options.minConnections;if(this.components.connectionManager.getConnections().length>=e)return void(this.autoDialTimeout=XO(this._autoDial,this.options.autoDialInterval));const t=await this.components.peerStore.all(),r=await Xu(t.sort((()=>Math.random()>.5?1:-1)),(e=>MO(e,(e=>!e.id.equals(this.components.peerId)))),(e=>_S(e,((e,t)=>t.protocols.length>e.protocols.length||null!=t.id.publicKey&&null==e.id.publicKey?1:-1))),(async e=>await Hd(e)));for(let t=0;this.running&&t<r.length&&this.components.connectionManager.getConnections().length<e;t++){if(!this.running)return;const e=r[t];if(0===this.components.connectionManager.getConnections(e.id).length){px("connecting to a peerStore stored peer %p",e.id);try{await this.components.connectionManager.openConnection(e.id)}catch(e){px.error("could not connect to peerStore stored peer",e)}}}this.running&&(this.autoDialTimeout=XO(this._autoDial,this.options.autoDialInterval))}}var gx;!function(e){let t,r,n,s,i,o;!function(e){e.SUCCESS="SUCCESS",e.HOP_SRC_ADDR_TOO_LONG="HOP_SRC_ADDR_TOO_LONG",e.HOP_DST_ADDR_TOO_LONG="HOP_DST_ADDR_TOO_LONG",e.HOP_SRC_MULTIADDR_INVALID="HOP_SRC_MULTIADDR_INVALID",e.HOP_DST_MULTIADDR_INVALID="HOP_DST_MULTIADDR_INVALID",e.HOP_NO_CONN_TO_DST="HOP_NO_CONN_TO_DST",e.HOP_CANT_DIAL_DST="HOP_CANT_DIAL_DST",e.HOP_CANT_OPEN_DST_STREAM="HOP_CANT_OPEN_DST_STREAM",e.HOP_CANT_SPEAK_RELAY="HOP_CANT_SPEAK_RELAY",e.HOP_CANT_RELAY_TO_SELF="HOP_CANT_RELAY_TO_SELF",e.STOP_SRC_ADDR_TOO_LONG="STOP_SRC_ADDR_TOO_LONG",e.STOP_DST_ADDR_TOO_LONG="STOP_DST_ADDR_TOO_LONG",e.STOP_SRC_MULTIADDR_INVALID="STOP_SRC_MULTIADDR_INVALID",e.STOP_DST_MULTIADDR_INVALID="STOP_DST_MULTIADDR_INVALID",e.STOP_RELAY_REFUSED="STOP_RELAY_REFUSED",e.MALFORMED_MESSAGE="MALFORMED_MESSAGE"}(t=e.Status||(e.Status={})),function(e){e[e.SUCCESS=100]="SUCCESS",e[e.HOP_SRC_ADDR_TOO_LONG=220]="HOP_SRC_ADDR_TOO_LONG",e[e.HOP_DST_ADDR_TOO_LONG=221]="HOP_DST_ADDR_TOO_LONG",e[e.HOP_SRC_MULTIADDR_INVALID=250]="HOP_SRC_MULTIADDR_INVALID",e[e.HOP_DST_MULTIADDR_INVALID=251]="HOP_DST_MULTIADDR_INVALID",e[e.HOP_NO_CONN_TO_DST=260]="HOP_NO_CONN_TO_DST",e[e.HOP_CANT_DIAL_DST=261]="HOP_CANT_DIAL_DST",e[e.HOP_CANT_OPEN_DST_STREAM=262]="HOP_CANT_OPEN_DST_STREAM",e[e.HOP_CANT_SPEAK_RELAY=270]="HOP_CANT_SPEAK_RELAY",e[e.HOP_CANT_RELAY_TO_SELF=280]="HOP_CANT_RELAY_TO_SELF",e[e.STOP_SRC_ADDR_TOO_LONG=320]="STOP_SRC_ADDR_TOO_LONG",e[e.STOP_DST_ADDR_TOO_LONG=321]="STOP_DST_ADDR_TOO_LONG",e[e.STOP_SRC_MULTIADDR_INVALID=350]="STOP_SRC_MULTIADDR_INVALID",e[e.STOP_DST_MULTIADDR_INVALID=351]="STOP_DST_MULTIADDR_INVALID",e[e.STOP_RELAY_REFUSED=390]="STOP_RELAY_REFUSED",e[e.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE"}(r||(r={})),function(e){e.codec=()=>Sc(r)}(t=e.Status||(e.Status={})),function(e){e.HOP="HOP",e.STOP="STOP",e.STATUS="STATUS",e.CAN_HOP="CAN_HOP"}(n=e.Type||(e.Type={})),function(e){e[e.HOP=1]="HOP",e[e.STOP=2]="STOP",e[e.STATUS=3]="STATUS",e[e.CAN_HOP=4]="CAN_HOP"}(s||(s={})),function(e){e.codec=()=>Sc(s)}(n=e.Type||(e.Type={})),function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.id&&e.id.byteLength>0)&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={id:new Uint8Array(0),addrs:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.id=e.bytes();break;case 2:r.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(i=e.Peer||(e.Peer={})),e.codec=()=>(null==o&&(o=Ac(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.srcPeer&&(r.uint32(18),e.Peer.codec().encode(t.srcPeer,r,{writeDefaults:!1})),null!=t.dstPeer&&(r.uint32(26),e.Peer.codec().encode(t.dstPeer,r,{writeDefaults:!1})),null!=t.code&&(r.uint32(32),e.Status.codec().encode(t.code,r)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){const r=t.uint32();switch(r>>>3){case 1:n.type=e.Type.codec().decode(t);break;case 2:n.srcPeer=e.Peer.codec().decode(t,t.uint32());break;case 3:n.dstPeer=e.Peer.codec().decode(t,t.uint32());break;case 4:n.code=e.Status.codec().decode(t);break;default:t.skipType(7&r)}}return n}))),o),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(gx||(gx={}));const mx=He("libp2p:stream:converter");function wx(e,t={}){const{stream:r,remoteAddr:n}=e,{sink:s,source:i}=r,o=async function*(){for await(const e of i)yield*e}(),a={async sink(e){null!=t.signal&&(e=tT(e,t.signal));try{await s(e),await c()}catch(e){"aborted"!==e.type&&mx(e)}},source:null!=t.signal?tT(o,t.signal):o,remoteAddr:n,timeline:{open:Date.now(),close:void 0},async close(){await s(async function*(){yield new Uint8Array(0)}()),await c()}};async function c(){return null==a.timeline.close&&(a.timeline.close=Date.now()),await Promise.resolve()}return a}const bx="/libp2p/circuit/relay/0.1.0";function vx(e,t){e.write({type:gx.Type.STATUS,code:t})}function Ex(e,t){try{null!=e.dstPeer?.addrs&&e.dstPeer.addrs.forEach((e=>Ki(e)))}catch(r){throw vx(t,e.type===gx.Type.HOP?gx.Status.HOP_DST_MULTIADDR_INVALID:gx.Status.STOP_DST_MULTIADDR_INVALID),r}try{null!=e.srcPeer?.addrs&&e.srcPeer.addrs.forEach((e=>Ki(e)))}catch(r){throw vx(t,e.type===gx.Type.HOP?gx.Status.HOP_SRC_MULTIADDR_INVALID:gx.Status.STOP_SRC_MULTIADDR_INVALID),r}}function _x(e){const t=ju(),r=function(e){const t=async function*(){let t=yield,r=new mp;for await(const n of e)if(null!=t)for(r.append(n);r.length>=t;){const e=r.sublist(0,t);if(r.consume(t),t=yield e,null==t){r.length>0&&(t=yield r,r=new mp);break}}else r.append(n),t=yield r,r=new mp;if(null!=t)throw Object.assign(new Error(`stream ended before ${t} bytes became available`),{code:"ERR_UNDER_READ",buffer:r})}();return t.next(),t}(e.source),n=Bd();let s;const i=e.sink(async function*(){yield*t;const e=await n.promise;yield*e}());return i.catch((e=>{s=e})),{reader:r,writer:t,stream:{sink:async e=>null!=s?await Promise.reject(s):(n.resolve(e),await i),source:r},rest:()=>t.end(),write:t.push,read:async()=>{const e=await r.next();if(null!=e.value)return e.value}}}const Sx=He("libp2p:circuit:stream-handler");class Ax{constructor(e){const{stream:t,maxLength:r=4096}=e;this.stream=t,this.shake=_x(this.stream),this.decoder=cT.fromReader(this.shake.reader,{maxDataLength:r})}async read(){const e=await this.decoder.next();if(null!=e.value){const t=gx.decode(e.value);return Sx("read message type",t.type),t}Sx("read received no value, closing stream"),this.close()}write(e){Sx("write message type %s",e.type),this.shake.write(iT.single(gx.encode(e)))}rest(){return this.shake.rest(),this.shake.stream}end(e){this.write(e),this.close()}close(){Sx("closing the stream"),this.rest().sink([]).catch((e=>{Sx.error(e)}))}}const Ix=He("libp2p:circuit:stop"),Rx=He("libp2p:circuit:hop");const kx=He("libp2p:circuit");class Tx{constructor(e,t){this._init=t,this.components=e,this._started=!1}isStarted(){return this._started}async start(){this._started||(this._started=!0,await this.components.registrar.handle(bx,(e=>{this._onProtocol(e).catch((e=>{kx.error(e)}))})).catch((e=>{kx.error(e)})))}async stop(){await this.components.registrar.unhandle(bx)}hopEnabled(){return!0}hopActive(){return!0}get[kO](){return!0}get[Symbol.toStringTag](){return"libp2p/circuit-relay-v1"}async _onProtocol(e){const{connection:t,stream:r}=e,n=new ei.TimeoutController(this._init.hop.timeout);try{(0,jO.setMaxListeners)?.(1/0,n.signal)}catch{}try{const e=nT(r,n.signal),s=new Ax({stream:{...r,...e}}),i=await s.read();if(null==i)return kx("request was invalid, could not read from stream"),s.write({type:gx.Type.STATUS,code:gx.Status.MALFORMED_MESSAGE}),void s.close();let o;switch(i.type){case gx.Type.CAN_HOP:kx("received CAN_HOP request from %p",t.remotePeer),await function(e){const{connection:t,streamHandler:r,circuit:n}=e,s=n.hopEnabled();Rx("can hop (%s) request from %p",s,t.remotePeer),r.end({type:gx.Type.STATUS,code:s?gx.Status.SUCCESS:gx.Status.HOP_CANT_SPEAK_RELAY})}({circuit:this,connection:t,streamHandler:s});break;case gx.Type.HOP:kx("received HOP request from %p",t.remotePeer),await async function(e){const{connection:t,request:r,streamHandler:n,circuit:s,connectionManager:i}=e;if(!s.hopEnabled())return Rx("HOP request received but we are not acting as a relay"),n.end({type:gx.Type.STATUS,code:gx.Status.HOP_CANT_SPEAK_RELAY});try{Ex(r,n)}catch(e){return void Rx.error("invalid hop request via peer %p %o",t.remotePeer,e)}if(null==r.dstPeer)return void Rx("HOP request received but we do not receive a dstPeer");const o=Qa(r.dstPeer.id),a=i.getConnections(o);if(0===a.length&&!s.hopActive())return Rx("HOP request received but we are not connected to the destination peer"),n.end({type:gx.Type.STATUS,code:gx.Status.HOP_NO_CONN_TO_DST});if(0===a.length)return Rx("did not have connection to remote peer"),n.end({type:gx.Type.STATUS,code:gx.Status.HOP_NO_CONN_TO_DST});const c={type:gx.Type.STOP,dstPeer:r.dstPeer,srcPeer:r.srcPeer};let l;try{Rx("performing STOP request");const e=await async function(e){const{connection:t,request:r,signal:n}=e,s=await t.newStream(bx,{signal:n});Ix("starting stop request to %p",t.remotePeer);const i=new Ax({stream:s});i.write(r);const o=await i.read();if(null!=o){if(o.code===gx.Status.SUCCESS)return Ix("stop request to %p was successful",t.remotePeer),i.rest();Ix("stop request failed with code %d",o.code),i.close()}else i.close()}({connection:a[0],request:c});if(null==e)throw new Error("Could not stop");l=e}catch(e){return void Rx.error(e)}Rx("hop request from %p is valid",t.remotePeer),n.write({type:gx.Type.STATUS,code:gx.Status.SUCCESS});const h=n.rest();return Rx("creating related connections"),await Xu(h,l,h)}({connection:t,request:i,streamHandler:s,circuit:this,connectionManager:this.components.connectionManager});break;case gx.Type.STOP:kx("received STOP request from %p",t.remotePeer),o=await function(e){const{connection:t,request:r,streamHandler:n}=e;try{Ex(r,n)}catch(e){return void Ix.error("invalid stop request via peer %p %o",t.remotePeer,e)}return Ix("stop request is valid"),n.write({type:gx.Type.STATUS,code:gx.Status.SUCCESS}),n.rest()}({connection:t,request:i,streamHandler:s});break;default:return kx("Request of type %s not supported",i.type),s.write({type:gx.Type.STATUS,code:gx.Status.MALFORMED_MESSAGE}),void s.close()}if(null!=o){const e=wx({stream:o,remoteAddr:t.remoteAddr.encapsulate("/p2p-circuit").encapsulate(Ki(i.dstPeer?.addrs[0])),localAddr:Ki(i.srcPeer?.addrs[0])}),r=i.type===gx.Type.HOP?"relay":"inbound";kx("new %s connection %s",r,e.remoteAddr);const n=await this.components.upgrader.upgradeInbound(e);kx("%s connection %s upgraded",r,e.remoteAddr),null!=this.handler&&this.handler(n)}}finally{n.clear()}}async dial(e,t={}){const r=e.toString().split("/p2p-circuit"),n=Ki(r[0]),s=Ki(r[r.length-1]),i=n.getPeerId(),o=s.getPeerId();if(null==i||null==o){const e="Circuit relay dial failed as addresses did not have peer id";throw kx.error(e),qe(new Error(e),LO.ERR_RELAYED_DIAL)}const a=Za(i),c=Za(o);let l=!1,h=this.components.connectionManager.getConnections(a)[0];null==h&&(await this.components.peerStore.addressBook.add(a,[n]),h=await this.components.connectionManager.openConnection(a,t),l=!0);try{const r=await async function(e){const{connection:t,request:r,signal:n}=e,s=await t.newStream(bx,{signal:n}),i=new Ax({stream:s});i.write(r);const o=await i.read();if(null==o)throw qe(new Error("HOP request had no response"),LO.ERR_HOP_REQUEST_FAILED);if(o.code===gx.Status.SUCCESS)return Rx("hop request was successful"),i.rest();throw Rx("hop request failed with code %d, closing stream",o.code),i.close(),qe(new Error(`HOP request failed with code "${o.code??"unknown"}"`),LO.ERR_HOP_REQUEST_FAILED)}({...t,connection:h,request:{type:gx.Type.HOP,srcPeer:{id:this.components.peerId.toBytes(),addrs:this.components.addressManager.getAddresses().map((e=>e.bytes))},dstPeer:{id:c.toBytes(),addrs:[Ki(s).bytes]}}}),i=wx({stream:r,remoteAddr:e,localAddr:n.encapsulate(`/p2p-circuit/p2p/${this.components.peerId.toString()}`)});return kx("new outbound connection %s",i.remoteAddr),await this.components.upgrader.upgradeOutbound(i)}catch(e){throw kx.error("Circuit relay dial failed",e),l&&await h.close(),e}}createListener(e){return this.handler=e.handler,function(e){const t=new Map,r=Object.assign(new iA,{close:async()=>await Promise.resolve(),listen:async function(n){const s=Ki(n.toString().split("/p2p-circuit").find((e=>""!==e))),i=s.getPeerId();if(null==i)throw new Error("Could not determine relay peer from multiaddr");const o=Za(i);await e.peerStore.addressBook.add(o,[s]);const a=await e.connectionManager.openConnection(o),c=a.remoteAddr.encapsulate("/p2p-circuit");t.set(a.remotePeer.toString(),c),r.dispatchEvent(new aA("listening"))},getAddrs:function(){const e=[];for(const r of t.values())e.push(r);return e}});return e.connectionManager.addEventListener("peer:disconnect",(e=>{const{detail:n}=e;t.delete(n.remotePeer.toString())&&r.dispatchEvent(new aA("close"))})),r}({connectionManager:this.components.connectionManager,peerStore:this.components.peerStore})}filter(e){return(e=Array.isArray(e)?e:[e]).filter((e=>lo.matches(e)))}}async function Cx(e){const t=(new TextEncoder).encode(e),r=await As.digest(t);return kt.createV0(r)}const Px="hop_relay",Nx="true",Dx="/libp2p/relay";var Ox=r(99699);function xx(e){const{address:t}=e.nodeAddress();return Boolean(Ox(t))}function Lx(e,t){const r=xx(e.multiaddr),n=xx(t.multiaddr);return r&&!n?1:!r&&n||e.isCertified&&!t.isCertified?-1:!e.isCertified&&t.isCertified?1:0}const Bx=He("libp2p:auto-relay"),Mx=()=>{};class Ux{constructor(e,t){this.components=e,this.addressSorter=t.addressSorter??Lx,this.maxListeners=t.maxListeners??1,this.listenRelays=new Set,this.onError=t.onError??Mx,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this),this.components.peerStore.addEventListener("change:protocols",(e=>{this._onProtocolChange(e).catch((e=>{Bx.error(e)}))})),this.components.connectionManager.addEventListener("peer:disconnect",this._onPeerDisconnected)}async _onProtocolChange(e){const{peerId:t,protocols:r}=e.detail,n=t.toString();if(null!=r.find((e=>e===bx))){if(!this.listenRelays.has(n))try{const e=this.components.connectionManager.getConnections(t);if(0===e.length)return;const r=e[0];if(r.remoteAddr.protoCodes().includes(290))return void Bx(`relayed connection to ${n} will not be used to hop on`);const s=await async function(e){const{connection:t,signal:r}=e,n=await t.newStream(bx,{signal:r}),s=new Ax({stream:n});s.write({type:gx.Type.CAN_HOP});const i=await s.read();return await s.close(),null!=i&&i.code===gx.Status.SUCCESS}({connection:r});s&&(await this.components.peerStore.metadataBook.setValue(t,Px,Xs(Nx)),await this._addListenRelay(r,n))}catch(e){this.onError(e)}}else this.listenRelays.has(n)&&await this._removeListenRelay(n)}_onPeerDisconnected(e){const t=e.detail.remotePeer.toString();this.listenRelays.has(t)&&this._removeListenRelay(t).catch((e=>{Bx.error(e)}))}async _addListenRelay(e,t){try{if(this.listenRelays.size>=this.maxListeners)return;const r=await Xu(await this.components.peerStore.addressBook.get(e.remotePeer),(e=>_S(e,this.addressSorter)),(async e=>await Hd(e))),n=await Promise.all(r.map((async t=>{try{let r=t.multiaddr;return null==r.getPeerId()&&(r=r.encapsulate(`/p2p/${e.remotePeer.toString()}`)),r=r.encapsulate("/p2p-circuit"),await this.components.transportManager.listen([r]),!0}catch(e){Bx.error("error listening on circuit address",e),this.onError(e)}return!1})));n.includes(!0)&&this.listenRelays.add(t)}catch(e){this.onError(e),this.listenRelays.delete(t)}}async _removeListenRelay(e){this.listenRelays.delete(e)&&await this._listenOnAvailableHopRelays([e])}async _listenOnAvailableHopRelays(e=[]){if(this.listenRelays.size>=this.maxListeners)return;const t=[],r=await this.components.peerStore.all();for(const{id:n,metadata:s}of r){const r=n.toString();if(this.listenRelays.has(r))continue;if(e.includes(r))continue;const i=s.get(Px);if(null==i||ni(i)!==Nx)continue;const o=this.components.connectionManager.getConnections(n);if(0!==o.length){if(await this._addListenRelay(o[0],r),this.listenRelays.size>=this.maxListeners)return}else t.push(n)}for(const e of t)if(await this._tryToListenOnRelay(e),this.listenRelays.size>=this.maxListeners)return;try{const e=await Cx(Dx);for await(const t of this.components.contentRouting.findProviders(e)){if(0===t.multiaddrs.length)continue;const e=t.id;if(!e.equals(this.components.peerId)&&(await this.components.peerStore.addressBook.add(e,t.multiaddrs),await this._tryToListenOnRelay(e),this.listenRelays.size>=this.maxListeners))return}}catch(e){this.onError(e)}}async _tryToListenOnRelay(e){try{const t=await this.components.connectionManager.openConnection(e);await this._addListenRelay(t,e.toString())}catch(t){Bx.error("Could not use %p as relay",e,t),this.onError(t,`could not connect and listen on known hop relay ${e.toString()}`)}}}const zx=He("libp2p:relay");class Vx{constructor(e,t){this.components=e,this.autoRelay=!1!==t.autoRelay?.enabled?new Ux(e,{addressSorter:t.addressSorter,...t.autoRelay}):void 0,this.started=!1,this.init=t,this._advertiseService=this._advertiseService.bind(this)}isStarted(){return this.started}async start(){!1!==this.init.hop.enabled&&!1!==this.init.advertise.enabled&&(this.timeout=(0,FO.setDelayedInterval)(this._advertiseService,this.init.advertise.ttl,this.init.advertise.bootDelay)),this.started=!0}async stop(){null!=this.timeout&&(0,FO.clearDelayedInterval)(this.timeout),this.started=!1}async _advertiseService(){try{const e=await Cx(Dx);await this.components.contentRouting.provide(e)}catch(e){e.code===LO.ERR_NO_ROUTERS_AVAILABLE?(zx.error("a content router, such as a DHT, must be provided in order to advertise the relay service",e),await this.stop()):zx.error(e)}}}var Fx=r(7314);r(29222),r(41486);const jx=Ic.pki,Kx=He("libp2p:keychain:cms"),$x=new WeakMap;class Hx{constructor(e,t){if(null==e)throw qe(new Error("keychain is required"),LO.ERR_KEYCHAIN_REQUIRED);this.keychain=e,$x.set(this,{dek:t})}async encrypt(e,t){if(!(t instanceof Uint8Array))throw qe(new Error("Plain data must be a Uint8Array"),LO.ERR_INVALID_PARAMETERS);const r=await this.keychain.findKeyByName(e),n=await this.keychain.getPrivateKey(e),s=$x.get(this);if(null==s)throw qe(new Error("dek missing"),LO.ERR_INVALID_PARAMETERS);const i=s.dek,o=Ic.pki.decryptRsaPrivateKey(n,i),a=await((e,t)=>{const r=jx.rsa.setPublicKey(t.n,t.e),n=jx.createCertificate();n.publicKey=r,n.serialNumber="01",n.validity.notBefore=new Date,n.validity.notAfter=new Date,n.validity.notAfter.setFullYear(n.validity.notBefore.getFullYear()+10);const s=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:e.id}];return n.setSubject(s),n.setIssuer(s),n.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),n.sign(t),n})(r,o),c=Ic.pkcs7.createEnvelopedData();return c.addRecipient(a),c.content=Ic.util.createBuffer(t),c.encrypt(),Xs(Ic.asn1.toDer(c.toAsn1()).getBytes(),"ascii")}async decrypt(e){if(!(e instanceof Uint8Array))throw qe(new Error("CMS data is required"),LO.ERR_INVALID_PARAMETERS);let t;try{const r=Ic.util.createBuffer(ni(e,"ascii")),n=Ic.asn1.fromDer(r);t=Ic.pkcs7.messageFromAsn1(n)}catch(e){throw Kx.error(e),qe(new Error("Invalid CMS"),LO.ERR_INVALID_CMS)}const r=t.recipients.filter((e=>e.issuer.find((e=>"O"===e.shortName&&"ipfs"===e.value)))).filter((e=>e.issuer.find((e=>"CN"===e.shortName)))).map((e=>({recipient:e,keyId:e.issuer.find((e=>"CN"===e.shortName)).value}))),n=await async function(e,t){const r=e.map(t);return e[(await Promise.all(r)).findIndex((e=>e))]}(r,(async e=>{try{if(null!=await this.keychain.findKeyById(e.keyId))return!0}catch(e){return!1}return!1}));if(null==n){const e=r.map((e=>e.keyId));throw qe(new Error(`Decryption needs one of the key(s): ${e.join(", ")}`),LO.ERR_MISSING_KEYS,{missingKeys:e})}const s=await this.keychain.findKeyById(n.keyId);if(null==s)throw qe(new Error("No key available to decrypto"),LO.ERR_NO_KEY);const i=await this.keychain.getPrivateKey(s.name),o=$x.get(this);if(null==o)throw qe(new Error("dek missing"),LO.ERR_INVALID_PARAMETERS);const a=o.dek,c=Ic.pki.decryptRsaPrivateKey(i,a);return t.decrypt(n.recipient,c),Xs(t.content.getBytes(),"ascii")}}const qx=He("libp2p:keychain"),Gx="/info/",Wx=new WeakMap,Yx={dek:{keyLength:64,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function Zx(e){return null!=e&&"string"==typeof e&&e===Fx(e.trim())&&e.length>0}async function Qx(){const e=800*Math.random()+200;await new Promise((t=>setTimeout(t,e)))}function Jx(e){return new Do("/pkcs8/"+e)}function Xx(e){return new Do(Gx+e)}class eL{constructor(e,t){if(this.components=e,this.init=ye(Yx,t),null!=this.init.pass&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(null!=this.init.dek?.keyLength&&this.init.dek.keyLength<14)throw new Error("dek.keyLength must be least 14 bytes");if(null!=this.init.dek?.salt?.length&&this.init.dek.salt.length<16)throw new Error("dek.saltLength must be least 16 bytes");if(null!=this.init.dek?.iterationCount&&this.init.dek.iterationCount<1e3)throw new Error("dek.iterationCount must be least 1000");const r=null!=this.init.pass&&null!=this.init.dek?.salt?IR(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";Wx.set(this,{dek:r}),this.started=!1}isStarted(){return this.started}async start(){const e=Xx("self");await this.components.datastore.has(e)||await this.importPeer("self",this.components.peerId),this.started=!0}stop(){this.started=!1}get cms(){const e=Wx.get(this);if(null==e)throw qe(new Error("dek missing"),LO.ERR_INVALID_PARAMETERS);const t=e.dek;return new Hx(this,t)}static generateOptions(){const e=Object.assign({},Yx),t=3*Math.ceil(16/3);return e.dek.salt=ni(Cl(t),"base64"),e}static get options(){return Yx}async createKey(e,t,r=2048){if(!Zx(e)||"self"===e)throw await Qx(),qe(new Error("Invalid key name"),LO.ERR_INVALID_KEY_NAME);if("string"!=typeof t)throw await Qx(),qe(new Error("Invalid key type"),LO.ERR_INVALID_KEY_TYPE);const n=Jx(e);if(await this.components.datastore.has(n))throw await Qx(),qe(new Error("Key name already exists"),LO.ERR_KEY_ALREADY_EXISTS);if("rsa"===t.toLowerCase()&&(!Number.isSafeInteger(r)||r<2048))throw await Qx(),qe(new Error("Invalid RSA key size"),LO.ERR_INVALID_KEY_SIZE);let s;try{const i=await Xh(t,r),o=await i.id(),a=Wx.get(this);if(null==a)throw qe(new Error("dek missing"),LO.ERR_INVALID_PARAMETERS);const c=a.dek,l=await i.export(c);s={name:e,id:o};const h=this.components.datastore.batch();h.put(n,Xs(l)),h.put(Xx(e),Xs(JSON.stringify(s))),await h.commit()}catch(e){throw await Qx(),e}return s}async listKeys(){const e={prefix:Gx},t=[];for await(const r of this.components.datastore.query(e))t.push(JSON.parse(ni(r.value)));return t}async findKeyById(e){try{return(await this.listKeys()).find((t=>t.id===e))}catch(e){throw await Qx(),e}}async findKeyByName(e){if(!Zx(e))throw await Qx(),qe(new Error(`Invalid key name '${e}'`),LO.ERR_INVALID_KEY_NAME);const t=Xx(e);try{const e=await this.components.datastore.get(t);return JSON.parse(ni(e))}catch(t){throw await Qx(),qx.error(t),qe(new Error(`Key '${e}' does not exist.`),LO.ERR_KEY_NOT_FOUND)}}async removeKey(e){if(!Zx(e)||"self"===e)throw await Qx(),qe(new Error(`Invalid key name '${e}'`),LO.ERR_INVALID_KEY_NAME);const t=Jx(e),r=await this.findKeyByName(e),n=this.components.datastore.batch();return n.delete(t),n.delete(Xx(e)),await n.commit(),r}async renameKey(e,t){if(!Zx(e)||"self"===e)throw await Qx(),qe(new Error(`Invalid old key name '${e}'`),LO.ERR_OLD_KEY_NAME_INVALID);if(!Zx(t)||"self"===t)throw await Qx(),qe(new Error(`Invalid new key name '${t}'`),LO.ERR_NEW_KEY_NAME_INVALID);const r=Jx(e),n=Jx(t),s=Xx(e),i=Xx(t);if(await this.components.datastore.has(n))throw await Qx(),qe(new Error(`Key '${t}' already exists`),LO.ERR_KEY_ALREADY_EXISTS);try{const e=await this.components.datastore.get(r),o=await this.components.datastore.get(s),a=JSON.parse(ni(o));a.name=t;const c=this.components.datastore.batch();return c.put(n,e),c.put(i,Xs(JSON.stringify(a))),c.delete(r),c.delete(s),await c.commit(),a}catch(e){throw await Qx(),e}}async exportKey(e,t){if(!Zx(e))throw await Qx(),qe(new Error(`Invalid key name '${e}'`),LO.ERR_INVALID_KEY_NAME);if(null==t)throw await Qx(),qe(new Error("Password is required"),LO.ERR_PASSWORD_REQUIRED);const r=Jx(e);try{const e=ni(await this.components.datastore.get(r)),n=Wx.get(this);if(null==n)throw qe(new Error("dek missing"),LO.ERR_INVALID_PARAMETERS);const s=n.dek,i=await nu(e,s);return await i.export(t)}catch(e){throw await Qx(),e}}async importKey(e,t,r){if(!Zx(e)||"self"===e)throw await Qx(),qe(new Error(`Invalid key name '${e}'`),LO.ERR_INVALID_KEY_NAME);if(null==t)throw await Qx(),qe(new Error("PEM encoded key is required"),LO.ERR_PEM_REQUIRED);const n=Jx(e);if(await this.components.datastore.has(n))throw await Qx(),qe(new Error(`Key '${e}' already exists`),LO.ERR_KEY_ALREADY_EXISTS);let s,i;try{s=await nu(t,r)}catch(e){throw await Qx(),qe(new Error("Cannot read the key, most likely the password is wrong"),LO.ERR_CANNOT_READ_KEY)}try{i=await s.id();const e=Wx.get(this);if(null==e)throw qe(new Error("dek missing"),LO.ERR_INVALID_PARAMETERS);const r=e.dek;t=await s.export(r)}catch(e){throw await Qx(),e}const o={name:e,id:i},a=this.components.datastore.batch();return a.put(n,Xs(t)),a.put(Xx(e),Xs(JSON.stringify(o))),await a.commit(),o}async importPeer(e,t){try{if(!Zx(e))throw qe(new Error(`Invalid key name '${e}'`),LO.ERR_INVALID_KEY_NAME);if(null==t)throw qe(new Error("PeerId is required"),LO.ERR_MISSING_PRIVATE_KEY);if(null==t.privateKey)throw qe(new Error("PeerId.privKey is required"),LO.ERR_MISSING_PRIVATE_KEY);const r=await ru(t.privateKey),n=Jx(e);if(await this.components.datastore.has(n))throw await Qx(),qe(new Error(`Key '${e}' already exists`),LO.ERR_KEY_ALREADY_EXISTS);const s=Wx.get(this);if(null==s)throw qe(new Error("dek missing"),LO.ERR_INVALID_PARAMETERS);const i=s.dek,o=await r.export(i),a={name:e,id:t.toString()},c=this.components.datastore.batch();return c.put(n,Xs(o)),c.put(Xx(e),Xs(JSON.stringify(a))),await c.commit(),a}catch(e){throw await Qx(),e}}async getPrivateKey(e){if(!Zx(e))throw await Qx(),qe(new Error(`Invalid key name '${e}'`),LO.ERR_INVALID_KEY_NAME);try{const t=Jx(e);return ni(await this.components.datastore.get(t))}catch(t){throw await Qx(),qx.error(t),qe(new Error(`Key '${e}' does not exist.`),LO.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(e,t){if("string"!=typeof e)throw await Qx(),qe(new Error(`Invalid old pass type '${typeof e}'`),LO.ERR_INVALID_OLD_PASS_TYPE);if("string"!=typeof t)throw await Qx(),qe(new Error(`Invalid new pass type '${typeof t}'`),LO.ERR_INVALID_NEW_PASS_TYPE);if(t.length<20)throw await Qx(),qe(new Error(`Invalid pass length ${t.length}`),LO.ERR_INVALID_PASS_LENGTH);qx("recreating keychain");const r=Wx.get(this);if(null==r)throw qe(new Error("dek missing"),LO.ERR_INVALID_PARAMETERS);const n=r.dek;this.init.pass=t;const s=null!=t&&null!=this.init.dek?.salt?IR(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";Wx.set(this,{dek:s});const i=await this.listKeys();for(const e of i){const t=ni(await this.components.datastore.get(Jx(e.name))),r=await nu(t,n),i=s.toString(),o=await r.export(i),a=this.components.datastore.batch(),c={name:e.name,id:e.id};a.put(Jx(e.name),Xs(o)),a.put(Xx(e.name),Xs(JSON.stringify(c))),await a.commit()}qx("keychain reconstructed")}}async function*tL(e,t){for await(const r of e)await t(r),yield r}class rL{constructor(e){if("number"!=typeof e)throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");this.timespan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timespan)}push(e,t){if(null!=this.previousTime){const r=this.alpha(e,this.previousTime),n=t-this.movingAverage,s=r*n;this.movingAverage=r*t+(1-r)*this.movingAverage,this.variance=(1-r)*(this.variance+n*s),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+r*n}else this.movingAverage=t;this.previousTime=e}}function nL(e){return new rL(e)}class sL extends iA{constructor(e){super(),this.enabled=e.enabled,this.queue=[],this.stats={dataReceived:0n,dataSent:0n},this.frequencyLastTime=Date.now(),this.frequencyAccumulators={},this.movingAverages={dataReceived:[],dataSent:[]},this.computeThrottleMaxQueueSize=e.computeThrottleMaxQueueSize,this.computeThrottleTimeout=e.computeThrottleTimeout,this._update=this._update.bind(this),this.movingAverageIntervals=e.movingAverageIntervals;for(let t=0;t<e.initialCounters.length;t++){const r=e.initialCounters[t];this.stats[r]=0n,this.movingAverages[r]=[];for(let e=0;e<this.movingAverageIntervals.length;e++){const t=this.movingAverageIntervals[e];(this.movingAverages[r][t]=nL(t)).push(this.frequencyLastTime,0)}}}start(){this.enabled&&this.queue.length>0&&this._resetComputeTimeout()}stop(){null!=this.timeout&&(this.timeout.clear(),this.timeout=null)}getSnapshot(){return Object.assign({},this.stats)}getMovingAverages(){return Object.assign({},this.movingAverages)}push(e,t){this.queue.push([e,t,Date.now()]),this._resetComputeTimeout()}_resetComputeTimeout(){this.timeout=XO(this._update,this._nextTimeout())}_nextTimeout(){const e=this.queue.length/this.computeThrottleMaxQueueSize;return Math.max(this.computeThrottleTimeout*(1-e),0)}_update(){if(this.timeout=null,this.queue.length>0){let e=["",0,0];for(e of this.queue)this._applyOp(e);this.queue=[],e.length>2&&""!==e[0]&&this._updateFrequency(e[2]),this.dispatchEvent(new aA("update",{detail:this.stats}))}}_updateFrequency(e){const t=e-this.frequencyLastTime;this._updateFrequencyFor("dataReceived",t,e),this._updateFrequencyFor("dataSent",t,e),this.frequencyLastTime=e}_updateFrequencyFor(e,t,r){const n=this.frequencyAccumulators[e]??0;this.frequencyAccumulators[e]=0;const s=n/(t??1)*1e3;let i=this.movingAverages[e];null==i&&(i=this.movingAverages[e]=[]);const o=this.movingAverageIntervals;for(let e=0;e<o.length;e++){const t=o[e];let n=i[t];null==n&&(n=i[t]=nL(t)),n.push(r,s)}}_applyOp(e){const t=e[0],r=e[1];if("number"!=typeof r)throw new Error("invalid increment number");let n;n=Object.prototype.hasOwnProperty.call(this.stats,t)?this.stats[t]:this.stats[t]=0n,this.stats[t]=n+BigInt(r),null==this.frequencyAccumulators[t]&&(this.frequencyAccumulators[t]=0),this.frequencyAccumulators[t]+=r}}const iL=["dataReceived","dataSent"],oL={in:"dataReceived",out:"dataSent"};class aL{constructor(e){this.enabled=e.enabled,this.statsInit={...e,initialCounters:iL},this.globalStats=new sL(this.statsInit),this.peerStats=new Map,this.protocolStats=new Map,this.oldPeers=Qo(e.maxOldPeersRetention??50),this.running=!1,this._onMessage=this._onMessage.bind(this),this.systems=new Map}isStarted(){return this.running}async start(){this.enabled&&(this.running=!0)}async stop(){if(this.running){this.running=!1,this.globalStats.stop();for(const e of this.peerStats.values())e.stop();for(const e of this.protocolStats.values())e.stop()}}getGlobal(){return this.globalStats}getPeers(){return Array.from(this.peerStats.keys())}getComponentMetrics(){return this.systems}updateComponentMetric(e){const{system:t="libp2p",component:r,metric:n,value:s,label:i,help:o}=e;this.systems.has(t)||this.systems.set(t,new Map);const a=this.systems.get(t);if(null==a)throw new Error("Unknown metric system");a.has(r)||a.set(r,new Map);const c=a.get(r);if(null==c)throw new Error("Unknown metric component");c.set(n,{label:i,help:o,calculate:"function"!=typeof s?()=>s:s})}forPeer(e){const t=e.toString();return this.peerStats.get(t)??this.oldPeers.get(t)}getProtocols(){return Array.from(this.protocolStats.keys())}forProtocol(e){return this.protocolStats.get(e)}onPeerDisconnected(e){const t=e.toString(),r=this.peerStats.get(t);null!=r&&(r.stop(),this.peerStats.delete(t),this.oldPeers.set(t,r))}_onMessage(e){if(!this.running)return;const{remotePeer:t,protocol:r,direction:n,dataLength:s}=e,i=oL[n];let o=this.forPeer(t);if(null==o){const e=new sL(this.statsInit);this.peerStats.set(t.toString(),e),o=e}if(o.push(i,s),this.globalStats.push(i,s),null!=r){let e=this.forProtocol(r);if(null==e){const t=new sL(this.statsInit);this.protocolStats.set(r,t),e=t}e.push(i,s)}}updatePlaceholder(e,t){if(!this.running)return;const r=e.toString(),n=this.peerStats.get(r)??this.oldPeers.get(r),s=t.toString(),i=this.peerStats.get(s)??this.oldPeers.get(s);let o=n;var a,c;null!=i&&(c=o,(a=i).stop(),c.stop(),a.queue=[...a.queue,...c.queue],o=a,this.oldPeers.remove(s)),this.peerStats.delete(e.toString()),this.peerStats.set(s,o),o.start()}trackStream(e){const{stream:t,remotePeer:r,protocol:n}=e;if(!this.running)return;const s=t.source;t.source=tL(s,(e=>this._onMessage({remotePeer:r,protocol:n,direction:"in",dataLength:e.byteLength})));const i=t.sink;t.sink=async e=>await Xu(e,(e=>tL(e,(e=>{this._onMessage({remotePeer:r,protocol:n,direction:"out",dataLength:e.byteLength})}))),i)}}async function cL(e){try{return{status:"fulfilled",value:await e,isFulfilled:!0,isRejected:!1}}catch(e){return{status:"rejected",reason:e,isFulfilled:!1,isRejected:!0}}}class lL{value;next;constructor(e){this.value=e}}class hL{#e;#t;#r;constructor(){this.clear()}enqueue(e){const t=new lL(e);this.#e?(this.#t.next=t,this.#t=t):(this.#e=t,this.#t=t),this.#r++}dequeue(){const e=this.#e;if(e)return this.#e=this.#e.next,this.#r--,e.value}clear(){this.#e=void 0,this.#t=void 0,this.#r=0}get size(){return this.#r}*[Symbol.iterator](){let e=this.#e;for(;e;)yield e.value,e=e.next}}function uL(e){if(!Number.isInteger(e)&&e!==Number.POSITIVE_INFINITY||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=new hL;let r=0;const n=async(e,n,s)=>{r++;const i=(async()=>e(...s))();n(i);try{await i}catch{}r--,t.size>0&&t.dequeue()()},s=(s,...i)=>new Promise((o=>{((s,i,o)=>{t.enqueue(n.bind(void 0,s,i,o)),(async()=>{await Promise.resolve(),r<e&&t.size>0&&t.dequeue()()})()})(s,o,i)}));return Object.defineProperties(s,{activeCount:{get:()=>r},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear()}}}),s}async function dL(e,t={}){const{concurrency:r=Number.POSITIVE_INFINITY}=t,n=uL(r);return Promise.all(e.map((e=>e&&"function"==typeof e.then?cL(e):cL("function"==typeof e?n((()=>e())):Promise.resolve(e)))))}class pL extends Map{constructor(e){super();const{system:t,component:r,metric:n,metrics:s}=e;this.system=t??"libp2p",this.component=r,this.metric=n,this.metrics=s,this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){const t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metrics.updateComponentMetric({system:this.system,component:this.component,metric:this.metric,value:this.size})}}function fL(e){const{system:t,component:r,metric:n,metrics:s}=e;let i;return i=null!=s?new pL({system:t,component:r,metric:n,metrics:s}):new Map,i}const yL=He("libp2p:transports");class gL extends iA{constructor(e,t={}){super(),this.components=e,this.started=!1,this.transports=new Map,this.listeners=fL({component:"transport-manager",metric:"listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??mL.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(null==t)throw qe(new Error("Transport must have a valid tag"),LO.ERR_INVALID_KEY);if(this.transports.has(t))throw qe(new Error("There is already a transport with this tag"),LO.ERR_DUPLICATE_TRANSPORT);yL("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}async start(){const e=this.components.addressManager.getListenAddrs();await this.listen(e),this.started=!0}async stop(){const e=[];for(const[t,r]of this.listeners)for(yL("closing listeners for %s",t);r.length>0;){const t=r.pop();null!=t&&e.push(t.close())}await Promise.all(e),yL("all listeners closed");for(const e of this.listeners.keys())this.listeners.set(e,[]);this.started=!1}async dial(e,t){const r=this.transportForMultiaddr(e);if(null==r)throw qe(new Error(`No transport available for address ${String(e)}`),LO.ERR_TRANSPORT_UNAVAILABLE);try{return await r.dial(e,{...t,upgrader:this.components.upgrader})}catch(e){throw null==e.code&&(e.code=LO.ERR_TRANSPORT_DIAL_FAILED),e}}getAddrs(){let e=[];for(const t of this.listeners.values())for(const r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}transportForMultiaddr(e){for(const t of this.transports.values())if(t.filter([e]).length>0)return t}async listen(e){if(null==e||0===e.length)return void yL("no addresses were provided for listening, this node is dial only");const t=[];for(const[r,n]of this.transports.entries()){const s=n.filter(e),i=[];for(const e of s){yL("creating listener for %s on %s",r,e);const t=n.createListener({upgrader:this.components.upgrader});let s=this.listeners.get(r);null==s&&(s=[],this.listeners.set(r,s)),s.push(t),t.addEventListener("listening",(()=>{this.dispatchEvent(new aA("listener:listening",{detail:t}))})),t.addEventListener("close",(()=>{this.dispatchEvent(new aA("listener:close",{detail:t}))})),i.push(t.listen(e))}if(0!==i.length){if(null==(await dL(i)).find((e=>e.isFulfilled))&&this.faultTolerance!==mL.NO_FATAL)throw qe(new Error(`Transport (${r}) could not listen on any available address`),LO.ERR_NO_VALID_ADDRESSES)}else t.push(r)}if(t.length===this.transports.size){const e=`no valid addresses were provided for transports [${t.join(", ")}]`;if(this.faultTolerance===mL.FATAL_ALL)throw qe(new Error(e),LO.ERR_NO_VALID_ADDRESSES);yL(`libp2p in dial mode only: ${e}`)}}async remove(e){yL("removing %s",e);for(const t of this.listeners.get(e)??[])await t.close();this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}var mL;!function(e){e[e.FATAL_ALL=0]="FATAL_ALL",e[e.NO_FATAL=1]="NO_FATAL"}(mL||(mL={}));const wL="/multistream/1.0.0";var bL=r(81608);const vL=Xs("\n");function EL(e){const t=new mp(e,vL);return iT.single(t)}function _L(e,t,r={}){const n=EL(t);!0===r.writeBytes?e.push(n.subarray()):e.push(n)}async function SL(e,t){const r=await async function(e,t){let r=1;const n={[Symbol.asyncIterator]:()=>n,next:async()=>await e.next(r)};let s=n;null!=t?.signal&&(s=tT(n,t.signal));const i=await Xu(s,cT({onLength:e=>{r=e},maxDataLength:1024}),(async e=>await bL(e)));if(null==i||0===i.length)throw qe(new Error("no buffer returned"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");if(i.get(i.byteLength-1)!==vL[0])throw qe(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return i.sublist(0,-1)}(e,t);return ni(r.subarray())}r(76295);const AL=He("libp2p:mss:select");async function IL(e,t,r={}){t=Array.isArray(t)?[...t]:[t];const{reader:n,writer:s,rest:i,stream:o}=_x(e),a=t.shift();if(null==a)throw new Error("At least one protocol must be specified");AL('select: write ["%s", "%s"]',wL,a),function(e,t,r={}){const n=new mp;for(const e of t)n.append(EL(e));!0===r.writeBytes?e.push(n.subarray()):e.push(n)}(s,[Xs(wL),Xs(a)],r);let c=await SL(n,r);if(AL('select: read "%s"',c),c===wL&&(c=await SL(n,r),AL('select: read "%s"',c)),c===a)return i(),{stream:o,protocol:a};for(const e of t){AL('select: write "%s"',e),_L(s,Xs(e),r);const t=await SL(n,r);if(AL('select: read "%s" for "%s"',t,e),t===e)return i(),{stream:o,protocol:e}}throw i(),qe(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")}const RL=He("libp2p:mss:handle");async function kL(e,t,r){t=Array.isArray(t)?t:[t];const{writer:n,reader:s,rest:i,stream:o}=_x(e);for(;;){const e=await SL(s,r);if(RL('read "%s"',e),e!==wL){if(t.includes(e))return _L(n,Xs(e),r),RL('respond with "%s" for "%s"',e,e),i(),{stream:o,protocol:e};"ls"!==e?(_L(n,Xs("na"),r),RL('respond with "na" for "%s"',e)):(_L(n,new mp(...t.map((e=>EL(Xs(e))))),r),RL('respond with "%s" for %s',t,e))}else RL('respond with "%s" for "%s"',wL,e),_L(n,Xs(wL),r)}}var TL=r(97975);const CL=Symbol.for("@libp2p/connection"),PL=He("libp2p:connection");class NL{constructor(e){const{remoteAddr:t,remotePeer:r,newStream:n,close:s,getStreams:i,stat:o}=e;this.id=`${parseInt(String(1e9*Math.random())).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=r,this.stat={...o,status:ex},this._newStream=n,this._close=s,this._getStreams=i,this.tags=[],this._closing=!1}get[Symbol.toStringTag](){return"Connection"}get[CL](){return!0}get streams(){return this._getStreams()}async newStream(e,t){if(this.stat.status===tx)throw qe(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===rx)throw qe(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(e)||(e=[e]);const r=await this._newStream(e,t);return r.stat.direction="outbound",r}addStream(e){e.stat.direction="inbound"}removeStream(e){}async close(){if(this.stat.status!==rx&&!this._closing){this.stat.status=tx;try{this.streams.forEach((e=>e.close()))}catch(e){PL.error(e)}this._closing=!0,await this._close(),this._closing=!1,this.stat.timeline.close=Date.now(),this.stat.status=rx}}}const DL=He("libp2p:registrar");class OL{constructor(e){this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onProtocolChange=this._onProtocolChange.bind(this),this.components.connectionManager.addEventListener("peer:disconnect",this._onDisconnect),this.components.peerStore.addEventListener("change:protocols",this._onProtocolChange)}getProtocols(){return Array.from(new Set([...this.topologies.keys(),...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(null==t)throw qe(new Error(`No handler registered for protocol ${e}`),LO.ERR_NO_HANDLER_FOR_PROTOCOL);return t}getTopologies(e){const t=this.topologies.get(e);return null==t?[]:[...t.values()]}async handle(e,t,r){if(this.handlers.has(e))throw qe(new Error(`Handler already registered for protocol ${e}`),LO.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);const n=ye.bind({ignoreUndefined:!0})({maxInboundStreams:32,maxOutboundStreams:64},r);this.handlers.set(e,{handler:t,options:n}),await this.components.peerStore.protoBook.add(this.components.peerId,[e])}async unhandle(e){const t=Array.isArray(e)?e:[e];t.forEach((e=>{this.handlers.delete(e)})),await this.components.peerStore.protoBook.remove(this.components.peerId,t)}async register(e,t){if(null==(r=t)||!Boolean(r[XS]))throw DL.error("topology must be an instance of interfaces/topology"),qe(new Error("topology must be an instance of interfaces/topology"),LO.ERR_INVALID_PARAMETERS);var r;const n=`${(1e9*Math.random()).toString(36)}${Date.now()}`;let s=this.topologies.get(e);return null==s&&(s=new Map,this.topologies.set(e,s)),s.set(n,t),await t.setRegistrar(this),n}unregister(e){for(const[t,r]of this.topologies.entries())r.has(e)&&(r.delete(e),0===r.size&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.protoBook.get(t.remotePeer).then((e=>{for(const r of e){const e=this.topologies.get(r);if(null!=e)for(const r of e.values())r.onDisconnect(t.remotePeer)}})).catch((e=>{DL.error(e)}))}_onProtocolChange(e){const{peerId:t,protocols:r,oldProtocols:n}=e.detail,s=n.filter((e=>!r.includes(e))),i=r.filter((e=>!n.includes(e)));for(const e of s){const r=this.topologies.get(e);if(null!=r)for(const e of r.values())e.onDisconnect(t)}for(const e of i){const r=this.topologies.get(e);if(null!=r)for(const e of r.values()){const r=this.components.connectionManager.getConnections(t)[0];null!=r&&e.onConnect(t,r)}}}}const xL=He("libp2p:upgrader");function LL(e,t,r){let n=0;return r.streams.forEach((r=>{r.stat.direction===t&&r.stat.protocol===e&&n++})),n}class BL extends iA{constructor(e,t){super(),this.components=e,this.connectionEncryption=new Map,t.connectionEncryption.forEach((e=>{this.connectionEncryption.set(e.protocol,e)})),this.muxers=new Map,t.muxers.forEach((e=>{this.muxers.set(e.protocol,e)})),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout}async upgradeInbound(e){if(!await this.components.connectionManager.acceptIncomingConnection(e))throw qe(new Error("connection denied"),LO.ERR_CONNECTION_DENIED);let t,r,n,s,i,o,a;const c=this.components.metrics,l=new ei.TimeoutController(this.inboundUpgradeTimeout);try{(0,jO.setMaxListeners)?.(1/0,l.signal)}catch{}try{const h=nT(e,l.signal);if(e.source=h.source,e.sink=h.sink,await this.components.connectionGater.denyInboundConnection(e))throw qe(new Error("The multiaddr connection is blocked by gater.acceptConnection"),LO.ERR_CONNECTION_INTERCEPTED);if(null!=c){({setTarget:o,proxy:a}=TL());const t=`${(1e9*Math.random()).toString(36)}${Date.now()}`;o({toString:()=>t}),c.trackStream({stream:e,remotePeer:a})}xL("starting the inbound connection upgrade");let u=e;const d=this.components.connectionProtector;null!=d&&(xL("protecting the inbound connection"),u=await d.protect(e));try{if(({conn:t,remotePeer:r,protocol:i}=await this._encryptInbound(u)),await this.components.connectionGater.denyInboundEncryptedConnection(r,{...u,...t}))throw qe(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),LO.ERR_CONNECTION_INTERCEPTED);if(this.muxers.size>0){const e=await this._multiplexInbound({...u,...t},this.muxers);s=e.muxerFactory,n=e.stream}else n=t}catch(e){throw xL.error("Failed to upgrade inbound connection",e),e}if(await this.components.connectionGater.denyInboundUpgradedConnection(r,{...u,...t}))throw qe(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),LO.ERR_CONNECTION_INTERCEPTED);return null!=c&&(c.updatePlaceholder(a,r),o(r)),xL("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:i,direction:"inbound",maConn:e,upgradedConn:n,muxerFactory:s,remotePeer:r})}finally{this.components.connectionManager.afterUpgradeInbound(),l.clear()}}async upgradeOutbound(e,t){const r=e.remoteAddr.getPeerId();if(null==r)throw qe(new Error("outbound connection must have a peer id"),LO.ERR_INVALID_MULTIADDR);const n=Za(r);if(await this.components.connectionGater.denyOutboundConnection(n,e))throw qe(new Error("The multiaddr connection is blocked by connectionGater.denyOutboundConnection"),LO.ERR_CONNECTION_INTERCEPTED);let s,i,o,a,c,l,h;const u=this.components.metrics;if(null!=u){({setTarget:l,proxy:h}=TL());const t=`${(1e9*Math.random()).toString(36)}${Date.now()}`;l({toB58String:()=>t}),u.trackStream({stream:e,remotePeer:h})}xL("Starting the outbound connection upgrade");let d=e;if(!0!==t?.skipProtection){const t=this.components.connectionProtector;null!=t&&(d=await t.protect(e))}try{if(s=d,!0!==t?.skipEncryption){if(({conn:s,remotePeer:i,protocol:a}=await this._encryptOutbound(d,n)),await this.components.connectionGater.denyOutboundEncryptedConnection(i,{...d,...s}))throw qe(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),LO.ERR_CONNECTION_INTERCEPTED)}else a="native",i=n;if(o=s,null!=t?.muxerFactory)c=t.muxerFactory;else if(this.muxers.size>0){const e=await this._multiplexOutbound({...d,...s},this.muxers);c=e.muxerFactory,o=e.stream}}catch(t){throw xL.error("Failed to upgrade outbound connection",t),await e.close(t),t}if(await this.components.connectionGater.denyOutboundUpgradedConnection(i,{...d,...s}))throw qe(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),LO.ERR_CONNECTION_INTERCEPTED);return null!=u&&(u.updatePlaceholder(h,i),l(i)),xL("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:a,direction:"outbound",maConn:e,upgradedConn:o,muxerFactory:c,remotePeer:i})}_createConnection(e){const{cryptoProtocol:t,direction:r,maConn:n,upgradedConn:s,remotePeer:i,muxerFactory:o}=e;let a,c,l;null!=o&&(a=o.createStreamMuxer({direction:r,onIncomingStream:e=>{null!=l&&Promise.resolve().then((async()=>{const t=this.components.registrar.getProtocols(),{stream:n,protocol:s}=await kL(e,t);xL("%s: incoming stream opened on %s",r,s);const o=this.components.metrics;if(null!=o&&o.trackStream({stream:n,remotePeer:i,protocol:s}),null==l)return;const a=function(e,t){try{const{options:r}=t.getHandler(e);return r.maxInboundStreams}catch(e){if(e.code!==LO.ERR_NO_HANDLER_FOR_PROTOCOL)throw e}return 32}(s,this.components.registrar);LL(s,"inbound",l)!==a?(e.source=n.source,e.sink=n.sink,e.stat.protocol=s,this.components.peerStore.protoBook.add(i,[s]).catch((e=>xL.error(e))),l.addStream(e),this._onStream({connection:l,stream:e,protocol:s})):e.abort(qe(new Error(`Too many inbound protocol streams for protocol "${s}" - limit ${a}`),LO.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS))})).catch((t=>{xL.error(t),null==e.stat.timeline.close&&e.close()}))},onStreamEnd:e=>{l?.removeStream(e.id)}}),c=async(e,t={})=>{if(null==a)throw qe(new Error("Stream is not multiplexed"),LO.ERR_MUXER_UNAVAILABLE);xL("%s: starting new stream on %s",r,e);const n=await a.newStream(),s=this.components.metrics;let o;try{if(null==t.signal){xL("No abort signal was passed while trying to negotiate protocols %s falling back to default timeout",e),o=new ei.TimeoutController(3e4),t.signal=o.signal;try{(0,jO.setMaxListeners)?.(1/0,o.signal)}catch{}}const{stream:r,protocol:a}=await IL(n,e,t);null!=s&&s.trackStream({stream:r,remotePeer:i,protocol:a});const c=function(e,t){try{const{options:r}=t.getHandler(e);return r.maxOutboundStreams}catch(e){if(e.code!==LO.ERR_NO_HANDLER_FOR_PROTOCOL)throw e}return 64}(a,this.components.registrar);if(LL(a,"outbound",l)===c){const e=qe(new Error(`Too many outbound protocol streams for protocol "${a}" - limit ${c}`),LO.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw n.abort(e),e}return this.components.peerStore.protoBook.add(i,[a]).catch((e=>xL.error(e))),n.source=r.source,n.sink=r.sink,n.stat.protocol=a,n}catch(e){if(xL.error("could not create new stream",e),null==n.stat.timeline.close&&n.close(),null!=e.code)throw e;throw qe(e,LO.ERR_UNSUPPORTED_PROTOCOL)}finally{null!=o&&o.clear()}},Xu(s,a,s).catch(xL.error));const h=n.timeline;n.timeline=new Proxy(h,{set:(...e)=>(null!=l&&"close"===e[1]&&null!=e[2]&&null==h.close&&(async()=>{try{"OPEN"===l.stat.status&&await l.close()}catch(e){xL.error(e)}finally{this.dispatchEvent(new aA("connectionEnd",{detail:l}))}})().catch((e=>{xL.error(e)})),Reflect.set(...e))}),n.timeline.upgraded=Date.now();const u=()=>{throw qe(new Error("connection is not multiplexed"),LO.ERR_CONNECTION_NOT_MULTIPLEXED)};var d;return d={remoteAddr:n.remoteAddr,remotePeer:i,stat:{status:"OPEN",direction:r,timeline:n.timeline,multiplexer:a?.protocol,encryption:t},newStream:c??u,getStreams:()=>null!=a?a.streams:u(),close:async()=>{await n.close(),null!=a&&a.close()}},l=new NL(d),this.dispatchEvent(new aA("connection",{detail:l})),l}_onStream(e){const{connection:t,stream:r,protocol:n}=e,{handler:s}=this.components.registrar.getHandler(n);s({connection:t,stream:r})}async _encryptInbound(e){const t=Array.from(this.connectionEncryption.keys());xL("handling inbound crypto protocol selection",t);try{const{stream:r,protocol:n}=await kL(e,t,{writeBytes:!0}),s=this.connectionEncryption.get(n);if(null==s)throw new Error(`no crypto module found for ${n}`);return xL("encrypting inbound connection..."),{...await s.secureInbound(this.components.peerId,r),protocol:n}}catch(e){throw qe(e,LO.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t){const r=Array.from(this.connectionEncryption.keys());xL("selecting outbound crypto protocol",r);try{const{stream:n,protocol:s}=await IL(e,r,{writeBytes:!0}),i=this.connectionEncryption.get(s);if(null==i)throw new Error(`no crypto module found for ${s}`);return xL("encrypting outbound connection to %p",t),{...await i.secureOutbound(this.components.peerId,n,t),protocol:s}}catch(e){throw qe(e,LO.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){const r=Array.from(t.keys());xL("outbound selecting muxer %s",r);try{const{stream:n,protocol:s}=await IL(e,r,{writeBytes:!0});return xL("%s selected as muxer protocol",s),{stream:n,muxerFactory:t.get(s)}}catch(e){throw xL.error("error multiplexing outbound stream",e),qe(e,LO.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){const r=Array.from(t.keys());xL("inbound handling muxers %s",r);try{const{stream:n,protocol:s}=await kL(e,r,{writeBytes:!0});return{stream:n,muxerFactory:t.get(s)}}catch(e){throw xL.error("error multiplexing inbound stream",e),qe(e,LO.ERR_MUXER_UNAVAILABLE)}}}var ML;!function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.protocolVersion&&(t.uint32(42),t.string(e.protocolVersion)),null!=e.agentVersion&&(t.uint32(50),t.string(e.agentVersion)),null!=e.publicKey&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.listenAddrs)for(const r of e.listenAddrs)t.uint32(18),t.bytes(r);if(null!=e.observedAddr&&(t.uint32(34),t.bytes(e.observedAddr)),null!=e.protocols)for(const r of e.protocols)t.uint32(26),t.string(r);null!=e.signedPeerRecord&&(t.uint32(66),t.bytes(e.signedPeerRecord)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={listenAddrs:[],protocols:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 5:r.protocolVersion=e.string();break;case 6:r.agentVersion=e.string();break;case 1:r.publicKey=e.bytes();break;case 2:r.listenAddrs.push(e.bytes());break;case 4:r.observedAddr=e.bytes();break;case 3:r.protocols.push(e.string());break;case 8:r.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(ML||(ML={}));const UL="js-libp2p/0.0.0",zL=He("libp2p:identify");class VL{constructor(e,t){this.components=e,this.started=!1,this.init=t,this.identifyProtocolStr=`/${t.protocolPrefix}/id/1.0.0`,this.identifyPushProtocolStr=`/${t.protocolPrefix}/id/push/1.0.0`,this.host={protocolVersion:`${t.protocolPrefix}/0.1.0`,...t.host},this.components.connectionManager.addEventListener("peer:connect",(e=>{const t=e.detail;this.identify(t).catch(zL.error)})),this.components.peerStore.addEventListener("change:multiaddrs",(e=>{const{peerId:t}=e.detail;this.components.peerId.equals(t)&&this.pushToPeerStore().catch((e=>zL.error(e)))})),this.components.peerStore.addEventListener("change:protocols",(e=>{const{peerId:t}=e.detail;this.components.peerId.equals(t)&&this.pushToPeerStore().catch((e=>zL.error(e)))}))}isStarted(){return this.started}async start(){this.started||(await this.components.peerStore.metadataBook.setValue(this.components.peerId,"AgentVersion",Xs(this.host.agentVersion)),await this.components.peerStore.metadataBook.setValue(this.components.peerId,"ProtocolVersion",Xs(this.host.protocolVersion)),await this.components.registrar.handle(this.identifyProtocolStr,(e=>{this._handleIdentify(e).catch((e=>{zL.error(e)}))}),{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),await this.components.registrar.handle(this.identifyPushProtocolStr,(e=>{this._handlePush(e).catch((e=>{zL.error(e)}))}),{maxInboundStreams:this.init.maxPushIncomingStreams,maxOutboundStreams:this.init.maxPushOutgoingStreams}),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.identifyProtocolStr),await this.components.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async push(e){const t=await this.components.peerStore.addressBook.getRawEnvelope(this.components.peerId),r=this.components.addressManager.getAddresses().map((e=>e.bytes)),n=await this.components.peerStore.protoBook.get(this.components.peerId),s=e.map((async e=>{let s;const i=new ei.TimeoutController(this.init.timeout);try{(0,jO.setMaxListeners)?.(1/0,i.signal)}catch{}try{s=await e.newStream([this.identifyPushProtocolStr],{signal:i.signal});const o=nT(s,i.signal);await o.sink(Xu([ML.encode({listenAddrs:r,signedPeerRecord:t,protocols:n})],iT()))}catch(e){zL.error("could not push identify update to peer",e)}finally{null!=s&&s.close(),i.clear()}}));await Promise.all(s)}async pushToPeerStore(){if(!this.isStarted())return;const e=[];for(const t of this.components.connectionManager.getConnections()){const r=t.remotePeer;(await this.components.peerStore.get(r)).protocols.includes(this.identifyPushProtocolStr)&&e.push(t)}await this.push(e)}async _identify(e,t={}){let r,n,s=t.signal;if(null==s){r=new ei.TimeoutController(this.init.timeout),s=r.signal;try{(0,jO.setMaxListeners)?.(1/0,r.signal)}catch{}}try{n=await e.newStream([this.identifyProtocolStr],{signal:s});const t=nT(n,s),i=await Xu([],t,cT({maxDataLength:this.init.maxIdentifyMessageSize??8192}),(async e=>await Lw(e)));if(null==i)throw qe(new Error("No data could be retrieved"),LO.ERR_CONNECTION_ENDED);try{return ML.decode(i)}catch(e){throw qe(e,LO.ERR_INVALID_MESSAGE)}}finally{null!=r&&r.clear(),null!=n&&n.close()}}async identify(e,t={}){const r=await this._identify(e,t),{publicKey:n,listenAddrs:s,protocols:i,observedAddr:o,signedPeerRecord:a,agentVersion:c,protocolVersion:l}=r;if(null==n)throw qe(new Error("public key was missing from identify message"),LO.ERR_MISSING_PUBLIC_KEY);const h=await Ja(n);if(!e.remotePeer.equals(h))throw qe(new Error("identified peer does not match the expected peer"),LO.ERR_INVALID_PEER);if(this.components.peerId.equals(h))throw qe(new Error("identified peer is our own peer id?"),LO.ERR_INVALID_PEER);const u=VL.getCleanMultiaddr(o);if(null!=a){zL("received signed peer record from %p",h);try{const e=await WS.openAndCertify(a,JS.DOMAIN);if(!e.peerId.equals(h))throw qe(new Error("identified peer does not match the expected peer"),LO.ERR_INVALID_PEER);if(await this.components.peerStore.addressBook.consumePeerRecord(e))return await this.components.peerStore.protoBook.set(h,i),null!=c&&await this.components.peerStore.metadataBook.setValue(h,"AgentVersion",Xs(c)),null!=l&&await this.components.peerStore.metadataBook.setValue(h,"ProtocolVersion",Xs(l)),void zL("identify completed for peer %p and protocols %o",h,i)}catch(e){zL("received invalid envelope, discard it and fallback to listenAddrs is available",e)}}else zL("no signed peer record received from %p",h);zL("falling back to legacy addresses from %p",h);try{await this.components.peerStore.addressBook.set(h,s.map((e=>Ki(e))))}catch(e){zL.error("received invalid addrs",e)}await this.components.peerStore.protoBook.set(h,i),null!=c&&await this.components.peerStore.metadataBook.setValue(h,"AgentVersion",Xs(c)),null!=l&&await this.components.peerStore.metadataBook.setValue(h,"ProtocolVersion",Xs(l)),zL("identify completed for peer %p and protocols %o",h,i),zL("received observed address of %s",u?.toString())}async _handleIdentify(e){const{connection:t,stream:r}=e,n=new ei.TimeoutController(this.init.timeout);try{(0,jO.setMaxListeners)?.(1/0,n.signal)}catch{}try{const e=this.components.peerId.publicKey??new Uint8Array(0),s=await this.components.peerStore.get(this.components.peerId),i=this.components.addressManager.getAddresses().map((e=>e.decapsulateCode(hi("p2p").code)));let o=s.peerRecordEnvelope;if(i.length>0&&null==o){const e=new JS({peerId:this.components.peerId,multiaddrs:i}),t=await WS.seal(e,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(t),o=t.marshal().subarray()}const a=ML.encode({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:e,listenAddrs:i.map((e=>e.bytes)),signedPeerRecord:o,observedAddr:t.remoteAddr.bytes,protocols:s.protocols}),c=nT(r,n.signal),l=Xu([a],iT());await c.sink(l)}catch(e){zL.error("could not respond to identify request",e)}finally{r.close(),n.clear()}}async _handlePush(e){const{connection:t,stream:r}=e,n=new ei.TimeoutController(this.init.timeout);try{(0,jO.setMaxListeners)?.(1/0,n.signal)}catch{}let s;try{const e=nT(r,n.signal),t=await Xu([],e,cT({maxDataLength:this.init.maxIdentifyMessageSize??8192}),(async e=>await Lw(e)));null!=t&&(s=ML.decode(t))}catch(e){return zL.error("received invalid message",e)}finally{r.close(),n.clear()}if(null==s)return zL.error("received invalid message");const i=t.remotePeer;if(this.components.peerId.equals(i))zL("received push from ourselves?");else{if(zL("received push from %p",i),null!=s.signedPeerRecord){zL("received signedPeerRecord in push");try{const e=await WS.openAndCertify(s.signedPeerRecord,JS.DOMAIN);if(await this.components.peerStore.addressBook.consumePeerRecord(e))return zL("consumed signedPeerRecord sent in push"),void await this.components.peerStore.protoBook.set(i,s.protocols);zL("failed to consume signedPeerRecord sent in push")}catch(e){zL("received invalid envelope, discard it and fallback to listenAddrs is available",e)}}else zL("did not receive signedPeerRecord in push");try{await this.components.peerStore.addressBook.set(i,s.listenAddrs.map((e=>Ki(e))))}catch(e){zL.error("received invalid addrs",e)}try{await this.components.peerStore.protoBook.set(i,s.protocols)}catch(e){zL.error("received invalid protocols",e)}zL("handled push from %p",i)}}static getCleanMultiaddr(e){if(null!=e&&e.length>0)try{return Ki(e)}catch{}}}var FL,jL;!function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),!0!==r.writeDefaults&&""===e.identifier||(t.uint32(10),t.string(e.identifier)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={identifier:""},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();t>>>3==1?r.identifier=e.string():e.skipType(7&t)}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(FL||(FL={})),function(e){let t,r,n;!function(e){e.OK="OK",e.NOT_FOUND="NOT_FOUND",e.ERROR="ERROR"}(t=e.StatusCode||(e.StatusCode={})),function(e){e[e.OK=0]="OK",e[e.NOT_FOUND=1]="NOT_FOUND",e[e.ERROR=2]="ERROR"}(r||(r={})),function(e){e.codec=()=>Sc(r)}(t=e.StatusCode||(e.StatusCode={})),e.codec=()=>(null==n&&(n=Ac(((t,n,s={})=>{!1!==s.lengthDelimited&&n.fork(),(!0===s.writeDefaults||null!=t.status&&0!==r[t.status])&&(n.uint32(8),e.StatusCode.codec().encode(t.status,n)),(!0===s.writeDefaults||null!=t.data&&t.data.byteLength>0)&&(n.uint32(18),n.bytes(t.data)),!1!==s.lengthDelimited&&n.ldelim()}),((r,n)=>{const s={status:t.OK,data:new Uint8Array(0)},i=null==n?r.len:r.pos+n;for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:s.status=e.StatusCode.codec().decode(r);break;case 2:s.data=r.bytes();break;default:r.skipType(7&t)}}return s}))),n),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(jL||(jL={}));const KL=He("libp2p:fetch");class $L{constructor(e,t){this.started=!1,this.components=e,this.protocol=`/${t.protocolPrefix??"libp2p"}/fetch/0.0.1`,this.lookupFunctions=new Map,this.handleMessage=this.handleMessage.bind(this),this.init=t}async start(){await this.components.registrar.handle(this.protocol,(e=>{this.handleMessage(e).catch((e=>{KL.error(e)})).finally((()=>{e.stream.close()}))}),{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}async fetch(e,t,r={}){KL("dialing %s to %p",this.protocol,e);const n=await this.components.connectionManager.openConnection(e,r);let s,i,o=r.signal;if(null==o){s=new ei.TimeoutController(this.init.timeout),o=s.signal;try{(0,jO.setMaxListeners)?.(1/0,s.signal)}catch{}}try{i=await n.newStream([this.protocol],{signal:o});const e=nT(i,o),r=await Xu([FL.encode({identifier:t})],iT(),e,cT(),(async function(e){const t=await Lw(e);if(null==t)throw qe(new Error("No data received"),LO.ERR_INVALID_MESSAGE);const r=jL.decode(t);switch(r.status){case jL.StatusCode.OK:return r.data;case jL.StatusCode.NOT_FOUND:return null;case jL.StatusCode.ERROR:{const e=(new TextDecoder).decode(r.data);throw qe(new Error("Error in fetch protocol response: "+e),LO.ERR_INVALID_PARAMETERS)}default:throw qe(new Error("Unknown response status"),LO.ERR_INVALID_MESSAGE)}}));return r??null}finally{null!=s&&s.clear(),null!=i&&i.close()}}async handleMessage(e){const{stream:t}=e,r=this;await Xu(t,cT(),(async function*(e){const t=await Lw(e);if(null==t)throw qe(new Error("No data received"),LO.ERR_INVALID_MESSAGE);const n=FL.decode(t);let s;const i=r._getLookupFunction(n.identifier);if(null!=i){const e=await i(n.identifier);s=null!=e?{status:jL.StatusCode.OK,data:e}:{status:jL.StatusCode.NOT_FOUND,data:new Uint8Array(0)}}else{const e=(new TextEncoder).encode("No lookup function registered for key: "+n.identifier);s={status:jL.StatusCode.ERROR,data:e}}yield jL.encode(s)}),iT(),t)}_getLookupFunction(e){for(const t of this.lookupFunctions.keys())if(e.startsWith(t))return this.lookupFunctions.get(t)}registerLookupFunction(e,t){if(this.lookupFunctions.has(e))throw qe(new Error("Fetch protocol handler for key prefix '"+e+"' already registered"),LO.ERR_KEY_ALREADY_EXISTS);this.lookupFunctions.set(e,t)}unregisterLookupFunction(e,t){null!=t&&this.lookupFunctions.get(e)!==t||this.lookupFunctions.delete(e)}}const HL=He("libp2p:ping");class qL{constructor(e,t){this.components=e,this.started=!1,this.protocol=`/${t.protocolPrefix}/ping/1.0.0`,this.init=t}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){const{stream:t}=e;Xu(t,t).catch((e=>{HL.error(e)}))}async ping(e,t={}){HL("dialing %s to %p",this.protocol,e);const r=Date.now(),n=Cl(32),s=await this.components.connectionManager.openConnection(e,t);let i,o,a=t.signal;if(null==a){i=new ei.TimeoutController(this.init.timeout),a=i.signal;try{(0,jO.setMaxListeners)?.(1/0,i.signal)}catch{}}try{o=await s.newStream([this.protocol],{signal:a});const e=nT(o,a),t=await Xu([n],e,(async e=>await Lw(e))),c=Date.now();if(null==t||!Ti(n,t.subarray()))throw qe(new Error("Received wrong ping ack"),LO.ERR_WRONG_PING_ACK);return c-r}finally{null!=i&&i.clear(),null!=o&&o.close()}}}var GL=r(66830);const WL="object"==typeof window&&"object"==typeof document&&9===document.nodeType,YL=GL(),ZL=WL&&!YL,QL=YL&&!WL,JL=YL&&WL,XL=void 0!==globalThis.process&&void 0!==globalThis.process.release&&"node"===globalThis.process.release.name&&!YL,eB="function"==typeof importScripts&&"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,tB=(void 0!==globalThis.process&&void 0!==globalThis.process.env&&globalThis.process.env.NODE_ENV,"undefined"!=typeof navigator&&"ReactNative"===navigator.product);function rB(e){const{address:t}=e.nodeAddress();return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r=t)||/^::1$/.test(r);var r}const nB=He("libp2p:nat");function sB(e=1024,t=65535){return Math.floor(Math.random()*(t-e+1)+e)}class iB{constructor(e,t){if(this.components=e,this.started=!1,this.enabled=t.enabled,this.externalAddress=t.externalAddress,this.localAddress=t.localAddress,this.description=t.description??`libp2p@0.0.0 ${this.components.peerId.toString()}`,this.ttl=t.ttl??7200,this.keepAlive=t.keepAlive??!0,this.gateway=t.gateway,this.ttl<7200)throw qe(new Error("NatManager ttl should be at least 7200 seconds"),LO.ERR_INVALID_PARAMETERS)}isStarted(){return this.started}start(){}afterStart(){ZL||!this.enabled||this.started||(this.started=!0,this._start().catch((e=>{nB.error(e)})))}async _start(){const e=this.components.transportManager.getAddrs();for(const t of e){const{family:e,host:r,port:n,transport:s}=t.toOptions();if(!t.isThinWaistAddress()||"tcp"!==s)continue;if(rB(t))continue;if(4!==e)continue;const i=await this._getClient(),o=this.externalAddress??await i.externalIp();if(Ox(o))throw new Error(`${o} is private - please set config.nat.externalIp to an externally routable IP or ensure you are not behind a double NAT`);const a=sB();nB(`opening uPnP connection from ${o}:${a} to ${r}:${n}`),await i.map({publicPort:a,localPort:n,localAddress:this.localAddress,protocol:"TCP"===s.toUpperCase()?"TCP":"UDP"}),this.components.addressManager.addObservedAddr(Vi({family:4,address:o,port:a},s))}}async _getClient(){return null!=this.client||(this.client=await async function(){throw new Error("Not supported in browsers")}((this.description,this.ttl,this.keepAlive,this.gateway))),this.client}async stop(){if(!ZL&&null!=this.client)try{await this.client.close(),this.client=void 0}catch(e){nB.error(e)}}}const oB=He("libp2p:peer-record-updater");class aB{constructor(e){this.components=e,this.started=!1,this.update=this.update.bind(this)}isStarted(){return this.started}async start(){this.started=!0,this.components.transportManager.addEventListener("listener:listening",this.update),this.components.transportManager.addEventListener("listener:close",this.update),this.components.addressManager.addEventListener("change:addresses",this.update)}async stop(){this.started=!1,this.components.transportManager.removeEventListener("listener:listening",this.update),this.components.transportManager.removeEventListener("listener:close",this.update),this.components.addressManager.removeEventListener("change:addresses",this.update)}update(){Promise.resolve().then((async()=>{const e=new JS({peerId:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map((e=>e.decapsulateCode(hi("p2p").code)))}),t=await WS.seal(e,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(t)})).catch((e=>{oB.error("Could not update self peer record: %o",e)}))}}class cB{constructor(e){this.dht=e}async findPeer(e,t={}){for await(const r of this.dht.findPeer(e,t))if("FINAL_PEER"===r.name)return r.peer;throw qe(new Error(xO.NOT_FOUND),LO.ERR_NOT_FOUND)}async*getClosestPeers(e,t={}){for await(const r of this.dht.getClosestPeers(e,t))"FINAL_PEER"===r.name&&(yield r.peer)}}const lB="ERR_INVALID_PARAMETERS",hB="ERR_NOT_FOUND";var uB=r(95623),dB=r(1773),pB=r(20253);const fB=He("libp2p:peer-store:address-book"),yB="change:multiaddrs";async function gB(){return!0}class mB{constructor(e,t,r){this.dispatchEvent=e,this.store=t,this.addressFilter=r??gB}async consumePeerRecord(e){fB.trace("consumePeerRecord await write lock");const t=await this.store.lock.writeLock();let r,n,s;fB.trace("consumePeerRecord got write lock");try{let i;try{i=JS.createFromProtobuf(e.payload)}catch(e){return fB.error("invalid peer record received"),!1}r=i.peerId;const o=i.multiaddrs;if(!r.equals(e.peerId))return fB("signing key does not match PeerId in the PeerRecord"),!1;if(null==o||0===o.length)return!1;if(await this.store.has(r)&&(n=await this.store.load(r),null!=n.peerRecordEnvelope)){const e=await WS.createFromProtobuf(n.peerRecordEnvelope),t=JS.createFromProtobuf(e.payload);if(t.seqNumber>=i.seqNumber)return fB("sequence number was lower or equal to existing sequence number - stored: %d received: %d",t.seqNumber,i.seqNumber),!1}const a=await wB(r,o,this.addressFilter,!0);s=await this.store.patchOrCreate(r,{addresses:a,peerRecordEnvelope:e.marshal().subarray()}),fB("stored provided peer record for %p",i.peerId)}finally{fB.trace("consumePeerRecord release write lock"),t()}return this.dispatchEvent(new aA(yB,{detail:{peerId:r,multiaddrs:s.addresses.map((({multiaddr:e})=>e)),oldMultiaddrs:null==n?[]:n.addresses.map((({multiaddr:e})=>e))}})),!0}async getRawEnvelope(e){fB.trace("getRawEnvelope await read lock");const t=await this.store.lock.readLock();fB.trace("getRawEnvelope got read lock");try{return(await this.store.load(e)).peerRecordEnvelope}catch(e){if(e.code!==hB)throw e}finally{fB.trace("getRawEnvelope release read lock"),t()}}async getPeerRecord(e){const t=await this.getRawEnvelope(e);if(null!=t)return await WS.createFromProtobuf(t)}async get(e){e=Ya(e),fB.trace("get wait for read lock");const t=await this.store.lock.readLock();fB.trace("get got read lock");try{return(await this.store.load(e)).addresses}catch(e){if(e.code!==hB)throw e}finally{fB.trace("get release read lock"),t()}return[]}async set(e,t){if(e=Ya(e),!Array.isArray(t))throw fB.error("multiaddrs must be an array of Multiaddrs"),qe(new Error("multiaddrs must be an array of Multiaddrs"),lB);fB.trace("set await write lock");const r=await this.store.lock.writeLock();fB.trace("set got write lock");let n,s,i=!1;try{const o=await wB(e,t,this.addressFilter);if(0===o.length)return;try{if(n=await this.store.load(e),i=!0,new Set([...o.map((({multiaddr:e})=>e.toString())),...n.addresses.map((({multiaddr:e})=>e.toString()))]).size===n.addresses.length&&o.length===n.addresses.length)return}catch(e){if(e.code!==hB)throw e}s=await this.store.patchOrCreate(e,{addresses:o}),fB("set multiaddrs for %p",e)}finally{fB.trace("set multiaddrs for %p",e),fB("set release write lock"),r()}this.dispatchEvent(new aA(yB,{detail:{peerId:e,multiaddrs:s.addresses.map((e=>e.multiaddr)),oldMultiaddrs:null==n?[]:n.addresses.map((({multiaddr:e})=>e))}})),i||this.dispatchEvent(new aA("peer",{detail:{id:e,multiaddrs:s.addresses.map((e=>e.multiaddr)),protocols:s.protocols}}))}async add(e,t){if(e=Ya(e),!Array.isArray(t))throw fB.error("multiaddrs must be an array of Multiaddrs"),qe(new Error("multiaddrs must be an array of Multiaddrs"),lB);fB.trace("add await write lock");const r=await this.store.lock.writeLock();let n,s,i;fB.trace("add got write lock");try{const o=await wB(e,t,this.addressFilter);if(0===o.length)return;try{if(s=await this.store.load(e),n=!0,new Set([...o.map((({multiaddr:e})=>e.toString())),...s.addresses.map((({multiaddr:e})=>e.toString()))]).size===s.addresses.length)return}catch(e){if(e.code!==hB)throw e}i=await this.store.mergeOrCreate(e,{addresses:o}),fB("added multiaddrs for %p",e)}finally{fB.trace("set release write lock"),r()}this.dispatchEvent(new aA(yB,{detail:{peerId:e,multiaddrs:i.addresses.map((e=>e.multiaddr)),oldMultiaddrs:null==s?[]:s.addresses.map((({multiaddr:e})=>e))}})),!0===n&&this.dispatchEvent(new aA("peer",{detail:{id:e,multiaddrs:i.addresses.map((e=>e.multiaddr)),protocols:i.protocols}}))}async delete(e){e=Ya(e),fB.trace("delete await write lock");const t=await this.store.lock.writeLock();let r;fB.trace("delete got write lock");try{try{r=await this.store.load(e)}catch(e){if(e.code!==hB)throw e}await this.store.patchOrCreate(e,{addresses:[]})}finally{fB.trace("delete release write lock"),t()}null!=r&&this.dispatchEvent(new aA(yB,{detail:{peerId:e,multiaddrs:[],oldMultiaddrs:null==r?[]:r.addresses.map((({multiaddr:e})=>e))}}))}}async function wB(e,t,r,n=!1){return await Xu(t,(e=>pB(e,(e=>{if(!Fi(e))throw fB.error("multiaddr must be an instance of Multiaddr"),qe(new Error("multiaddr must be an instance of Multiaddr"),lB)}))),(t=>Mu(t,(async t=>await r(e,t)))),(e=>dB(e,(e=>({multiaddr:e,isCertified:n})))),(async e=>await uB(e)))}const bB=He("libp2p:peer-store:key-book"),vB="change:pubkey";class EB{constructor(e,t){this.dispatchEvent=e,this.store=t}async set(e,t){if(e=Ya(e),!(t instanceof Uint8Array))throw bB.error("publicKey must be an instance of Uint8Array to store data"),qe(new Error("publicKey must be an instance of PublicKey"),lB);bB.trace("set await write lock");const r=await this.store.lock.writeLock();bB.trace("set got write lock");let n,s=!1;try{try{if(n=await this.store.load(e),null!=n.pubKey&&Ti(n.pubKey,t))return}catch(e){if(e.code!==hB)throw e}await this.store.patchOrCreate(e,{pubKey:t}),s=!0}finally{bB.trace("set release write lock"),r()}s&&this.dispatchEvent(new aA(vB,{detail:{peerId:e,publicKey:t,oldPublicKey:null==n?void 0:n.pubKey}}))}async get(e){e=Ya(e),bB.trace("get await write lock");const t=await this.store.lock.readLock();bB.trace("get got write lock");try{return(await this.store.load(e)).pubKey}catch(e){if(e.code!==hB)throw e}finally{bB("get release write lock"),t()}}async delete(e){e=Ya(e),bB.trace("delete await write lock");const t=await this.store.lock.writeLock();let r;bB.trace("delete got write lock");try{try{r=await this.store.load(e)}catch(e){if(e.code!==hB)throw e}await this.store.patchOrCreate(e,{pubKey:void 0})}catch(e){if(e.code!==hB)throw e}finally{bB.trace("delete release write lock"),t()}this.dispatchEvent(new aA(vB,{detail:{peerId:e,publicKey:void 0,oldPublicKey:null==r?void 0:r.pubKey}}))}}const _B=He("libp2p:peer-store:metadata-book"),SB="change:metadata";class AB{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){e=Ya(e),_B.trace("get await read lock");const t=await this.store.lock.readLock();_B.trace("get got read lock");try{return(await this.store.load(e)).metadata}catch(e){if(e.code!==hB)throw e}finally{_B.trace("get release read lock"),t()}return new Map}async getValue(e,t){e=Ya(e),_B.trace("getValue await read lock");const r=await this.store.lock.readLock();_B.trace("getValue got read lock");try{return(await this.store.load(e)).metadata.get(t)}catch(e){if(e.code!==hB)throw e}finally{_B.trace("getValue release write lock"),r()}}async set(e,t){if(e=Ya(e),!(t instanceof Map))throw _B.error("valid metadata must be provided to store data"),qe(new Error("valid metadata must be provided"),lB);_B.trace("set await write lock");const r=await this.store.lock.writeLock();let n;_B.trace("set got write lock");try{try{n=await this.store.load(e)}catch(e){if(e.code!==hB)throw e}await this.store.mergeOrCreate(e,{metadata:t})}finally{_B.trace("set release write lock"),r()}this.dispatchEvent(new aA(SB,{detail:{peerId:e,metadata:t,oldMetadata:null==n?new Map:n.metadata}}))}async setValue(e,t,r){if(e=Ya(e),"string"!=typeof t||!(r instanceof Uint8Array))throw _B.error("valid key and value must be provided to store data"),qe(new Error("valid key and value must be provided"),lB);_B.trace("setValue await write lock");const n=await this.store.lock.writeLock();let s,i;_B.trace("setValue got write lock");try{try{s=await this.store.load(e);const n=s.metadata.get(t);if(null!=n&&Ti(r,n))return}catch(e){if(e.code!==hB)throw e}i=await this.store.mergeOrCreate(e,{metadata:new Map([[t,r]])})}finally{_B.trace("setValue release write lock"),n()}this.dispatchEvent(new aA(SB,{detail:{peerId:e,metadata:i.metadata,oldMetadata:null==s?new Map:s.metadata}}))}async delete(e){e=Ya(e),_B.trace("delete await write lock");const t=await this.store.lock.writeLock();let r;_B.trace("delete got write lock");try{try{r=await this.store.load(e)}catch(e){if(e.code!==hB)throw e}null!=r&&await this.store.patch(e,{metadata:new Map})}finally{_B.trace("delete release write lock"),t()}null!=r&&this.dispatchEvent(new aA(SB,{detail:{peerId:e,metadata:new Map,oldMetadata:r.metadata}}))}async deleteValue(e,t){e=Ya(e),_B.trace("deleteValue await write lock");const r=await this.store.lock.writeLock();let n,s;_B.trace("deleteValue got write lock");try{s=await this.store.load(e),n=s.metadata,n.delete(t),await this.store.patch(e,{metadata:n})}catch(e){if(e.code!==hB)throw e}finally{_B.trace("deleteValue release write lock"),r()}null!=n&&this.dispatchEvent(new aA(SB,{detail:{peerId:e,metadata:n,oldMetadata:null==s?new Map:s.metadata}}))}}const IB=He("libp2p:peer-store:proto-book"),RB="change:protocols";class kB{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){IB.trace("get wait for read lock");const t=await this.store.lock.readLock();IB.trace("get got read lock");try{return(await this.store.load(e)).protocols}catch(e){if(e.code!==hB)throw e}finally{IB.trace("get release read lock"),t()}return[]}async set(e,t){if(e=Ya(e),!Array.isArray(t))throw IB.error("protocols must be provided to store data"),qe(new Error("protocols must be provided"),lB);IB.trace("set await write lock");const r=await this.store.lock.writeLock();let n,s;IB.trace("set got write lock");try{try{if(n=await this.store.load(e),new Set([...t]).size===n.protocols.length)return}catch(e){if(e.code!==hB)throw e}s=await this.store.patchOrCreate(e,{protocols:t}),IB("stored provided protocols for %p",e)}finally{IB.trace("set release write lock"),r()}this.dispatchEvent(new aA(RB,{detail:{peerId:e,protocols:s.protocols,oldProtocols:null==n?[]:n.protocols}}))}async add(e,t){if(e=Ya(e),!Array.isArray(t))throw IB.error("protocols must be provided to store data"),qe(new Error("protocols must be provided"),lB);IB.trace("add await write lock");const r=await this.store.lock.writeLock();let n,s;IB.trace("add got write lock");try{try{if(n=await this.store.load(e),new Set([...n.protocols,...t]).size===n.protocols.length)return}catch(e){if(e.code!==hB)throw e}s=await this.store.mergeOrCreate(e,{protocols:t}),IB("added provided protocols for %p",e)}finally{IB.trace("add release write lock"),r()}this.dispatchEvent(new aA(RB,{detail:{peerId:e,protocols:s.protocols,oldProtocols:null==n?[]:n.protocols}}))}async remove(e,t){if(e=Ya(e),!Array.isArray(t))throw IB.error("protocols must be provided to store data"),qe(new Error("protocols must be provided"),lB);IB.trace("remove await write lock");const r=await this.store.lock.writeLock();let n,s;IB.trace("remove got write lock");try{try{n=await this.store.load(e);const r=new Set(n.protocols);for(const e of t)r.delete(e);if(n.protocols.length===r.size)return;t=Array.from(r)}catch(e){if(e.code!==hB)throw e}s=await this.store.patchOrCreate(e,{protocols:t})}finally{IB.trace("remove release write lock"),r()}this.dispatchEvent(new aA(RB,{detail:{peerId:e,protocols:s.protocols,oldProtocols:null==n?[]:n.protocols}}))}async delete(e){e=Ya(e),IB.trace("delete await write lock");const t=await this.store.lock.writeLock();let r;IB.trace("delete got write lock");try{try{r=await this.store.load(e)}catch(e){if(e.code!==hB)throw e}await this.store.patchOrCreate(e,{protocols:[]})}finally{IB.trace("delete release write lock"),t()}null!=r&&this.dispatchEvent(new aA(RB,{detail:{peerId:e,protocols:[],oldProtocols:r.protocols}}))}}var TB,CB,PB;!function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.addresses)for(const r of e.addresses)t.uint32(10),CB.codec().encode(r,t,{writeDefaults:!0});if(null!=e.protocols)for(const r of e.protocols)t.uint32(18),t.string(r);if(null!=e.metadata)for(const r of e.metadata)t.uint32(26),PB.codec().encode(r,t,{writeDefaults:!0});null!=e.pubKey&&(t.uint32(34),t.bytes(e.pubKey)),null!=e.peerRecordEnvelope&&(t.uint32(42),t.bytes(e.peerRecordEnvelope)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={addresses:[],protocols:[],metadata:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.addresses.push(CB.codec().decode(e,e.uint32()));break;case 2:r.protocols.push(e.string());break;case 3:r.metadata.push(PB.codec().decode(e,e.uint32()));break;case 4:r.pubKey=e.bytes();break;case 5:r.peerRecordEnvelope=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(TB||(TB={})),function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.multiaddr&&e.multiaddr.byteLength>0)&&(t.uint32(10),t.bytes(e.multiaddr)),null!=e.isCertified&&(t.uint32(16),t.bool(e.isCertified)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={multiaddr:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.multiaddr=e.bytes();break;case 2:r.isCertified=e.bool();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(CB||(CB={})),function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),!0!==r.writeDefaults&&""===e.key||(t.uint32(10),t.string(e.key)),(!0===r.writeDefaults||null!=e.value&&e.value.byteLength>0)&&(t.uint32(18),t.bytes(e.value)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={key:"",value:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.key=e.string();break;case 2:r.value=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(PB||(PB={}));const NB=He("libp2p:peer-store:store");class DB{constructor(e){this.components=e,this.lock=vb({name:"peer-store",singleProcess:!0})}_peerIdToDatastoreKey(e){if(null==e.type)throw NB.error("peerId must be an instance of peer-id to store data"),qe(new Error("peerId must be an instance of peer-id"),lB);const t=e.toCID().toString();return new Do(`/peers/${t}`)}async has(e){return await this.components.datastore.has(this._peerIdToDatastoreKey(e))}async delete(e){await this.components.datastore.delete(this._peerIdToDatastoreKey(e))}async load(e){const t=await this.components.datastore.get(this._peerIdToDatastoreKey(e)),r=TB.decode(t),n=new Map;for(const e of r.metadata)n.set(e.key,e.value);return{...r,id:e,addresses:r.addresses.map((({multiaddr:e,isCertified:t})=>({multiaddr:Ki(e),isCertified:t??!1}))),metadata:n,pubKey:r.pubKey??void 0,peerRecordEnvelope:r.peerRecordEnvelope??void 0}}async save(e){if(null!=e.pubKey&&null!=e.id.publicKey&&!Ti(e.pubKey,e.id.publicKey))throw NB.error("peer publicKey bytes do not match peer id publicKey bytes"),qe(new Error("publicKey bytes do not match peer id publicKey bytes"),lB);const t=new Set,r=e.addresses.filter((e=>!t.has(e.multiaddr.toString())&&(t.add(e.multiaddr.toString()),!0))).sort(((e,t)=>e.multiaddr.toString().localeCompare(t.multiaddr.toString()))).map((({multiaddr:e,isCertified:t})=>({multiaddr:e.bytes,isCertified:t}))),n=[];[...e.metadata.keys()].sort().forEach((t=>{const r=e.metadata.get(t);null!=r&&n.push({key:t,value:r})}));const s=TB.encode({addresses:r,protocols:e.protocols.sort(),pubKey:e.pubKey,metadata:n,peerRecordEnvelope:e.peerRecordEnvelope});return await this.components.datastore.put(this._peerIdToDatastoreKey(e.id),s.subarray()),await this.load(e.id)}async patch(e,t){const r=await this.load(e);return await this._patch(e,t,r)}async patchOrCreate(e,t){let r;try{r=await this.load(e)}catch(t){if(t.code!==hB)throw t;r={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._patch(e,t,r)}async _patch(e,t,r){return await this.save({...r,...t,id:e})}async merge(e,t){const r=await this.load(e);return await this._merge(e,t,r)}async mergeOrCreate(e,t){let r;try{r=await this.load(e)}catch(t){if(t.code!==hB)throw t;r={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._merge(e,t,r)}async _merge(e,t,r){const n=new Map;return r.addresses.forEach((e=>{n.set(e.multiaddr.toString(),e.isCertified)})),(t.addresses??[]).forEach((e=>{const t=e.multiaddr.toString(),r=Boolean(n.get(t))||e.isCertified;n.set(t,r)})),await this.save({id:e,addresses:Array.from(n.entries()).map((([e,t])=>({multiaddr:Ki(e),isCertified:t}))),protocols:Array.from(new Set([...r.protocols??[],...t.protocols??[]])),metadata:new Map([...r.metadata?.entries()??[],...t.metadata?.entries()??[]]),pubKey:t.pubKey??(null!=r?r.pubKey:void 0),peerRecordEnvelope:t.peerRecordEnvelope??(null!=r?r.peerRecordEnvelope:void 0)})}async*all(){for await(const e of this.components.datastore.queryKeys({prefix:"/peers/"})){const t=e.toString().split("/")[2],r=De.decode(t);yield this.load(Qa(r))}}}var OB,xB;!function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.tags)for(const r of e.tags)t.uint32(10),xB.codec().encode(r,t,{writeDefaults:!0});!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={tags:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();t>>>3==1?r.tags.push(xB.codec().decode(e,e.uint32())):e.skipType(7&t)}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(OB||(OB={})),function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),!0!==r.writeDefaults&&""===e.name||(t.uint32(10),t.string(e.name)),null!=e.value&&(t.uint32(16),t.uint32(e.value)),null!=e.expiry&&(t.uint32(24),t.uint64(e.expiry)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={name:""},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.name=e.string();break;case 2:r.value=e.uint32();break;case 3:r.expiry=e.uint64();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(xB||(xB={}));const LB=He("libp2p:peer-store");class BB extends iA{constructor(e,t={}){super(),this.components=e,this.store=new DB(e),this.addressBook=new mB(this.dispatchEvent.bind(this),this.store,t.addressFilter),this.keyBook=new EB(this.dispatchEvent.bind(this),this.store),this.metadataBook=new AB(this.dispatchEvent.bind(this),this.store),this.protoBook=new kB(this.dispatchEvent.bind(this),this.store)}async forEach(e){LB.trace("getPeers await read lock");const t=await this.store.lock.readLock();LB.trace("getPeers got read lock");try{for await(const t of this.store.all())t.id.equals(this.components.peerId)||e(t)}finally{LB.trace("getPeers release read lock"),t()}}async all(){const e=[];return await this.forEach((t=>{e.push(t)})),e}async delete(e){LB.trace("delete await write lock");const t=await this.store.lock.writeLock();LB.trace("delete got write lock");try{await this.store.delete(e)}finally{LB.trace("delete release write lock"),t()}}async get(e){LB.trace("get await read lock");const t=await this.store.lock.readLock();LB.trace("get got read lock");try{return await this.store.load(e)}finally{LB.trace("get release read lock"),t()}}async has(e){LB.trace("has await read lock");const t=await this.store.lock.readLock();LB.trace("has got read lock");try{return await this.store.has(e)}finally{LB.trace("has release read lock"),t()}}async tagPeer(e,t,r={}){const n=r.value??0,s=Math.round(n),i=r.ttl??void 0;if(s!==n||s<0||s>100)throw qe(new Error("Tag value must be between 0-100"),"ERR_TAG_VALUE_OUT_OF_BOUNDS");const o=await this.metadataBook.getValue(e,"tags");let a=[];null!=o&&(a=OB.decode(o).tags);for(const e of a)if(e.name===t)throw qe(new Error("Peer already tagged"),"ERR_DUPLICATE_TAG");a.push({name:t,value:s,expiry:null==i?void 0:BigInt(Date.now()+i)}),await this.metadataBook.setValue(e,"tags",OB.encode({tags:a}).subarray())}async unTagPeer(e,t){const r=await this.metadataBook.getValue(e,"tags");let n=[];null!=r&&(n=OB.decode(r).tags),n=n.filter((e=>e.name!==t)),await this.metadataBook.setValue(e,"tags",OB.encode({tags:n}).subarray())}async getTags(e){const t=await this.metadataBook.getValue(e,"tags");let r=[];null!=t&&(r=OB.decode(t).tags);const n=BigInt(Date.now()),s=r.filter((e=>null==e.expiry||e.expiry>n));return s.length!==r.length&&await this.metadataBook.setValue(e,"tags",OB.encode({tags:s}).subarray()),s.map((e=>({name:e.name,value:e.value??0})))}}class MB{constructor(e){this.dht=e}async provide(e){await dd(this.dht.provide(e))}async*findProviders(e,t={}){for await(const r of this.dht.findProviders(e,t))"PROVIDER"===r.name&&(yield*r.providers)}async put(e,t,r){await dd(this.dht.put(e,t,r))}async get(e,t){for await(const r of this.dht.get(e,t))if("VALUE"===r.name)return r.value;throw qe(new Error("Not found"),"ERR_NOT_FOUND")}}class UB{constructor(e={}){this._started=!1,this._peerId=e.peerId,this._addressManager=e.addressManager,this._peerStore=e.peerStore,this._upgrader=e.upgrader,this._metrics=e.metrics,this._registrar=e.registrar,this._connectionManager=e.connectionManager,this._transportManager=e.transportManager,this._connectionGater=e.connectionGater,this._contentRouting=e.contentRouting,this._peerRouting=e.peerRouting,this._datastore=e.datastore,this._connectionProtector=e.connectionProtector,this._dht=e.dht,this._pubsub=e.pubsub,this._dialer=e.dialer}isStarted(){return this._started}async beforeStart(){await Promise.all(Object.values(this).filter((e=>lR(e))).map((async e=>{null!=e.beforeStart&&await e.beforeStart()})))}async start(){await Promise.all(Object.values(this).filter((e=>lR(e))).map((async e=>{await e.start()}))),this._started=!0}async afterStart(){await Promise.all(Object.values(this).filter((e=>lR(e))).map((async e=>{null!=e.afterStart&&await e.afterStart()})))}async beforeStop(){await Promise.all(Object.values(this).filter((e=>lR(e))).map((async e=>{null!=e.beforeStop&&await e.beforeStop()})))}async stop(){await Promise.all(Object.values(this).filter((e=>lR(e))).map((async e=>{await e.stop()}))),this._started=!1}async afterStop(){await Promise.all(Object.values(this).filter((e=>lR(e))).map((async e=>{null!=e.afterStop&&await e.afterStop()})))}get peerId(){if(null==this._peerId)throw qe(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this._peerId}set peerId(e){this._peerId=e}get addressManager(){if(null==this._addressManager)throw qe(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this._addressManager}set addressManager(e){this._addressManager=e}get peerStore(){if(null==this._peerStore)throw qe(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this._peerStore}set peerStore(e){this._peerStore=e}get upgrader(){if(null==this._upgrader)throw qe(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this._upgrader}set upgrader(e){this._upgrader=e}get registrar(){if(null==this._registrar)throw qe(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this._registrar}set registrar(e){this._registrar=e}get connectionManager(){if(null==this._connectionManager)throw qe(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this._connectionManager}set connectionManager(e){this._connectionManager=e}get transportManager(){if(null==this._transportManager)throw qe(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this._transportManager}set transportManager(e){this._transportManager=e}get connectionGater(){if(null==this._connectionGater)throw qe(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this._connectionGater}set connectionGater(e){this._connectionGater=e}get contentRouting(){if(null==this._contentRouting)throw qe(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this._contentRouting}set contentRouting(e){this._contentRouting=e}get peerRouting(){if(null==this._peerRouting)throw qe(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this._peerRouting}set peerRouting(e){this._peerRouting=e}get datastore(){if(null==this._datastore)throw qe(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this._datastore}set datastore(e){this._datastore=e}get connectionProtector(){return this._connectionProtector}set connectionProtector(e){this._connectionProtector=e}get dialer(){if(null==this._dialer)throw qe(new Error("dialer not set"),"ERR_SERVICE_MISSING");return this._dialer}set dialer(e){this._dialer=e}get metrics(){return this._metrics}set metrics(e){this._metrics=e}get dht(){return this._dht}set dht(e){this._dht=e}get pubsub(){return this._pubsub}set pubsub(e){this._pubsub=e}}var zB=r(67172);const VB=globalThis.fetch,FB=globalThis.Headers;function jB(e,t,r){return`${e}?name=${t}&type=${r}`}async function KB(e,t){const r=await VB(e,{headers:new FB({accept:"application/dns-json"}),signal:t});return await r.json()}function $B(e,t){return`${t}_${e}`}globalThis.Request,globalThis.Response;const HB=Object.assign(me("dns-over-http-resolver"),{error:me("dns-over-http-resolver:error")}),qB=class{constructor(e={}){this._cache=new zB({max:e?.maxCache??100}),this._TXTcache=new zB({max:e?.maxCache??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=e.request??KB,this._abortControllers=[]}cancel(){this._abortControllers.forEach((e=>e.abort()))}getServers(){return this._servers}_getShuffledServers(){const e=[...this._servers];for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*t),n=e[t];e[t]=e[r],e[r]=n}return e}setServers(e){this._servers=e}async resolve(e,t="A"){switch(t){case"A":return await this.resolve4(e);case"AAAA":return await this.resolve6(e);case"TXT":return await this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){const t=this._cache.get($B(e,"A"));if(null!=t)return t;let r=!1;for(const t of this._getShuffledServers()){const n=new AbortController;this._abortControllers.push(n);try{const r=await this._request(jB(t,e,"A"),n.signal),s=r.Answer.map((e=>e.data)),i=Math.min(...r.Answer.map((e=>e.TTL)));return this._cache.set($B(e,"A"),s,{ttl:i}),s}catch(s){n.signal.aborted&&(r=!0),HB.error(`${t} could not resolve ${e} record A`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==n))}}if(r)throw Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record A`)}async resolve6(e){const t="AAAA",r=this._cache.get($B(e,t));if(null!=r)return r;let n=!1;for(const r of this._getShuffledServers()){const s=new AbortController;this._abortControllers.push(s);try{const n=await this._request(jB(r,e,t),s.signal),i=n.Answer.map((e=>e.data)),o=Math.min(...n.Answer.map((e=>e.TTL)));return this._cache.set($B(e,t),i,{ttl:o}),i}catch(t){s.signal.aborted&&(n=!0),HB.error(`${r} could not resolve ${e} record AAAA`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==s))}}if(n)throw Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record AAAA`)}async resolveTxt(e){const t="TXT",r=this._TXTcache.get($B(e,t));if(null!=r)return r;let n=!1;for(const r of this._getShuffledServers()){const s=new AbortController;this._abortControllers.push(s);try{const n=await this._request(jB(r,e,t),s.signal),i=n.Answer.map((e=>[e.data.replace(/['"]+/g,"")])),o=Math.min(...n.Answer.map((e=>e.TTL)));return this._TXTcache.set($B(e,t),i,{ttl:o}),i}catch(t){s.signal.aborted&&(n=!0),HB.error(`${r} could not resolve ${e} record TXT`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==s))}}if(n)throw Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record TXT`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}},{code:GB}=hi("dnsaddr"),WB={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:e=>e},connectionManager:{maxConnections:300,minConnections:50,autoDial:!0,autoDialInterval:1e4,maxParallelDials:100,maxDialsPerPeer:4,dialTimeout:3e4,inboundUpgradeTimeout:3e4,resolvers:{dnsaddr:async function(e,t={}){const r=new qB;null!=t.signal&&t.signal.addEventListener("abort",(()=>{r.cancel()}));const n=e.getPeerId(),[,s]=e.stringTuples().find((([e])=>e===GB))??[];if(null==s)throw new Error("No hostname found in multiaddr");let i=(await r.resolveTxt(`_dnsaddr.${s}`)).flat().map((e=>e.split("=")[1]));return null!=n&&(i=i.filter((e=>e.includes(n)))),i}},addressSorter:Lx},connectionGater:{},transportManager:{faultTolerance:mL.FATAL_ALL},metrics:{enabled:!1,computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[6e4,3e5,9e5],maxOldPeersRetention:50},peerRouting:{refreshManager:{enabled:!0,interval:6e5,bootDelay:1e4}},nat:{enabled:!0,ttl:7200,keepAlive:!0},relay:{enabled:!0,advertise:{bootDelay:9e5,enabled:!1,ttl:18e5},hop:{enabled:!1,active:!1,timeout:3e4},autoRelay:{enabled:!1,maxListeners:2}},identify:{protocolPrefix:"ipfs",host:{agentVersion:UL},timeout:6e4,maxInboundStreams:1,maxOutboundStreams:1,maxPushIncomingStreams:1,maxPushOutgoingStreams:1},ping:{protocolPrefix:"ipfs",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4},fetch:{protocolPrefix:"libp2p",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4}};var YB;!function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.id&&e.id.byteLength>0)&&(t.uint32(10),t.bytes(e.id)),null!=e.pubKey&&(t.uint32(18),t.bytes(e.pubKey)),null!=e.privKey&&(t.uint32(26),t.bytes(e.privKey)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={id:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.id=e.bytes();break;case 2:r.pubKey=e.bytes();break;case 3:r.privKey=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(YB||(YB={}));const ZB=async()=>{const e=await Xh("Ed25519"),t=await QB(e);if("Ed25519"===t.type)return t;throw new Error(`Generated unexpected PeerId type "${t.type}"`)};async function QB(e){return await Ja(tu(e.public),(t=e,Jh(r=(r??"rsa").toLowerCase()),t.bytes));var t,r}class JB extends iA{get[TO](){return!0}get[Symbol.toStringTag](){return"@libp2p/dummy-dht"}get wan(){throw qe(new Error(xO.DHT_DISABLED),LO.DHT_DISABLED)}get lan(){throw qe(new Error(xO.DHT_DISABLED),LO.DHT_DISABLED)}get(){throw qe(new Error(xO.DHT_DISABLED),LO.DHT_DISABLED)}findProviders(){throw qe(new Error(xO.DHT_DISABLED),LO.DHT_DISABLED)}findPeer(){throw qe(new Error(xO.DHT_DISABLED),LO.DHT_DISABLED)}getClosestPeers(){throw qe(new Error(xO.DHT_DISABLED),LO.DHT_DISABLED)}provide(){throw qe(new Error(xO.DHT_DISABLED),LO.DHT_DISABLED)}put(){throw qe(new Error(xO.DHT_DISABLED),LO.DHT_DISABLED)}async getMode(){throw qe(new Error(xO.DHT_DISABLED),LO.DHT_DISABLED)}async setMode(){throw qe(new Error(xO.DHT_DISABLED),LO.DHT_DISABLED)}async refreshRoutingTable(){throw qe(new Error(xO.DHT_DISABLED),LO.DHT_DISABLED)}}class XB extends iA{constructor(){super(...arguments),this.topicValidators=new Map}isStarted(){return!1}start(){}stop(){}get globalSignaturePolicy(){throw qe(new Error(xO.PUBSUB_DISABLED),LO.ERR_PUBSUB_DISABLED)}get multicodecs(){throw qe(new Error(xO.PUBSUB_DISABLED),LO.ERR_PUBSUB_DISABLED)}getPeers(){throw qe(new Error(xO.PUBSUB_DISABLED),LO.ERR_PUBSUB_DISABLED)}getTopics(){throw qe(new Error(xO.PUBSUB_DISABLED),LO.ERR_PUBSUB_DISABLED)}subscribe(){throw qe(new Error(xO.PUBSUB_DISABLED),LO.ERR_PUBSUB_DISABLED)}unsubscribe(){throw qe(new Error(xO.PUBSUB_DISABLED),LO.ERR_PUBSUB_DISABLED)}getSubscribers(){throw qe(new Error(xO.PUBSUB_DISABLED),LO.ERR_PUBSUB_DISABLED)}async publish(){throw qe(new Error(xO.PUBSUB_DISABLED),LO.ERR_PUBSUB_DISABLED)}}class eM extends Error{constructor(e="The operation was aborted"){super(e),this.code=eM.code,this.type=eM.type}static get code(){return"ABORT_ERR"}static get type(){return"aborted"}}var tM=r(5181);const rM=He("libp2p:dialer:dial-request");class nM{constructor(e){const{addrs:t,dialAction:r,dialer:n}=e;this.addrs=t,this.dialer=n,this.dialAction=r}async run(e={}){const t=this.dialer.getTokens(this.addrs.length);if(t.length<1)throw qe(new Error("No dial tokens available"),LO.ERR_NO_DIAL_TOKENS);const r=new tM;for(const e of t)r.push(e).catch((e=>{rM.error(e)}));const n=this.addrs.map((()=>{const e=new AbortController;try{(0,jO.setMaxListeners)?.(1/0,e.signal)}catch{}return e}));if(null!=e.signal)try{(0,jO.setMaxListeners)?.(1/0,e.signal)}catch{}let s=0,i=!1;try{return await Promise.any(this.addrs.map((async(o,a)=>{const c=await r.shift();if(i)throw this.dialer.releaseToken(t.splice(t.indexOf(c),1)[0]),qe(new Error("dialAction already succeeded"),LO.ERR_ALREADY_SUCCEEDED);const l=n[a];if(null==l)throw qe(new Error("dialAction did not come with an AbortController"),LO.ERR_INVALID_PARAMETERS);let h;try{const i=l.signal;h=await this.dialAction(o,{...e,signal:null!=e.signal?(0,Oo.anySignal)([i,e.signal]):i}),n[a]=void 0}finally{s++,this.addrs.length-s>=t.length?r.push(c).catch((e=>{rM.error(e)})):this.dialer.releaseToken(t.splice(t.indexOf(c),1)[0])}if(null==h)throw qe(new Error("dialAction led to empty object"),LO.ERR_TRANSPORT_DIAL_FAILED);return i=!0,h})))}finally{n.forEach((e=>{void 0!==e&&e.abort()})),t.forEach((e=>this.dialer.releaseToken(e)))}}}const sM=He("libp2p:dialer"),iM="dialler";class oM{constructor(e,t={}){this.started=!1,this.addressSorter=t.addressSorter??Lx,this.maxAddrsToDial=t.maxAddrsToDial??25,this.timeout=t.dialTimeout??3e4,this.maxDialsPerPeer=t.maxDialsPerPeer??4,this.tokens=[...new Array(t.maxParallelDials??100)].map(((e,t)=>t)),this.components=e,this.pendingDials=fL({component:iM,metric:"pending-dials",metrics:t.metrics}),this.pendingDialTargets=fL({component:iM,metric:"pending-dial-targets",metrics:e.metrics});for(const[e,r]of Object.entries(t.resolvers??{}))Ui.set(e,r)}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1;for(const e of this.pendingDials.values())try{e.controller.abort()}catch(e){sM.error(e)}this.pendingDials.clear();for(const e of this.pendingDialTargets.values())e.reject(new eM("Dialer was destroyed"));this.pendingDialTargets.clear()}async dial(e,t={}){const{id:r,multiaddrs:n}=qO(e);if(this.components.peerId.equals(r))throw qe(new Error("Tried to dial self"),LO.ERR_DIALED_SELF);if(sM("check multiaddrs %p",r),null!=n&&n.length>0&&(sM("storing multiaddrs %p",r,n),await this.components.peerStore.addressBook.add(r,n)),await this.components.connectionGater.denyDialPeer(r))throw qe(new Error("The dial request is blocked by gater.allowDialPeer"),LO.ERR_PEER_DIAL_INTERCEPTED);sM("creating dial target for %p",r);const s=await this._createCancellableDialTarget(r,t);if(0===s.addrs.length)throw qe(new Error("The dial request has no valid addresses"),LO.ERR_NO_VALID_ADDRESSES);const i=this.pendingDials.get(s.id)??this._createPendingDial(s,t);try{const e=await i.promise;return sM("dial succeeded to %s",s.id),e}catch(e){throw sM("dial failed to %s",s.id,e),i.controller.signal.aborted&&(e.code=LO.ERR_TIMEOUT),sM.error(e),e}finally{i.destroy()}}async _createCancellableDialTarget(e,t){const r=`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`,n=new Promise(((e,t)=>{this.pendingDialTargets.set(r,{resolve:e,reject:t})}));try{return await Promise.race([this._createDialTarget(e,t),n])}finally{this.pendingDialTargets.delete(r)}}async _createDialTarget(e,t){const r=this._resolve.bind(this),n=await Xu(await this.components.peerStore.addressBook.get(e),(t=>MO(t,(async t=>!await this.components.connectionGater.denyDialMultiaddr(e,t.multiaddr)))),(e=>_S(e,this.addressSorter)),(async function*(e){for await(const n of e)yield*await r(n.multiaddr,t)}),(e=>MO(e,(e=>Boolean(this.components.transportManager.transportForMultiaddr(e))))),(t=>zd(t,(t=>e.toString()===t.getPeerId()?t:t.encapsulate(`/p2p/${e.toString()}`)))),(async e=>await Hd(e)));if(n.length>this.maxAddrsToDial)throw await this.components.peerStore.delete(e),qe(new Error("dial with more addresses than allowed"),LO.ERR_TOO_MANY_ADDRESSES);return{id:e.toString(),addrs:n}}_createPendingDial(e,t={}){const r=new nM({addrs:e.addrs,dialAction:async(e,t={})=>{if(!0===t.signal?.aborted)throw qe(new Error("already aborted"),LO.ERR_ALREADY_ABORTED);return await this.components.transportManager.dial(e,t).catch((t=>{throw sM.error("dial to %s failed",e,t),t}))},dialer:this}),n=new ei.TimeoutController(this.timeout),s=[n.signal];null!=t.signal&&s.push(t.signal);const i=(0,Oo.anySignal)(s);try{(0,jO.setMaxListeners)?.(1/0,i)}catch{}const o={dialRequest:r,controller:n,promise:r.run({...t,signal:i}),destroy:()=>{n.clear(),this.pendingDials.delete(e.id)}};return this.pendingDials.set(e.id,o),o}getTokens(e){const t=Math.min(e,this.maxDialsPerPeer,this.tokens.length),r=this.tokens.splice(0,t);return sM("%d tokens request, returning %d, %d remaining",e,t,this.tokens.length),r}releaseToken(e){this.tokens.includes(e)||(sM("token %d released",e),this.tokens.push(e))}async _resolve(e,t){if(!e.protoNames().includes("dnsaddr"))return[e];const r=await this._resolveRecord(e,t);return(await Promise.all(r.map((async e=>await this._resolve(e,t))))).flat().reduce(((e,t)=>(null==e.find((e=>e.equals(t)))&&e.push(t),e)),[])}async _resolveRecord(e,t){try{return e=Ki(e.toString()),await e.resolve(t)}catch(t){return sM.error(`multiaddr ${e.toString()} could not be resolved`,t),[]}}}const aM=He("libp2p");class cM extends iA{constructor(e){super(),this.started=!1,this.peerId=e.peerId;const t=this.components=new UB({peerId:e.peerId,datastore:e.datastore??new Wu,connectionGater:{denyDialPeer:async()=>await Promise.resolve(!1),denyDialMultiaddr:async()=>await Promise.resolve(!1),denyInboundConnection:async()=>await Promise.resolve(!1),denyOutboundConnection:async()=>await Promise.resolve(!1),denyInboundEncryptedConnection:async()=>await Promise.resolve(!1),denyOutboundEncryptedConnection:async()=>await Promise.resolve(!1),denyInboundUpgradedConnection:async()=>await Promise.resolve(!1),denyOutboundUpgradedConnection:async()=>await Promise.resolve(!1),filterMultiaddrForPeer:async()=>await Promise.resolve(!0),...e.connectionGater}});t.peerStore=new BB(t,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore}),this.services=[t],e.metrics.enabled&&(this.metrics=this.components.metrics=new aL(e.metrics)),this.peerStore=this.components.peerStore,this.peerStore.addEventListener("peer",(e=>{const{detail:t}=e;this.dispatchEvent(new aA("peer:discovery",{detail:t}))})),null!=e.connectionProtector&&(this.components.connectionProtector=e.connectionProtector(t)),this.components.upgrader=new BL(this.components,{connectionEncryption:(e.connectionEncryption??[]).map((e=>this.configureComponent(e(this.components)))),muxers:(e.streamMuxers??[]).map((e=>this.configureComponent(e(this.components)))),inboundUpgradeTimeout:e.connectionManager.inboundUpgradeTimeout}),this.components.dialer=new oM(this.components,e.connectionManager),this.connectionManager=this.components.connectionManager=new dx(this.components,e.connectionManager),this.registrar=this.components.registrar=new OL(this.components),this.components.transportManager=new gL(this.components,e.transportManager),this.components.addressManager=new WO(this.components,e.addresses),this.configureComponent(new aB(this.components)),this.configureComponent(new yx(this.components,{enabled:e.connectionManager.autoDial,minConnections:e.connectionManager.minConnections,autoDialInterval:e.connectionManager.autoDialInterval}));const r=eL.generateOptions();this.keychain=this.configureComponent(new eL(this.components,{...r,...e.keychain})),this.services.push(new iB(this.components,e.nat)),e.transports.forEach((e=>{this.components.transportManager.add(this.configureComponent(e(this.components)))})),this.identifyService=new VL(this.components,{...e.identify}),this.configureComponent(this.identifyService),null!=e.dht?this.dht=this.components.dht=e.dht(this.components):this.dht=new JB,null!=e.pubsub?this.pubsub=this.components.pubsub=e.pubsub(this.components):this.pubsub=new XB;const n=(e.peerRouters??[]).map((e=>this.configureComponent(e(this.components))));null!=e.dht&&(n.push(this.configureComponent(new cB(this.dht))),this.dht.addEventListener("peer",(e=>{this.onDiscoveryPeer(e)}))),this.peerRouting=this.components.peerRouting=this.configureComponent(new $O(this.components,{...e.peerRouting,routers:n}));const s=(e.contentRouters??[]).map((e=>this.configureComponent(e(this.components))));null!=e.dht&&s.push(this.configureComponent(new MB(this.dht))),this.contentRouting=this.components.contentRouting=this.configureComponent(new HO(this.components,{routers:s})),e.relay.enabled&&(this.components.transportManager.add(this.configureComponent(new Tx(this.components,e.relay))),this.configureComponent(new Vx(this.components,{addressSorter:e.connectionManager.addressSorter,...e.relay}))),this.fetchService=this.configureComponent(new $L(this.components,{...e.fetch})),this.pingService=this.configureComponent(new qL(this.components,{...e.ping}));for(const t of e.peerDiscovery??[])this.configureComponent(t(this.components)).addEventListener("peer",(e=>{this.onDiscoveryPeer(e)}))}configureComponent(e){return lR(e)&&this.services.push(e),e}async start(){if(!this.started){this.started=!0,aM("libp2p is starting");try{await Promise.all(this.services.map((async e=>{null!=e.beforeStart&&await e.beforeStart()}))),await Promise.all(this.services.map((e=>e.start()))),await Promise.all(this.services.map((async e=>{null!=e.afterStart&&await e.afterStart()}))),aM("libp2p has started")}catch(e){throw aM.error("An error occurred starting libp2p",e),await this.stop(),e}}}async stop(){this.started&&(aM("libp2p is stopping"),this.started=!1,await Promise.all(this.services.map((async e=>{null!=e.beforeStop&&await e.beforeStop()}))),await Promise.all(this.services.map((e=>e.stop()))),await Promise.all(this.services.map((async e=>{null!=e.afterStop&&await e.afterStop()}))),aM("libp2p has stopped"))}isStarted(){return this.started}getConnections(e){return this.components.connectionManager.getConnections(e)}getPeers(){const e=new ix;for(const t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){const{id:r,multiaddrs:n}=qO(e);return await this.components.peerStore.addressBook.add(r,n),await this.components.connectionManager.openConnection(r,t)}async dialProtocol(e,t,r={}){if(null==t)throw qe(new Error("no protocols were provided to open a stream"),LO.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(0===(t=Array.isArray(t)?t:[t]).length)throw qe(new Error("no protocols were provided to open a stream"),LO.ERR_INVALID_PROTOCOLS_FOR_STREAM);const n=await this.dial(e,r);return await n.newStream(t,r)}getMultiaddrs(){return this.components.addressManager.getAddresses()}async hangUp(e){const{id:t}=qO(e);await this.components.connectionManager.closeConnections(t)}async getPublicKey(e,t={}){if(aM("getPublicKey %p",e),null!=e.publicKey)return e.publicKey;const r=await this.peerStore.get(e);if(null!=r.pubKey)return r.pubKey;if(null==this.dht)throw qe(new Error("Public key was not in the peer store and the DHT is not enabled"),LO.ERR_NO_ROUTERS_AVAILABLE);const n=di([Xs("/pk/"),e.multihash.digest]);for await(const r of this.dht.get(n,t))if("VALUE"===r.name){const t=eu(r.value);return await this.peerStore.keyBook.set(e,r.value),t.bytes}throw qe(new Error(`Node not responding with its public key: ${e.toString()}`),LO.ERR_INVALID_RECORD)}async fetch(e,t,r={}){const{id:n,multiaddrs:s}=qO(e);return null!=s&&await this.components.peerStore.addressBook.add(n,s),await this.fetchService.fetch(n,t,r)}async ping(e,t={}){const{id:r,multiaddrs:n}=qO(e);return n.length>0&&await this.components.peerStore.addressBook.add(r,n),await this.pingService.ping(r,t)}async handle(e,t,r){Array.isArray(e)||(e=[e]),await Promise.all(e.map((async e=>{await this.components.registrar.handle(e,t,r)})))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map((async e=>{await this.components.registrar.unhandle(e)})))}onDiscoveryPeer(e){const{detail:t}=e;t.id.toString()!==this.peerId.toString()?(t.multiaddrs.length>0&&this.components.peerStore.addressBook.add(t.id,t.multiaddrs).catch((e=>aM.error(e))),t.protocols.length>0&&this.components.peerStore.protoBook.set(t.id,t.protocols).catch((e=>aM.error(e))),this.dispatchEvent(new aA("peer:discovery",{detail:t}))):aM.error(new Error(LO.ERR_DISCOVERED_SELF))}}var lM=r(26665);const hM=20,uM=3,dM=Number(3e5),pM=Number(3e4),fM=Number(3e5),yM=Number(3e4),gM=Number(3e4),mM=Xs("/pk/");function wM(e){return{...e,multiaddrs:e.multiaddrs.filter((e=>{const[[t,r]]=e.stringTuples();return(4===t||6===t)&&null!=r&&!Ox(r)}))}}function bM(e){return{...e,multiaddrs:e.multiaddrs.filter((e=>{const[[t,r]]=e.stringTuples();return(4===t||6===t)&&null!=r&&Ox(r)}))}}async function vM(e){return(await As.digest(e)).digest}async function EM(e){return await vM(e.toBytes())}function _M(e){return new Do(`/dht/record/${ni(e,"base32")}`,!1)}function SM(e,t){const r=new Date;return new ld(e,t,r).serialize()}const AM="routing-table-size";class IM{constructor(e,t){const{kBucketSize:r,pingTimeout:n,lan:s,pingConcurrency:i,protocol:o,tagName:a,tagValue:c}=t;this.components=e,this.log=He(`libp2p:kad-dht:${s?"lan":"wan"}:routing-table`),this.kBucketSize=r??20,this.pingTimeout=n??1e4,this.pingConcurrency=i??10,this.lan=s,this.running=!1,this.protocol=o,this.tagName=a??"kad-close",this.tagValue=c??50;const l=()=>{this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:"ping-queue-size",value:this.pingQueue.size}),this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:"ping-running",value:this.pingQueue.pending})};this.pingQueue=new Ma({concurrency:this.pingConcurrency}),this.pingQueue.addListener("add",l),this.pingQueue.addListener("next",l),this._onPing=this._onPing.bind(this)}isStarted(){return this.running}async start(){this.running=!0;const e=new lM({localNodeId:await EM(this.components.peerId),numberOfNodesPerKBucket:this.kBucketSize,numberOfNodesToPing:1});this.kb=e,e.on("ping",this._onPing),this._tagPeers(e)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(e){let t=new ix;const r=function(e,t=100){let r;return()=>{clearTimeout(r),r=setTimeout((()=>e()),t)}}((()=>{const r=new ix(e.closest(e.localNodeId,20).map((e=>e.peer))),n=r.difference(t),s=t.difference(r);Promise.resolve().then((async()=>{for(const e of n)await this.components.peerStore.tagPeer(e,this.tagName,{value:this.tagValue});for(const e of s)await this.components.peerStore.unTagPeer(e,this.tagName)})).catch((e=>{this.log.error("Could not update peer tags",e)})),t=r}));e.on("added",(()=>{r()})),e.on("removed",(()=>{r()}))}_onPing(e,t){this.pingQueue.add((async()=>{if(!this.running)return;let r=0;try{await Promise.all(e.map((async e=>{let t;try{t=new ei.TimeoutController(this.pingTimeout);const n={signal:t.signal};this.log("pinging old contact %p",e.peer);const s=await this.components.connectionManager.openConnection(e.peer,n);(await s.newStream(this.protocol,n)).close(),r++}catch(t){this.running&&null!=this.kb&&(this.log.error("could not ping peer %p",e.peer,t),this.log("evicting old contact after ping failed %p",e),this.kb.remove(e.id))}finally{null!=t&&t.clear(),this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:AM,value:this.size})}}))),this.running&&r<e.length&&null!=this.kb&&(this.log("adding new contact %p",t.peer),this.kb.add(t))}catch(e){this.log.error("could not process k-bucket ping event",e)}})).catch((e=>{this.log.error("could not process k-bucket ping event",e)}))}get size(){return null==this.kb?0:this.kb.count()}async find(e){const t=await EM(e),r=this.closestPeer(t);if(null!=r&&e.equals(r))return r}closestPeer(e){const t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e,t=this.kBucketSize){return null==this.kb?[]:this.kb.closest(e,t).map((e=>e.peer))}async add(e){if(null==this.kb)throw new Error("RoutingTable is not started");const t=await EM(e);this.kb.add({id:t,peer:e}),this.log("added %p with kad id %b",e,t),this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:AM,value:this.size})}async remove(e){if(null==this.kb)throw new Error("RoutingTable is not started");const t=await EM(e);this.kb.remove(t),this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:AM,value:this.size})}}function RM(e,t){if(e.length!==t.length)throw new Error("Inputs should have the same length");const r=Ws(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return qs(r)}const kM=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782];class TM{constructor(e){const{peerRouting:t,routingTable:r,refreshInterval:n,refreshQueryTimeout:s,lan:i}=e;this.log=He(`libp2p:kad-dht:${i?"lan":"wan"}:routing-table:refresh`),this.peerRouting=t,this.routingTable=r,this.refreshInterval=n??fM,this.refreshQueryTimeout=s??yM,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async start(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){null!=this.refreshTimeoutId&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),r=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${r.map((e=>e.toISOString())).join(", ")} ]`),Promise.all(r.map((async(n,s)=>{try{if(await this._refreshCommonPrefixLength(s,n,e),0===this._numPeersForCpl(t)){const t=Math.min(2*(s+1),r.length-1);for(let r=s+1;r<t+1;r++)try{await this._refreshCommonPrefixLength(r,n,e)}catch(e){this.log.error(e)}}}catch(e){this.log.error(e)}}))).catch((e=>{this.log.error(e)})).then((()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),null!=this.refreshTimeoutId.unref&&this.refreshTimeoutId.unref()})).catch((e=>{this.log.error(e)}))}async _refreshCommonPrefixLength(e,t,r){if(!r&&t.getTime()>Date.now()-this.refreshInterval)return void this.log("not running refresh for cpl %s as time since last refresh not above interval",e);const n=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,n,this.routingTable.size);const s=new ei.TimeoutController(this.refreshQueryTimeout);try{const t=await dE(this.peerRouting.getClosestPeers(n.toBytes(),{signal:s.signal}));this.log(`found ${t} peers that were close to imaginary peer %p`,n),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,n,this.routingTable.size)}finally{s.clear()}}_getTrackedCommonPrefixLengthsForRefresh(e){e>15&&(e=15);const t=[];for(let r=0;r<=e;r++)t[r]=this.commonPrefixLengthRefreshedAt[r]??new Date;return t}async _generateRandomPeerId(e){if(null==this.routingTable.kb)throw new Error("Routing table not started");const t=Cl(2),r=(t[1]<<8)+t[0];return Qa(await this._makePeerId(this.routingTable.kb.localNodeId,r,e))}async _makePeerId(e,t,r){if(r>15)throw new Error("Cannot generate peer ID for common prefix length greater than 15");const n=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1),s=65535<<16-(r+1),i=kM[(n^32768>>r)&s|t&~s],o=new ArrayBuffer(34),a=new DataView(o,0,o.byteLength);return a.setUint8(0,As.code),a.setUint8(1,32),a.setUint32(2,i,!1),new Uint8Array(a.buffer,a.byteOffset,a.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const r of this._prefixLengths())r===e&&t++;return t}*_prefixLengths(){if(null!=this.routingTable.kb)for(const{id:e}of this.routingTable.kb.toIterable()){const t=RM(this.routingTable.kb.localNodeId,e);let r=0;for(const e of t){if(0!==e)break;r++}yield r}}}var CM,PM;!function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&(t.uint32(10),t.bytes(e.key)),null!=e.value&&(t.uint32(18),t.bytes(e.value)),null!=e.author&&(t.uint32(26),t.bytes(e.author)),null!=e.signature&&(t.uint32(34),t.bytes(e.signature)),null!=e.timeReceived&&(t.uint32(42),t.string(e.timeReceived)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.key=e.bytes();break;case 2:r.value=e.bytes();break;case 3:r.author=e.bytes();break;case 4:r.signature=e.bytes();break;case 5:r.timeReceived=e.string();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(CM||(CM={})),function(e){let t,r,n,s,i,o;!function(e){e.PUT_VALUE="PUT_VALUE",e.GET_VALUE="GET_VALUE",e.ADD_PROVIDER="ADD_PROVIDER",e.GET_PROVIDERS="GET_PROVIDERS",e.FIND_NODE="FIND_NODE",e.PING="PING"}(t=e.MessageType||(e.MessageType={})),function(e){e[e.PUT_VALUE=0]="PUT_VALUE",e[e.GET_VALUE=1]="GET_VALUE",e[e.ADD_PROVIDER=2]="ADD_PROVIDER",e[e.GET_PROVIDERS=3]="GET_PROVIDERS",e[e.FIND_NODE=4]="FIND_NODE",e[e.PING=5]="PING"}(r||(r={})),function(e){e.codec=()=>Sc(r)}(t=e.MessageType||(e.MessageType={})),function(e){e.NOT_CONNECTED="NOT_CONNECTED",e.CONNECTED="CONNECTED",e.CAN_CONNECT="CAN_CONNECT",e.CANNOT_CONNECT="CANNOT_CONNECT"}(n=e.ConnectionType||(e.ConnectionType={})),function(e){e[e.NOT_CONNECTED=0]="NOT_CONNECTED",e[e.CONNECTED=1]="CONNECTED",e[e.CAN_CONNECT=2]="CAN_CONNECT",e[e.CANNOT_CONNECT=3]="CANNOT_CONNECT"}(s||(s={})),function(e){e.codec=()=>Sc(s)}(n=e.ConnectionType||(e.ConnectionType={})),function(t){let r;t.codec=()=>(null==r&&(r=Ac(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.id&&(r.uint32(10),r.bytes(t.id)),null==t.addrs)throw new Error('Protocol error: required field "addrs" was not found in object');for(const e of t.addrs)r.uint32(18),r.bytes(e);null!=t.connection&&(r.uint32(24),e.ConnectionType.codec().encode(t.connection,r)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={addrs:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){const r=t.uint32();switch(r>>>3){case 1:n.id=t.bytes();break;case 2:n.addrs.push(t.bytes());break;case 3:n.connection=e.ConnectionType.codec().decode(t);break;default:t.skipType(7&r)}}return n}))),r),t.encode=e=>gc(e,t.codec()),t.decode=e=>yc(e,t.codec())}(i=e.Peer||(e.Peer={})),e.codec=()=>(null==o&&(o=Ac(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.MessageType.codec().encode(t.type,r)),null!=t.clusterLevelRaw&&(r.uint32(80),r.int32(t.clusterLevelRaw)),null!=t.key&&(r.uint32(18),r.bytes(t.key)),null!=t.record&&(r.uint32(26),r.bytes(t.record)),null==t.closerPeers)throw new Error('Protocol error: required field "closerPeers" was not found in object');for(const n of t.closerPeers)r.uint32(66),e.Peer.codec().encode(n,r);if(null==t.providerPeers)throw new Error('Protocol error: required field "providerPeers" was not found in object');for(const n of t.providerPeers)r.uint32(74),e.Peer.codec().encode(n,r);!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={closerPeers:[],providerPeers:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){const r=t.uint32();switch(r>>>3){case 1:n.type=e.MessageType.codec().decode(t);break;case 10:n.clusterLevelRaw=t.int32();break;case 2:n.key=t.bytes();break;case 3:n.record=t.bytes();break;case 8:n.closerPeers.push(e.Peer.codec().decode(t,t.uint32()));break;case 9:n.providerPeers.push(e.Peer.codec().decode(t,t.uint32()));break;default:t.skipType(7&r)}}return n}))),o),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(PM||(PM={}));const NM=PM.MessageType,DM=PM.ConnectionType,OM=Object.keys(NM);class xM{constructor(e,t,r){if(!(t instanceof Uint8Array))throw new Error("Key must be a Uint8Array");this.type=e,this.key=t,this.clusterLevelRaw=r,this.closerPeers=[],this.providerPeers=[],this.record=void 0}get clusterLevel(){const e=this.clusterLevelRaw-1;return e<0?0:e}set clusterLevel(e){this.clusterLevelRaw=e}serialize(){return PM.encode({key:this.key,type:this.type,clusterLevelRaw:this.clusterLevelRaw,closerPeers:this.closerPeers.map(LM),providerPeers:this.providerPeers.map(LM),record:null==this.record?void 0:this.record.serialize().subarray()})}static deserialize(e){const t=PM.decode(e),r=new xM(t.type??PM.MessageType.PUT_VALUE,t.key??Uint8Array.from([]),t.clusterLevelRaw??0);return r.closerPeers=t.closerPeers.map(BM),r.providerPeers=t.providerPeers.map(BM),null!=t.record?.length&&(r.record=ld.deserialize(t.record)),r}}function LM(e){return{id:e.id.toBytes(),addrs:(e.multiaddrs??[]).map((e=>e.bytes)),connection:DM.CONNECTED}}function BM(e){if(null==e.id)throw new Error("Invalid peer in message");return{id:Qa(e.id),multiaddrs:(e.addrs??[]).map((e=>Ki(e))),protocols:[]}}function MM(e){return{...e,name:"SENDING_QUERY",type:0,messageName:e.type,messageType:OM.indexOf(e.type.toString())}}function UM(e){return{...e,name:"PEER_RESPONSE",type:1,messageName:e.messageType,closer:null!=e.closer?e.closer:[],providers:null!=e.providers?e.providers:[]}}function zM(e){return{...e,name:"FINAL_PEER",type:2}}function VM(e){return{...e,name:"QUERY_ERROR",type:3}}function FM(e){return{...e,name:"PROVIDER",type:4}}function jM(e){return{...e,name:"VALUE",type:5}}function KM(e){return{...e,name:"DIALING_PEER",type:7}}class $M extends iA{constructor(e,t){super();const{protocol:r,lan:n}=t;this.components=e,this.log=He(`libp2p:kad-dht:${n?"lan":"wan"}:network`),this.running=!1,this.protocol=r}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(e,t,r={}){if(this.running){this.log("sending %s to %p",t.type,e),yield KM({peer:e}),yield MM({to:e,type:t.type});try{const n=await this.components.connectionManager.openConnection(e,r),s=await n.newStream(this.protocol,r),i=await this._writeReadMessage(s,t.serialize(),r);yield UM({from:e,messageType:i.type,closer:i.closerPeers,providers:i.providerPeers,record:i.record})}catch(t){yield VM({from:e,error:t})}finally{null!=s&&s.close()}}}async*sendMessage(e,t,r={}){if(this.running){this.log("sending %s to %p",t.type,e),yield KM({peer:e}),yield MM({to:e,type:t.type});try{const n=await this.components.connectionManager.openConnection(e,r),s=await n.newStream(this.protocol,r);await this._writeMessage(s,t.serialize(),r),yield UM({from:e,messageType:t.type})}catch(t){yield VM({from:e,error:t})}finally{null!=s&&s.close()}}}async _writeMessage(e,t,r){null!=r.signal&&(e=nT(e,r.signal)),await Xu([t],iT(),e,dd)}async _writeReadMessage(e,t,r){null!=r.signal&&(e=nT(e,r.signal));const n=await Xu([t],iT(),e,cT(),(async e=>{const t=await Lw(e);if(null!=t)return t;throw qe(new Error("No message received"),"ERR_NO_MESSAGE_RECEIVED")})),s=xM.deserialize(n);return s.closerPeers.forEach((e=>{this.dispatchEvent(new aA("peer",{detail:e}))})),s.providerPeers.forEach((e=>{this.dispatchEvent(new aA("peer",{detail:e}))})),s}}function HM(e,t){const r=t.key,n=ni(r).split("/");if(n.length<3)return;const s=e[n[1].toString()];if(null==s)throw qe(new Error("Invalid record keytype"),"ERR_INVALID_RECORD_KEY_TYPE");return s(r,t.value)}const qM={pk:async(e,t)=>{if(!(e instanceof Uint8Array))throw qe(new Error('"key" must be a Uint8Array'),"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(e.byteLength<5)throw qe(new Error("invalid public key record"),"ERR_INVALID_RECORD_KEY_TOO_SHORT");if("/pk/"!==ni(e.subarray(0,4)))throw qe(new Error("key was not prefixed with /pk/"),"ERR_INVALID_RECORD_KEY_BAD_PREFIX");if(!Ti(e.slice(4),(await As.digest(t)).bytes))throw qe(new Error("public key does not match passed in key"),"ERR_INVALID_RECORD_HASH_MISMATCH")}},GM={pk:function(e,t){return 0}};class WM{constructor(e,t){const{validators:r,selectors:n,peerRouting:s,queryManager:i,routingTable:o,network:a,lan:c}=t;this.components=e,this.log=He(`libp2p:kad-dht:${c?"lan":"wan"}:content-fetching`),this.validators=r,this.selectors=n,this.peerRouting=s,this.queryManager=i,this.routingTable=o,this.network=a}async putLocal(e,t){const r=_M(e);await this.components.datastore.put(r,t)}async getLocal(e){this.log("getLocal %b",e);const t=_M(e);this.log("fetching record for key %k",t);const r=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const n=ld.deserialize(r);return await HM(this.validators,n),n}async*sendCorrectionRecord(e,t,r,n={}){this.log("sendCorrection for %b",e);const s=await SM(e,r);for(const{value:i,from:o}of t){if(Ti(i,r)){this.log("record was ok");continue}if(this.components.peerId.equals(o)){try{const t=_M(e);this.log(`Storing corrected record for key ${t.toString()}`),await this.components.datastore.put(t,s.subarray())}catch(e){this.log.error("Failed error correcting self",e)}continue}let t=!1;const a=new xM(NM.PUT_VALUE,e,0);a.record=ld.deserialize(s);for await(const e of this.network.sendRequest(o,a,n))"PEER_RESPONSE"===e.name&&null!=e.record&&Ti(e.record.value,ld.deserialize(s).value)&&(t=!0),yield e;t||(yield VM({from:o,error:qe(new Error("value not put correctly"),"ERR_PUT_VALUE_INVALID")})),this.log.error("Failed error correcting entry")}}async*put(e,t,r={}){this.log("put key %b value %b",e,t);const n=await SM(e,t),s=_M(e);this.log(`storing record for key ${s.toString()}`),await this.components.datastore.put(s,n.subarray()),yield*Xu(this.peerRouting.getClosestPeers(e,{signal:r.signal}),(t=>zd(t,(t=>async()=>{if("FINAL_PEER"!==t.name)return[t];const s=[],i=new xM(NM.PUT_VALUE,e,0);i.record=ld.deserialize(n),this.log("send put to %p",t.peer.id);for await(const e of this.network.sendRequest(t.peer.id,i,r))s.push(e),"PEER_RESPONSE"===e.name&&(null!=e.record&&Ti(e.record.value,ld.deserialize(n).value)||s.push(VM({from:t.peer.id,error:qe(new Error("value not put correctly"),"ERR_PUT_VALUE_INVALID")})));return s}))),(e=>Ud(e,{ordered:!1,concurrency:uM})),(async function*(e){for await(const t of e)yield*t}))}async*get(e,t={}){this.log("get %b",e);const r=[];for await(const n of this.getMany(e,t))"VALUE"===n.name&&r.push(n),yield n;if(0===r.length)return;const n=r.map((e=>e.value));let s=0;try{s=function(e,t,r){if(0===r.length)throw qe(new Error("No records given"),"ERR_NO_RECORDS_RECEIVED");const n=ni(t).split("/");if(n.length<3)throw qe(new Error("Record key does not have a selector function"),"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY");const s=e[n[1].toString()];if(null==s){const e=`Unrecognized key prefix: ${n[1]}`;throw qe(new Error(e),"ERR_UNRECOGNIZED_KEY_PREFIX")}return 1===r.length?0:s(t,r)}(this.selectors,e,n)}catch(e){if("ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY"!==e.code)throw e}const i=n[s];if(this.log("GetValue %b %b",e,i),null==i)throw qe(new Error("best value was not found"),"ERR_NOT_FOUND");yield*this.sendCorrectionRecord(e,r,i,t),yield r[s]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const t=await this.getLocal(e);yield jM({value:t.value,from:this.components.peerId})}catch(t){this.log("error getting local value for %b",e,t)}const r=await vM(e),n=this.routingTable.closestPeers(r);this.log("found %d peers in routing table",n.length);const s=this;yield*this.queryManager.run(e,n,(async function*({peer:t,signal:r}){for await(const n of s.peerRouting.getValueOrPeers(t,e,{signal:r}))yield n,"PEER_RESPONSE"===n.name&&null!=n.record&&(yield jM({from:t,value:n.record.value}))}),t)}}class YM{constructor(e,t){const{network:r,peerRouting:n,queryManager:s,routingTable:i,providers:o,lan:a}=t;this.components=e,this.log=He(`libp2p:kad-dht:${a?"lan":"wan"}:content-routing`),this.network=r,this.peerRouting=n,this.queryManager=s,this.routingTable=i,this.providers=o}async*provide(e,t,r={}){this.log("provide %s",e),await this.providers.addProvider(e,this.components.peerId);const n=new xM(NM.ADD_PROVIDER,e.bytes,0);n.providerPeers=[{id:this.components.peerId,multiaddrs:t,protocols:[]}];let s=0;const i=t=>async()=>{if("FINAL_PEER"!==t.name)return[t];const i=[];this.log("putProvider %s to %p",e,t.peer.id);try{this.log("sending provider record for %s to %p",e,t.peer.id);for await(const o of this.network.sendMessage(t.peer.id,n,r))"PEER_RESPONSE"===o.name&&(this.log("sent provider record for %s to %p",e,t.peer.id),s++),i.push(o)}catch(e){this.log.error("error sending provide record to peer %p",t.peer.id,e),i.push(VM({from:t.peer.id,error:e}))}return i};yield*Xu(this.peerRouting.getClosestPeers(e.multihash.bytes,r),(e=>zd(e,(e=>i(e)))),(e=>Ud(e,{ordered:!1,concurrency:uM})),(async function*(e){for await(const t of e)yield*t})),this.log("sent provider records to %d peers",s)}async*findProviders(e,t){const r=this.routingTable.kBucketSize,n=e.multihash.bytes,s=await vM(n),i=this;this.log("findProviders %c",e);const o=await this.providers.getProviders(e);if(o.length>0){const e=[];for(const t of o.slice(0,r))e.push({id:t,multiaddrs:(await this.components.peerStore.addressBook.get(t)??[]).map((e=>e.multiaddr)),protocols:[]});yield UM({from:this.components.peerId,messageType:NM.GET_PROVIDERS,providers:e}),yield FM({from:this.components.peerId,providers:e})}if(o.length>=r)return;const a=async function*({peer:e,signal:t}){const r=new xM(NM.GET_PROVIDERS,n,0);yield*i.network.sendRequest(e,r,{signal:t})},c=new Set(o.map((e=>e.toString())));for await(const i of this.queryManager.run(n,this.routingTable.closestPeers(s),a,t))if(yield i,"PEER_RESPONSE"===i.name){this.log("Found %d provider entries for %c and %d closer peers",i.providers.length,e,i.closer.length);const t=[];for(const e of i.providers)c.has(e.id.toString())||(c.add(e.id.toString()),t.push(e));if(t.length>0&&(yield FM({from:i.from,providers:t})),c.size===r)return}}}class ZM{constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map((e=>e.peerId))}async add(e){if(null!=this.peerDistances.find((t=>t.peerId.equals(e))))return;const t=await EM(e),r={peerId:e,distance:RM(this.originDhtKey,t)};this.peerDistances.push(r),this.peerDistances.sort(((e,t)=>CE(e.distance,t.distance))),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async anyCloser(e){if(0===e.length)return!1;if(0===this.length)return!0;const t=await Promise.all(e.map(EM)),r=this.peerDistances[this.peerDistances.length-1].distance;for(const e of t)if(CE(RM(this.originDhtKey,e),r)<0)return!0;return!1}}class QM{constructor(e,t){const{routingTable:r,network:n,validators:s,queryManager:i,lan:o}=t;this.components=e,this.routingTable=r,this.network=n,this.validators=s,this.queryManager=i,this.log=He(`libp2p:kad-dht:${o?"lan":"wan"}:peer-routing`)}async findPeerLocal(e){let t;const r=await this.routingTable.find(e);if(null!=r){this.log("findPeerLocal found %p in routing table",e);try{t=await this.components.peerStore.get(r)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}}if(null==t)try{t=await this.components.peerStore.get(e)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}if(null!=t)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map((e=>e.multiaddr)),protocols:[]}}async*_getValueSingle(e,t,r={}){const n=new xM(NM.GET_VALUE,t,0);yield*this.network.sendRequest(e,n,r)}async*getPublicKeyFromNode(e,t={}){const r=function(e){return di([mM,e.toBytes()])}(e);for await(const n of this._getValueSingle(e,r,t))if(yield n,"PEER_RESPONSE"===n.name&&null!=n.record){const t=await Ja(tu({bytes:n.record.value}));if(!t.equals(e))throw qe(new Error("public key does not match id"),"ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(null==t.publicKey)throw qe(new Error("public key missing"),"ERR_PUBLIC_KEY_MISSING");yield jM({from:e,value:t.publicKey})}throw qe(new Error(`Node not responding with its public key: ${e.toString()}`),"ERR_INVALID_RECORD")}async*findPeer(e,t={}){this.log("findPeer %p",e);const r=await this.findPeerLocal(e);if(null!=r)return this.log("found local"),void(yield zM({from:this.components.peerId,peer:r}));const n=await EM(e),s=this.routingTable.closestPeers(n);if(null!=s.find((t=>t.equals(e))))try{const t=await this.components.peerStore.get(e);return this.log("found in peerStore"),void(yield zM({from:this.components.peerId,peer:{id:t.id,multiaddrs:t.addresses.map((e=>e.multiaddr)),protocols:[]}}))}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}const i=this,o=async function*({peer:t,signal:r}){const n=new xM(NM.FIND_NODE,e.toBytes(),0);for await(const s of i.network.sendRequest(t,n,{signal:r}))if(yield s,"PEER_RESPONSE"===s.name){const t=s.closer.find((t=>t.id.equals(e)));null!=t&&(yield zM({from:s.from,peer:t}))}};let a=!1;for await(const r of this.queryManager.run(e.toBytes(),s,o,t))"FINAL_PEER"===r.name&&(a=!0),yield r;a||(yield VM({from:this.components.peerId,error:qe(new Error("Not found"),"ERR_NOT_FOUND")}))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const r=await vM(e),n=this.routingTable.closestPeers(r),s=this,i=new ZM(r,this.routingTable.kBucketSize);await Promise.all(n.map((async e=>await i.add(e))));const o=async function*({peer:t,signal:r}){s.log("closerPeersSingle %s from %p",ni(e,"base32"),t);const n=new xM(NM.FIND_NODE,e,0);yield*s.network.sendRequest(t,n,{signal:r})};for await(const r of this.queryManager.run(e,n,o,t))yield r,"PEER_RESPONSE"===r.name&&await Promise.all(r.closer.map((async e=>await i.add(e.id))));this.log("found %d peers close to %b",i.length,e);for(const e of i.peers)yield zM({from:this.components.peerId,peer:{id:e,multiaddrs:(await this.components.peerStore.addressBook.get(e)??[]).map((e=>e.multiaddr)),protocols:[]}})}async*getValueOrPeers(e,t,r={}){for await(const n of this._getValueSingle(e,t,r)){if("PEER_RESPONSE"===n.name&&null!=n.record)try{await this._verifyRecordOnline(n.record)}catch(e){const t="invalid record received, discarded";this.log(t),yield VM({from:n.from,error:qe(new Error(t),"ERR_INVALID_RECORD")});continue}yield n}}async _verifyRecordOnline(e){if(null==e.timeReceived)throw qe(new Error("invalid record received"),"ERR_INVALID_RECORD");await HM(this.validators,new ld(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const r=await vM(e),n=this.routingTable.closestPeers(r),s=[];for(const e of n)if(!e.equals(t))try{const t=await this.components.peerStore.addressBook.get(e),r=await this.components.peerStore.protoBook.get(e);s.push({id:e,multiaddrs:t.map((e=>e.multiaddr)),protocols:r})}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}return s.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",s.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p",e,t),s}}const JM=He("libp2p:kad-dht:providers");class XM{constructor(e,t={}){const{cacheSize:r,cleanupInterval:n,provideValidity:s}=t;this.components=e,this.cleanupInterval=n??36e5,this.provideValidity=s??864e5,this.cache=Qo(r??256),this.syncQueue=new Ma({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval((()=>{this._cleanup().catch((e=>{JM.error(e)}))}),this.cleanupInterval))}async stop(){this.started=!1,null!=this.cleaner&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){return await this.syncQueue.add((async()=>{const e=Date.now();let t=0,r=0;const n=new Map,s=this.components.datastore.batch(),i=this.components.datastore.query({prefix:"/dht/provider"});for await(const e of i)try{const{cid:i,peerId:o}=tU(e.key),a=rU(e.value).getTime(),c=Date.now(),l=c-a,h=l>this.provideValidity;if(JM("comparing: %d - %d = %d > %d %s",c,a,l,this.provideValidity,h?"(expired)":""),h){r++,s.delete(e.key);const t=n.get(i)??new Set;t.add(o),n.set(i,t)}t++}catch(e){JM.error(e.message)}n.size>0?(JM("deleting %d / %d entries",r,t),await s.commit()):JM("nothing to delete");for(const[e,t]of n){const r=eU(e),n=this.cache.get(r);if(null!=n){for(const e of t)n.delete(e);0===n.size?this.cache.remove(r):this.cache.set(r,n)}}JM("Cleanup successful (%dms)",Date.now()-e)}))}async _getProvidersMap(e){const t=eU(e);let r=this.cache.get(t);return null==r&&(r=await async function(e,t){const r=new Map,n=e.query({prefix:eU(t)});for await(const e of n){const{peerId:t}=tU(e.key);r.set(t,rU(e.value))}return r}(this.components.datastore,e),this.cache.set(t,r)),r}async addProvider(e,t){return await this.syncQueue.add((async()=>{JM("%p provides %s",t,e);const r=await this._getProvidersMap(e);JM("loaded %s provs",r.size);const n=new Date;r.set(t.toString(),n);const s=eU(e);this.cache.set(s,r),await async function(e,t,r,n){const s=[eU(t),"/",r.toString()].join(""),i=new Do(s),o=Uint8Array.from(ui.encode(n.getTime()));return await e.put(i,o)}(this.components.datastore,e,t,n)}))}async getProviders(e){return await this.syncQueue.add((async()=>(JM("get providers for %s",e),[...(await this._getProvidersMap(e)).keys()].map((e=>Za(e))))))}}function eU(e){return`/dht/provider/${"string"==typeof e?e:ni(e.multihash.bytes,"base32")}`}function tU(e){const t=e.toString().split("/");if(5!==t.length)throw new Error(`incorrectly formatted provider entry key in datastore: ${e.toString()}`);return{cid:t[3],peerId:t[4]}}function rU(e){return new Date(ui.decode(e))}const nU=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");const sU="running-queries";class iU{constructor(e,t){const{lan:r=!1,disjointPaths:n=hM,alpha:s=uM}=t;this.components=e,this.disjointPaths=n??hM,this.controllers=new Set,this.running=!1,this.alpha=s??uM,this.lan=r,this.queries=0}isStarted(){return this.running}async start(){this.running=!0}async stop(){this.running=!1;for(const e of this.controllers)e.abort();this.controllers.clear()}async*run(e,t,r,n={}){if(!this.running)throw new Error("QueryManager not started");let s;if(null==n.signal){s=new ei.TimeoutController(gM),n.signal=s.signal;try{null!=jO.setMaxListeners&&(0,jO.setMaxListeners)(1/0,s.signal)}catch{}}const i=new AbortController;this.controllers.add(i);const o=[i.signal];null!=n.signal&&o.push(n.signal);const a=(0,Oo.anySignal)(o);try{null!=jO.setMaxListeners&&(0,jO.setMaxListeners)(1/0,a)}catch{}const c=He(`libp2p:kad-dht:${this.lan?"lan":"wan"}:query:`+ni(e,"base58btc")),l=t.slice(0,Math.min(this.disjointPaths,t.length)),h=Date.now(),u=new iA;try{if(c("query:start"),this.queries++,this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:sU,value:this.queries}),0===t.length)return void c.error("Running query with no peers");const o=new ix,d=l.map(((t,s)=>async function*(e){const{key:t,startingPeer:r,ourPeerId:n,signal:s,query:i,alpha:o,pathIndex:a,numPaths:c,cleanUp:l,queryFuncTimeout:h,log:u,peersSeen:d}=e,p=new Ma({concurrency:o}),f=await vM(t);!function e(r,o){if(null==r)return;d.add(r);const l=BigInt("0x"+ni(RM(o,f),"base16"));p.add((async()=>{let o;const y=[s];null!=h&&(o=new ei.TimeoutController(h),y.push(o.signal));const g=(0,Oo.anySignal)(y);try{for await(const s of i({key:t,peer:r,signal:g,pathIndex:a,numPaths:c})){if(g.aborted)return;if("PEER_RESPONSE"===s.name)for(const i of s.closer){if(d.has(i.id)){u("already seen %p in query",i.id);continue}if(n.equals(i.id)){u("not querying ourselves");continue}const s=await EM(i.id);BigInt("0x"+ni(RM(s,f),"base16"))>l?u("skipping %p as they are not closer to %b than %p",i.id,t,r):(u("querying closer peer %p",i.id),e(i.id,s))}p.emit("completed",s)}o?.clear()}catch(e){s.aborted?p.emit("error",e):p.emit("completed",VM({from:r,error:e}))}finally{o?.clear()}}),{priority:nU-l}).catch((e=>{u.error(e)}))}(r,await EM(r)),yield*async function*(e,t,r,n){let s=Bd(),i=!0;const o=[],a=()=>{i&&(n("clean up queue, results %d, queue size %d, pending tasks %d",o.length,e.size,e.pending),i=!1,e.clear(),o.splice(0,o.length))};for(e.on("completed",(e=>{o.push(e),s.resolve()})),e.on("error",(e=>{n("queue error",e),a(),s.reject(e)})),e.on("idle",(()=>{n("queue idle"),i=!1,s.resolve()})),t.addEventListener("abort",(()=>{n("abort queue");const e=i;a(),e&&s.reject(qe(new Error("Query aborted"),"ERR_QUERY_ABORTED"))})),r.addEventListener("cleanup",(()=>{a(),s.resolve()}));i;)for(await s.promise,s=Bd();o.length>0;){const e=o.shift();null!=e&&(yield e)}yield*o}(p,s,l,u)}({key:e,startingPeer:t,ourPeerId:this.components.peerId,signal:a,query:r,pathIndex:s,numPaths:l.length,alpha:this.alpha,cleanUp:u,queryFuncTimeout:n.queryFuncTimeout,log:c,peersSeen:o})));for await(const e of dS(...d))yield e,"QUERY_ERROR"===e.name&&c("error",e.error)}catch(e){if(this.running||"ERR_QUERY_ABORTED"!==e.code)throw e}finally{this.controllers.delete(i),null!=s&&s.clear(),this.queries--,this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:sU,value:this.queries}),u.dispatchEvent(new aA("cleanup")),c("query:done in %dms",Date.now()-h)}}}const oU=He("libp2p:kad-dht:rpc:handlers:add-provider");class aU{constructor(e){const{providers:t}=e;this.providers=t}async handle(e,t){if(oU("start"),null==t.key||0===t.key.length)throw qe(new Error("Missing key"),"ERR_MISSING_KEY");let r;try{r=kt.decode(t.key)}catch(e){throw qe(new Error("Invalid CID"),"ERR_INVALID_CID")}null!=t.providerPeers&&0!==t.providerPeers.length||oU.error("no providers found in message"),await Promise.all(t.providerPeers.map((async t=>{t.id.equals(e)?t.multiaddrs.length<1?oU("no valid addresses for provider %p. Ignore",e):(oU("received provider %p for %s (addrs %s)",e,r,t.multiaddrs.map((e=>e.toString()))),await this.providers.addProvider(r,t.id)):oU("invalid provider peer %p from %p",t.id,e)})))}}const cU=He("libp2p:kad-dht:rpc:handlers:find-node");class lU{constructor(e,t){const{peerRouting:r,lan:n}=t;this.components=e,this.peerRouting=r,this.lan=Boolean(n)}async handle(e,t){cU("incoming request from %p for peers closer to %b",e,t.key);let r=[];r=Ti(this.components.peerId.toBytes(),t.key)?[{id:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map((e=>e.decapsulateCode(hi("p2p").code))),protocols:[]}]:await this.peerRouting.getCloserPeersOffline(t.key,e),r=r.map(this.lan?bM:wM).filter((({multiaddrs:e})=>e.length));const n=new xM(t.type,new Uint8Array(0),t.clusterLevel);return r.length>0?n.closerPeers=r:cU("could not find any peers closer to %b than %p",t.key,e),n}}const hU=He("libp2p:kad-dht:rpc:handlers:get-providers");class uU{constructor(e,t){const{peerRouting:r,providers:n,lan:s}=t;this.components=e,this.peerRouting=r,this.providers=n,this.lan=Boolean(s)}async handle(e,t){let r;try{r=kt.decode(t.key)}catch(e){throw qe(new Error("Invalid CID"),"ERR_INVALID_CID")}hU("%p asking for providers for %s",e,r);const[n,s]=await Promise.all([this.providers.getProviders(r),this.peerRouting.getCloserPeersOffline(t.key,e)]),i=await this._getPeers(n),o=await this._getPeers(s.map((({id:e})=>e))),a=new xM(t.type,t.key,t.clusterLevel);return i.length>0&&(a.providerPeers=i),o.length>0&&(a.closerPeers=o),hU("got %s providers %s closerPeers",i.length,o.length),a}async _getAddresses(e){return(await this.components.peerStore.addressBook.get(e)).map((e=>e.multiaddr))}async _getPeers(e){const t=[],r=this.lan?bM:wM;for(const n of e){const e=r({id:n,multiaddrs:await this._getAddresses(n),protocols:[]});e.multiaddrs.length>0&&t.push(e)}return t}}const dU=He("libp2p:kad-dht:rpc:handlers:get-value");class pU{constructor(e,t){const{peerRouting:r}=t;this.components=e,this.peerRouting=r}async handle(e,t){const r=t.key;if(dU("%p asked for key %b",e,r),null==r||0===r.length)throw qe(new Error("Invalid key"),"ERR_INVALID_KEY");const n=new xM(NM.GET_VALUE,r,t.clusterLevel);if(function(e){return"/pk/"===ni(e.subarray(0,4))}(r)){dU("is public key");const e=function(e){return Qa(e.subarray(4))}(r);let t;try{const r=await this.components.peerStore.keyBook.get(e);if(null==r)throw qe(new Error("No public key found in key book"),"ERR_NOT_FOUND");t=r}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}if(null!=t)return dU("returning found public key"),n.record=new ld(r,t,new Date),n}const[s,i]=await Promise.all([this._checkLocalDatastore(r),this.peerRouting.getCloserPeersOffline(t.key,e)]);return null!=s&&(dU("had record for %b in local datastore",r),n.record=s),i.length>0&&(dU("had %s closer peers in routing table",i.length),n.closerPeers=i),n}async _checkLocalDatastore(e){dU("checkLocalDatastore looking for %b",e);const t=_M(e);let r;try{r=await this.components.datastore.get(t)}catch(e){if("ERR_NOT_FOUND"===e.code)return;throw e}const n=ld.deserialize(r);if(null==n)throw qe(new Error("Invalid record"),"ERR_INVALID_RECORD");if(!(null==n.timeReceived||Date.now()-n.timeReceived.getTime()>1296e5))return n;await this.components.datastore.delete(t)}}const fU=He("libp2p:kad-dht:rpc:handlers:ping");class yU{async handle(e,t){return fU("ping from %p",e),t}}class gU{constructor(e,t){const{validators:r}=t;this.components=e,this.log=He("libp2p:kad-dht:rpc:handlers:put-value"),this.validators=r}async handle(e,t){const r=t.key;this.log("%p asked us to store value for key %b",e,r);const n=t.record;if(null==n){const t=`Empty record from: ${e.toString()}`;throw this.log.error(t),qe(new Error(t),"ERR_EMPTY_RECORD")}try{await HM(this.validators,n),n.timeReceived=new Date;const e=_M(n.key);await this.components.datastore.put(e,n.serialize().subarray()),this.log("put record for %b into datastore under key %k",r,e)}catch(e){this.log("did not put record for key %b into datastore %o",r,e)}return t}}class mU{constructor(e,t){const{providers:r,peerRouting:n,validators:s,lan:i}=t;this.log=He("libp2p:kad-dht:rpc"),this.routingTable=t.routingTable,this.handlers={[NM.GET_VALUE]:new pU(e,{peerRouting:n}),[NM.PUT_VALUE]:new gU(e,{validators:s}),[NM.FIND_NODE]:new lU(e,{peerRouting:n,lan:i}),[NM.ADD_PROVIDER]:new aU({providers:r}),[NM.GET_PROVIDERS]:new uU(e,{peerRouting:n,providers:r,lan:i}),[NM.PING]:new yU}}async handleMessage(e,t){try{await this.routingTable.add(e)}catch(e){this.log.error("Failed to update the kbucket store",e)}const r=this.handlers[t.type];if(null!=r)return await r.handle(e,t);this.log.error(`no handler found for message type: ${t.type}`)}onIncomingStream(e){Promise.resolve().then((async()=>{const{stream:t,connection:r}=e,n=r.remotePeer;try{await this.routingTable.add(n)}catch(e){this.log.error(e)}const s=this;await Xu(t,cT(),(async function*(e){for await(const t of e){const e=xM.deserialize(t);s.log("incoming %s from %p",e.type,n);const r=await s.handleMessage(n,e);null!=r&&(yield r.serialize())}}),iT(),t)})).catch((e=>{this.log.error(e)}))}}class wU extends iA{constructor(e,t){super();const{protocol:r,lan:n}=t;this.components=e,this.log=He("libp2p:kad-dht:topology-listener:"+(n?"lan":"wan")),this.running=!1,this.protocol=r}isStarted(){return this.running}async start(){if(this.running)return;this.running=!0;const e=rA({onConnect:e=>{this.log("observed peer %p with protocol %s",e,this.protocol),this.dispatchEvent(new aA("peer",{detail:e}))}});this.registrarId=await this.components.registrar.register(this.protocol,e)}stop(){this.running=!1,null!=this.registrarId&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class bU{constructor(e,t){const{peerRouting:r,lan:n,count:s,interval:i,queryTimeout:o}=t;this.components=e,this.log=He(`libp2p:kad-dht:${n?"lan":"wan"}:query-self`),this.running=!1,this.peerRouting=r,this.count=s??hM,this.interval=i??dM,this.queryTimeout=o??pM}isStarted(){return this.running}async start(){this.running||(this.running=!0,this._querySelf())}async stop(){this.running=!1,null!=this.timeoutId&&clearTimeout(this.timeoutId),null!=this.controller&&this.controller.abort()}_querySelf(){Promise.resolve().then((async()=>{const e=new ei.TimeoutController(this.queryTimeout);try{this.controller=new AbortController;const t=(0,Oo.anySignal)([this.controller.signal,e.signal]);try{null!=jO.setMaxListeners&&(0,jO.setMaxListeners)(1/0,t)}catch{}const r=await Xu(this.peerRouting.getClosestPeers(this.components.peerId.toBytes(),{signal:t}),(e=>async function*(e,t){let r=0;if(!(t<1))for await(const n of e)if(yield n,r++,r===t)return}(e,this.count)),(async e=>await dE(e)));this.log("query ran successfully - found %d peers",r)}catch(e){this.log("query error",e)}finally{this.timeoutId=setTimeout(this._querySelf.bind(this),this.interval),e.clear()}})).catch((e=>{this.log("query error",e)}))}}class vU extends iA{constructor(e,t){super();const{kBucketSize:r,clientMode:n,validators:s,selectors:i,querySelfInterval:o,lan:a,protocolPrefix:c,pingTimeout:l,pingConcurrency:h,maxInboundStreams:u,maxOutboundStreams:d}=t;this.running=!1,this.components=e,this.lan=Boolean(a),this.log=He("libp2p:kad-dht:"+(!0===a?"lan":"wan")),this.protocol=`${c??"/ipfs"}${!0===a?"/lan":""}/kad/1.0.0`,this.kBucketSize=r??20,this.clientMode=n??!0,this.maxInboundStreams=u??32,this.maxOutboundStreams=d??64,this.routingTable=new IM(e,{kBucketSize:r,lan:this.lan,pingTimeout:l,pingConcurrency:h,protocol:this.protocol}),this.providers=new XM(e),this.validators={...qM,...s},this.selectors={...GM,...i},this.network=new $M(e,{protocol:this.protocol,lan:this.lan}),this.queryManager=new iU(e,{disjointPaths:Math.ceil(this.kBucketSize/2),lan:a}),this.peerRouting=new QM(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,lan:this.lan}),this.contentFetching=new WM(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,network:this.network,lan:this.lan}),this.contentRouting=new YM(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,lan:this.lan}),this.routingTableRefresh=new TM({peerRouting:this.peerRouting,routingTable:this.routingTable,lan:this.lan}),this.rpc=new mU(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,lan:this.lan}),this.topologyListener=new wU(e,{protocol:this.protocol,lan:this.lan}),this.querySelf=new bU(e,{peerRouting:this.peerRouting,interval:o,lan:this.lan}),this.network.addEventListener("peer",(e=>{const t=e.detail;this.onPeerConnect(t).catch((e=>{this.log.error("could not add %p to routing table",t.id,e)})),this.dispatchEvent(new aA("peer",{detail:t}))})),this.topologyListener.addEventListener("peer",(e=>{const t=e.detail;Promise.resolve().then((async()=>{const e=await this.components.peerStore.addressBook.get(t),r={id:t,multiaddrs:e.map((e=>e.multiaddr)),protocols:[]};await this.onPeerConnect(r)})).catch((e=>{this.log.error("could not add %p to routing table",t,e)}))}))}get[TO](){return!0}get[Symbol.toStringTag](){return"@libp2p/kad-dht"}async onPeerConnect(e){if(this.log("peer %p connected with protocols %s",e.id,e.protocols),0!==(e=this.lan?bM(e):wM(e)).multiaddrs.length)try{await this.routingTable.add(e.id)}catch(t){this.log.error("could not add %p to routing table",e.id,t)}else this.log("ignoring %p as they do not have any %s addresses in %s",e.id,this.lan?"private":"public",e.multiaddrs.map((e=>e.toString())))}isStarted(){return this.running}async getMode(){return this.clientMode?"client":"server"}async setMode(e){await this.components.registrar.unhandle(this.protocol),"client"===e?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),await Promise.all([this.providers.start(),this.queryManager.start(),this.network.start(),this.routingTable.start(),this.topologyListener.start(),this.querySelf.start()]),await this.routingTableRefresh.start()}async stop(){this.running=!1,await Promise.all([this.providers.stop(),this.queryManager.stop(),this.network.stop(),this.routingTable.stop(),this.routingTableRefresh.stop(),this.topologyListener.stop(),this.querySelf.stop()])}async*put(e,t,r={}){yield*this.contentFetching.put(e,t,r)}async*get(e,t={}){yield*this.contentFetching.get(e,t)}async*provide(e,t={}){yield*this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t)}async*findProviders(e,t={}){yield*this.contentRouting.findProviders(e,t)}async*findPeer(e,t={}){yield*this.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t={}){yield*this.peerRouting.getClosestPeers(e,t)}async refreshRoutingTable(){await this.routingTableRefresh.refreshTable(!0)}}const EU=He("libp2p:kad-dht");class _U extends iA{constructor(e,t,r){super(),this.components=e,this.wan=t,this.lan=r,this.wan.addEventListener("peer",(e=>{this.dispatchEvent(new aA("peer",{detail:e.detail}))})),this.lan.addEventListener("peer",(e=>{this.dispatchEvent(new aA("peer",{detail:e.detail}))}))}get[TO](){return!0}get[Symbol.toStringTag](){return"@libp2p/dual-kad-dht"}isStarted(){return this.wan.isStarted()&&this.lan.isStarted()}async getMode(){return await this.wan.getMode()}async setMode(e){await this.wan.setMode(e)}async start(){await Promise.all([this.lan.start(),this.wan.start()])}async stop(){await Promise.all([this.lan.stop(),this.wan.stop()])}async*put(e,t,r={}){for await(const n of dS(this.lan.put(e,t,r),this.wan.put(e,t,r)))yield n}async*get(e,t={}){let r=!1,n=!1;for await(const s of dS(this.lan.get(e,t),this.wan.get(e,t)))yield s,"DIALING_PEER"===s.name&&(r=!0),"VALUE"===s.name&&(r=!0,null!=s.value&&(n=!0)),"SENDING_QUERY"===s.name&&(r=!0);if(!r)throw qe(new Error("No peers found in routing table!"),"ERR_NO_PEERS_IN_ROUTING_TABLE");n||(yield VM({from:this.components.peerId,error:qe(new Error("Not found"),"ERR_NOT_FOUND")}))}async*provide(e,t={}){let r=0,n=0;const s=[],i=[this.lan];"server"===await this.wan.getMode()&&i.push(this.wan);for await(const o of dS(...i.map((r=>r.provide(e,t)))))yield o,"SENDING_QUERY"===o.name&&r++,"QUERY_ERROR"===o.name&&s.push(o.error),"PEER_RESPONSE"===o.name&&"ADD_PROVIDER"===o.messageName&&(EU("sent provider record for %s to %p",e,o.from),n++);if(0===n){if(s.length>0)throw qe(new Error(`Failed to provide to ${s.length} of ${r} peers`),"ERR_PROVIDES_FAILED",{errors:s});throw qe(new Error("Failed to provide - no peers found"),"ERR_PROVIDES_FAILED")}}async*findProviders(e,t={}){yield*dS(this.lan.findProviders(e,t),this.wan.findProviders(e,t))}async*findPeer(e,t={}){let r=!1;for await(const n of dS(this.lan.findPeer(e,t),this.wan.findPeer(e,t)))yield n,"SENDING_QUERY"!==n.name&&"FINAL_PEER"!==n.name||(r=!0);if(!r)throw qe(new Error("Peer lookup failed"),"ERR_LOOKUP_FAILED")}async*getClosestPeers(e,t={}){yield*dS(this.lan.getClosestPeers(e,t),this.wan.getClosestPeers(e,t))}async refreshRoutingTable(){await Promise.all([this.lan.refreshRoutingTable(),this.wan.refreshRoutingTable()])}}class SU extends _U{constructor(e,t){super(e,new vU(e,{protocolPrefix:"/ipfs",...t,lan:!1}),new vU(e,{protocolPrefix:"/ipfs",...t,clientMode:!1,lan:!0}))}}const AU=He("libp2p:bootstrap");class IU extends iA{constructor(e,t={list:[]}){if(null==t.list||0===t.list.length)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=e,this.timeout=t.timeout??1e3,this.list=[];for(const e of t.list){if(!ho.matches(e)){AU.error("Invalid multiaddr");continue}const t=Ki(e),r=t.getPeerId();if(null==r){AU.error("Invalid bootstrap multiaddr without peer id");continue}const n={id:Za(r),multiaddrs:[t],protocols:[]};this.list.push(n)}this._init=t}get[TO](){return!0}get[Symbol.toStringTag](){return"@libp2p/bootstrap"}isStarted(){return Boolean(this.timer)}start(){this.isStarted()||(AU("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout((()=>{this._discoverBootstrapPeers().catch((e=>{AU.error(e)}))}),this.timeout))}async _discoverBootstrapPeers(){if(null!=this.timer)for(const e of this.list){if(await this.components.peerStore.tagPeer(e.id,this._init.tagName??"bootstrap",{value:this._init.tagValue??50,ttl:this._init.tagTTL??12e4}),null==this.timer)return;this.dispatchEvent(new aA("peer",{detail:e}))}}stop(){null!=this.timer&&clearTimeout(this.timer),this.timer=void 0}}IU.tag="bootstrap";const RU=WebSocket;var kU=r(42929);const TU=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==r[o])throw new TypeError(i+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,s=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*l+1>>>0,o=new Uint8Array(i);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var u=0,d=i-1;(0!==h||u<s)&&-1!==d;d--,u++)h+=a*o[d]>>>0,o[d]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");s=u,t++}if(" "!==e[t]){for(var p=i-s;p!==i&&0===o[p];)p++;for(var f=new Uint8Array(n+(i-p)),y=n;p!==i;)f[y++]=o[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var o=(i-s)*h+1>>>0,l=new Uint8Array(o);s!==i;){for(var u=t[s],d=0,p=o-1;(0!==u||d<n)&&-1!==p;p--,d++)u+=256*l[p]>>>0,l[p]=u%a>>>0,u=u/a>>>0;if(0!==u)throw new Error("Non-zero carry");n=d,s++}for(var f=o-n;f!==o&&0===l[f];)f++;for(var y=c.repeat(r);f<o;++f)y+=e.charAt(l[f]);return y},decodeUnsafe:u,decode:function(e){var r=u(e);if(r)return r;throw new Error(`Non-${t} character`)}}},CU=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class PU{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class NU{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return OU(this,e)}}class DU{constructor(e){this.decoders=e}or(e){return OU(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const OU=(e,t)=>new DU({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class xU{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new PU(e,t,r),this.decoder=new NU(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const LU=({name:e,prefix:t,encode:r,decode:n})=>new xU(e,t,r,n),BU=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:s}=TU(r,t);return LU({prefix:e,name:t,encode:n,decode:e=>CU(s(e))})},MU=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>LU({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],s=(1<<r)-1;let i="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,i+=t[s&a>>o];if(o&&(i+=t[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i})(e,n,r),decode:t=>((e,t,r,n)=>{const s={};for(let e=0;e<t.length;++e)s[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,l=0;for(let t=0;t<i;++t){const i=s[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),UU=LU({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),zU=MU({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),VU=MU({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),FU=BU({prefix:"9",name:"base10",alphabet:"0123456789"}),jU=MU({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),KU=MU({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),$U=MU({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),HU=MU({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),qU=MU({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),GU=MU({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),WU=MU({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),YU=MU({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ZU=MU({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),QU=MU({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),JU=MU({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),XU=BU({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ez=BU({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),tz=BU({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),rz=BU({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),nz=MU({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),sz=MU({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),iz=MU({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),oz=MU({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),az=Array.from(""),cz=az.reduce(((e,t,r)=>(e[r]=t,e)),[]),lz=az.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]),hz=LU({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+cz[t]),"")},decode:function(e){const t=[];for(const r of e){const e=lz[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var uz=Math.pow(2,31),dz=Math.pow(2,7),pz=Math.pow(2,14),fz=Math.pow(2,21),yz=Math.pow(2,28),gz=Math.pow(2,35),mz=Math.pow(2,42),wz=Math.pow(2,49),bz=Math.pow(2,56),vz=Math.pow(2,63),Ez={encode:function e(t,r,n){r=r||[];for(var s=n=n||0;t>=uz;)r[n++]=255&t|128,t/=128;for(;-128&t;)r[n++]=255&t|128,t>>>=7;return r[n]=0|t,e.bytes=n-s+1,r},decode:function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(127&n)<<i:(127&n)*Math.pow(2,i),i+=7}while(n>=128);return e.bytes=o-r,s},encodingLength:function(e){return e<dz?1:e<pz?2:e<fz?3:e<yz?4:e<gz?5:e<mz?6:e<wz?7:e<bz?8:e<vz?9:10}};const _z=Ez,Sz=(e,t,r=0)=>(_z.encode(e,t,r),t),Az=e=>_z.encodingLength(e),Iz=(e,t)=>{const r=t.byteLength,n=Az(e),s=n+Az(r),i=new Uint8Array(s+r);return Sz(e,i,0),Sz(r,i,n),i.set(t,s),new Rz(e,r,t,i)};class Rz{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const kz=({name:e,code:t,encode:r})=>new Tz(e,t,r);class Tz{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Iz(this.code,t):t.then((e=>Iz(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Cz=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Pz=kz({name:"sha2-256",code:18,encode:Cz("SHA-256")}),Nz=kz({name:"sha2-512",code:19,encode:Cz("SHA-512")}),Dz=CU,Oz={code:0,name:"identity",encode:Dz,digest:e=>Iz(0,Dz(e))},xz="raw",Lz=85,Bz=e=>CU(e),Mz=e=>CU(e),Uz=new TextEncoder,zz=new TextDecoder,Vz="json",Fz=512,jz=e=>Uz.encode(JSON.stringify(e)),Kz=e=>JSON.parse(zz.decode(e));r(82784);class $z{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this.byteOffset=n.byteOffset,this.byteLength=n.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:esm_src_cid_hidden,byteLength:esm_src_cid_hidden,code:esm_src_cid_readonly,version:esm_src_cid_readonly,multihash:esm_src_cid_readonly,bytes:esm_src_cid_readonly,_baseCache:esm_src_cid_hidden,asCID:esm_src_cid_hidden})}toV0(){if(0===this.version)return this;{const{code:e,multihash:t}=this;if(e!==esm_src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==esm_src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return $z.createV0(t)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return $z.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Digest.equals(this.multihash,e.multihash)}toString(e){const{bytes:t,version:r,_baseCache:n}=this;return 0===r?esm_src_cid_toStringV0(t,n,e||base58btc.encoder):esm_src_cid_toStringV1(t,n,e||base32.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return src_cid_deprecate(/^0\.0/,src_cid_IS_CID_DEPRECATION),!(!e||!e[esm_src_cid_cidSymbol]&&e.asCID!==e)}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof $z)return e;if(null!=e&&e.asCID===e){const{version:t,code:r,multihash:n,bytes:s}=e;return new $z(t,r,n,s||esm_src_cid_encodeCID(t,r,n.bytes))}if(null!=e&&!0===e[esm_src_cid_cidSymbol]){const{version:t,multihash:r,code:n}=e,s=Digest.decode(r);return $z.create(t,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");switch(e){case 0:if(t!==esm_src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${esm_src_cid_DAG_PB_CODE}) block encoding`);return new $z(e,t,r,r.bytes);case 1:{const n=esm_src_cid_encodeCID(e,t,r.bytes);return new $z(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return $z.create(0,esm_src_cid_DAG_PB_CODE,e)}static createV1(e,t){return $z.create(1,e,t)}static decode(e){const[t,r]=$z.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=$z.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),i=new Digest.Digest(t.multihashCode,t.digestSize,s,n);return[0===t.version?$z.createV0(i):$z.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){const t=()=>{const[t,r]=varint.decode(e.subarray(0));return t};let r=t(),n=esm_src_cid_DAG_PB_CODE;if(18===r||1===r&&t(),0!==r&&1!==r)throw new RangeError(`Invalid CID version ${r}`);const s=t(),i=t(),o=0+i;return{version:r,codec:n,multihashCode:s,digestSize:i,multihashSize:o-0,size:o}}static parse(e,t){const[r,n]=esm_src_cid_parseCIDtoBytes(e,t),s=$z.decode(n);return s._baseCache.set(r,e),s}}Symbol.for("@ipld/js-cid/CID");const Hz={...ee,...te,...re,...ne,...se,...ie,...oe,...ae,...ce,...le};function qz(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Gz(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Wz=Gz("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Yz=Gz("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=function(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?qz(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),Zz={utf8:Wz,"utf-8":Wz,hex:Hz.base16,latin1:Yz,ascii:Yz,binary:Yz,...Hz};function Qz(e){return e instanceof ArrayBuffer||"ArrayBuffer"===e?.constructor?.name&&"number"==typeof e?.byteLength}const Jz=e=>{if(e.readyState>=2)throw new Error("socket closed");if(1!==e.readyState)return new Promise(((t,r)=>{function n(){e.removeEventListener("open",s),e.removeEventListener("error",i)}function s(){n(),t()}function i(t){n(),r(t.error??new Error(`connect ECONNREFUSED ${e.url}`))}e.addEventListener("open",s),e.addEventListener("error",i)}))},Xz=(e,t)=>((t=t??{}).closeOnEnd=!1!==t.closeOnEnd,async r=>{for await(const t of r){try{await Jz(e)}catch(e){if("socket closed"===e.message)break;throw e}e.send(t)}if(null!=t.closeOnEnd&&e.readyState<=1)return await new Promise(((t,r)=>{e.addEventListener("close",(e=>{if(e.wasClean||1006===e.code)t();else{const t=Object.assign(new Error("ws error"),{event:e});r(t)}})),setTimeout((()=>e.close()))}))}),eV={http:"ws",https:"wss"};function tV(e,t){t=t??{};const r=((e,t)=>(0,mo.relative)(e,t,eV,"ws"))(e,("undefined"==typeof window?"":window.location).toString());return((e,t)=>{t=t??{};const r=(e=>{e.binaryType="arraybuffer";const t=async()=>await new Promise(((t,r)=>{if(s)return t();if(null!=n)return r(n);const i=t=>{e.removeEventListener("open",o),e.removeEventListener("error",a),t()},o=()=>i(t),a=t=>{i((()=>r(t.error??new Error(`connect ECONNREFUSED ${e.url}`))))};e.addEventListener("open",o),e.addEventListener("error",a)})),r=async function*(){const r=new kU.zN((({push:t,stop:r,fail:n})=>{const s=e=>{let r=null;"string"==typeof e.data&&(r=function(e,t="utf8"){const r=Zz[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):qz(globalThis.Buffer.from(e,"utf-8"))}(e.data)),Qz(e.data)&&(r=new Uint8Array(e.data)),e.data instanceof Uint8Array&&(r=e.data),null!=r&&t(r)},i=e=>n(e.error??new Error("Socket error"));return e.addEventListener("message",s),e.addEventListener("error",i),e.addEventListener("close",r),()=>{e.removeEventListener("message",s),e.removeEventListener("error",i),e.removeEventListener("close",r)}}),{highWaterMark:1/0});await t();for await(const e of r)yield Qz(e)?new Uint8Array(e):e}();let n,s=1===e.readyState;return e.addEventListener("open",(()=>{s=!0,n=null})),e.addEventListener("close",(()=>{s=!1,n=null})),e.addEventListener("error",(t=>{s||(n=t.error??new Error(`connect ECONNREFUSED ${e.url}`))})),Object.assign(r,{connected:t})})(e);let n=t.remoteAddress,s=t.remotePort;if(null!=e.url)try{const t=new URL(e.url);n=t.hostname,s=parseInt(t.port,10)}catch{}if(null==n||null==s)throw new Error("Remote connection did not have address and/or port");return{sink:Xz(e,t),source:r,connected:async()=>await r.connected(),close:async()=>{e.readyState!==e.CONNECTING&&e.readyState!==e.OPEN||await new Promise((t=>{e.addEventListener("close",(()=>{t()})),e.close()}))},destroy:()=>{null!=e.terminate?e.terminate():e.close()},remoteAddress:n,remotePort:s,socket:e}})(new RU(r,t.websocket),t)}class rV extends Error{constructor(e){super(e),this.name="TimeoutError"}}class nV extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const sV=e=>void 0===globalThis.DOMException?new nV(e):new DOMException(e),iV=e=>{const t=void 0===e.reason?sV("This operation was aborted."):e.reason;return t instanceof Error?t:sV(t)},oV=He("libp2p:websockets:socket");const aV=He("libp2p:websockets");class cV{constructor(e){this.init=e}get[Symbol.toStringTag](){return"@libp2p/websockets"}get[kO](){return!0}async dial(e,t){aV("dialing %s",e),t=t??{};const r=function(e,t,r){const n={async sink(t){null!=r?.signal&&(t=tT(t,r.signal));try{await e.sink(t)}catch(e){"aborted"!==e.type&&oV.error(e)}},source:null!=(r=r??{}).signal?tT(e.source,r.signal):e.source,remoteAddr:t,timeline:{open:Date.now()},async close(){const t=Date.now();try{await function(e,t){const{milliseconds:r,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout}}=t;let o;const a=new Promise(((a,c)=>{if("number"!=typeof r||1!==Math.sign(r))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(r!==Number.POSITIVE_INFINITY){if(t.signal){const{signal:e}=t;e.aborted&&c(iV(e)),e.addEventListener("abort",(()=>{c(iV(e))}))}o=i.setTimeout.call(void 0,(()=>{if(n){try{a(n())}catch(e){c(e)}return}const t=s instanceof Error?s:new rV("string"==typeof s?s:`Promise timed out after ${r} milliseconds`);"function"==typeof e.cancel&&e.cancel(),c(t)}),r),(async()=>{try{a(await e)}catch(e){c(e)}finally{i.clearTimeout.call(void 0,o)}})()}else a(e)}));return a.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},a}(e.close(),{milliseconds:2e3})}catch(r){const{host:s,port:i}=n.remoteAddr.toOptions();oV("timeout closing stream to %s:%s after %dms, destroying it manually",s,i,Date.now()-t),e.destroy()}finally{n.timeline.close=Date.now()}}};return e.socket.addEventListener("close",(()=>{null==n.timeline.close&&(n.timeline.close=Date.now())}),{once:!0}),n}(await this._connect(e,t),e);aV("new outbound connection %s",r.remoteAddr);const n=await t.upgrader.upgradeOutbound(r);return aV("outbound connection %s upgraded",r.remoteAddr),n}async _connect(e,t){if(!0===t?.signal?.aborted)throw new eM;const r=e.toOptions();aV("dialing %s:%s",r.host,r.port);const n=Bd(),s=e=>{aV.error("connection error:",e),n.reject(e)},i=tV(Gw(e),this.init);if(null!=i.socket.on?i.socket.on("error",s):i.socket.onerror=s,null==t.signal)return await Promise.race([i.connected(),n.promise]),aV("connected %s",e),i;let o;const a=new Promise(((e,r)=>{if(o=()=>{r(new eM),i.close().catch((e=>{aV.error("error closing raw socket",e)}))},!0===t?.signal?.aborted)return o();t?.signal?.addEventListener("abort",o)}));try{await Promise.race([a,n.promise,i.connected()])}finally{null!=o&&t?.signal?.removeEventListener("abort",o)}return aV("connected %s",e),i}createListener(e){return function(){throw new Error("WebSocket Servers can not be created in the browser!")}(this.init)}filter(e){return e=Array.isArray(e)?e:[e],null!=this.init?.filter?this.init?.filter(e):ZL||eB?function(e){return e.filter((e=>{if(e.protoCodes().includes(290))return!1;const t=e.decapsulateCode(421);return eo.matches(t)&&Gi.matches(t.decapsulateCode(6).decapsulateCode(478))}))}(e):function(e){return e.filter((e=>{if(e.protoCodes().includes(290))return!1;const t=e.decapsulateCode(421);return Xi.matches(t)||eo.matches(t)}))}(e)}}function lV(e){return new Uint8Array(e)}var hV;!function(e){e[e.NEW_STREAM=0]="NEW_STREAM",e[e.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",e[e.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",e[e.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",e[e.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",e[e.RESET_RECEIVER=5]="RESET_RECEIVER",e[e.RESET_INITIATOR=6]="RESET_INITIATOR"}(hV||(hV={}));const uV=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),dV=Object.freeze({NEW_STREAM:hV.NEW_STREAM,MESSAGE:hV.MESSAGE_INITIATOR,CLOSE:hV.CLOSE_INITIATOR,RESET:hV.RESET_INITIATOR}),pV=Object.freeze({MESSAGE:hV.MESSAGE_RECEIVER,CLOSE:hV.CLOSE_RECEIVER,RESET:hV.RESET_RECEIVER}),fV=10240,yV=new class{constructor(){this._pool=lV(fV),this._poolOffset=0}write(e){const t=this._pool;let r=this._poolOffset;ui.encode(e.id<<3|e.type,t,r),r+=ui.encode.bytes,e.type!==hV.NEW_STREAM&&e.type!==hV.MESSAGE_INITIATOR&&e.type!==hV.MESSAGE_RECEIVER||null==e.data?ui.encode(0,t,r):ui.encode(e.data.length,t,r),r+=ui.encode.bytes;const n=t.subarray(this._poolOffset,r);return fV-r<100?(this._pool=lV(fV),this._poolOffset=0):this._poolOffset=r,e.type!==hV.NEW_STREAM&&e.type!==hV.MESSAGE_INITIATOR&&e.type!==hV.MESSAGE_RECEIVER||null==e.data?[n]:[n,...e.data instanceof Uint8Array?[e.data]:e.data]}};class gV{constructor(){this._buffer=new mp,this._headerInfo=null}write(e){if(null==e||0===e.length)return[];this._buffer.append(e);const t=[];for(;0!==this._buffer.length;){if(null==this._headerInfo)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(e){break}const{id:e,type:r,length:n,offset:s}=this._headerInfo;if(this._buffer.length-s<n)break;const i={id:e,type:r};r!==hV.NEW_STREAM&&r!==hV.MESSAGE_INITIATOR&&r!==hV.MESSAGE_RECEIVER||(i.data=this._buffer.sublist(s,s+n)),t.push(i),this._buffer.consume(s+n),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:r}=mV(e),{value:n,offset:s}=mV(e,r),i=7&t;if(null==uV[i])throw new Error(`Invalid type received: ${i}`);return{id:t>>3,type:i,offset:r+s,length:n}}}function mV(e,t=0){let r,n=0,s=0,i=t;const o=e.length;do{if(i>=o||s>49)throw t=0,new RangeError("Could not decode varint");r=e.get(i++),n+=s<28?(127&r)<<s:(127&r)*Math.pow(2,s),s+=7}while(r>=128);return{value:n,offset:t=i-t}}async function*wV(e){const t=new gV;for await(const r of e){const e=t.write(r);e.length>0&&(yield e)}}const bV=1<<20,vV=He("libp2p:mplex:stream"),EV="ERR_STREAM_RESET",_V=He("libp2p:mplex");function SV(e){const t={...e,type:`${uV[e.type]} (${e.type})`};return e.type===hV.NEW_STREAM&&(t.data=ni(e.data instanceof Uint8Array?e.data:e.data.subarray())),e.type!==hV.MESSAGE_INITIATOR&&e.type!==hV.MESSAGE_RECEIVER||(t.data=ni(e.data instanceof Uint8Array?e.data:e.data.subarray(),"base16")),t}class AV{constructor(e){this.protocol="/mplex/6.7.0",e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.sink=this._createSink();const t=this._createSource();this._source=t,this.source=t,this.closeController=new AbortController,this.rateLimiter=new ax.RateLimiterMemory({points:e.disconnectThreshold??5,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const t=this._streamId++;e=null==e?t.toString():e.toString();const r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}close(e){this.closeController.signal.aborted||(null!=e?this.streams.forEach((t=>t.abort(e))):this.streams.forEach((e=>e.close())),this.closeController.abort())}_newReceiverStream(e){const{id:t,name:r}=e,n=this._streams.receivers;return this._newStream({id:t,name:r,type:"receiver",registry:n})}_newStream(e){const{id:t,name:r,type:n,registry:s}=e;if(_V("new %s stream %s %s",n,t),"initiator"===n&&this._streams.initiators.size===(this._init.maxOutboundStreams??1024))throw qe(new Error("Too many outbound streams open"),"ERR_TOO_MANY_OUTBOUND_STREAMS");if(s.has(t))throw new Error(`${n} stream ${t} already exists!`);const i=function(e){const{id:t,name:r,send:n,onEnd:s,type:i="initiator",maxMsgSize:o=bV}=e,a=new AbortController,c=new AbortController,l=new AbortController,h="initiator"===i?dV:pV,u="initiator"===i?`i${t}`:`r${t}`,d=`${null==r?t:r}`;let p,f=!1,y=!1,g=!1;const m={open:Date.now()},w=e=>{y||(y=!0,vV.trace("%s stream %s sink end - err: %o",i,d,e),null!=e&&null==p&&(p=e),f&&(m.close=Date.now(),null!=s&&s(p)))},b=ju({onEnd:e=>{f||(f=!0,vV.trace("%s stream %s source end - err: %o",i,d,e),null!=e&&null==p&&(p=e),y&&(v.stat.timeline.close=Date.now(),null!=s&&s(p)))}}),v={close:()=>{vV.trace("%s stream %s close",i,d),v.closeRead(),v.closeWrite()},closeRead:()=>{vV.trace("%s stream %s closeRead",i,d),f||b.end()},closeWrite:()=>{if(vV.trace("%s stream %s closeWrite",i,d),!y){l.abort();try{n({id:t,type:h.CLOSE})}catch(e){vV.trace("%s stream %s error sending close",i,r,e)}w()}},abort:e=>{vV.trace("%s stream %s abort",i,d,e),b.end(e),a.abort(),w(e)},reset:()=>{const e=qe(new Error("stream reset"),EV);c.abort(),b.end(e),w(e)},sink:async e=>{if(g)throw qe(new Error("sink already called on stream"),"ERR_DOUBLE_SINK");if(g=!0,y)throw qe(new Error("stream closed for writing"),"ERR_SINK_ENDED");e=tT(e,(0,Oo.anySignal)([a.signal,c.signal,l.signal]));try{"initiator"===i&&n({id:t,type:dV.NEW_STREAM,data:new mp(Xs(d))});const r=new mp;for await(const s of e)if(s.length<=o)n({id:t,type:h.MESSAGE,data:s instanceof mp?s:new mp(s)});else for(r.append(s);0!==r.length;){if(r.length<=o){n({id:t,type:h.MESSAGE,data:r.sublist()}),r.consume(r.length);break}n({id:t,type:h.MESSAGE,data:r.sublist(0,o)}),r.consume(o)}}catch(e){if("aborted"===e.type&&"The operation was aborted"===e.message){if(l.signal.aborted)return;c.signal.aborted&&(e.message="stream reset",e.code=EV),a.signal.aborted&&(e.message="stream aborted",e.code="ERR_STREAM_ABORT")}if(e.code===EV)vV.trace("%s stream %s reset",i,r);else{vV.trace("%s stream %s error",i,r,e);try{n({id:t,type:h.RESET})}catch(e){vV.trace("%s stream %s error sending reset",i,r,e)}}return b.end(e),void w(e)}try{n({id:t,type:h.CLOSE})}catch(e){vV.trace("%s stream %s error sending close",i,r,e)}w()},source:b,sourcePush:e=>{b.push(e)},sourceReadableLength:()=>b.readableLength,stat:{direction:"initiator"===i?"outbound":"inbound",timeline:m},metadata:{},id:u};return v}({id:t,name:r,send:e=>{_V.enabled&&_V.trace("%s stream %s send",n,t,SV(e)),this._source.push(e)},type:n,onEnd:()=>{_V("%s stream with id %s and protocol %s ended",n,t,i.stat.protocol),s.delete(t),null!=this._init.onStreamEnd&&this._init.onStreamEnd(i)},maxMsgSize:this._init.maxMsgSize});return s.set(t,i),i}_createSink(){return async e=>{const t=[this.closeController.signal];null!=this._init.signal&&t.push(this._init.signal),e=tT(e,Oo(t));try{await Xu(e,wV,function(e){const t=e??bV,r=e=>{if((e.type===hV.NEW_STREAM||e.type===hV.MESSAGE_INITIATOR||e.type===hV.MESSAGE_RECEIVER)&&e.data.byteLength>t)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"})};return e=>async function*(){for await(const t of e)Array.isArray(t)?(t.forEach(r),yield*t):(r(t),yield t)}()}(this._init.maxMsgSize),(async e=>{for await(const t of e)await this._handleIncoming(t)})),this._source.end()}catch(e){_V("error in sink",e),this._source.end(e)}}}_createSource(){const e=function(e={}){return Ku((e=>{let t;const r=[];for(;!e.isEmpty()&&(t=e.shift(),null!=t);){if(null!=t.error)throw t.error;!1===t.done&&r.push(t.value)}return null==t?{done:!0}:{done:!0===t.done,value:r}}),e)}({objectMode:!0,onEnd:e=>{this.close(e)}});return Object.assign(async function*(e){for await(const t of e)if(Array.isArray(t))for(const e of t)yield*yV.write(e);else yield*yV.write(t)}(e),{push:e.push,end:e.end,return:e.return})}async _handleIncoming(e){const{id:t,type:r}=e;if(_V.enabled&&_V.trace("incoming message",SV(e)),e.type===hV.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??1024)){_V("too many inbound streams open"),this._source.push({id:t,type:hV.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{return _V("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),void this._source.end(new Error("Too many open streams"))}return}const r=this._newReceiverStream({id:t,name:ni(e.data instanceof Uint8Array?e.data:e.data.subarray())});return void(null!=this._init.onIncomingStream&&this._init.onIncomingStream(r))}const n=(1==(1&r)?this._streams.initiators:this._streams.receivers).get(t);if(null==n)return void _V("missing stream %s for message type %s",t,uV[r]);const s=this._init.maxStreamBufferSize??4194304;switch(r){case hV.MESSAGE_INITIATOR:case hV.MESSAGE_RECEIVER:if(n.sourceReadableLength()>s){this._source.push({id:e.id,type:r===hV.MESSAGE_INITIATOR?hV.RESET_RECEIVER:hV.RESET_INITIATOR});const t=qe(new Error("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers"),"ERR_STREAM_INPUT_BUFFER_FULL");return void n.abort(t)}n.sourcePush(e.data);break;case hV.CLOSE_INITIATOR:case hV.CLOSE_RECEIVER:n.closeRead();break;case hV.RESET_INITIATOR:case hV.RESET_RECEIVER:n.reset();break;default:_V("unknown message type %s",r)}}}class IV{constructor(e={}){this.protocol="/mplex/6.7.0",this._init=e}createStreamMuxer(e={}){return new AV({...e,...this._init})}}function RV(e={}){return()=>new IV(e)}function kV(e,t={}){const r=_x(e),n=cT.fromReader(r.reader,t),s={read:async e=>{const{value:t}=await r.reader.next(e);if(null==t)throw new Error("Value is null");return t},readLP:async()=>{const{value:e}=await n.next();if(null==e)throw new Error("Value is null");return e},readPB:async e=>{const t=await s.readLP();if(null==t)throw new Error("Value is null");const r=t instanceof Uint8Array?t:t.slice();return e.decode(r)},write:e=>{e instanceof Uint8Array?r.writer.push(e):r.writer.push(e.slice())},writeLP:e=>{s.write(iT.single(e,t))},writePB:(e,t)=>{s.writeLP(t.encode(e))},pb:e=>({read:async()=>await s.readPB(e),write:t=>s.writePB(t,e)}),unwrap:()=>(r.rest(),r.stream)};return s}function TV(){const e=Bd();let t=!1;return{sink:async r=>{if(t)throw new Error("already piped");t=!0,e.resolve(r)},source:async function*(){const t=await e.promise;yield*t}()}}const CV=65535,PV=Boolean(globalThis.process?.env?.DUMP_SESSION_KEYS);var NV=r(78770),DV=r(22621),OV=r(9020),xV=r(73691);const LV={hashSHA256:e=>(0,OV.vp)(e),getHKDF(e,t){const r=new NV.t(OV.mE,t,e).expand(96);return[r.subarray(0,32),r.subarray(32,64),r.subarray(64,96)]},generateX25519KeyPair(){const e=DV.Au();return{publicKey:e.publicKey,privateKey:e.secretKey}},generateX25519KeyPairFromSeed(e){const t=DV._w(e);return{publicKey:t.publicKey,privateKey:t.secretKey}},generateX25519SharedKey:(e,t)=>DV.gi(e,t),chaCha20Poly1305Encrypt:(e,t,r,n)=>new xV.OK(n).seal(t,e,r),chaCha20Poly1305Decrypt:(e,t,r,n)=>new xV.OK(n).open(t,e,r)},BV=e=>{const t=(2,globalThis.Buffer?globalThis.Buffer.allocUnsafe(2):new Uint8Array(2));return new DataView(t.buffer,t.byteOffset,t.byteLength).setUint16(0,e,!1),t};BV.bytes=2;const MV=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");return e instanceof Uint8Array?new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1):e.getUint16(0)};MV.bytes=2;class UV extends Error{constructor(e="Unexpected Peer"){super(e),this.code=UV.code}static get code(){return"ERR_UNEXPECTED_PEER"}}class zV extends Error{constructor(e="Invalid crypto exchange"){super(e),this.code=zV.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}}class VV extends Error{constructor(e="Invalid crypto transmission"){super(e),this.code=VV.code}static get code(){return"ERR_INVALID_CRYPTO_TRANSMISSION"}}var FV,jV;async function KV(e){return await Ja(e.identityKey)}function $V(e){return jV.decode(e)}function HV(e){const t=Xs("noise-libp2p-static-key:");return di([t,e],t.length+e.length)}async function qV(e,t,r){const n=await Ja(t.identityKey);if(!n.equals(r))throw new Error("Peer ID doesn't match libp2p public key.");const s=HV(e);if(null==n.publicKey)throw new Error("PublicKey was missing from PeerId");if(null==t.identitySig)throw new Error("Signature was missing from message");const i=eu(n.publicKey);if(!await i.verify(s,t.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return n}function GV(e){return e instanceof Uint8Array&&32===e.length}!function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(const r of e.webtransportCerthashes)t.uint32(10),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={webtransportCerthashes:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();t>>>3==1?r.webtransportCerthashes.push(e.bytes()):e.skipType(7&t)}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(FV||(FV={})),function(e){let t;e.codec=()=>(null==t&&(t=Ac(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.identityKey&&e.identityKey.byteLength>0)&&(t.uint32(10),t.bytes(e.identityKey)),(!0===r.writeDefaults||null!=e.identitySig&&e.identitySig.byteLength>0)&&(t.uint32(18),t.bytes(e.identitySig)),null!=e.extensions&&(t.uint32(34),FV.codec().encode(e.extensions,t,{writeDefaults:!1})),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.identityKey=e.bytes();break;case 2:r.identitySig=e.bytes();break;case 4:r.extensions=FV.codec().decode(e,e.uint32());break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>gc(t,e.codec()),e.decode=t=>yc(t,e.codec())}(jV||(jV={}));const WV=He("libp2p:noise");let YV;function ZV(e){e?(YV(`LOCAL_PUBLIC_EPHEMERAL_KEY ${ni(e.publicKey,"hex")}`),YV(`LOCAL_PRIVATE_EPHEMERAL_KEY ${ni(e.privateKey,"hex")}`)):YV("Missing local ephemeral keys.")}function QV(e){YV(`REMOTE_EPHEMERAL_PUBLIC_KEY ${ni(e,"hex")}`)}YV=PV?WV:Object.assign((()=>{}),{enabled:!1,trace:()=>{},error:()=>{}});class JV{constructor(e=0){this.n=e,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error("Cipherstate has reached maximum n, a new handshake must be performed")}}class XV{constructor(e){this.crypto=e}encryptWithAd(e,t,r){const n=this.encrypt(e.k,e.n,t,r);return e.n.increment(),n}decryptWithAd(e,t,r){const{plaintext:n,valid:s}=this.decrypt(e.k,e.n,t,r);return s&&e.n.increment(),{plaintext:n,valid:s}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(e){return Ti(this.createEmptyKey(),e)}encrypt(e,t,r,n){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(n,t.getBytes(),r,e)}encryptAndHash(e,t){let r;return r=this.hasKey(e.cs)?this.encryptWithAd(e.cs,e.h,t):t,this.mixHash(e,r),r}decrypt(e,t,r,n){t.assertValue();const s=this.crypto.chaCha20Poly1305Decrypt(n,t.getBytes(),r,e);return s?{plaintext:s,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(e,t){let r,n=!0;return this.hasKey(e.cs)?({plaintext:r,valid:n}=this.decryptWithAd(e.cs,e.h,t)):r=t,this.mixHash(e,t),{plaintext:r,valid:n}}dh(e,t){try{const r=this.crypto.generateX25519SharedKey(e,t);return 32===r.length?r:r.subarray(0,32)}catch(e){return WV(e.message),new Uint8Array(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256(di([e,t],e.length+t.length))}mixKey(e,t){const[r,n]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(n),e.ck=r}initializeKey(e){return{k:e,n:new JV}}initializeSymmetric(e){const t=Xs(e,"utf-8"),r=this.hashProtocolName(t),n=r,s=this.createEmptyKey();return{cs:this.initializeKey(s),ck:n,h:r}}hashProtocolName(e){if(e.length<=32){const t=new Uint8Array(32);return t.set(e),t}return this.getHash(e,new Uint8Array(0))}split(e){const[t,r]=this.crypto.getHKDF(e.ck,new Uint8Array(0));return{cs1:this.initializeKey(t),cs2:this.initializeKey(r)}}writeMessageRegular(e,t){const r=this.encryptWithAd(e,new Uint8Array(0),t);return{ne:this.createEmptyKey(),ns:new Uint8Array(0),ciphertext:r}}readMessageRegular(e,t){return this.decryptWithAd(e,new Uint8Array(0),t.ciphertext)}}class eF extends XV{initializeInitiator(e,t,r,n){const s=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");return this.mixHash(s,e),{ss:s,s:t,rs:r,psk:n,re:new Uint8Array(32)}}initializeResponder(e,t,r,n){const s=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");return this.mixHash(s,e),{ss:s,s:t,rs:r,psk:n,re:new Uint8Array(32)}}writeMessageA(e,t,r){const n=new Uint8Array(0);e.e=void 0!==r?r:this.crypto.generateX25519KeyPair();const s=e.e.publicKey;return this.mixHash(e.ss,s),{ne:s,ns:n,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();const r=e.e.publicKey;this.mixHash(e.ss,r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const n=e.s.publicKey,s=this.encryptAndHash(e.ss,n);return this.mixKey(e.ss,this.dh(e.s.privateKey,e.re)),{ne:r,ns:s,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageC(e,t){const r=e.s.publicKey,n=this.encryptAndHash(e.ss,r);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const s=this.encryptAndHash(e.ss,t),i={ne:this.createEmptyKey(),ns:n,ciphertext:s},{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,messageBuffer:i,cs1:o,cs2:a}}readMessageA(e,t){return GV(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(GV(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);n&&GV(r)&&(e.rs=r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:s,valid:i}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:s,valid:n&&i}}readMessageC(e,t){const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);if(n&&GV(r)&&(e.rs=r),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:s,valid:i}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,plaintext:s,valid:n&&i,cs1:o,cs2:a}}initSession(e,t,r){const n=this.createEmptyKey(),s=new Uint8Array(32);let i;return i=e?this.initializeInitiator(t,r,s,n):this.initializeResponder(t,r,s,n),{hs:i,i:e,mc:0}}sendMessage(e,t,r){let n;if(0===e.mc)n=this.writeMessageA(e.hs,t,r);else if(1===e.mc)n=this.writeMessageB(e.hs,t);else if(2===e.mc){const{h:r,messageBuffer:s,cs1:i,cs2:o}=this.writeMessageC(e.hs,t);n=s,e.h=r,e.cs1=i,e.cs2=o}else{if(!(e.mc>2))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");n=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");n=this.writeMessageRegular(e.cs2,t)}}return e.mc++,n}recvMessage(e,t){let r=new Uint8Array(0),n=!1;if(0===e.mc)({plaintext:r,valid:n}=this.readMessageA(e.hs,t));else if(1===e.mc)({plaintext:r,valid:n}=this.readMessageB(e.hs,t));else if(2===e.mc){const{h:s,plaintext:i,valid:o,cs1:a,cs2:c}=this.readMessageC(e.hs,t);r=i,n=o,e.h=s,e.cs1=a,e.cs2=c}return e.mc++,{plaintext:r,valid:n}}}class tF{constructor(e,t,r,n,s,i,o,a){this.remoteExtensions={webtransportCerthashes:[]},this.isInitiator=e,this.payload=t,this.prologue=r,this.staticKeypair=s,this.connection=i,o&&(this.remotePeer=o),this.xx=a??new eF(n),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){var e;if(e=this.session.hs.s,YV(`LOCAL_STATIC_PUBLIC_KEY ${ni(e.publicKey,"hex")}`),YV(`LOCAL_STATIC_PRIVATE_KEY ${ni(e.privateKey,"hex")}`),this.isInitiator){WV("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,new Uint8Array(0));this.connection.writeLP(function(e){return di([e.ne,e.ciphertext],e.ne.length+e.ciphertext.length)}(e)),WV("Stage 0 - Initiator finished sending first message."),ZV(this.session.hs.e)}else{WV("Stage 0 - Responder waiting to receive first message...");const e=function(e){if(e.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:e.subarray(0,32),ciphertext:e.subarray(32,e.length),ns:new Uint8Array(0)}}((await this.connection.readLP()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new zV("xx handshake stage 0 validation fail");WV("Stage 0 - Responder received first message."),QV(this.session.hs.re)}}async exchange(){if(this.isInitiator){WV("Stage 1 - Initiator waiting to receive first message from responder...");const t=function(e){if(e.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:e.subarray(0,32),ns:e.subarray(32,80),ciphertext:e.subarray(80,e.length)}}((await this.connection.readLP()).subarray()),{plaintext:r,valid:n}=this.xx.recvMessage(this.session,t);if(!n)throw new zV("xx handshake stage 1 validation fail");WV("Stage 1 - Initiator received the message."),QV(this.session.hs.re),e=this.session.hs.rs,YV(`REMOTE_STATIC_PUBLIC_KEY ${ni(e,"hex")}`),WV("Initiator going to check remote's signature...");try{const e=$V(r);this.remotePeer=this.remotePeer||await KV(e),await qV(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){throw new UV(`Error occurred while verifying signed payload: ${e.message}`)}WV("All good with the signature!")}else{WV("Stage 1 - Responder sending out first message with signed payload and static key.");const e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(function(e){return di([e.ne,e.ns,e.ciphertext],e.ne.length+e.ns.length+e.ciphertext.length)}(e)),WV("Stage 1 - Responder sent the second handshake message with signed payload."),ZV(this.session.hs.e)}var e}async finish(){if(this.isInitiator){WV("Stage 2 - Initiator sending third handshake message.");const e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(function(e){return di([e.ns,e.ciphertext],e.ns.length+e.ciphertext.length)}(e)),WV("Stage 2 - Initiator sent message with signed payload.")}else{WV("Stage 2 - Responder waiting for third handshake message...");const e=function(e){if(e.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:e.subarray(0,48),ciphertext:e.subarray(48,e.length)}}((await this.connection.readLP()).subarray()),{plaintext:t,valid:r}=this.xx.recvMessage(this.session,e);if(!r)throw new zV("xx handshake stage 2 validation fail");WV("Stage 2 - Responder received the message, finished handshake.");try{const e=$V(t);this.remotePeer=this.remotePeer||await KV(e),await qV(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){throw new UV(`Error occurred while verifying signed payload: ${e.message}`)}}var e;(e=this.session).cs1&&e.cs2?(YV(`CIPHER_STATE_1 ${e.cs1.n.getUint64()} ${ni(e.cs1.k,"hex")}`),YV(`CIPHER_STATE_2 ${e.cs2.n.getUint64()} ${ni(e.cs2.k,"hex")}`)):YV("Missing cipher state.")}encrypt(e,t){const r=this.getCS(t);return this.xx.encryptWithAd(r,new Uint8Array(0),e)}decrypt(e,t){const r=this.getCS(t,!1);return this.xx.decryptWithAd(r,new Uint8Array(0),e)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new zV("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}}class rF{constructor(e={}){this.protocol="/noise";const{staticNoiseKey:t,extensions:r,crypto:n,prologueBytes:s,metrics:i}=e;this.crypto=n??LV,this.extensions=r,this.metrics=i?function(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}(i):void 0,this.staticKeys=t?this.crypto.generateX25519KeyPairFromSeed(t):this.crypto.generateX25519KeyPair(),this.prologue=s??new Uint8Array(0)}async secureOutbound(e,t,r){const n=kV(t,{lengthEncoder:BV,lengthDecoder:MV,maxDataLength:CV}),s=await this.performHandshake({connection:n,isInitiator:!0,localPeer:e,remotePeer:r});return{conn:await this.createSecureConnection(n,s),remoteExtensions:s.remoteExtensions,remotePeer:s.remotePeer}}async secureInbound(e,t,r){const n=kV(t,{lengthEncoder:BV,lengthDecoder:MV,maxDataLength:CV}),s=await this.performHandshake({connection:n,isInitiator:!1,localPeer:e,remotePeer:r});return{conn:await this.createSecureConnection(n,s),remotePeer:s.remotePeer,remoteExtensions:s.remoteExtensions}}async performHandshake(e){const t=await async function(e,t,r){const n=await async function(e,t){if(null==e.privateKey)throw new Error("PrivateKey was missing from PeerId");const r=await ru(e.privateKey);return await r.sign(t)}(e,HV(t));if(null==e.publicKey)throw new Error("PublicKey was missing from local PeerId");return function(e,t,r){return jV.encode({identityKey:e,identitySig:t,extensions:r??{webtransportCerthashes:[]}}).subarray()}(e.publicKey,n,r)}(e.localPeer,this.staticKeys.publicKey,this.extensions);return await this.performXXHandshake(e,t)}async performXXHandshake(e,t){const{isInitiator:r,remotePeer:n,connection:s}=e,i=new tF(r,t,this.prologue,this.crypto,this.staticKeys,s,n);try{await i.propose(),await i.exchange(),await i.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(e){if(this.metrics?.xxHandshakeErrors.increment(),e instanceof Error)throw e.message=`Error occurred during XX handshake: ${e.message}`,e}return i}async createSecureConnection(e,t){const[r,n]=function(){const e=TV(),t=TV();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}(),s=e.unwrap();return await Xu(r,function(e,t){return async function*(r){for await(const n of r)for(let r=0;r<n.length;r+=65519){let s=r+65519;s>n.length&&(s=n.length);const i=e.encrypt(n.subarray(r,s),e.session);t?.encryptedPackets.increment(),yield BV(i.byteLength),yield i}}}(t,this.metrics),s,cT({lengthDecoder:MV}),function(e,t){return async function*(r){for await(const n of r)for(let r=0;r<n.length;r+=CV){let s=r+CV;s>n.length&&(s=n.length);const{plaintext:i,valid:o}=e.decrypt(n.subarray(r,s),e.session);if(!o)throw t?.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");t?.decryptedPackets.increment(),yield i}}}(t,this.metrics),r),n}}function nF(e={}){return()=>new rF(e)}const sF=ye.bind({ignoreUndefined:!0,concatArrays:!0});function iF({options:e={},peerId:t,multiaddrs:r=[],repo:n,keychainConfig:s={},config:i={}}){const{datastore:h}=n,u=function({options:e,config:t,datastore:r,keychainConfig:n,peerId:s,multiaddrs:i}){const h={datastore:r,peerId:s},u={addresses:{listen:i.map((e=>e.toString())),announce:qu(e,"addresses.announce",qu(t,"Addresses.Announce",[])),noAnnounce:qu(e,"addresses.noAnnounce",qu(t,"Addresses.NoAnnounce",[]))},connectionManager:qu(e,"connectionManager",{maxConnections:qu(e,"config.Swarm.ConnMgr.HighWater",qu(t,"Swarm.ConnMgr.HighWater")),minConnections:qu(e,"config.Swarm.ConnMgr.LowWater",qu(t,"Swarm.ConnMgr.LowWater"))}),keychain:n,identify:{host:{agentVersion:"js-ipfs/0.17.0"}},contentRouters:[],peerRouters:[],peerDiscovery:[],transports:[],streamMuxers:[RV({maxInboundStreams:256,maxOutboundStreams:1024})],connectionEncryption:[nF()],relay:{enabled:qu(e,"relay.enabled",qu(t,"relay.enabled",!0)),hop:{enabled:qu(e,"relay.hop.enabled",qu(t,"relay.hop.enabled",!1)),active:qu(e,"relay.hop.active",qu(t,"relay.hop.active",!1))}},nat:{enabled:!qu(t,"Swarm.DisableNatPortMap",!1)}};var d;qu(e,"config.Pubsub.Enabled",qu(t,"Pubsub.Enabled",!0))&&(u.pubsub=(()=>{const e=qu(t,"Pubsub.Router")||"gossipsub",r={gossipsub:e=>{const t=new dT({allowPublishToZeroPeers:!0,fallbackToFloodsub:!0,emitSelf:!0,maxInboundStreams:64,maxOutboundStreams:128});return t.init({getPeerId:()=>e.peerId,getPeerStore:()=>e.peerStore,getRegistrar:()=>e.registrar,getConnectionManager:()=>e.connectionManager}),t}};if(!r[e])throw qe(new Error(`Router unavailable. Configure libp2p.modules.pubsub to use the ${e} router.`),"ERR_NOT_SUPPORTED");return r[e]})()),"none"!==qu(t,"Routing.Type","dhtclient")&&(u.dht=(d={clientMode:"dhtserver"!==qu(t,"Routing.Type","dht"),kBucketSize:qu(e,"dht.kBucketSize",20),validators:{ipns:ku},selectors:{ipns:Gu}},e=>new SU(e,d)));const p=qu(e,"config.Bootstrap",qu(t,"Bootstrap",[]));p.length>0&&u.peerDiscovery?.push(function(e){return t=>new IU(t,e)}({list:p}));let f=qu(e,"libp2p",void 0);"function"==typeof f&&(f=void 0);const y=sF(h,function(){const e=function(e={}){const t=new OO(e);return{transport:e=>(t.peerId=e.peerId,t),discovery:t.discovery}}();return{transports:[e.transport],peerDiscovery:[e.discovery],connectionManager:{maxParallelDials:150,maxDialsPerPeer:4,dialTimeout:1e4,autoDial:!0},nat:{enabled:!1},metrics:{enabled:!0}}}(),u,f),g=qu(e,"config.Addresses.Delegates",qu(t,"Addresses.Delegates",[]));if(g.length>0){const e=Ki(g[Math.floor(Math.random()*g.length)]).toOptions(),t=function(e={}){const t={name:hs.name,code:hs.code,encode:e=>e,decode:e=>e},r=Object.values(Bs);(e.ipld&&e.ipld.bases?e.ipld.bases:[]).forEach((e=>r.push(e)));const n=new AT({bases:r,loadBase:e.ipld&&e.ipld.loadBase}),s=Object.values(Us);[o,a,c,l,t].concat(e.ipld&&e.ipld.codecs||[]).forEach((e=>s.push(e)));const i=new RT({codecs:s,loadCodec:e.ipld&&e.ipld.loadCodec}),h=Object.values(Ms);(e.ipld&&e.ipld.hashers?e.ipld.hashers:[]).forEach((e=>h.push(e)));const u=new TT({hashers:h,loadHasher:e.ipld&&e.ipld.loadHasher});return{add:DN(e),addAll:TN(e),bitswap:WT(e),block:iC(e),bootstrap:uC(e),cat:ON(e),commands:xN(e),config:EC(e),dag:TC(i,e),dht:BC(e),diag:VC(e),dns:LN(e),files:tP(e),get:MN(e),getEndpointConfig:BN(e),id:UN(e),isOnline:zN(e),key:lP(e),log:pP(e),ls:VN(e),mount:jN(e),name:vP(e),object:DP(i,e),pin:rN(e),ping:KN(e),pubsub:pN(e),refs:yN(e),repo:bN(e),resolve:$N(e),start:HN(e),stats:EN(e),stop:qN(e),swarm:kN(e),version:GN(e),bases:n,codecs:i,hashers:u}}({host:e.host,protocol:443===parseInt(e.port)?"https":"http",port:e.port});y.contentRouters?.push((m=t,()=>new _T(m))),y.peerRouters?.push(function(e){return()=>new gT(e)}(t))}var m;return qu(e,"config.Discovery.MDNS.Enabled",qu(t,"Discovery.MDNS.Enabled",!0))||(y.peerDiscovery=y.peerDiscovery?.filter((e=>{try{if("function"==typeof e)return"@libp2p/mdns"!==e({})[Symbol.toStringTag]}catch{}return!0}))),null==y.transports&&(y.transports=[]),null==y.transports.find((e=>{try{if("function"==typeof e)return"@libp2p/websockets"===e({})[Symbol.toStringTag]}catch{}return!1}))&&y.transports.push(function(e={}){return()=>new cV(e)}()),y}({options:e,config:i,datastore:h,keychainConfig:s,peerId:t,multiaddrs:r});return"function"==typeof e.libp2p?e.libp2p({libp2pOptions:u,options:e,config:i,datastore:h,peerId:t}):async function(e){return await async function(e){return null==e.peerId&&(e.peerId=await ZB()),new cM(function(e){const t=ye(WB,e);if(null==t.transports||t.transports.length<1)throw qe(new Error(xO.ERR_TRANSPORTS_REQUIRED),LO.ERR_TRANSPORTS_REQUIRED);if(null==t.connectionEncryption||0===t.connectionEncryption.length)throw qe(new Error(xO.CONN_ENCRYPTION_REQUIRED),LO.CONN_ENCRYPTION_REQUIRED);if(null===t.connectionProtector&&null!=globalThis.process?.env?.LIBP2P_FORCE_PNET)throw qe(new Error(xO.ERR_PROTECTOR_REQUIRED),LO.ERR_PROTECTOR_REQUIRED);return t.identify.host.agentVersion===UL&&(XL||QL?t.identify.host.agentVersion+=` UserAgent=${globalThis.process.version}`:(ZL||eB||JL||tB)&&(t.identify.host.agentVersion+=` UserAgent=${globalThis.navigator.userAgent}`)),t}(e))}(e)}(u)}const oF=ye.bind({ignoreUndefined:!0}),aF=He("ipfs:components:peer:storage");class cF{constructor(e,t,r,n,s){this.print=n,this.peerId=e,this.keychain=t,this.repo=r,this.print=n,this.isNew=s}static async start(e,t,r){const{repoAutoMigrate:n,repo:s,onMigrationProgress:i}=r,o="string"==typeof s||null==s?OS(e,t,{path:s,autoMigrate:n,onMigrationProgress:i}):s,{peerId:a,keychain:c,isNew:l}=await lF(e,o,r);return new cF(a,c,o,e,l)}}const lF=async(e,t,r)=>{if(!t.closed)return{...await fF(t,r),isNew:!1};try{return await t.open(),{...await fF(t,r),isNew:!1}}catch(n){if(n.code!==V_)throw n;if(r.init&&!1===r.init.allowNew)throw new Hs("Initialization of new repos disabled by config, pass `config.init.isNew: true` to enable it");return{...await hF(e,t,r),isNew:!0}}},hF=async(e,t,r)=>{const n=r.init||{},s=await t.exists();if(aF("repo exists?",s),!0===s)throw new Error("repo already exists");const i=n.privateKey?await uF(n.privateKey):await dF(e,n),o=pF(i);aF("peer identity: %s",o.PeerID);const a={...oF(gF({Addresses:{Swarm:[],Announce:[],NoAnnounce:[],API:"",Gateway:"",RPC:"",Delegates:["/dns4/node0.delegate.ipfs.io/tcp/443/https","/dns4/node1.delegate.ipfs.io/tcp/443/https","/dns4/node2.delegate.ipfs.io/tcp/443/https","/dns4/node3.delegate.ipfs.io/tcp/443/https"]},Discovery:{MDNS:{Enabled:!1,Interval:10},webRTCStar:{Enabled:!0}},Bootstrap:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"],Pubsub:{Enabled:!0},Swarm:{ConnMgr:{LowWater:5,HighWater:20},DisableNatPortMap:!0},Routing:{Type:"dhtclient"}},n.profiles),r.config),Identity:o};await t.init(a),await t.open(),aF("repo opened");const c={pass:r.pass};try{c.dek=await t.config.get("Keychain.DEK")}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}const l=await iF({options:void 0,multiaddrs:void 0,peerId:i,repo:t,config:a,keychainConfig:c});return await t.datastore.has(new Do("/info/self"))||await l.keychain.importPeer("self",i),await t.config.set("Keychain",{DEK:l.keychain.init.dek}),{peerId:i,keychain:l.keychain}},uF=async e=>{if(aF("using user-supplied private-key"),Ka(e))return e;const t=Xs(e,"base64pad"),r=await ru(t);return await Ja(r.public.bytes,r.bytes)},dF=(e,{algorithm:t="Ed25519",bits:r=2048})=>{if(e("generating %s keypair...",t),"Ed25519"===t)return ZB();if("RSA"===t)return(async e=>{const t=await Xh("RSA",e?.bits??2048),r=await QB(t);if("RSA"===r.type)return r;throw new Error(`Generated unexpected PeerId type "${r.type}"`)})({bits:r});throw qe(new Error("Unknown PeerId algorithm"),"ERR_UNKNOWN_PEER_ID_ALGORITHM")},pF=e=>{if(null==e.privateKey)throw qe(new Error("Private key missing"),"ERR_MISSING_PRIVATE_KEY");return{PeerID:e.toString(),PrivKey:ni(e.privateKey,"base64pad")}},fF=async(e,t)=>{const r=t.config,n=t.init&&t.init.profiles||[],s=t.pass,i=await e.config.getAll(),o=yF(gF(i,n),r);if(i!==o&&await e.config.replace(o),!o.Identity||!o.Identity.PrivKey)throw new zs("No private key was found in the config, please intialize the repo");const a=Xs(o.Identity.PrivKey,"base64pad"),c=await ru(a),l=await Ja(c.public.bytes,c.bytes);return{peerId:l,keychain:(await iF({options:void 0,multiaddrs:void 0,peerId:l,repo:e,config:o,keychainConfig:{pass:s,...o.Keychain}})).keychain}},yF=(e,t)=>t?oF(e,t):e,gF=(e,t)=>(t||[]).reduce(((e,t)=>{const r=aw[t];if(!r)throw new Error(`Could not find profile with name '${t}'`);return aF("applying profile %s",t),r.transform(e)}),e);var mF=r(56566);const wF=function(e){let t=new Uint8Array(e.reduce(((e,t)=>e+ui.encodingLength(t)),0)),r=0;for(const n of e)t=ui.encode(n,t,r),r+=ui.encodingLength(n);return t};class bF{constructor(e,t,r){this._refCounter=1,this.cid=e,this.priority=t||1,this.wantType=r}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toString(Pe)}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}}const vF=Ge.Reader,EF=Ge.Writer,_F=Ge.util,SF=Ge.roots["ipfs-bitswap"]||(Ge.roots["ipfs-bitswap"]={}),AF=SF.Message=(()=>{function e(e){if(this.blocks=[],this.payload=[],this.blockPresences=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.wantlist=null,e.prototype.blocks=_F.emptyArray,e.prototype.payload=_F.emptyArray,e.prototype.blockPresences=_F.emptyArray,e.prototype.pendingBytes=0,e.encode=function(e,t){if(t||(t=EF.create()),null!=e.wantlist&&Object.hasOwnProperty.call(e,"wantlist")&&SF.Message.Wantlist.encode(e.wantlist,t.uint32(10).fork()).ldelim(),null!=e.blocks&&e.blocks.length)for(var r=0;r<e.blocks.length;++r)t.uint32(18).bytes(e.blocks[r]);if(null!=e.payload&&e.payload.length)for(r=0;r<e.payload.length;++r)SF.Message.Block.encode(e.payload[r],t.uint32(26).fork()).ldelim();if(null!=e.blockPresences&&e.blockPresences.length)for(r=0;r<e.blockPresences.length;++r)SF.Message.BlockPresence.encode(e.blockPresences[r],t.uint32(34).fork()).ldelim();return null!=e.pendingBytes&&Object.hasOwnProperty.call(e,"pendingBytes")&&t.uint32(40).int32(e.pendingBytes),t},e.decode=function(e,t){e instanceof vF||(e=vF.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new SF.Message;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.wantlist=SF.Message.Wantlist.decode(e,e.uint32());break;case 2:n.blocks&&n.blocks.length||(n.blocks=[]),n.blocks.push(e.bytes());break;case 3:n.payload&&n.payload.length||(n.payload=[]),n.payload.push(SF.Message.Block.decode(e,e.uint32()));break;case 4:n.blockPresences&&n.blockPresences.length||(n.blockPresences=[]),n.blockPresences.push(SF.Message.BlockPresence.decode(e,e.uint32()));break;case 5:n.pendingBytes=e.int32();break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof SF.Message)return e;var t=new SF.Message;if(null!=e.wantlist){if("object"!=typeof e.wantlist)throw TypeError(".Message.wantlist: object expected");t.wantlist=SF.Message.Wantlist.fromObject(e.wantlist)}if(e.blocks){if(!Array.isArray(e.blocks))throw TypeError(".Message.blocks: array expected");t.blocks=[];for(var r=0;r<e.blocks.length;++r)"string"==typeof e.blocks[r]?_F.base64.decode(e.blocks[r],t.blocks[r]=_F.newBuffer(_F.base64.length(e.blocks[r])),0):e.blocks[r].length>=0&&(t.blocks[r]=e.blocks[r])}if(e.payload){if(!Array.isArray(e.payload))throw TypeError(".Message.payload: array expected");for(t.payload=[],r=0;r<e.payload.length;++r){if("object"!=typeof e.payload[r])throw TypeError(".Message.payload: object expected");t.payload[r]=SF.Message.Block.fromObject(e.payload[r])}}if(e.blockPresences){if(!Array.isArray(e.blockPresences))throw TypeError(".Message.blockPresences: array expected");for(t.blockPresences=[],r=0;r<e.blockPresences.length;++r){if("object"!=typeof e.blockPresences[r])throw TypeError(".Message.blockPresences: object expected");t.blockPresences[r]=SF.Message.BlockPresence.fromObject(e.blockPresences[r])}}return null!=e.pendingBytes&&(t.pendingBytes=0|e.pendingBytes),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.blocks=[],r.payload=[],r.blockPresences=[]),t.defaults&&(r.wantlist=null,r.pendingBytes=0),null!=e.wantlist&&e.hasOwnProperty("wantlist")&&(r.wantlist=SF.Message.Wantlist.toObject(e.wantlist,t)),e.blocks&&e.blocks.length){r.blocks=[];for(var n=0;n<e.blocks.length;++n)r.blocks[n]=t.bytes===String?_F.base64.encode(e.blocks[n],0,e.blocks[n].length):t.bytes===Array?Array.prototype.slice.call(e.blocks[n]):e.blocks[n]}if(e.payload&&e.payload.length)for(r.payload=[],n=0;n<e.payload.length;++n)r.payload[n]=SF.Message.Block.toObject(e.payload[n],t);if(e.blockPresences&&e.blockPresences.length)for(r.blockPresences=[],n=0;n<e.blockPresences.length;++n)r.blockPresences[n]=SF.Message.BlockPresence.toObject(e.blockPresences[n],t);return null!=e.pendingBytes&&e.hasOwnProperty("pendingBytes")&&(r.pendingBytes=e.pendingBytes),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message"},e.Wantlist=function(){function e(e){if(this.entries=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.entries=_F.emptyArray,e.prototype.full=!1,e.encode=function(e,t){if(t||(t=EF.create()),null!=e.entries&&e.entries.length)for(var r=0;r<e.entries.length;++r)SF.Message.Wantlist.Entry.encode(e.entries[r],t.uint32(10).fork()).ldelim();return null!=e.full&&Object.hasOwnProperty.call(e,"full")&&t.uint32(16).bool(e.full),t},e.decode=function(e,t){e instanceof vF||(e=vF.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new SF.Message.Wantlist;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.entries&&n.entries.length||(n.entries=[]),n.entries.push(SF.Message.Wantlist.Entry.decode(e,e.uint32()));break;case 2:n.full=e.bool();break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof SF.Message.Wantlist)return e;var t=new SF.Message.Wantlist;if(e.entries){if(!Array.isArray(e.entries))throw TypeError(".Message.Wantlist.entries: array expected");t.entries=[];for(var r=0;r<e.entries.length;++r){if("object"!=typeof e.entries[r])throw TypeError(".Message.Wantlist.entries: object expected");t.entries[r]=SF.Message.Wantlist.Entry.fromObject(e.entries[r])}}return null!=e.full&&(t.full=Boolean(e.full)),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.entries=[]),t.defaults&&(r.full=!1),e.entries&&e.entries.length){r.entries=[];for(var n=0;n<e.entries.length;++n)r.entries[n]=SF.Message.Wantlist.Entry.toObject(e.entries[n],t)}return null!=e.full&&e.hasOwnProperty("full")&&(r.full=e.full),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message.Wantlist"},e.WantType=function(){const e={},t=Object.create(e);return t[e[0]="Block"]=0,t[e[1]="Have"]=1,t}(),e.Entry=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.block=_F.newBuffer([]),e.prototype.priority=0,e.prototype.cancel=!1,e.prototype.wantType=0,e.prototype.sendDontHave=!1,e.encode=function(e,t){return t||(t=EF.create()),null!=e.block&&Object.hasOwnProperty.call(e,"block")&&t.uint32(10).bytes(e.block),null!=e.priority&&Object.hasOwnProperty.call(e,"priority")&&t.uint32(16).int32(e.priority),null!=e.cancel&&Object.hasOwnProperty.call(e,"cancel")&&t.uint32(24).bool(e.cancel),null!=e.wantType&&Object.hasOwnProperty.call(e,"wantType")&&t.uint32(32).int32(e.wantType),null!=e.sendDontHave&&Object.hasOwnProperty.call(e,"sendDontHave")&&t.uint32(40).bool(e.sendDontHave),t},e.decode=function(e,t){e instanceof vF||(e=vF.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new SF.Message.Wantlist.Entry;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.block=e.bytes();break;case 2:n.priority=e.int32();break;case 3:n.cancel=e.bool();break;case 4:n.wantType=e.int32();break;case 5:n.sendDontHave=e.bool();break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof SF.Message.Wantlist.Entry)return e;var t=new SF.Message.Wantlist.Entry;switch(null!=e.block&&("string"==typeof e.block?_F.base64.decode(e.block,t.block=_F.newBuffer(_F.base64.length(e.block)),0):e.block.length>=0&&(t.block=e.block)),null!=e.priority&&(t.priority=0|e.priority),null!=e.cancel&&(t.cancel=Boolean(e.cancel)),e.wantType){case"Block":case 0:t.wantType=0;break;case"Have":case 1:t.wantType=1}return null!=e.sendDontHave&&(t.sendDontHave=Boolean(e.sendDontHave)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.block="":(r.block=[],t.bytes!==Array&&(r.block=_F.newBuffer(r.block))),r.priority=0,r.cancel=!1,r.wantType=t.enums===String?"Block":0,r.sendDontHave=!1),null!=e.block&&e.hasOwnProperty("block")&&(r.block=t.bytes===String?_F.base64.encode(e.block,0,e.block.length):t.bytes===Array?Array.prototype.slice.call(e.block):e.block),null!=e.priority&&e.hasOwnProperty("priority")&&(r.priority=e.priority),null!=e.cancel&&e.hasOwnProperty("cancel")&&(r.cancel=e.cancel),null!=e.wantType&&e.hasOwnProperty("wantType")&&(r.wantType=t.enums===String?SF.Message.Wantlist.WantType[e.wantType]:e.wantType),null!=e.sendDontHave&&e.hasOwnProperty("sendDontHave")&&(r.sendDontHave=e.sendDontHave),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message.Wantlist.Entry"},e}(),e}(),e.Block=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.prefix=_F.newBuffer([]),e.prototype.data=_F.newBuffer([]),e.encode=function(e,t){return t||(t=EF.create()),null!=e.prefix&&Object.hasOwnProperty.call(e,"prefix")&&t.uint32(10).bytes(e.prefix),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),t},e.decode=function(e,t){e instanceof vF||(e=vF.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new SF.Message.Block;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.prefix=e.bytes();break;case 2:n.data=e.bytes();break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof SF.Message.Block)return e;var t=new SF.Message.Block;return null!=e.prefix&&("string"==typeof e.prefix?_F.base64.decode(e.prefix,t.prefix=_F.newBuffer(_F.base64.length(e.prefix)),0):e.prefix.length>=0&&(t.prefix=e.prefix)),null!=e.data&&("string"==typeof e.data?_F.base64.decode(e.data,t.data=_F.newBuffer(_F.base64.length(e.data)),0):e.data.length>=0&&(t.data=e.data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.prefix="":(r.prefix=[],t.bytes!==Array&&(r.prefix=_F.newBuffer(r.prefix))),t.bytes===String?r.data="":(r.data=[],t.bytes!==Array&&(r.data=_F.newBuffer(r.data)))),null!=e.prefix&&e.hasOwnProperty("prefix")&&(r.prefix=t.bytes===String?_F.base64.encode(e.prefix,0,e.prefix.length):t.bytes===Array?Array.prototype.slice.call(e.prefix):e.prefix),null!=e.data&&e.hasOwnProperty("data")&&(r.data=t.bytes===String?_F.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message.Block"},e}(),e.BlockPresenceType=function(){const e={},t=Object.create(e);return t[e[0]="Have"]=0,t[e[1]="DontHave"]=1,t}(),e.BlockPresence=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.cid=_F.newBuffer([]),e.prototype.type=0,e.encode=function(e,t){return t||(t=EF.create()),null!=e.cid&&Object.hasOwnProperty.call(e,"cid")&&t.uint32(10).bytes(e.cid),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(16).int32(e.type),t},e.decode=function(e,t){e instanceof vF||(e=vF.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new SF.Message.BlockPresence;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.cid=e.bytes();break;case 2:n.type=e.int32();break;default:e.skipType(7&s)}}return n},e.fromObject=function(e){if(e instanceof SF.Message.BlockPresence)return e;var t=new SF.Message.BlockPresence;switch(null!=e.cid&&("string"==typeof e.cid?_F.base64.decode(e.cid,t.cid=_F.newBuffer(_F.base64.length(e.cid)),0):e.cid.length>=0&&(t.cid=e.cid)),e.type){case"Have":case 0:t.type=0;break;case"DontHave":case 1:t.type=1}return t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.cid="":(r.cid=[],t.bytes!==Array&&(r.cid=_F.newBuffer(r.cid))),r.type=t.enums===String?"Have":0),null!=e.cid&&e.hasOwnProperty("cid")&&(r.cid=t.bytes===String?_F.base64.encode(e.cid,0,e.cid.length):t.bytes===Array?Array.prototype.slice.call(e.cid):e.cid),null!=e.type&&e.hasOwnProperty("type")&&(r.type=t.enums===String?SF.Message.BlockPresenceType[e.type]:e.type),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ge.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message.BlockPresence"},e}(),e})(),IF=AF.Wantlist.WantType.Block,RF=AF.Wantlist.WantType.Have;class kF{constructor(e,t){this.set=t?fL({system:"ipfs",component:"bitswap",metric:"wantlist",metrics:t.metrics}):new Map,this._stats=e}get length(){return this.set.size}add(e,t,r){const n=e.toString(Pe),s=this.set.get(n);s?(s.inc(),s.priority=t,s.wantType===RF&&r===IF&&(s.wantType=r)):(this.set.set(n,new bF(e,t,r)),this._stats&&this._stats.push(null,"wantListSize",1))}remove(e){const t=e.toString(Pe),r=this.set.get(t);r&&(r.dec(),r.hasRefs()||(this.set.delete(t),this._stats&&this._stats.push(null,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){return this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map((e=e=>e[1].key,t=Array.from(this.set.entries()),Array.prototype.slice.call(t,0).sort(((t,r)=>{const n=e(t),s=e(r);return n<s?-1:n>s?1:0}))));var e,t}contains(e){const t=e.toString(Pe);return this.set.has(t)}get(e){const t=e.toString(Pe);return this.set.get(t)}}kF.Entry=bF;const TF=kF.Entry;class CF{constructor(e,t,r,n,s){this.entry=new TF(e,t,r),this.cancel=Boolean(n),this.sendDontHave=Boolean(s)}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get wantType(){return this.entry.wantType}set wantType(e){this.entry.wantType=e}get[Symbol.toStringTag](){return`BitswapMessageEntry ${this.cid.toString(Pe)} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}}const PF=(e,t)=>{const r=["bitswap"];return t&&r.push(t),e&&r.push(`${e.toString().slice(0,8)}`),Object.assign(me(r.join(":")),{error:me(r.concat(["error"]).join(":"))})},NF=(e,t)=>{if(e.size!==t.size)return!1;for(const[r,n]of e){const e=t.get(r);if(void 0===e)return!1;if(n instanceof Uint8Array&&e instanceof Uint8Array&&!Ti(n,e))return!1;if(n instanceof CF&&e instanceof CF&&!n.equals(e))return!1}return!0};class DF{constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return 0===this.blocks.size&&0===this.wantlist.size&&0===this.blockPresences.size}addEntry(e,t,r,n,s){null==r&&(r=DF.WantType.Block);const i=e.toString(Pe),o=this.wantlist.get(i);o?(o.wantType===r&&(o.priority=t),n&&(o.cancel=Boolean(n)),s&&(o.sendDontHave=Boolean(s)),r===DF.WantType.Block&&o.wantType===DF.WantType.Have&&(o.wantType=r)):this.wantlist.set(i,new CF(e,t,r,n,s))}addBlock(e,t){const r=e.toString(Pe);this.blocks.set(r,t)}addHave(e){const t=e.toString(Pe);this.blockPresences.has(t)||this.blockPresences.set(t,DF.BlockPresenceType.Have)}addDontHave(e){const t=e.toString(Pe);this.blockPresences.has(t)||this.blockPresences.set(t,DF.BlockPresenceType.DontHave)}cancel(e){const t=e.toString(Pe);this.wantlist.delete(t),this.addEntry(e,0,DF.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){const e={wantlist:{entries:Array.from(this.wantlist.values()).map((e=>({block:e.cid.bytes,priority:Number(e.priority),cancel:Boolean(e.cancel)}))),full:!!this.full||void 0},blocks:Array.from(this.blocks.values())};return AF.encode(e).finish()}serializeToBitswap110(){const e={wantlist:{entries:Array.from(this.wantlist.values()).map((e=>({block:e.cid.bytes,priority:Number(e.priority),wantType:e.wantType,cancel:Boolean(e.cancel),sendDontHave:Boolean(e.sendDontHave)}))),full:!!this.full||void 0},blockPresences:[],payload:[],pendingBytes:this.pendingBytes};for(const[t,r]of this.blocks.entries()){const n=kt.parse(t),s=n.version,i=n.code,o=n.multihash.code,a=n.multihash.digest.length,c=wF([s,i,o,a]);e.payload.push(new AF.Block({prefix:c,data:r}))}for(const[t,r]of this.blockPresences)e.blockPresences.push(new AF.BlockPresence({cid:kt.parse(t).bytes,type:r}));return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),AF.encode(e).finish()}equals(e){return!!(this.full===e.full&&this.pendingBytes===e.pendingBytes&&NF(this.wantlist,e.wantlist)&&NF(this.blocks,e.blocks)&&NF(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){const e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}}DF.deserialize=async(e,t)=>{const r=AF.decode(e),n=r.wantlist&&r.wantlist.full||!1,s=new DF(n);return r.wantlist&&r.wantlist.entries&&r.wantlist.entries.forEach((e=>{if(!e.block)return;const t=kt.decode(e.block);s.addEntry(t,e.priority||0,e.wantType,Boolean(e.cancel),Boolean(e.sendDontHave))})),r.blockPresences&&r.blockPresences.forEach((e=>{if(!e.cid)return;const t=kt.decode(e.cid);e.type===DF.BlockPresenceType.Have?s.addHave(t):s.addDontHave(t)})),r.blocks.length>0?(await Promise.all(r.blocks.map((async e=>{const t=await As.digest(e),r=kt.createV0(t);s.addBlock(r,e)}))),s):r.payload.length>0?(await Promise.all(r.payload.map((async e=>{if(!e.prefix||!e.data)return;const r=mF(e.prefix),n=r[0],i=r[1],o=r[2],a=o===As.code?As:t&&await t.getHasher(o);if(!a)throw qe(new Error("Unknown hash algorithm"),"ERR_UNKNOWN_HASH_ALG");const c=await a.digest(e.data),l=kt.create(n,i,c);s.addBlock(l,e.data)}))),s.setPendingBytes(r.pendingBytes),s):s},DF.blockPresenceSize=e=>e.bytes.length+1,DF.Entry=CF,DF.WantType={Block:AF.Wantlist.WantType.Block,Have:AF.Wantlist.WantType.Have},DF.BlockPresenceType={Have:AF.BlockPresenceType.Have,DontHave:AF.BlockPresenceType.DontHave};const OF=Math.pow(2,31)-1;class xF{constructor(e,t,r){var n,s,i,o,a,c,l;this.peerId=t,this.network=r,this.refcnt=1,this._entries=[],this._log=PF(e,"msgqueue"),this.sendEntries=(n=this._sendEntries.bind(this),s=1,o=null,a=null,c=function(){o&&(clearTimeout(o),a=null,o=null)},l=function(){if(!s)return n.apply(this,arguments);var e=this,t=arguments,r=i&&!o;return c(),a=function(){n.apply(e,t)},o=setTimeout((function(){if(o=null,!r){var e=a;return a=null,e()}}),s),r?a():void 0},l.cancel=c,l.flush=function(){var e=a;c(),e&&e()},l)}addMessage(e){e.empty||this.send(e)}addEntries(e){this._entries=this._entries.concat(e),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;const e=new DF(!1);this._entries.forEach((t=>{t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)})),this._entries=[],this.addMessage(e)}async send(e){try{await this.network.connectTo(this.peerId)}catch(e){return void this._log.error("cant connect to peer %s: %s",this.peerId.toString(),e.message)}this._log("sending message to peer %s",this.peerId.toString()),this.network.sendMessage(this.peerId,e).catch((e=>{this._log.error("send error: %s",e.message)}))}}class LF{constructor(e,t,r,n){this.peers=fL({system:"ipfs",component:"bitswap",metric:"want-manager-peers",metrics:n.metrics}),this.wantlist=new kF(r,n),this.network=t,this._stats=r,this._peerId=e,this._log=PF(e,"want")}_addEntries(e,t,r){const n=e.map(((e,r)=>new DF.Entry(e,OF-r,DF.WantType.Block,t)));n.forEach((e=>{e.cancel?r?this.wantlist.removeForce(e.cid.toString(Pe)):this.wantlist.remove(e.cid):(this._log("adding to wl"),this.wantlist.add(e.cid,e.priority))}));for(const e of this.peers.values())e.addEntries(n)}_startPeerHandler(e){let t=this.peers.get(e.toString());if(t)return void t.refcnt++;t=new xF(this._peerId,e,this.network);const r=new DF(!0);for(const e of this.wantlist.entries())r.addEntry(e[1].cid,e[1].priority);return t.addMessage(r),this.peers.set(e.toString(),t),t}_stopPeerHandler(e){const t=this.peers.get(e.toString());t&&(t.refcnt--,t.refcnt>0||this.peers.delete(e.toString()))}wantBlocks(e,t={}){this._addEntries(e,!1),t&&t.signal&&t.signal.addEventListener("abort",(()=>{this.cancelWants(e)}))}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach((e=>this.disconnected(e.peerId)))}}const BF="/ipfs/bitswap/1.0.0",MF="/ipfs/bitswap/1.1.0",UF="/ipfs/bitswap/1.2.0";class zF{constructor(e,t,r,n={}){this._log=PF(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[BF],n.b100Only||(this._protocols.unshift(MF),this._protocols.unshift(UF)),this._stats=r,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=n.hashLoader,this._maxInboundStreams=n.maxInboundStreams??32,this._maxOutboundStreams=n.maxOutboundStreams??128,this._incomingStreamTimeout=n.incomingStreamTimeout??3e4}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection,{maxInboundStreams:this._maxInboundStreams,maxOutboundStreams:this._maxOutboundStreams});const e=rA({onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect});this._registrarIds=[];for(const t of this._protocols)this._registrarIds.push(await this._libp2p.registrar.register(t,e));this._libp2p.getConnections().forEach((e=>{this._onPeerConnect(e.remotePeer)}))}async stop(){if(this._running=!1,await this._libp2p.unhandle(this._protocols),null!=this._registrarIds){for(const e of this._registrarIds)this._libp2p.registrar.unregister(e);this._registrarIds=[]}}_onConnection({stream:e,connection:t}){if(!this._running)return;const r=new ei.TimeoutController(this._incomingStreamTimeout);Promise.resolve().then((async()=>{this._log("incoming new bitswap %s connection from %p",e.stat.protocol,t.remotePeer),await Xu(tT(e.source,r.signal),cT(),(async e=>{for await(const n of e){try{const e=await DF.deserialize(n.subarray(),this._hashLoader);await this._bitswap._receiveMessage(t.remotePeer,e)}catch(e){this._bitswap._receiveError(e);break}r.reset()}}))})).catch((t=>{this._log(t),e.abort(t)})).finally((()=>{r.clear(),e.close()}))}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e,t={}){return this._libp2p.contentRouting.findProviders(e,t)}async findAndConnect(e,t){const r=[];let n=0;for await(const s of this.findProviders(e,t))if(this._log(`connecting to provider ${s.id}`),r.push(this.connectTo(s.id,t).catch((e=>{this._log.error(e)}))),n++,3===n)break;await Promise.all(r)}async provide(e,t){await this._libp2p.contentRouting.provide(e,t)}async sendMessage(e,t){if(!this._running)throw new Error("network isn't running");const r=e.toString();this._log("sendMessage to %s",r,t);const n=await this._libp2p.dial(e),s=await n.newStream([UF,MF,BF]);await async function(e,t,r){try{let r;switch(e.stat.protocol){case BF:r=t.serializeToBitswap100();break;case MF:case UF:r=t.serializeToBitswap110();break;default:throw new Error("Unknown protocol: "+e.stat.protocol)}await Xu([r],iT(),e)}catch(e){r(e)}finally{e.close()}}(s,t,this._log),this._updateSentStats(e,t.blocks)}async connectTo(e,t){if(!this._running)throw new Error("network isn't running");return this._libp2p.dial(e,t)}_updateSentStats(e,t){const r=e.toString();if(this._stats){for(const e of t.values())this._stats.push(r,"dataSent",e.length);this._stats.push(r,"blocksSent",t.size)}}}class VF{constructor(e){this.partner=e,this.wantlist=new kF,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesRecv+=e}wants(e,t,r){this.wantlist.add(e,t,r)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}}class FF extends Map{constructor(e,t){super(),this._cmp=t||this._defaultSort,this._keys=[];for(const[t,r]of e||[])this.set(t,r)}update(e){if(e<0||e>=this._keys.length)return;const t=this._keys[e];this._keys.splice(e,1);const r=this._find(t);this._keys.splice(r,0,t)}set(e,t){if(this.has(e)){const t=this.indexOf(e);this._keys.splice(t,1)}super.set(e,t);const r=this._find(e);return this._keys.splice(r,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;const t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;const t=this._find(e);if(this._keys[t]===e)return t;for(let r=1;r<this._keys.length;r++){if(this._keys[t+r]===e)return t+r;if(this._keys[t-r]===e)return t-r}return-1}_find(e){let t=0,r=this._keys.length;for(;t<r;){const n=t+r>>>1,s=this._kCmp(this._keys[n],e);if(s<0)t=n+1;else{if(!(s>0))return n;r=n}}return t}*keys(){for(const e of this._keys)yield e}*values(){for(const e of this._keys)yield this.get(e)}*entries(){for(const e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e,t){if(e)for(const r of this._keys)e.apply(t,[[r,this.get(r)]])}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}}const jF={hasNewInfo:()=>!1,merge(){}};class KF{constructor(e=jF){this._taskMerger=e,this._byPeer=new FF([],$F.compare)}pushTasks(e,t){let r=this._byPeer.get(e.toString());r||(r=new $F(e,this._taskMerger)),r.pushTasks(t),this._byPeer.set(e.toString(),r)}popTasks(e){const t=this._head();if(void 0===t)return{tasks:[],pendingSize:0};const{tasks:r,pendingSize:n}=t.popTasks(e);if(0===r.length)return{tasks:r,pendingSize:n};const s=t.peerId;return t.isIdle()?this._byPeer.delete(s.toString()):this._byPeer.update(0),{peerId:s,tasks:r,pendingSize:n}}_head(){if(0!==this._byPeer.size)for(const[,e]of this._byPeer)return e}remove(e,t){const r=this._byPeer.get(t.toString());r&&r.remove(e)}tasksDone(e,t){const r=this._byPeer.get(e.toString());if(!r)return;const n=this._byPeer.indexOf(e.toString());for(const e of t)r.taskDone(e);this._byPeer.update(n)}}class $F{constructor(e,t){this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new HF,this._active=new Set}pushTasks(e){for(const t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;const t=this._pending.get(e.topic);if(t)return e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),void this._taskMerger.merge(e,t);this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){const t=[];for(const r of this._active)r.topic===e.topic&&t.push(r);return 0===t.length||this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0;const r=[],n=this._pending.tasks();for(let s=0;s<n.length&&t<e;s++){const e=n[s];r.push(e),t+=e.size,this._pending.delete(e.topic),this._activeTotalSize+=e.size,this._active.add(e)}return{tasks:r,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return 0===this._pending.length&&0===this._active.size}static compare(e,t){return 0===e[1]._pending.length?1:0===t[1]._pending.length?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}}class HF{constructor(){this._tasks=new FF([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce(((e,t)=>e+t.task.size),0)}get(e){return(this._tasks.get(e)||{}).task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map((e=>e.task))}updatePriority(e,t){const r=this._tasks.get(e);if(!r)return;const n=this._tasks.indexOf(e);r.task.priority=t,this._tasks.update(n)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}}const qF={hasNewInfo(e,t){let r=!1,n=!1;for(const e of t)e.data.haveBlock&&(r=!0),e.data.isWantBlock&&(n=!0);return!(n||!e.data.isWantBlock)||!(r||!e.data.haveBlock)},merge(e,t){const r=e.data,n=t.data;!n.haveBlock&&r.haveBlock&&(n.haveBlock=r.haveBlock,n.blockSize=r.blockSize),!n.isWantBlock&&r.isWantBlock&&(n.isWantBlock=!0,n.haveBlock&&!r.haveBlock||(n.haveBlock=r.haveBlock,t.size=e.size)),n.isWantBlock&&n.haveBlock&&(t.size=n.blockSize)}},GF=DF.WantType;class WF{constructor(e,t,r,n,s,i={}){this._log=PF(e,"engine"),this.blockstore=t,this.network=r,this._stats=n,this._opts=this._processOpts(i),this.ledgerMap=fL({system:"ipfs",component:"bitswap",metric:"ledger-map",metrics:s.metrics}),this._running=!1,this._requestQueue=new KF(qF)}_processOpts(e){return{maxSizeReplaceHasWithBlock:1024,targetMessageSize:16384,...e}}_scheduleProcessTasks(){setTimeout((()=>{this._processTasks()}))}async _processTasks(){if(!this._running)return;const{peerId:e,tasks:t,pendingSize:r}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(0===t.length)return;const n=new DF(!1);n.setPendingBytes(r);const s=[],i=new Map;for(const e of t){const t=kt.parse(e.topic);e.data.haveBlock?e.data.isWantBlock?(s.push(t),i.set(e.topic,e.data)):n.addHave(t):n.addDontHave(t)}const o=await this._getBlocks(s);for(const[e,t]of i){const r=kt.parse(e),s=o.get(e);s?n.addBlock(r,s):t.sendDontHave&&n.addDontHave(r)}if(n.empty)return e&&this._requestQueue.tasksDone(e,t),void this._scheduleProcessTasks();try{e&&await this.network.sendMessage(e,n);for(const[t,r]of o.entries())e&&this.messageSent(e,kt.parse(t),r)}catch(e){this._log.error(e)}e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){const t=e.toString(),r=this.ledgerMap.get(t);return r?r.wantlist.sortedEntries():new Map}ledgerForPeer(e){const t=e.toString(),r=this.ledgerMap.get(t);return r?{peer:r.partner,value:r.debtRatio(),sent:r.accounting.bytesSent,recv:r.accounting.bytesRecv,exchanged:r.exchangeCount}:null}peers(){return Array.from(this.ledgerMap.values()).map((e=>e.partner))}receivedBlocks(e){if(e.length){for(const t of this.ledgerMap.values())for(const r of e){const e=t.wantlistContains(r.cid);if(!e)continue;const n=r.data.length,s=this._sendAsBlock(e.wantType,n);let i=n;s||(i=DF.blockPresenceSize(e.cid)),this._requestQueue.pushTasks(t.partner,[{topic:e.cid.toString(Pe),priority:e.priority,size:i,data:{blockSize:n,isWantBlock:s,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){const r=this._findOrCreate(e);if(t.empty)return;if(t.full&&(r.wantlist=new kF),this._updateBlockAccounting(t.blocks,r),0===t.wantlist.size)return void this._scheduleProcessTasks();const n=[],s=[];t.wantlist.forEach((e=>{e.cancel?(r.cancelWant(e.cid),n.push(e.cid)):(r.wants(e.cid,e.priority,e.wantType),s.push(e))})),this._cancelWants(e,n),await this._addWants(e,s),this._scheduleProcessTasks()}_cancelWants(e,t){for(const r of t)this._requestQueue.remove(r.toString(Pe),e)}async _addWants(e,t){const r=await this._getBlockSizes(t.map((e=>e.cid))),n=[];for(const s of t){const t=s.cid.toString(Pe),i=r.get(t);if(null==i)s.sendDontHave&&n.push({topic:t,priority:s.priority,size:DF.blockPresenceSize(s.cid),data:{isWantBlock:s.wantType===GF.Block,blockSize:0,haveBlock:!1,sendDontHave:s.sendDontHave}});else{const e=this._sendAsBlock(s.wantType,i);let r=i;e||(r=DF.blockPresenceSize(s.cid)),n.push({topic:t,priority:s.priority,size:r,data:{isWantBlock:e,blockSize:i,haveBlock:!0,sendDontHave:s.sendDontHave}})}this._requestQueue.pushTasks(e,n)}}_sendAsBlock(e,t){return e===GF.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){const t=await this._getBlocks(e);return new Map([...t].map((([e,t])=>[e,t.length])))}async _getBlocks(e){const t=new Map;return await Promise.all(e.map((async e=>{try{const r=await this.blockstore.get(e);t.set(e.toString(Pe),r)}catch(t){"ERR_NOT_FOUND"!==t.code&&this._log.error("failed to query blockstore for %s: %s",e,t)}}))),t}_updateBlockAccounting(e,t){for(const r of e.values())this._log("got block (%s bytes)",r.length),t.receivedBytes(r.length)}messageSent(e,t,r){const n=this._findOrCreate(e);n.sentBytes(r.length),n.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){this.ledgerMap.delete(e.toString())}_findOrCreate(e){const t=e.toString(),r=this.ledgerMap.get(t);if(r)return r;const n=new VF(e);return this.ledgerMap.set(t,n),this._stats&&this._stats.push(t,"peerCount",1),n}start(){this._running=!0}stop(){this._running=!1}}const YF=e=>`unwant:${ni(e.multihash.bytes,"base64")}`,ZF=e=>`block:${ni(e.multihash.bytes,"base64")}`;class QF extends jO.EventEmitter{constructor(e){super(),this.setMaxListeners(1e3),this._log=PF(e,"notif")}hasBlock(e,t){const r=ZF(e);this._log(r),this.emit(r,t)}wantBlock(e,t={}){if(!e)throw new Error("Not a valid cid");const r=ZF(e),n=YF(e);return this._log(`wantBlock:${e}`),new Promise(((s,i)=>{const o=()=>{this.removeListener(r,a),i(new Error(`Block for ${e} unwanted`))},a=e=>{this.removeListener(n,o),s(e)};this.once(n,o),this.once(r,a),t&&t.signal&&t.signal.addEventListener("abort",(()=>{this.removeListener(r,a),this.removeListener(n,o),i(new Error(`Want for ${e} aborted`))}))}))}unwantBlock(e){const t=YF(e);this._log(t),this.emit(t)}}var JF=r(3024);class XF extends jO.EventEmitter{constructor(e,t){super(),this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach((e=>{this._stats[e]=BigInt(0),this._movingAverages[e]={},this._options.movingAverageIntervals.forEach((t=>{(this._movingAverages[e][t]=JF(t)).push(this._frequencyLastTime,0)}))})),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){const e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;for(;this._queue.length;){const t=e=this._queue.shift();t&&this._applyOp(t)}e&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){const t=e-this._frequencyLastTime;t&&Object.keys(this._stats).forEach((r=>{this._updateFrequencyFor(r,t,e)})),this._frequencyLastTime=e}_updateFrequencyFor(e,t,r){const n=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;const s=n/t*1e3;let i=this._movingAverages[e];i||(i=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach((e=>{let t=i[e];t||(t=i[e]=JF(e)),t.push(r,s)}))}_applyOp(e){const t=e[0],r=e[1];if("number"!=typeof r)throw new Error(`invalid increment number: ${r}`);Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(r),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=r}}const ej={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[6e4,3e5,9e5]};class tj extends jO.EventEmitter{constructor(e,t=[],r=ej){super();const n=Object.assign({},ej,r);if("number"!=typeof n.computeThrottleTimeout)throw new Error("need computeThrottleTimeout");if("number"!=typeof n.computeThrottleMaxQueueSize)throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=t,this._options=n,this._enabled=this._options.enabled,this._global=new XF(t,n),this._global.on("update",(e=>this.emit("update",e))),this._peers=fL({system:"ipfs",component:"bitswap",metric:"stats-peers",metrics:e.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(const e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){const t="string"!=typeof e&&e.toString?e.toString():`${e}`;return this._peers.get(t)}push(e,t,r){if(this._enabled&&(this._global.push(t,r),e)){let n=this._peers.get(e);n||(n=new XF(this._initialCounters,this._options),this._peers.set(e,n)),n.push(t,r)}}disconnected(e){const t=e.toString(),r=this._peers.get(t);r&&(r.stop(),this._peers.delete(t))}}const rj={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},nj=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"];class sj extends TS{constructor(e,t,r={}){super(),this._libp2p=e,this._log=PF(this.peerId),this._options=Object.assign({},rj,r),this._stats=new tj(e,nj,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new zF(e,this,this._stats,{hashLoader:r.hashLoader,maxInboundStreams:r.maxInboundStreams,maxOutboundStreams:r.maxOutboundStreams,incomingStreamTimeout:r.incomingStreamTimeout}),this.blockstore=t,this.engine=new WF(this.peerId,t,this.network,this._stats,e),this.wm=new LF(this.peerId,this.network,this._stats,e),this.notifications=new QF(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch(e){this._log("failed to receive message",t)}if(0===t.blocks.size)return;const r=[];for(const[e,n]of t.blocks.entries()){const t=kt.parse(e);r.push({wasWanted:this.wm.wantlist.contains(t),cid:t,data:n})}this.wm.cancelWants(r.filter((({wasWanted:e})=>e)).map((({cid:e})=>e))),await Promise.all(r.map((({cid:t,wasWanted:r,data:n})=>this._handleReceivedBlock(e,t,n,r))))}async _handleReceivedBlock(e,t,r,n){this._log("received block");const s=await this.blockstore.has(t);this._updateReceiveCounters(e.toString(),t,r,s),n&&await this.put(t,r)}_updateReceiveCounters(e,t,r,n){this._stats.push(e,"blocksReceived",1),this._stats.push(e,"dataReceived",r.length),n&&(this._stats.push(e,"dupBlksReceived",1),this._stats.push(e,"dupDataReceived",r.length))}_receiveError(e){this._log.error("ReceiveError: %s",e.message)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async get(e,t={}){const r=(e,t)=>(this.wm.wantBlocks([e],t),this.notifications.wantBlock(e,t));let n=!1;const s=async(e,t)=>{try{return await this.blockstore.get(e,t)}catch(s){if("ERR_NOT_FOUND"!==s.code)throw s;return n||(n=!0,this.network.findAndConnect(e,t).catch((e=>this._log.error(e)))),r(e,t)}},i=new AbortController,o=t.signal?(0,Oo.anySignal)([t.signal,i.signal]):i.signal;try{return await Promise.race([this.notifications.wantBlock(e,{signal:o}),s(e,{signal:o})])}finally{i.abort()}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}unwant(e){const t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach((e=>this.notifications.unwantBlock(e)))}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,r){await this.blockstore.put(e,t),this._sendHaveBlockNotifications(e,t)}async*putMany(e,t){for await(const{key:r,value:n}of this.blockstore.putMany(e,t))this._sendHaveBlockNotifications(r,n),yield{key:r,value:n}}_sendHaveBlockNotifications(e,t){this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,data:t}]),this.network.provide(e).catch((e=>{this._log.error("Failed to provide: %s",e.message)}))}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this._stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}unwrap(){return this.blockstore}}function ij(e){return e=e||new Error("Not Found"),qe(e,"ERR_NOT_FOUND")}function oj(e){return e=e||new Error("Aborted"),qe(e,"ERR_ABORTED")}class aj extends TS{constructor(e,t){super(),this.child=e,this.bitswap=t}open(){return this.child.open()}close(){return this.child.close()}unwrap(){return this.child}async put(e,t,r={}){await this.has(e)||(this.bitswap.isStarted()?await this.bitswap.put(e,t,r):await this.child.put(e,t,r))}async*putMany(e,t={}){const r=Vd(e,(async({key:e})=>!await this.has(e)));this.bitswap.isStarted()?yield*this.bitswap.putMany(r,t):yield*this.child.putMany(r,t)}async get(e,t={}){return!await this.has(e)&&this.bitswap.isStarted()?this.bitswap.get(e,t):this.child.get(e,t)}async*getMany(e,t={}){const r=ju({objectMode:!0}),n=ju({objectMode:!0});Promise.resolve().then((async()=>{for await(const t of e)!await this.has(t)&&this.bitswap.isStarted()?r.push(t):n.push(t);r.end(),n.end()})),yield*dS(this.bitswap.getMany(r,t),this.child.getMany(n,t))}async delete(e,t){await this.child.delete(e,t)}async*deleteMany(e,t){yield*this.child.deleteMany(e,t)}async has(e,t={}){return this.child.has(e,t)}async*query(e,t={}){yield*this.child.query(e,t)}async*queryKeys(e,t={}){yield*this.child.queryKeys(e,t)}}class cj{constructor(e,t,r,n,s){this.peerId=e,this.libp2p=t,this.bitswap=r,this.repo=n,this.blockstore=s}static async start({peerId:e,repo:t,print:r,hashers:n,options:s}){t.closed&&await t.open();const i=await t.config.getAll(),o=await iF({options:s,repo:t,peerId:e,multiaddrs:lj(e,i),config:i,keychainConfig:void 0});await o.start();for(const e of o.getMultiaddrs())r(`Swarm listening on ${e.toString()}`);const a=((e,t,r={})=>new sj(e,t,r))(o,t.blocks,{statsEnabled:!0,hashLoader:n,maxInboundStreams:1024,maxOutboundStreams:1024});await a.start();const c=new aj(t.blocks,a);return t.blocks=c,t.pins.blockstore=c,new cj(e,o,a,t,c)}static async stop(e){e.repo.blocks=e.blockstore.unwrap(),e.repo.pins.blockstore=e.blockstore.unwrap(),await e.bitswap.stop(),await e.libp2p.stop()}}const lj=(e,t)=>{const r=e.toString(),n=[],s=t.Addresses&&t.Addresses.Swarm||[];for(const e of s){let t=Ki(e);if(t.protoCodes().includes(hj))throw qe(new Error("websocket-star swarm addresses are not supported. See https://github.com/ipfs/js-ipfs/issues/2779"),"ERR_WEBSOCKET_STAR_SWARM_ADDR_NOT_SUPPORTED");const s=t.getPeerId();s&&s!==r&&(t=t.encapsulate(`/p2p/${r}`)),n.push(t)}return n},hj=479;class uj{constructor({network:e}){this.addrs=function({network:e}){return zo((async function(t={}){const r=[],{libp2p:n}=await e.use(t);return await n.peerStore.forEach((e=>{r.push({id:e.id,addrs:e.addresses.map((e=>e.multiaddr))})})),r}))}({network:e}),this.connect=function({network:e}){return zo((async function(t,r={}){const{libp2p:n}=await e.use(r);await n.dial(t,r)}))}({network:e}),this.disconnect=function({network:e}){return zo((async function(t,r={}){const{libp2p:n}=await e.use(r);await n.hangUp(t)}))}({network:e}),this.localAddrs=function({network:e}){return zo((async function(t={}){const{libp2p:r}=await e.use(t);return r.getMultiaddrs()}))}({network:e}),this.peers=function({network:e}){return zo((async function(t={}){const{libp2p:r}=await e.use(t);if(t.verbose){const e=[];for(const n of r.getConnections()){const r={addr:n.remoteAddr,peer:n.remotePeer};(t.verbose||t.direction)&&(r.direction=n.stat.direction),t.verbose&&(r.muxer=n.stat.multiplexer,r.latency="n/a",r.streams=[]),e.push(r)}return e}const n=new Map;for(const e of r.getConnections()){const t={addr:e.remoteAddr,peer:e.remotePeer};n.set(e.remotePeer.toString(),t)}return Array.from(n.values())}))}({network:e})}}const dj={success:!0,time:0,text:""},pj="/ipns/";function fj(e){let t;if(e.startsWith(pj)&&(e=e.substring(pj.length)),"1"!==e[0]&&"Q"!==e[0]||(e=`z${e}`),"z"===e[0]&&(t=Pe.decode(e)),"k"===e[0]&&(t=ms.decode(e)),!t)throw new Error("Could not parse string");if(1!==t[0]&&114!==t[1]&&(t=di([[1,114],t])),40!==t.length)throw new Error("Incorrect length "+t.length);return di([Xs(pj),t.subarray(2)])}const yj=async(e,t,r)=>{const n=await e.use(r);if(null!=n.libp2p.dht)return n;{const e=async function*(){yield{from:t,name:"QUERY_ERROR",type:3,error:new Hs("dht not enabled")}};return{libp2p:{dht:{get:e,put:e,findProviders:e,findPeer:e,provide:e,getClosestPeers:e}}}}},gj=async()=>{throw new Hs("pubsub not enabled")};var mj=r(82784);const wj=ye.bind({ignoreUndefined:!0}),bj=He("ipfs");class vj{constructor({print:e,storage:t,codecs:r,options:n}){const{peerId:s,repo:i,keychain:o}=t,a=Zo.create(cj),c=Jw(n.preload),l=zo((async(e,t={recursive:!0})=>{if("string"!=typeof e)throw new Error("Invalid arguments, domain must be a string");return async function(e,t){return(async(e,t={})=>{const r=new URLSearchParams(t);r.set("arg",e);const n=r.toString();if(!t.nocache&&za.has(n)){const e=za.get(n);return Fa(e)}const s=await Va.add((async()=>{const e=await Ua.get("https://ipfs.io/api/v0/dns",{searchParams:r}),t=new URL(e.url).search.slice(1),n=await e.json();return za.set(t,n,6e4),n}));return Fa(s)})(e,t)}(e=function(e){return e.endsWith(".eth")&&(e=e.replace(/.eth$/,".eth.link")),e}(e),t)})),h=function({network:e}){return()=>{const t=e.try();return null!=t&&Boolean(t.libp2p.isStarted())}}({network:a}),u=new gd(n),d=Object.values(Ms);(n.ipld&&n.ipld.hashers?n.ipld.hashers:[]).forEach((e=>d.push(e))),this.hashers=new TT({hashers:d,loadHasher:n.ipld&&n.ipld.loadHasher});const p=Object.values(Bs);(n.ipld&&n.ipld.bases?n.ipld.bases:[]).forEach((e=>p.push(e))),this.bases=new AT({bases:p,loadBase:n.ipld&&n.ipld.loadBase});const f=new sc({repo:i,codecs:r}),y=new jd({codecs:r,hashers:this.hashers,preload:c,repo:i}),g=new Id({dns:l,ipns:u,repo:i,codecs:r,peerId:s,isOnline:h,keychain:o,options:n}),m=function({repo:e,codecs:t,bases:r,name:n}){return zo((async function(s,i={}){if(!Ro(s))throw new Error("invalid argument "+s);if(ko(s))for await(const e of n.resolve(s,i))s=e;const[,o,a,...c]=s.split("/"),l=i.cidBase?await r.getBase(i.cidBase):void 0,h=function(e){try{return Za(e).toBytes()}catch{return kt.parse(e).bytes}}(a);if(0===c.length)return`/${o}/${l?l.encoder.encode(h):a}`;const u=kt.decode(h);s=c.join("/");const d=Yo(u,s,t,e,i);let p=u,f=s;for await(const e of d)kt.asCID(e.value)&&(p=e.value,f=e.remainderPath);return`/ipfs/${p.toString(l&&l.encoder)}${f?"/"+f:""}`}))}({repo:i,codecs:r,bases:this.bases,name:g}),w=new $w({repo:i,codecs:r,hashers:this.hashers,preload:c}),b=Object.assign(function({repo:e,codecs:t,resolve:r,preload:n}){return async function*(s,i={}){if(0===i.maxDepth)return;if(i.edges&&i.format&&i.format!==kd)throw new Error("Cannot set edges to true and also specify format");if(i.format=i.edges?"<src> -> <dst>":i.format,"number"!=typeof i.maxDepth&&(i.maxDepth=i.recursive?1/0:1),i.timeout){const e=[new ei.TimeoutController(i.timeout).signal];i.signal&&e.push(i.signal),i.signal=(0,Oo.anySignal)(e)}const o=(Array.isArray(s)?s:[s]).map((e=>function(e,t,r){const{cid:n,path:s}=Fo(t);return!1!==r.preload&&e(n),`/ipfs/${n}${s||""}`}(n,e,i)));for(const n of o)try{yield*Td(r,e,t,n,i)}catch(e){yield{ref:"",err:e.message}}}}({repo:i,codecs:r,resolve:m,preload:c}),{local:Nd({repo:t.repo})}),{add:v,addAll:E,cat:_,get:S,ls:A}=new rw({preload:c,repo:i,options:n.EXPERIMENTAL,hashers:this.hashers}),I=function({repo:e,preload:t,hashers:r,options:n}){const s=function(e){const{repoOwner:t}=Object.assign({},Qv||{},e),r=_b(t),n={};return Zv({options:e,mfs:n,operations:Gv,lock:e=>r.readLock(e)}),Zv({options:e,mfs:n,operations:Wv,lock:e=>r.writeLock(e)}),Object.keys(Yv).forEach((t=>{n[t]=Yv[t](e)})),n}({repo:e,repoOwner:!1!==n.repoOwner,hashers:r}),i=e=>(...r)=>{const n=r.filter((e=>_o(e,wo)||Eo(e)));if(n.length){const e=r[r.length-1];e&&!1!==e.preload&&n.forEach((e=>t(e)))}return e(...r)};return{...s,chmod:s.chmod,cp:i(s.cp),mkdir:s.mkdir,stat:i(s.stat),rm:s.rm,read:i(s.read),touch:s.touch,write:s.write,mv:i(s.mv),flush:s.flush,ls:i((async function*(...e){for await(const t of s.ls(...e))yield{...t,size:t.size||0}}))}}({repo:i,preload:c,hashers:this.hashers,options:n}),R=function({preload:e,files:t,options:r={}}){if(r.interval=r.interval||3e4,!r.enabled){Xw("MFS preload disabled");const e=async()=>{};return{start:e,stop:e}}let n,s="";const i=async()=>{try{const o=await t.stat("/"),a=o.cid.toString();s!==a&&(Xw(`preloading updated MFS root ${s} -> ${o.cid}`),await e(o.cid),s=a)}catch(e){Xw.error("failed to preload MFS root",e)}finally{n=setTimeout(i,r.interval)}};return{async start(){const e=await t.stat("/");s=e.cid.toString(),Xw(`monitoring MFS root ${e.cid}`),n=setTimeout(i,r.interval)},stop(){clearTimeout(n)}}}({files:I,preload:c,options:n.preload});this.preload=c,this.name=g,this.ipns=u,this.pin=f,this.resolve=m,this.block=y,this.refs=b,this.start=function({network:e,preload:t,peerId:r,keychain:n,repo:s,ipns:i,mfsPreload:o,print:a,hashers:c,options:l}){return async()=>{const{libp2p:h}=await Zo.start(e,{peerId:r,repo:s,print:a,hashers:c,options:l});await Promise.all([i.startOnline({keychain:n,libp2p:h,peerId:r,repo:s}),t.start(),o.start()])}}({network:a,peerId:s,repo:i,preload:c,ipns:u,mfsPreload:R,print:e,keychain:o,hashers:this.hashers,options:n}),this.stop=function({network:e,preload:t,ipns:r,repo:n,mfsPreload:s}){return async()=>{await Promise.all([t.stop(),r.stop(),s.stop()]),await Zo.stop(e),await n.close()}}({network:a,preload:c,mfsPreload:R,ipns:u,repo:i}),this.dht=function({network:e,repo:t,peerId:r}){const{get:n,put:s,findProvs:i,findPeer:o,provide:a,query:c}={async*get(t,n={}){const{libp2p:s}=await yj(e,r,n),i=t instanceof Uint8Array?t:fj(t);if(null==s.dht)throw qe(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.get(i,n)},async*put(t,n,s){const{libp2p:i}=await yj(e,r,s),o=t instanceof Uint8Array?t:fj(t);if(null==i.dht)throw qe(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*i.dht.put(o,n,s)},async*findProvs(t,n={}){const{libp2p:s}=await yj(e,r,n);if(null==s.dht)throw qe(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.findProviders(t,{signal:n.signal})},async*findPeer(t,n={}){const{libp2p:s}=await yj(e,r,n);if(null==s.dht)throw qe(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.findPeer(t,{signal:n.signal})},async*provide(n,s={recursive:!1}){const{libp2p:i}=await yj(e,r,s);if(!await t.blocks.has(n))throw qe(new Error("block(s) not found locally, cannot provide"),"ERR_BLOCK_NOT_FOUND");if(s.recursive)throw qe(new Error("not implemented yet"),"ERR_NOT_IMPLEMENTED_YET");if(null==i.dht)throw qe(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*i.dht.provide(n)},async*query(t,n={}){const{libp2p:s}=await yj(e,r,n);let i;const o=kt.asCID(t);if(i=null!=o?o.multihash.bytes:Za(t.toString()).toBytes(),null==s.dht)throw qe(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.getClosestPeers(i,n)}};return{get:zo(n),put:zo(s),findProvs:zo(i),findPeer:zo(o),provide:zo(a),query:zo(c)}}({network:a,repo:i,peerId:s}),this.pubsub=function({network:e,config:t}){const r=qu(t||{},"Pubsub.Enabled",!0),n={};let s;return{subscribe:r?zo((async function(t,r,i={}){const{libp2p:o}=await e.use(i);o.pubsub.subscribe(t),null==s&&(s=e=>{const t=e.detail;n[t.topic]&&n[t.topic].forEach((e=>{"function"!=typeof e?null!=e&&null!=e.handleEvent&&e.handleEvent(t):e(t)}))},o.pubsub.addEventListener("message",s)),null!=r&&(null==n[t]&&(n[t]=[]),n[t].push(r))})):gj,unsubscribe:r?zo((async function(t,r,i={}){const{libp2p:o}=await e.use(i);null!=r&&null!=n[t]&&(n[t]=n[t].filter((e=>e!==r)),0===n[t].length&&delete n[t]),"function"!=typeof r&&delete n[t],null==n[t]&&o.pubsub.unsubscribe(t),0===Object.keys(n).length&&(o.pubsub.removeEventListener("message",s),s=void 0)})):gj,publish:r?zo((async function(t,r,n={}){const{libp2p:s}=await e.use(n);if(!r)throw qe(new Error('argument "data" is required'),"ERR_ARG_REQUIRED");await s.pubsub.publish(t,r)})):gj,ls:r?zo((async function(t={}){const{libp2p:r}=await e.use(t);return r.pubsub.getTopics()})):gj,peers:r?zo((async function(t,r={}){const{libp2p:n}=await e.use(r);return n.pubsub.getSubscribers(t)})):gj}}({network:a,config:n.config}),this.dns=l,this.isOnline=h,this.id=function({peerId:e,network:t}){return zo((async function(r={}){const n=t.try();if(!n){if(r.peerId)throw new js;if(null==e.publicKey)throw qe(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");return{id:e,publicKey:ni(e.publicKey,"base64pad"),addresses:[],agentVersion:"js-ipfs/0.17.0",protocolVersion:"9000",protocols:[]}}const{libp2p:s}=n,i=r.peerId?r.peerId:e,o=await async function(e,t,r){let n=await t.peerStore.get(e);n||(n=await async function(e,t,r){if(null==t.dht)throw qe(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");for await(const n of t.dht.findPeer(e,r))if("FINAL_PEER"===n.name)break;const n=await t.peerStore.get(e);if(!n)throw qe(new Error("Could not find peer"),"ERR_NOT_FOUND");return n}(e,t,r));let s=e.publicKey?e.publicKey:await t.peerStore.keyBook.get(e);if(null==s)try{s=await t.getPublicKey(e,r)}catch(t){sw.error("Could not load public key for",e.toString(),t)}return{...n,publicKey:s,metadata:n.metadata||new Map,addresses:n.addresses.map((e=>e.multiaddr))}}(i,s,r),a=ni(o.metadata.get("AgentVersion")||new Uint8Array),c=ni(o.metadata.get("ProtocolVersion")||new Uint8Array),l=o.id.toString();return{id:i,publicKey:o.publicKey?ni(o.publicKey,"base64pad"):"",addresses:(o.addresses||[]).map((e=>{const t=e.toString();return t.endsWith(`/p2p/${l}`)?t:`${t}/p2p/${l}`})).sort().map((e=>Ki(e))),agentVersion:a,protocolVersion:c,protocols:(o.protocols||[]).sort()}}))}({network:a,peerId:s}),this.version=function({repo:e}){return zo((async function(t={}){const r=await e.version.get();return{version:nw,commit:"e8b7b66bfa98c2a1c0d0bfc19f698d7d00b6c888",repo:`${r}`,"ipfs-core":nw,"interface-ipfs-core":"^0.157.0"}}))}({repo:i}),this.bitswap=new Od({network:a}),this.bootstrap=new Ld({repo:i}),this.config=function({repo:e}){return{getAll:zo((async function(t={}){return e.config.getAll(t)})),get:zo((async function(t,r){return t?e.config.get(t,r):Promise.reject(new Error("key argument is required"))})),set:zo((async function(t,r,n){return e.config.set(t,r,n)})),replace:zo((async function(t,r){return e.config.replace(t,r)})),profiles:{apply:zo((async function(t,r={dryRun:!1}){const{dryRun:n}=r,s=aw[t];if(!s)throw new Error(`No profile with name '${t}' exists`);try{const t=await e.config.getAll(r);let i=JSON.parse(JSON.stringify(t));return i=s.transform(i),n||await e.config.replace(i,r),delete t.Identity.PrivKey,delete i.Identity.PrivKey,{original:t,updated:i}}catch(e){throw cw(e),new Error(`Could not apply profile '${t}' to config: ${e.message}`)}})),list:zo(lw)}}}({repo:i}),this.ping=function({network:e}){return zo((async function*(t,r={}){const{libp2p:n}=await e.use();r.count=r.count||10;const s=await n.peerStore.get(t);let i=s&&s.id;if(!i){yield{...dj,text:`Looking up peer ${t}`};const e=await n.peerRouting.findPeer(t);i=e&&e.id}if(!i)throw new Error("Peer was not found");yield{...dj,text:`PING ${i.toString()}`};let o=0,a=0;for(let e=0;e<r.count;e++)try{const e=await n.ping(i);a+=e,o++,yield{...dj,time:e}}catch(e){yield{...dj,success:!1,text:e.toString()}}if(o){const e=a/o;yield{...dj,text:`Average latency: ${e}ms`}}}))}({network:a}),this.add=v,this.addAll=E,this.cat=_,this.get=S,this.ls=A,this.dag=w,this.files=I,this.key=new Xv({keychain:o}),this.object=new iE({preload:c,codecs:r,repo:i}),this.repo=new cE({repo:i,hashers:this.hashers}),this.stats=new hE({repo:i,network:a}),this.swarm=new uj({network:a}),Object.defineProperty(this,"libp2p",{get(){const e=a.try();return e?e.libp2p:void 0}});const k=()=>Promise.reject(qe(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED"));this.commands=k,this.diag={cmds:k,net:k,sys:k},this.log={level:k,ls:k,tail:async function*(){throw qe(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")}},this.mount=k,this.codecs=r}async init(){throw new Fs}}r(52596);const Ej=async function(e={}){const t=(e=wj({start:!0,EXPERIMENTAL:{},preload:{enabled:!ge.isTest,addresses:["/dns4/node0.preload.ipfs.io/https","/dns4/node1.preload.ipfs.io/https","/dns4/node2.preload.ipfs.io/https","/dns4/node3.preload.ipfs.io/https"]}},e)).init||{},r={name:hs.name,code:hs.code,encode:e=>e,decode:e=>e},n=Object.values(Us);[o,a,c,l,r].concat(e.ipld&&e.ipld.codecs||[]).forEach((e=>n.push(e)));const s=new RT({codecs:n,loadCodec:e.ipld&&e.ipld.loadCodec}),i=e.silent?bj:mj.log;bj("creating repo");const h=await cF.start(i,s,e);bj("getting repo config");const u=await h.repo.config.getAll(),d=new vj({storage:h,print:i,codecs:s,options:{...e,config:u}});if(bj("starting preload"),await d.preload.start(),bj("starting storage"),d.ipns.startOffline(h),h.isNew&&!t.emptyRepo){const e=await(async e=>{const t=ir({Data:new ot({type:"directory"}).marshal(),Links:[]}),r=await e.block.put(t,{mhtype:"sha2-256",format:"dag-pb"});return await e.pin.add(r),r})(d);if(bj("adding default assets"),await void d.addAll,bj("initializing IPNS keyspace"),null==h.peerId.publicKey)throw qe(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");const t=new ei.TimeoutController(3e4);try{await d.ipns.initializeKeyspace(h.peerId,Xs(`/ipfs/${e}`),{signal:t.signal})}finally{t.clear()}}return!1!==e.start&&(bj("starting node"),await d.start()),d}}}]);
//# sourceMappingURL=vendors-node_modules_ethersproject_contracts_lib_esm_index_js-node_modules_ethersproject_unit-680f1b.40889cac.js.map